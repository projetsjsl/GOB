# Cursor Rules - GOB Dashboard

## ðŸš€ Commandes Slash PersonnalisÃ©es

Quand l'utilisateur tape une de ces commandes, exÃ©cutez l'action correspondante :

### `/start`
Initialiser l'environnement de dÃ©veloppement :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && node scripts/start-dev-setup.js --verbose
```
Puis lire et rÃ©sumer le fichier `.start-context.json` gÃ©nÃ©rÃ©.

### `/pull` ou `/p`
Pull le repo et afficher les changements :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && git pull origin main && git log --oneline -5
```

### `/status` ou `/st`
Afficher l'Ã©tat du projet :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && git status && cat .start-context.json 2>/dev/null | head -30
```

### `/build` ou `/b`
Lancer le build :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && npm run build
```

### `/lint` ou `/l`
VÃ©rifier le linting :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && npm run lint
```

### `/commit "message"` ou `/c "message"`
Commiter les changements :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && git add -A && git commit -m "message"
```

### `/push`
Pousser vers origin :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && git push origin HEAD
```

### `/dev`
DÃ©marrer le serveur de dÃ©veloppement :
```bash
cd /Users/projetsjsl/Documents/GitHub/GOB && npm run dev
```

### `/kill`
Tuer le serveur de dÃ©veloppement :
```bash
kill $(cat /Users/projetsjsl/Documents/GitHub/GOB/.vite.pid 2>/dev/null) 2>/dev/null || kill $(lsof -ti:5173) 2>/dev/null
```

---

## âš ï¸ CRITICAL: Error Prevention

**BEFORE CODING, ALWAYS CONSULT**: `docs/REPERTOIRE_COMPLET_ERREURS.md`

This document contains 32+ documented errors with root causes, solutions, and lessons learned.

### Most Common Errors to Avoid:

1. **Order of Declaration** (40% of errors)
   - âŒ Using variables in `useState` initializers before they're defined
   - âœ… Define all constants/variables BEFORE `useState` if used in initializer

2. **Reference Errors** (35% of errors)
   - âŒ Variables used without `typeof` checks
   - âŒ Components not exposed globally: `window.ComponentName = ComponentName`
   - âœ… Always protect references: `typeof variable !== 'undefined' ? variable : defaultValue`

3. **Z-Index Issues** (12% of errors)
   - âŒ Using `absolute` positioning with parent `overflow`
   - âœ… Use `fixed` positioning + dynamic calculation for dropdowns

4. **Layout Problems** (8% of errors)
   - âŒ `minWidth` too large reducing space for flex children
   - âœ… Use reasonable `minWidth` (80px) + `flex-1` for flexible elements

5. **Environment Variables** (5% of errors)
   - âŒ Using `import.meta.env` in Babel inline
   - âœ… Use multi-method fallback: `window.importMetaEnv` â†’ meta tag â†’ API

### Checklist Before Committing:

- [ ] All variables defined BEFORE use in `useState` initializers
- [ ] All components exposed globally: `window.ComponentName = ComponentName`
- [ ] All references protected: `typeof variable !== 'undefined'`
- [ ] Z-index hierarchy: modals (10000+) > dropdowns (9999) > content (1-100)
- [ ] No duplicate declarations (`useState`, functions)
- [ ] Environment variables have multiple fallback methods
- [ ] Fixed positioning for dropdowns with `overflow` parents
- [ ] CSS theme variables used instead of hardcoded colors

## Key Files Reference

- `CLAUDE.md` - Main project guide
- `docs/REPERTOIRE_COMPLET_ERREURS.md` - **CRITICAL**: Error reference
- `docs/INDEX.md` - Documentation index
- `docs/api/DOCUMENTATION_APIs.md` - API documentation

## Architecture Notes

- Dashboard uses Babel inline (not Vite build) - `import.meta.env` not available
- All components loaded via `<script type="text/babel">` must be exposed: `window.ComponentName = ComponentName`
- Theme system order is critical: `customThemes` â†’ `defaultThemes` â†’ `allThemes`
- Z-index hierarchy: modals (10000+) > dropdowns (9999) > content (1-100) > background (0)

## Code Patterns

### Safe Variable Access
```javascript
const value = typeof variable !== 'undefined' ? variable : defaultValue;
```

### Component Exposure
```javascript
const MyComponent = () => { /* ... */ };
window.MyComponent = MyComponent; // Required for Babel inline
```

### useState with Dependencies
```javascript
// Define dependencies FIRST
const barTypes = [ /* ... */ ];

// Then use in useState
const [config, setConfig] = useState(() => {
    barTypes.forEach(/* ... */); // âœ… barTypes is defined
});
```

### Fixed Positioning for Dropdowns
```javascript
// Calculate position dynamically
const rect = buttonRef.current.getBoundingClientRect();
menuEl.style.left = `${rect.left}px`;
menuEl.style.bottom = `${window.innerHeight - rect.top + 8}px`;
```

See `docs/REPERTOIRE_COMPLET_ERREURS.md` for complete examples and solutions.

