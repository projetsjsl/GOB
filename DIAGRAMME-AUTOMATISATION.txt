🤖 AUTOMATISATION EMMA EN DIRECT - DIAGRAMME DE FLUX

═══════════════════════════════════════════════════════════════════════════════

🕐 HORAIRES AUTOMATIQUES
═══════════════════════════════════════════════════════════════════════════════

8h00 EST  ──→ 🌅 BRIEFING MATINAL
12h00 EST ──→ ☀️ BRIEFING MIDI  
16h30 EST ──→ 🌇 BRIEFING CLÔTURE

═══════════════════════════════════════════════════════════════════════════════

🔄 FLUX COMPLET D'AUTOMATISATION
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   🕐 pg_cron    │───▶│  📡 Vercel API   │───▶│  📧 Resend      │
│   (Supabase)    │    │  (gobapps.com)   │    │   (Email)       │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ send_morning_   │    │ /api/ai-services │    │ Emma En Direct  │
│ briefing_direct │    │ /api/marketdata  │    │ → projetsjsl@   │
│ send_noon_      │    │                  │    │   gmail.com     │
│ briefing_direct │    │                  │    │                 │
│ send_close_     │    │                  │    │                 │
│ briefing_direct │    │                  │    │                 │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ 💾 Supabase     │    │ 📊 Sources API   │    │ 📋 Historique   │
│ (Stockage)      │    │                  │    │ (Dashboard)     │
└─────────────────┘    └──────────────────┘    └─────────────────┘

═══════════════════════════════════════════════════════════════════════════════

📊 SOURCES DE DONNÉES (PAR DÉFAUT)
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📈 DONNÉES DE MARCHÉ (Yahoo Finance)                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ • Prix temps réel (GOOGL, T, BNS, TD, etc.)                                │
│ • Indices (S&P 500, NASDAQ, TSX)                                           │
│ • Devises (EUR/USD, GBP/USD, USD/CAD)                                      │
│ • Commodities (WTI, Or, Cuivre, Argent)                                    │
│ • Volatilité (VIX, MOVE Index)                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📰 ACTUALITÉS (Perplexity)                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ • Nouvelles financières récentes                                            │
│ • Analyses de marché                                                        │
│ • Événements économiques                                                    │
│ • Nouvelles par ticker (26 tickers + Watchlist Dan)                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 🤖 ANALYSE IA (OpenAI GPT-4)                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ • Analyse complète des marchés                                              │
│ • Recommandations d'investissement                                          │
│ • Insights sectoriels                                                       │
│ • Synthèse des données                                                      │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

🏛️ MODULES EXPERT EMMA (ENRICHISSEMENT AUTOMATIQUE)
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 📈 Yield Curves │  │ 💱 Forex Detail │  │ 📊 Volatility   │  │ 🛢️ Commodities  │
│ US/CA Rates     │  │ USD/CAD Pairs   │  │ VIX/MOVE Index  │  │ WTI/Gold/Copper │
└─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 📰 Tickers News │  │ 📅 Earnings     │  │ 💰 Dividends    │
│ 26 Main + Dan   │  │ Calendar        │  │ Calendar        │
└─────────────────┘  └─────────────────┘  └─────────────────┘

═══════════════════════════════════════════════════════════════════════════════

📝 STRUCTURE DU BRIEFING GÉNÉRÉ
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ 🎯 EMMA EN DIRECT · [TYPE] - [DATE]                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📊 RÉSUMÉ EXÉCUTIF                                                          │
│ • État général des marchés                                                  │
│ • Points clés de la session                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📈 DONNÉES DE MARCHÉ                                                        │
│ • Indices principaux (S&P 500, NASDAQ, TSX)                                │
│ • Devises (EUR/USD, GBP/USD, USD/CAD)                                      │
│ • Commodities (WTI, Or, Cuivre, Argent)                                    │
│ • Volatilité (VIX, MOVE Index)                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📰 TOP NOUVELLES - TICKERS SUIVIS                                           │
│ • Top 3-5 nouvelles par ticker (26 tickers principaux)                     │
│ • Nouvelles récentes et impactantes                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📋 WATCHLIST DAN - ANALYSE RAPIDE                                           │
│ • Performance + 1-2 nouvelles clés par ticker                              │
│ • Analyse rapide des positions                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│ 🏛️ MODULES EXPERT EMMA                                                      │
│ • Yield Curves (US/CA)                                                     │
│ • Forex détaillé vs USD/CAD                                                │
│ • Volatilité avancée (VIX, MOVE)                                           │
│ • Commodities (WTI, Or, Cuivre, Argent)                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│ 📅 AGENDA ÉCONOMIQUE                                                        │
│ • Événements du jour                                                        │
│ • Événements de demain                                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│ 💡 RECOMMANDATIONS & INSIGHTS                                               │
│ • Analyse sectorielle                                                       │
│ • Perspectives d'investissement                                             │
│ • Points d'attention                                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ ⚠️ DISCLAIMER BETA                                                          │
│ • Version en développement                                                  │
│ • Vérifier les données                                                      │
│ • Signaler les améliorations                                                │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

🔍 MONITORING & LOGS
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ 📋 Log Complet  │    │ 🔍 Diagnostic   │    │ 📈 Historique   │
│ (Dashboard)     │    │ APIs (Dashboard)│    │ (Dashboard)     │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • Chaque étape  │    │ • Statut APIs   │    │ • Tous briefings│
│ • Prompts       │    │ • Temps réponse │    │ • Statuts       │
│ • Réponses      │    │ • Erreurs       │    │ • Timestamps    │
│ • Erreurs       │    │ • Recommandations│   │ • Actions       │
└─────────────────┘    └─────────────────┘    └─────────────────┘

═══════════════════════════════════════════════════════════════════════════════

🚨 GESTION D'ERREURS
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ 🔄 Retry Auto   │    │ 📧 Fallback     │    │ 📝 Log Erreurs  │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • API échec     │    │ • Données simu  │    │ • Supabase      │
│ • Email échec   │    │ • Contenu alt   │    │ • Dashboard     │
│ • Délai retry   │    │ • Mode démo     │    │ • Détails complets│
└─────────────────┘    └─────────────────┘    └─────────────────┘

═══════════════════════════════════════════════════════════════════════════════

🎯 RÉSUMÉ SIMPLE
═══════════════════════════════════════════════════════════════════════════════

1. 🕐 Supabase déclenche automatiquement 3x/jour
2. 📡 Vercel collecte les données (Yahoo, Perplexity, OpenAI)
3. 🤖 IA génère le briefing complet
4. 📧 Resend envoie l'email
5. 💾 Supabase sauvegarde tout

RÉSULTAT : Briefing Emma En Direct dans votre boîte email 3x/jour ! 🎉

═══════════════════════════════════════════════════════════════════════════════
