<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CurveWatch - Courbes de Taux US & Canada | GOB Dashboard</title>
    <meta name="description" content="Visualisation en temps r√©el des courbes de taux d'int√©r√™t am√©ricaines et canadiennes">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- PropTypes (required for Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts for charts (same as dashboard - MUST load before components) -->
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/dist/Recharts.js"></script>
    <script>
        // Expose Recharts globally (same as dashboard - line 615)
        window.Recharts = window.Recharts || {};
        
        // Wait for Recharts to fully initialize and handle UMD format
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Handle UMD format - check if Recharts is in default export
                if (window.Recharts && window.Recharts.default) {
                    const recharts = window.Recharts.default;
                    // Copy all exports to main object
                    Object.keys(recharts).forEach(key => {
                        if (!window.Recharts[key]) {
                            window.Recharts[key] = recharts[key];
                        }
                    });
                }
                console.log('‚úÖ Recharts initialized in standalone:', {
                    hasRecharts: !!window.Recharts,
                    hasLineChart: !!(window.Recharts && window.Recharts.LineChart),
                    hasResponsiveContainer: !!(window.Recharts && window.Recharts.ResponsiveContainer),
                    keys: window.Recharts ? Object.keys(window.Recharts).slice(0, 10) : []
                });
            }, 500);
        });
    </script>
    
    <!-- V0 Integration Wrapper - Permet d'int√©grer directement les composants v0 -->
    <script src="/js/dashboard/components/v0-integration-wrapper.js"></script>
    
    <!-- Iconoir Icons -->
    <script src="https://unpkg.com/iconoir@latest/html"></script>
    
    <!-- Polyfills for require/module (needed for some components) -->
    <script>
        if (typeof window.require === 'undefined') {
            window.require = function(moduleName) {
                if (moduleName === 'react') return window.React;
                if (moduleName === 'react-dom') return window.ReactDOM;
                if (moduleName === 'prop-types') return window.PropTypes || {};
                if (moduleName === 'react/jsx-runtime' || moduleName === 'react/jsx-dev-runtime') {
                    return {
                        jsx: React.createElement,
                        jsxs: React.createElement,
                        Fragment: React.Fragment
                    };
                }
                return {};
            };
        }
        window.exports = {};
        window.module = { exports: window.exports };
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Dark theme by default */
        [data-theme="dark"] {
            background-color: #0a0a0a;
            color: #e0e0e0;
        }
        
        [data-theme="light"] {
            background-color: #ffffff;
            color: #333333;
        }
    </style>
</head>
<body class="min-h-screen" data-theme="dark">
    <div id="root" class="min-h-screen w-full"></div>

    <!-- CurveWatch Container (pr√©requis - doit √™tre trait√© par Babel car contient du JSX) -->
    <script type="text/babel" src="/js/dashboard/components/CurveWatch/CurveWatchContainer.js"></script>
    
    <!-- CurveWatch Tab Component -->
    <script type="text/babel" src="/js/dashboard/components/tabs/CurveWatchTab.js"></script>

    <!-- Main App Script -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple wrapper app for standalone page
        const CurveWatchStandalone = () => {
            const [isDark, setIsDark] = useState(() => {
                return document.documentElement.getAttribute("data-theme") === "dark";
            });

            useEffect(() => {
                const handleThemeChange = () => {
                    setIsDark(document.documentElement.getAttribute("data-theme") === "dark");
                };
                
                // Listen for theme changes
                window.addEventListener("themeChanged", handleThemeChange);
                return () => window.removeEventListener("themeChanged", handleThemeChange);
            }, []);

            // Wait for CurveWatchTab to be available
            const [componentReady, setComponentReady] = useState(!!window.CurveWatchTab);

            useEffect(() => {
                if (window.CurveWatchTab) {
                    setComponentReady(true);
                    return;
                }

                // Check periodically
                const checkInterval = setInterval(() => {
                    if (window.CurveWatchTab) {
                        setComponentReady(true);
                        clearInterval(checkInterval);
                    }
                }, 100);

                return () => clearInterval(checkInterval);
            }, []);

            if (!componentReady) {
                return (
                    <div className={`flex items-center justify-center min-h-screen ${isDark ? 'bg-gray-900' : 'bg-white'}`}>
                        <div className="text-center">
                            <div className={`animate-spin rounded-full h-12 w-12 border-b-2 ${isDark ? 'border-blue-500' : 'border-blue-600'} mx-auto mb-4`}></div>
                            <p className={isDark ? 'text-gray-400' : 'text-gray-600'}>
                                Chargement de CurveWatch...
                            </p>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen w-full ${isDark ? 'bg-gray-900' : 'bg-white'}`}>
                    {/* Header */}
                    <header className={`${isDark ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border-b px-6 py-4`}>
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>
                                    CurveWatch
                                </h1>
                                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'} mt-1`}>
                                    Courbes de Taux US & Canada en Temps R√©el
                                </p>
                            </div>
                            <div className="flex items-center gap-4">
                                <button
                                    onClick={() => {
                                        const newTheme = isDark ? 'light' : 'dark';
                                        document.documentElement.setAttribute("data-theme", newTheme);
                                        setIsDark(!isDark);
                                        window.dispatchEvent(new CustomEvent('themeChanged'));
                                    }}
                                    className={`px-4 py-2 rounded-lg ${isDark ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-900'}`}
                                >
                                    {isDark ? '‚òÄÔ∏è' : 'üåô'} {isDark ? 'Light' : 'Dark'}
                                </button>
                                <a
                                    href="/beta-combined-dashboard.html?tab=jlab-curvewatch"
                                    className={`px-4 py-2 rounded-lg ${isDark ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'}`}
                                >
                                    ‚Üê Retour Dashboard
                                </a>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="h-[calc(100vh-80px)]">
                        <window.CurveWatchTab isDarkMode={isDark} />
                    </main>
                </div>
            );
        };

        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CurveWatchStandalone />);
    </script>
</body>
</html>
