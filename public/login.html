<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GOB - Connexion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .login-card {
      animation: slideUp 0.5s ease-out;
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .input-group input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
  </style>
</head>
<body>

  <div class="login-card bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">

    <!-- Logo et titre -->
    <div class="text-center mb-8">
      <div class="text-5xl mb-4">üíº</div>
      <h1 class="text-3xl font-bold text-gray-800 mb-2">GOB Dashboard</h1>
      <p class="text-gray-600">Groupe Ouellet Bolduc Financial Platform</p>
    </div>

    <!-- Formulaire de connexion -->
    <form id="login-form" class="space-y-6">

      <!-- Nom d'utilisateur -->
      <div class="input-group">
        <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
          Nom d'utilisateur
        </label>
        <input
          type="text"
          id="username"
          name="username"
          required
          autocomplete="username"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all"
          placeholder="Entrez votre nom d'utilisateur"
        />
      </div>

      <!-- Mot de passe -->
      <div class="input-group">
        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
          Mot de passe
        </label>
        <input
          type="password"
          id="password"
          name="password"
          required
          autocomplete="current-password"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none transition-all"
          placeholder="Entrez votre mot de passe"
        />
      </div>

      <!-- Message d'erreur -->
      <div id="error-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
      </div>

      <!-- Message de succ√®s -->
      <div id="success-message" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm">
      </div>

      <!-- Bouton de connexion -->
      <button
        type="submit"
        id="login-btn"
        class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all transform hover:scale-[1.02] active:scale-[0.98]"
      >
        Se connecter
      </button>

    </form>

    <!-- Aide -->
    <div class="mt-6 text-center">
      <p class="text-sm text-gray-500">
        Utilisateurs disponibles:
      </p>
      <div class="mt-2 flex flex-wrap justify-center gap-2 text-xs">
        <span class="px-2 py-1 bg-gray-100 rounded">Invite</span>
        <span class="px-2 py-1 bg-gray-100 rounded">Client</span>
        <span class="px-2 py-1 bg-blue-100 rounded">Daniel</span>
        <span class="px-2 py-1 bg-blue-100 rounded">GOB</span>
        <span class="px-2 py-1 bg-purple-100 rounded">Admin</span>
      </div>
      <p class="text-xs text-gray-400 mt-2">
        üí° Astuce: Mot de passe = nom d'utilisateur
      </p>
    </div>

  </div>

  <script>
    const loginForm = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');

    // V√©rifier si d√©j√† connect√©
    window.addEventListener('DOMContentLoaded', () => {
      const currentUser = sessionStorage.getItem('gob-user');
      if (currentUser) {
        // D√©j√† connect√©, rediriger
        window.location.href = '/beta-combined-dashboard.html';
      }
    });

    // Gestion de la soumission du formulaire
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      if (!username || !password) {
        showError('Veuillez remplir tous les champs');
        return;
      }

      // D√©sactiver le bouton pendant la requ√™te
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Connexion...';
      hideMessages();

      try {
        // Appel API d'authentification
        const response = await fetch('/api/auth', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'login',
            username,
            password
          })
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
          throw new Error(data.error || '√âchec de connexion');
        }

        // Succ√®s - Stocker les infos utilisateur
        sessionStorage.setItem('gob-user', JSON.stringify({
          username: data.user.username,
          role: data.user.role,
          display_name: data.user.display_name,
          permissions: data.user.permissions
        }));

        // Message de succ√®s
        showSuccess(`Bienvenue ${data.user.display_name}! Redirection...`);

        // Redirection apr√®s 1 seconde
        setTimeout(() => {
          window.location.href = '/beta-combined-dashboard.html';
        }, 1000);

      } catch (error) {
        console.error('Erreur de connexion:', error);
        showError(error.message || 'Erreur de connexion. V√©rifiez vos identifiants.');

        // R√©activer le bouton
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'Se connecter';
      }
    });

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove('hidden');
      successMessage.classList.add('hidden');
    }

    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.classList.remove('hidden');
      errorMessage.classList.add('hidden');
    }

    function hideMessages() {
      errorMessage.classList.add('hidden');
      successMessage.classList.add('hidden');
    }

    // Permettre Entr√©e pour soumettre
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loginForm.dispatchEvent(new Event('submit'));
      }
    });
  </script>

</body>
</html>
