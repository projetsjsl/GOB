<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOB Apps - Dashboard Financier Beta ‚Ä¢ Propuls√© par JSL AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            font-family: 'Inter', 'Roboto', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .stock-card {
            transition: all 0.3s ease;
        }
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .seeking-alpha-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        }
        .stocks-news-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const BetaCombinedDashboard = () => {
            // √âtats principaux
            const [activeTab, setActiveTab] = useState('seeking-alpha');
            const [tickers, setTickers] = useState(['CVS', 'MSFT']);
            const [stockData, setStockData] = useState({});
            const [newsData, setNewsData] = useState([]);
            const [seekingAlphaData, setSeekingAlphaData] = useState({});
            const [seekingAlphaStockData, setSeekingAlphaStockData] = useState({});
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState(null);
            const [selectedStock, setSelectedStock] = useState(null);
            const [newTicker, setNewTicker] = useState('');
            const [showTickerManager, setShowTickerManager] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [apiStatus, setApiStatus] = useState({});
            const [viewMode, setViewMode] = useState('cards');
            const [seekingAlphaViewMode, setSeekingAlphaViewMode] = useState('cards');
            
            // √âtats pour l'interface Seeking Alpha
            const [githubToken, setGithubToken] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [showScraperPopup, setShowScraperPopup] = useState(false);

            // Configuration API
            const API_BASE_URL = window.location.origin;
            
            // Configuration GitHub
            const GITHUB_REPO = 'projetsjsl/GOB';
            const GITHUB_BRANCH = 'main';
            
            // Fonction pour nettoyer l'encodage des caract√®res
            const cleanText = (text) => {
                if (!text) return '';
                return text
                    .replace(/√É¬©/g, '√©')
                    .replace(/√É¬®/g, '√®')
                    .replace(/√É /g, '√†')
                    .replace(/√É¬ß/g, '√ß')
                    .replace(/√É¬¥/g, '√¥')
                    .replace(/√É¬¢/g, '√¢')
                    .replace(/√É¬Æ/g, '√Æ')
                    .replace(/√É¬Ø/g, '√Ø')
                    .replace(/√É¬π/g, '√π')
                    .replace(/√É¬ª/g, '√ª')
                    .replace(/√É¬´/g, '√´')
                    .replace(/√É¬§/g, '√§')
                    .replace(/√É¬∂/g, '√∂')
                    .replace(/√É¬º/g, '√º')
                    .replace(/√¢‚Ç¨‚Ñ¢/g, "'")
                    .replace(/√¢‚Ç¨≈ì/g, '"')
                    .replace(/√¢‚Ç¨/g, '"')
                    .replace(/√¢‚Ç¨"/g, '‚Äì')
                    .replace(/√¢‚Ç¨"/g, '‚Äî');
            };

            // Messages
            const showMessage = (text, type = 'info') => {
                setMessage({ text, type });
                setTimeout(() => setMessage(null), 5000);
            };

            // Donn√©es Finnhub
            const fetchStockData = async (ticker) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/finnhub?endpoint=quote&symbol=${ticker}`);
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error('Erreur fetch stock data:', error);
                    return null;
                }
            };

            const refreshAllStocks = async () => {
                console.log('üîÑ Actualisation des donn√©es stocks...');
                setLoading(true);
                const newStockData = {};
                let successCount = 0;
                let errorCount = 0;
                
                for (const ticker of tickers) {
                    console.log(`üìä R√©cup√©ration des donn√©es pour ${ticker}...`);
                    try {
                        const data = await fetchStockData(ticker);
                        if (data && !data.message) {
                            newStockData[ticker] = {
                                ...data,
                                timestamp: new Date().toISOString()
                            };
                            successCount++;
                            console.log(`‚úÖ ${ticker}: Donn√©es r√©cup√©r√©es`, data);
                        } else {
                            console.log(`‚ö†Ô∏è ${ticker}: Pas de donn√©es ou erreur API`, data);
                            errorCount++;
                        }
                    } catch (error) {
                        console.error(`‚ùå ${ticker}: Erreur`, error);
                        errorCount++;
                    }
                }
                
                setStockData(newStockData);
                setLastUpdate(new Date());
                setLoading(false);
                
                const message = `Donn√©es mises √† jour: ${successCount} succ√®s, ${errorCount} erreurs`;
                console.log(message);
                showMessage(message, successCount > 0 ? 'success' : 'warning');
            };

            // Actualit√©s NewsAPI.ai
            const fetchNews = async () => {
                console.log('üì∞ R√©cup√©ration des actualit√©s...');
                try {
                    const tickersQuery = tickers.join(' OR ');
                    console.log(`üîç Recherche pour: ${tickersQuery}`);
                    
                    const response = await fetch(`${API_BASE_URL}/api/news?q=${encodeURIComponent(tickersQuery)}&limit=20`);
                    console.log(`üì° R√©ponse API News: ${response.status}`);
                    
                    if (!response.ok) throw new Error(`News API error: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('üìä Donn√©es news re√ßues:', data);
                    
                    setNewsData(data.articles || []);
                    
                    if (data.source === 'demo') {
                        showMessage('Actualit√©s de d√©monstration - Configurez NEWSAPI_KEY pour des actualit√©s r√©elles', 'info');
                    } else {
                        showMessage(`${data.articles?.length || 0} actualit√©s charg√©es`, 'success');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur fetch news:', error);
                    showMessage('Erreur chargement actualit√©s', 'error');
                    
                    const fallbackNews = [
                        {
                            title: "Actualit√©s financi√®res non disponibles",
                            description: "Impossible de charger les actualit√©s. V√©rifiez la configuration de l'API NewsAPI.",
                            url: "#",
                            publishedAt: new Date().toISOString(),
                            source: { name: "Syst√®me" }
                        }
                    ];
                    setNewsData(fallbackNews);
                }
            };

            // Fonction pour obtenir la couleur des grades Quant
            const getGradeColor = (grade) => {
                if (!grade) return 'bg-gray-100 text-gray-600';
                const letter = grade.charAt(0);
                if (letter === 'A') return 'bg-green-100 text-green-700';
                if (letter === 'B') return 'bg-blue-100 text-blue-700';
                if (letter === 'C') return 'bg-yellow-100 text-yellow-700';
                if (letter === 'D') return 'bg-orange-100 text-orange-700';
                if (letter === 'F') return 'bg-red-100 text-red-700';
                return 'bg-gray-100 text-gray-600';
            };

            // Donn√©es Seeking Alpha
            const fetchSeekingAlphaData = async () => {
                try {
                    const response = await fetch('/seeking-alpha/stock_analysis.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaData(data);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha:', error);
                }
            };

            const fetchSeekingAlphaStockData = async () => {
                try {
                    const response = await fetch('/seeking-alpha/stock_data.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaStockData(data);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha stock data:', error);
                }
            };

            // Monitoring Admin
            const checkApiStatus = async () => {
                const status = {
                    finnhub: { status: 'checking', responseTime: 0, error: null },
                    newsapi: { status: 'checking', responseTime: 0, error: null },
                    seekingAlpha: { status: 'checking', responseTime: 0, error: null }
                };

                // Test Finnhub API
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/finnhub?endpoint=quote&symbol=AAPL`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.finnhub = {
                            status: data.message ? 'warning' : 'success',
                            responseTime,
                            error: data.message || null
                        };
                    } else {
                        status.finnhub = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.finnhub = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test NewsAPI
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/news?q=finance&limit=5`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.newsapi = { status: 'success', responseTime, error: null };
                    } else {
                        status.newsapi = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.newsapi = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Seeking Alpha
                try {
                    const startTime = Date.now();
                    const response = await fetch('/seeking-alpha/stock_analysis.json');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.seekingAlpha = { status: 'success', responseTime, error: null };
                    } else {
                        status.seekingAlpha = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.seekingAlpha = { status: 'error', responseTime: 0, error: error.message };
                }

                setApiStatus(status);
            };

            // Initialisation
            useEffect(() => {
                console.log('üöÄ Initialisation du dashboard...');
                
                const loadAllData = async () => {
                    console.log('üìä Chargement des donn√©es...');
                    try {
                        await Promise.all([
                            fetchSeekingAlphaData(),
                            fetchSeekingAlphaStockData(),
                            refreshAllStocks(),
                            fetchNews(),
                            checkApiStatus()
                        ]);
                        console.log('‚úÖ Toutes les donn√©es charg√©es');
                    } catch (error) {
                        console.error('‚ùå Erreur lors du chargement:', error);
                    }
                };
                
                loadAllData();
                
                const interval = setInterval(() => {
                    console.log('üîÑ Auto-refresh des donn√©es...');
                    refreshAllStocks();
                    fetchNews();
                    fetchSeekingAlphaData();
                    fetchSeekingAlphaStockData();
                }, 300000);
                
                return () => clearInterval(interval);
            }, []);

            // Composant onglet Seeking Alpha
            const SeekingAlphaTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üìà Analyses Seeking Alpha</h2>
                        <div className="flex gap-2">
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                            >
                                Actualiser News
                            </button>
                        </div>
                    </div>

                    {/* Tableau de donn√©es financi√®res avec actualit√©s */}
                    <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-blue-300/20">
                        <h3 className="text-lg font-semibold text-white mb-4">üìä Donn√©es Financi√®res & Actualit√©s</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="border-b border-blue-300/20">
                                        <th className="text-left py-2 text-blue-200">Ticker</th>
                                        <th className="text-left py-2 text-blue-200">Prix</th>
                                        <th className="text-left py-2 text-blue-200">Change</th>
                                        <th className="text-left py-2 text-blue-200">P/E</th>
                                        <th className="text-left py-2 text-blue-200">Dividende</th>
                                        <th className="text-left py-2 text-blue-200">Secteur</th>
                                        <th className="text-left py-2 text-blue-200">Sentiment</th>
                                        <th className="text-left py-2 text-blue-200">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {tickers.map(ticker => {
                                        const stockDataItem = stockData[ticker];
                                        const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                        const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                        const parsedData = seekingAlphaItem?.parsedData;
                                        
                                        // Priorit√©: Claude > Parsed > Finnhub
                                        const price = claudeData?.metrics?.price || parsedData?.price || `$${stockDataItem?.c?.toFixed(2) || 'N/A'}`;
                                        const change = claudeData?.metrics?.priceChange || parsedData?.change || (stockDataItem?.dp >= 0 ? '+' : '') + (stockDataItem?.dp?.toFixed(2) || '0') + '%';
                                        const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                        const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                        const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                        
                                        const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                        
                                        // Trouver la nouvelle la plus r√©cente pour ce ticker
                                        const latestNews = newsData.find(article => {
                                            const text = (article.title + ' ' + article.description).toLowerCase();
                                            return text.includes(ticker.toLowerCase());
                                        });
                                        
                                        // Analyser le sentiment
                                        const analyzeSentiment = (title, description) => {
                                            if (!title && !description) return { sentiment: 'Neutre', color: 'text-gray-400', icon: 'üòê' };
                                            
                                            const text = (title + ' ' + description).toLowerCase();
                                            const positiveWords = ['strong', 'growth', 'increase', 'rise', 'gain', 'positive', 'beat', 'exceed', 'surge', 'rally', 'boost', 'fort', 'croissance', 'hausse', 'gain', 'positif', 'd√©passer'];
                                            const negativeWords = ['decline', 'fall', 'drop', 'loss', 'negative', 'miss', 'weak', 'concern', 'risk', 'challenge', 'baisse', 'chute', 'perte', 'n√©gatif', 'manquer', 'faible', 'pr√©occupation', 'risque'];
                                            
                                            const positiveCount = positiveWords.filter(word => text.includes(word)).length;
                                            const negativeCount = negativeWords.filter(word => text.includes(word)).length;
                                            
                                            if (positiveCount > negativeCount) {
                                                return { sentiment: 'Positif', color: 'text-green-400', icon: 'üìà' };
                                            } else if (negativeCount > positiveCount) {
                                                return { sentiment: 'N√©gatif', color: 'text-red-400', icon: 'üìâ' };
                                            } else {
                                                return { sentiment: 'Neutre', color: 'text-gray-400', icon: 'üòê' };
                                            }
                                        };
                                        
                                        const sentiment = latestNews ? analyzeSentiment(latestNews.title, latestNews.description) : { sentiment: 'N/A', color: 'text-gray-400', icon: '‚ùì' };
                                        
                                        return (
                                            <React.Fragment key={ticker}>
                                                {/* Ligne principale avec donn√©es financi√®res */}
                                                <tr className="border-b border-blue-300/10 hover:bg-blue-900/20 cursor-pointer"
                                                    onClick={() => setSelectedStock(ticker)}>
                                                    <td className="py-2 font-mono text-white font-bold">{ticker}</td>
                                                    <td className="py-2 text-white">{price}</td>
                                                    <td className={`py-2 ${changeColor}`}>{change}</td>
                                                    <td className="py-2 text-white">{peRatio}</td>
                                                    <td className="py-2 text-white">{dividendYield}</td>
                                                    <td className="py-2 text-white text-xs">{cleanText(sector)}</td>
                                                    <td className="py-2">
                                                        <div className="flex items-center gap-1">
                                                            <span className="text-sm">{sentiment.icon}</span>
                                                            <span className={`text-xs ${sentiment.color}`}>{sentiment.sentiment}</span>
                                                        </div>
                                                    </td>
                                                    <td className="py-2">
                                                        <button className="text-blue-300 hover:text-blue-200 text-xs">
                                                            Voir fiche ‚Üí
                                                        </button>
                                                    </td>
                                                </tr>
                                                
                                                {/* Ligne avec actualit√© r√©cente */}
                                                {latestNews && (
                                                    <tr className="border-b border-blue-300/5 hover:bg-blue-900/10">
                                                        <td className="py-1"></td>
                                                        <td colSpan="7" className="py-1">
                                                            <div className="bg-blue-900/20 rounded p-2 text-xs">
                                                                <div className="flex items-start gap-2">
                                                                    <span className="text-blue-300">üì∞</span>
                                                                    <div className="flex-1">
                                                                        <div className="text-blue-200 font-medium mb-1">
                                                                            {cleanText(latestNews.title)}
                                                                        </div>
                                                                        <div className="text-blue-300/80 line-clamp-2">
                                                                            {cleanText(latestNews.description)}
                                                                        </div>
                                                                        <div className="flex items-center gap-2 mt-1 text-blue-400/60">
                                                                            <span>{latestNews.source?.name || 'Source inconnue'}</span>
                                                                            <span>‚Ä¢</span>
                                                                            <span>
                                                                                {latestNews.publishedAt ? 
                                                                                    new Date(latestNews.publishedAt).toLocaleString('fr-FR') : 
                                                                                    'Date inconnue'
                                                                                }
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                )}
                                            </React.Fragment>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );

            // Composant onglet Stocks & News
            const StocksNewsTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-white">üìä Stocks & News</h2>
                        <div className="flex gap-2">
                            <div className="flex bg-slate-700 rounded-lg p-1">
                                <button
                                    onClick={() => setViewMode('list')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'list' 
                                            ? 'bg-blue-600 text-white' 
                                            : 'text-gray-300 hover:text-white'
                                    }`}
                                >
                                    üìã Liste
                                </button>
                                <button
                                    onClick={() => setViewMode('cards')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'cards' 
                                            ? 'bg-blue-600 text-white' 
                                            : 'text-gray-300 hover:text-white'
                                    }`}
                                >
                                    üé¥ Cartes
                                </button>
                            </div>
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                            >
                                Actualiser News
                            </button>
                        </div>
                    </div>

                    {lastUpdate && (
                        <p className="text-gray-400 text-sm">
                            Derni√®re mise √† jour: {new Date(lastUpdate).toLocaleString('fr-FR')}
                        </p>
                    )}

                    {/* Debug des donn√©es */}
                    <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                        <h3 className="text-lg font-semibold text-white mb-4">üîç Debug des Donn√©es</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div className="bg-slate-700 rounded p-3">
                                <div className="text-blue-300 font-medium mb-2">üìä Stock Data</div>
                                <div className="text-white">
                                    Tickers: {tickers.length} ({tickers.join(', ')})
                                </div>
                                <div className="text-white">
                                    Donn√©es charg√©es: {Object.keys(stockData).length}
                                </div>
                                <div className="text-white">
                                    Derni√®re MAJ: {lastUpdate ? new Date(lastUpdate).toLocaleString('fr-FR') : 'Jamais'}
                                </div>
                            </div>
                            <div className="bg-slate-700 rounded p-3">
                                <div className="text-green-300 font-medium mb-2">üì∞ News Data</div>
                                <div className="text-white">
                                    Articles: {newsData.length}
                                </div>
                                <div className="text-white">
                                    Premier article: {newsData[0]?.title?.substring(0, 30) || 'Aucun'}...
                                </div>
                            </div>
                            <div className="bg-slate-700 rounded p-3">
                                <div className="text-purple-300 font-medium mb-2">üéØ Seeking Alpha</div>
                                <div className="text-white">
                                    Stocks: {seekingAlphaData.stocks?.length || 0}
                                </div>
                                <div className="text-white">
                                    Stock Data: {Object.keys(seekingAlphaStockData.stocks || {}).length}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Vue en liste compacte */}
                    {viewMode === 'list' && tickers.length > 0 && (
                        <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                            <h3 className="text-lg font-semibold text-white mb-4">üìã Vue Liste</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b border-slate-600">
                                            <th className="text-left py-2 text-slate-300">Ticker</th>
                                            <th className="text-left py-2 text-slate-300">Prix</th>
                                            <th className="text-left py-2 text-slate-300">Change</th>
                                            <th className="text-left py-2 text-slate-300">P/E</th>
                                            <th className="text-left py-2 text-slate-300">Dividende</th>
                                            <th className="text-left py-2 text-slate-300">Secteur</th>
                                            <th className="text-left py-2 text-slate-300">Rating</th>
                                            <th className="text-left py-2 text-slate-300">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {tickers.map(ticker => {
                                            const data = stockData[ticker];
                                            const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                            const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            const parsedData = seekingAlphaItem?.parsedData;
                                            
                                            if (!data && !claudeData && !parsedData) return null;

                                            // Priorit√©: Claude > Parsed > Finnhub
                                            const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                            const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                            const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                            const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                            const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                            const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                            
                                            const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                            
                                            return (
                                                <tr key={ticker} className="border-b border-slate-700 hover:bg-slate-700/50 cursor-pointer"
                                                    onClick={() => setSelectedStock(ticker)}>
                                                    <td className="py-3 font-mono text-white font-bold">{ticker}</td>
                                                    <td className="py-3 text-white">{price}</td>
                                                    <td className={`py-3 ${changeColor}`}>{change}</td>
                                                    <td className="py-3 text-white">{peRatio}</td>
                                                    <td className="py-3 text-white">{dividendYield}</td>
                                                    <td className="py-3 text-white text-xs">{cleanText(sector)}</td>
                                                    <td className="py-3">
                                                        <span className="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold">
                                                            {rating}
                                                        </span>
                                                    </td>
                                                    <td className="py-3">
                                                        <button className="text-blue-300 hover:text-blue-200 text-xs">
                                                            Voir fiche ‚Üí
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                    {/* Cartes condens√©es */}
                    {viewMode === 'cards' && tickers.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {tickers.map(ticker => {
                                const data = stockData[ticker];
                                const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (!data && !claudeData && !parsedData) return null;

                                // Priorit√©: Claude > Parsed > Finnhub
                                const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                const marketCap = claudeData?.metrics?.marketCap || parsedData?.marketCap || 'N/A';
                                const companyName = claudeData?.companyName || parsedData?.companyName || 'N/A';
                                const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                
                                const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                const changeBgColor = (change.includes('+') || change.includes('green')) ? 'bg-green-500' : 'bg-red-500';

                                return (
                                    <div key={ticker} className="bg-slate-800 rounded-lg p-6 border border-slate-700 hover:border-blue-300/40 transition-all cursor-pointer"
                                         onClick={() => setSelectedStock(ticker)}>
                                        
                                        {/* Header avec ticker et rating */}
                                        <div className="flex justify-between items-start mb-6">
                                            <div>
                                                <h3 className="text-2xl font-bold text-white">{ticker}</h3>
                                                <p className="text-sm text-slate-400">
                                                    {cleanText(companyName)}
                                                </p>
                                            </div>
                                            <div className="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-sm">
                                                {rating}
                                            </div>
                                        </div>

                                        {/* Prix et changement */}
                                        <div className="bg-slate-700 rounded-lg p-4 mb-6">
                                            <div className="text-3xl font-bold text-white mb-1">
                                                {price}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className={`w-4 h-4 ${changeBgColor} rounded`}></div>
                                                <span className={`text-sm font-medium ${changeColor}`}>
                                                    {change}
                                                </span>
                                            </div>
                                        </div>

                                        {/* M√©triques cl√©s */}
                                        <div className="space-y-3 mb-6">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Market Cap</span>
                                                <span className="text-white font-medium">{marketCap}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">P/E Ratio</span>
                                                <span className="text-white font-medium">{peRatio}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Dividend</span>
                                                <span className="text-white font-medium">{dividendYield}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Secteur</span>
                                                <span className="text-white font-medium">{cleanText(sector)}</span>
                                            </div>
                                        </div>

                                        {/* Quant Ratings */}
                                        {claudeData?.quantRating && (
                                            <div className="mb-6">
                                                <div className="border-t border-slate-600 pt-4">
                                                    <h4 className="text-center text-slate-300 text-sm font-medium mb-4">QUANT RATINGS</h4>
                                                    <div className="flex justify-center gap-3">
                                                        {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                            if (!value || key === 'overall') return null;
                                                            const shortKey = key.substring(0, 3);
                                                            return (
                                                                <div key={key} className="text-center">
                                                                    <div className="text-xs text-slate-400 mb-1">{shortKey}</div>
                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getGradeColor(value)}`}>
                                                                        {value}
                                                                    </span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Call to action */}
                                        <div className="text-center">
                                            <div className="flex items-center justify-center gap-2 text-slate-400 text-sm">
                                                <span>üëÜ</span>
                                                <span>Cliquez pour le rapport d√©taill√©</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Message si aucune donn√©e */}
                    {tickers.length === 0 && (
                        <div className="bg-yellow-900/20 backdrop-blur-sm rounded-lg p-6 border border-yellow-300/20">
                            <div className="flex items-center gap-3">
                                <span className="text-yellow-400 text-2xl">‚ö†Ô∏è</span>
                                <div>
                                    <h3 className="text-yellow-200 font-semibold">Aucun ticker configur√©</h3>
                                    <p className="text-yellow-300/80 text-sm mt-1">
                                        Ajoutez des tickers dans l'onglet Seeking Alpha pour voir les donn√©es ici.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );

            // Composant Admin
            const AdminPanel = () => (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 w-96 max-w-full mx-4">
                        <h3 className="text-lg font-bold mb-4">Panel d'Administration</h3>
                        
                        <div className="space-y-3">
                            {Object.entries(apiStatus).map(([api, status]) => (
                                <div key={api} className="flex items-center justify-between p-2 bg-gray-100 rounded">
                                    <span className="font-mono capitalize">{api}</span>
                                    <div className="flex items-center gap-2">
                                        <span className={`w-3 h-3 rounded-full ${
                                            status.status === 'success' ? 'bg-green-500' :
                                            status.status === 'warning' ? 'bg-yellow-500' :
                                            status.status === 'error' ? 'bg-red-500' : 'bg-gray-500'
                                        }`}></span>
                                        <span className="text-sm">
                                            {status.responseTime}ms
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="flex gap-2 mt-4">
                            <button
                                onClick={checkApiStatus}
                                className="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                            >
                                V√©rifier
                            </button>
                            <button
                                onClick={() => setShowAdmin(false)}
                                className="flex-1 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                            >
                                Fermer
                            </button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-purple-800 to-blue-800 p-6">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center space-x-4">
                                <div className="bg-white/20 backdrop-blur-md rounded-2xl p-3 shadow-xl border border-white/30">
                                    <img 
                                        src="/logojslaidark.jpg" 
                                        alt="JSL AI Logo" 
                                        className="w-8 h-8 object-contain"
                                    />
                                </div>
                                <div>
                                    <h1 className="text-3xl font-bold text-white mb-2 font-['Inter']">
                                        GOB Apps - Dashboard Financier Beta
                                    </h1>
                                    <p className="text-purple-200 font-['Inter']">
                                        Plateforme financi√®re ‚Ä¢ Seeking Alpha + Stocks & News ‚Ä¢ Propuls√©e par JSL AI
                                    </p>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navigation par onglets */}
                    <nav className="bg-white/10 backdrop-blur-sm border-b border-white/20">
                        <div className="max-w-7xl mx-auto px-6">
                            <div className="flex space-x-1">
                                {[
                                    { id: 'seeking-alpha', label: 'üìà Seeking Alpha', component: SeekingAlphaTab },
                                    { id: 'stocks-news', label: 'üìä Stocks & News', component: StocksNewsTab }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`tab-button px-6 py-3 rounded-t-lg font-medium transition-all ${
                                            activeTab === tab.id 
                                                ? 'active' 
                                                : 'text-gray-300 hover:text-white hover:bg-white/10'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                                <button
                                    onClick={() => setShowAdmin(true)}
                                    className="ml-auto px-4 py-2 text-gray-300 hover:text-white hover:bg-white/10 rounded"
                                >
                                    ‚öôÔ∏è Admin
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* Contenu principal */}
                    <main className="max-w-7xl mx-auto p-6">
                        {activeTab === 'seeking-alpha' && <SeekingAlphaTab />}
                        {activeTab === 'stocks-news' && <StocksNewsTab />}
                    </main>

                    {/* Messages */}
                    {message && (
                        <div className={`fixed top-4 right-4 p-4 rounded-lg z-50 ${
                            message.type === 'error' ? 'bg-red-500' : 
                            message.type === 'success' ? 'bg-green-500' : 'bg-blue-500'
                        } text-white`}>
                            {message.text}
                        </div>
                    )}

                    {/* Panel Admin */}
                    {showAdmin && <AdminPanel />}
                </div>
            );
        };

        ReactDOM.render(<BetaCombinedDashboard />, document.getElementById('root'));
    </script>
</body>
</html>