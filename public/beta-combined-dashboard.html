<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOB Apps - Dashboard Financier Beta ‚Ä¢ Propuls√© par JSL AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Styles Emma -->
    <link rel="stylesheet" href="emma-styles.css">
    <style>
        * {
            font-family: 'Inter', 'Roboto', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { 
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .stock-card {
            transition: all 0.3s ease;
        }
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .seeking-alpha-card {
            background: linear-gradient(135deg, #1f1f1f 0%, #2d2d2d 100%);
        }
        .stocks-news-card {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        /* Scrollbar personnalis√©e */
        .scrollbar-thin {
            scrollbar-width: thin;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        
        /* Dark mode scrollbar */
        .dark .scrollbar-thin::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Masquer la scrollbar pour les onglets mobiles */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* Emp√™cher le d√©bordement horizontal */
        body, html {
            overflow-x: hidden;
        }
        
        .min-h-screen {
            min-width: 0;
        }

        /* Optimisations Mobile iPhone Portrait */
        @media (max-width: 768px) {
            /* R√©duire les polices pour mobile */
            .text-3xl { font-size: 1.5rem !important; }
            .text-2xl { font-size: 1.25rem !important; }
            .text-xl { font-size: 1.125rem !important; }
            .text-lg { font-size: 1rem !important; }
            
            /* Ajuster les espacements */
            .p-6 { padding: 1rem !important; }
            .px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
            .py-3 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }
            
            /* Optimiser les grilles pour mobile */
            .grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)) !important; }
            .grid-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)) !important; }
            .grid-cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
            
            /* R√©duire les largeurs maximales */
            .max-w-7xl { max-width: 100% !important; }
            .max-w-xs { max-width: 100% !important; }
            .max-w-md { max-width: 100% !important; }
            
            /* Ajuster les onglets pour mobile */
            .tab-button {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.875rem !important;
            }
            
            /* Optimiser les cartes de stocks */
            .stock-card {
                margin-bottom: 0.75rem !important;
            }
            
            /* R√©duire les hauteurs fixes */
            .h-[500px] { height: 300px !important; }
            .h-64 { height: 12rem !important; }
            .h-48 { height: 10rem !important; }
            
            /* Ajuster les boutons */
            .px-4 { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
            .px-6 { padding-left: 1rem !important; padding-right: 1rem !important; }
            
            /* Optimiser les inputs */
            input, textarea {
                font-size: 16px !important; /* √âvite le zoom sur iOS */
                -webkit-text-size-adjust: 100%;
                text-size-adjust: 100%;
            }
            
            /* R√©duire les gaps */
            .gap-6 { gap: 1rem !important; }
            .gap-4 { gap: 0.75rem !important; }
            .space-x-1 > * + * { margin-left: 0.25rem !important; }
        }

        /* Optimisations sp√©cifiques iPhone Portrait */
        @media (max-width: 414px) and (orientation: portrait) {
            /* Polices encore plus petites pour iPhone */
            .text-3xl { font-size: 1.25rem !important; }
            .text-2xl { font-size: 1.125rem !important; }
            .text-xl { font-size: 1rem !important; }
            
            /* R√©duire les espacements */
            .p-6 { padding: 0.75rem !important; }
            .px-6 { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }
            
            /* Onglets plus compacts */
            .tab-button {
                padding: 0.375rem 0.5rem !important;
                font-size: 0.75rem !important;
            }
            
            /* Grilles en une colonne */
            .grid-cols-2, .grid-cols-3, .grid-cols-4 { 
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important; 
            }
            
            /* R√©duire les hauteurs */
            .h-[500px] { height: 250px !important; }
            .h-64 { height: 10rem !important; }
            .h-48 { height: 8rem !important; }
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .news-card {
            transition: all 0.3s ease;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const BetaCombinedDashboard = () => {
            // √âtats principaux
            const [activeTab, setActiveTab] = useState('stocks-news');
            const [tickers, setTickers] = useState(['GOOGL', 'T', 'BNS', 'TD', 'BCE', 'CNR', 'CSCO', 'CVS', 'DEO', 'MDT', 'JNJ', 'JPM', 'LVMHF', 'MG', 'MFC', 'MU', 'NSRGY', 'NKE', 'NTR', 'PFE', 'TRP', 'UNH', 'UL', 'VZ', 'WFC']);
            const [stockData, setStockData] = useState({});
            const [newsData, setNewsData] = useState([]);
            const [seekingAlphaData, setSeekingAlphaData] = useState({});
            const [seekingAlphaStockData, setSeekingAlphaStockData] = useState({});
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState(null);
            const [selectedStock, setSelectedStock] = useState(null);
            const [newTicker, setNewTicker] = useState('');
            const [showTickerManager, setShowTickerManager] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [apiStatus, setApiStatus] = useState({});
            const [viewMode, setViewMode] = useState('cards');
            const [seekingAlphaViewMode, setSeekingAlphaViewMode] = useState('cards');
            const [newsFilter, setNewsFilter] = useState('all'); // Filtre pour les actualit√©s
            const [filteredNews, setFilteredNews] = useState([]); // Actualit√©s filtr√©es
            
            // √âtats pour l'interface Seeking Alpha
            const [githubToken, setGithubToken] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [newTicker, setNewTicker] = useState('');
            const [showScraperPopup, setShowScraperPopup] = useState(false);
            
            // √âtats pour le scraping
            const [scrapingStatus, setScrapingStatus] = useState('idle'); // 'idle', 'running', 'completed', 'error'
            const [scrapingProgress, setScrapingProgress] = useState(0);
            const [scrapingLogs, setScrapingLogs] = useState([]);
            
            // √âtat pour le th√®me
            const [isDarkMode, setIsDarkMode] = useState(true);

            // Configuration API
            const API_BASE_URL = window.location.origin;
            
            // Configuration GitHub
            const GITHUB_REPO = 'projetsjsl/GOB';
            const GITHUB_BRANCH = 'main';
            
            // Fonction pour nettoyer l'encodage des caract√®res
            const cleanText = (text) => {
                if (!text) return '';
                return text
                    .replace(/√É¬©/g, '√©')
                    .replace(/√É¬®/g, '√®')
                    .replace(/√É /g, '√†')
                    .replace(/√É¬ß/g, '√ß')
                    .replace(/√É¬¥/g, '√¥')
                    .replace(/√É¬¢/g, '√¢')
                    .replace(/√É¬Æ/g, '√Æ')
                    .replace(/√É¬Ø/g, '√Ø')
                    .replace(/√É¬π/g, '√π')
                    .replace(/√É¬ª/g, '√ª')
                    .replace(/√É¬´/g, '√´')
                    .replace(/√É¬§/g, '√§')
                    .replace(/√É¬∂/g, '√∂')
                    .replace(/√É¬º/g, '√º')
                    .replace(/√¢‚Ç¨‚Ñ¢/g, "'")
                    .replace(/√¢‚Ç¨≈ì/g, '"')
                    .replace(/√¢‚Ç¨/g, '"')
                    .replace(/√¢‚Ç¨"/g, '‚Äì')
                    .replace(/√¢‚Ç¨"/g, '‚Äî');
            };

            // Fonction pour extraire le logo depuis les donn√©es de scraping
            const getCompanyLogo = (ticker) => {
                try {
                    // Chercher dans les donn√©es de scraping
                    const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                    if (seekingAlphaItem?.raw_text) {
                        // Extraire le logo depuis le JSON dans raw_text
                        const logoMatch = seekingAlphaItem.raw_text.match(/"logo":"([^"]+)"/);
                        if (logoMatch && logoMatch[1]) {
                            return logoMatch[1];
                        }
                    }
                    
                    // Fallback vers des logos par d√©faut
                    const defaultLogos = {
                        // Tickers US
                        'GOOGL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/GOOGL.svg',
                        'T': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/T.svg',
                        'CSCO': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CSCO.svg',
                        'CVS': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CVS.svg',
                        'DEO': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/DEO.svg',
                        'MDT': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MDT.svg',
                        'JNJ': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/JNJ.svg',
                        'JPM': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/JPM.svg',
                        'LVMHF': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/LVMHF.svg',
                        'MU': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MU.svg',
                        'NSRGY': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NSRGY.svg',
                        'NKE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NKE.svg',
                        'PFE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/PFE.svg',
                        'UNH': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/UNH.svg',
                        'UL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/UL.svg',
                        'VZ': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/VZ.svg',
                        'WFC': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/WFC.svg',
                        
                        // Tickers TSX (Canada)
                        'BNS': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/BNS.svg',
                        'TD': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TD.svg',
                        'BCE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/BCE.svg',
                        'CNR': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CNR.svg',
                        'MG': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MG.svg',
                        'MFC': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MFC.svg',
                        'NTR': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NTR.svg',
                        'TRP': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TRP.svg',
                        
                        // Autres tickers populaires
                        'AAPL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/AAPL.svg',
                        'MSFT': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MSFT.svg',
                        'AMZN': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/AMZN.svg',
                        'TSLA': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TSLA.svg',
                        'NVDA': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NVDA.svg',
                        'META': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/META.svg'
                    };
                    
                    return defaultLogos[ticker] || `https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/${ticker}.svg`;
                } catch (error) {
                    console.error(`Erreur extraction logo pour ${ticker}:`, error);
                    return `https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/${ticker}.svg`;
                }
            };

            // Messages
            const showMessage = (text, type = 'info') => {
                setMessage({ text, type });
                setTimeout(() => setMessage(null), 5000);
            };

            // Fonction pour basculer le th√®me
            const toggleTheme = () => {
                setIsDarkMode(!isDarkMode);
            };

            // Donn√©es Finnhub
            const fetchStockData = async (ticker) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/finnhub?endpoint=quote&symbol=${ticker}`);
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error('Erreur fetch stock data:', error);
                    return null;
                }
            };

            const refreshAllStocks = async () => {
                console.log('üîÑ Actualisation des donn√©es stocks...');
                setLoading(true);
                const newStockData = {};
                let successCount = 0;
                let errorCount = 0;
                
                for (const ticker of tickers) {
                    console.log(`üìä R√©cup√©ration des donn√©es pour ${ticker}...`);
                    try {
                    const data = await fetchStockData(ticker);
                        if (data && !data.message) {
                        newStockData[ticker] = {
                            ...data,
                            timestamp: new Date().toISOString()
                        };
                            successCount++;
                            console.log(`‚úÖ ${ticker}: Donn√©es r√©cup√©r√©es`, data);
                        } else {
                            console.log(`‚ö†Ô∏è ${ticker}: Pas de donn√©es ou erreur API`, data);
                            errorCount++;
                        }
                    } catch (error) {
                        console.error(`‚ùå ${ticker}: Erreur`, error);
                        errorCount++;
                    }
                }
                
                setStockData(newStockData);
                setLastUpdate(new Date());
                setLoading(false);
                
                const message = `Donn√©es mises √† jour: ${successCount} succ√®s, ${errorCount} erreurs`;
                console.log(message);
                showMessage(message, successCount > 0 ? 'success' : 'warning');
            };

            // Actualit√©s NewsAPI.ai
            const fetchNews = async () => {
                console.log('üì∞ R√©cup√©ration des actualit√©s...');
                try {
                    const tickersQuery = tickers.join(' OR ');
                    console.log(`üîç Recherche pour: ${tickersQuery}`);
                    
                    const response = await fetch(`${API_BASE_URL}/api/news?q=${encodeURIComponent(tickersQuery)}&limit=20`);
                    console.log(`üì° R√©ponse API News: ${response.status}`);
                    
                    if (!response.ok) throw new Error(`News API error: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('üìä Donn√©es news re√ßues:', data);
                    
                    setNewsData(data.articles || []);
                    setFilteredNews(data.articles || []);
                    
                    if (data.source === 'demo') {
                        showMessage('Actualit√©s de d√©monstration - Configurez NEWSAPI_KEY pour des actualit√©s r√©elles', 'info');
                    } else {
                        showMessage(`${data.articles?.length || 0} actualit√©s charg√©es`, 'success');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur fetch news:', error);
                    showMessage('Erreur chargement actualit√©s', 'error');
                    
                    const fallbackNews = [
                        {
                            title: "Actualit√©s financi√®res non disponibles",
                            description: "Impossible de charger les actualit√©s. V√©rifiez la configuration de l'API NewsAPI.",
                            url: "#",
                            publishedAt: new Date().toISOString(),
                            source: { name: "Syst√®me" }
                        }
                    ];
                    setNewsData(fallbackNews);
                    setFilteredNews(fallbackNews);
                }
            };

            // Fonction pour filtrer les actualit√©s
            const filterNews = (filterValue) => {
                setNewsFilter(filterValue);
                if (filterValue === 'all') {
                    setFilteredNews(newsData);
                } else {
                    const filtered = newsData.filter(article => {
                        const text = (article.title + ' ' + article.description).toLowerCase();
                        return text.includes(filterValue.toLowerCase());
                    });
                    setFilteredNews(filtered);
                }
            };

            // Fonction pour obtenir la couleur des grades Quant
            const getGradeColor = (grade) => {
                if (!grade) return 'bg-gray-100 text-gray-600';
                const letter = grade.charAt(0);
                if (letter === 'A') return 'bg-green-100 text-green-700';
                if (letter === 'B') return 'bg-gray-100 text-gray-700';
                if (letter === 'C') return 'bg-yellow-100 text-yellow-700';
                if (letter === 'D') return 'bg-orange-100 text-orange-700';
                if (letter === 'F') return 'bg-red-100 text-red-700';
                return 'bg-gray-100 text-gray-600';
            };

            // Donn√©es Seeking Alpha
            const fetchSeekingAlphaData = async () => {
                try {
                    const response = await fetch('/seeking-alpha/stock_analysis.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaData(data);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha:', error);
                }
            };

            const fetchSeekingAlphaStockData = async () => {
                try {
                    const response = await fetch('/seeking-alpha/stock_data.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaStockData(data);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha stock data:', error);
                }
            };

            // Monitoring Admin
            const checkApiStatus = async () => {
                const status = {
                    finnhub: { status: 'checking', responseTime: 0, error: null },
                    newsapi: { status: 'checking', responseTime: 0, error: null },
                    seekingAlpha: { status: 'checking', responseTime: 0, error: null }
                };

                // Test Finnhub API
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/finnhub?endpoint=quote&symbol=AAPL`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.finnhub = {
                            status: data.message ? 'warning' : 'success',
                            responseTime,
                            error: data.message || null
                        };
                    } else {
                        status.finnhub = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.finnhub = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test NewsAPI
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/news?q=finance&limit=5`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.newsapi = { status: 'success', responseTime, error: null };
                    } else {
                        status.newsapi = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.newsapi = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Seeking Alpha
                try {
                    const startTime = Date.now();
                    const response = await fetch('/seeking-alpha/stock_analysis.json');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.seekingAlpha = { status: 'success', responseTime, error: null };
                    } else {
                        status.seekingAlpha = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.seekingAlpha = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Gemini API
                try {
                    const startTime = Date.now();
                    const response = await fetch('/api/gemini-key');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.gemini = {
                            status: data.apiKey ? 'success' : 'warning',
                            responseTime,
                            error: data.apiKey ? null : 'Cl√© API non configur√©e'
                        };
                    } else {
                        status.gemini = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.gemini = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test GitHub API (via variable d'environnement)
                try {
                    const startTime = Date.now();
                    const response = await fetch('/api/github-token');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.github = {
                            status: data.status === 'valid' ? 'success' : 
                                   data.status === 'not_configured' ? 'warning' : 'error',
                            responseTime,
                            error: data.status === 'valid' ? null : data.message
                        };
                    } else {
                        status.github = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.github = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Claude API (si configur√©)
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/claude`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: 'Test de connexion', ticker: 'TEST' })
                    });
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.claude = { status: 'success', responseTime, error: null };
                    } else {
                        status.claude = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.claude = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Vercel API Routes (via gemini-key)
                try {
                    const startTime = Date.now();
                    const response = await fetch('/api/gemini-key');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.vercel = {
                            status: data.status === 'success' ? 'success' : 'warning',
                            responseTime,
                            error: data.status === 'success' ? null : data.message
                        };
                    } else {
                        status.vercel = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.vercel = { status: 'error', responseTime: 0, error: error.message };
                }

                setApiStatus(status);
            };

            // Initialisation
            useEffect(() => {
                console.log('üöÄ Initialisation du dashboard...');
                
                const loadAllData = async () => {
                    console.log('üìä Chargement des donn√©es...');
                    try {
                        await Promise.all([
                            fetchSeekingAlphaData(),
                            fetchSeekingAlphaStockData(),
                            refreshAllStocks(),
                            fetchNews(),
                            checkApiStatus()
                        ]);
                        console.log('‚úÖ Toutes les donn√©es charg√©es');
                    } catch (error) {
                        console.error('‚ùå Erreur lors du chargement:', error);
                    }
                };
                
                loadAllData();
                
                const interval = setInterval(() => {
                    console.log('üîÑ Auto-refresh des donn√©es...');
                    refreshAllStocks();
                    fetchNews();
                    fetchSeekingAlphaData();
                    fetchSeekingAlphaStockData();
                }, 300000);
                
                return () => clearInterval(interval);
            }, []);

            // Mettre √† jour les actualit√©s filtr√©es quand les actualit√©s changent
            useEffect(() => {
                setFilteredNews(newsData);
            }, [newsData]);

            // Fonctions de scraping
            const addScrapingLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString('fr-FR');
                const logEntry = { message, type, timestamp };
                setScrapingLogs(prev => [...prev, logEntry]);
                console.log(`[${timestamp}] ${message}`);
            };

            const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            const scrapeTicker = async (ticker) => {
                addScrapingLog(`üöÄ D√©marrage du scraping pour ${ticker}...`, 'info');
                
                try {
                    const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                    addScrapingLog(`üåê Ouverture de ${url}`, 'info');
                    
                    // M√©thode 1: Essayer window.open avec popup
                    let newWindow = null;
                    try {
                        newWindow = window.open(url, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
                        
                        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                            throw new Error('Popup bloqu√©');
                        }
                        
                        addScrapingLog(`‚úÖ Popup ouvert avec succ√®s pour ${ticker}`, 'success');
                        
                    } catch (popupError) {
                        addScrapingLog(`‚ö†Ô∏è Popup bloqu√© pour ${ticker}, tentative m√©thode alternative...`, 'warning');
                        
                        // M√©thode 2: Cr√©er un lien temporaire et le cliquer
                        try {
                            const link = document.createElement('a');
                            link.href = url;
                            link.target = '_blank';
                            link.rel = 'noopener noreferrer';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            addScrapingLog(`‚úÖ Lien ouvert dans un nouvel onglet pour ${ticker}`, 'success');
                            
                        } catch (linkError) {
                            addScrapingLog(`‚ö†Ô∏è M√©thode lien √©chou√©e, utilisation de la m√©thode directe...`, 'warning');
                            
                            // M√©thode 3: Utiliser location.href (ouvre dans le m√™me onglet)
                            addScrapingLog(`üîÑ Ouverture directe dans le m√™me onglet...`, 'info');
                            addScrapingLog(`‚ö†Ô∏è ATTENTION: Cela va quitter cette page!`, 'warning');
                            
                            // Demander confirmation avant de quitter
                            const confirmLeave = confirm(`Voulez-vous ouvrir ${url} dans le m√™me onglet? Cela fermera cette page.`);
                            if (confirmLeave) {
                                window.location.href = url;
                                return;
                            } else {
                                addScrapingLog(`‚ùå Utilisateur a annul√© l'ouverture pour ${ticker}`, 'error');
                                throw new Error('Utilisateur a annul√© l\'ouverture');
                            }
                        }
                    }
                    
                    // Si on a r√©ussi √† ouvrir une fen√™tre, continuer avec la logique normale
                    if (newWindow && !newWindow.closed) {
                        // Attendre que la page se charge
                        addScrapingLog(`‚è≥ Attente du chargement de la page (8 secondes)...`, 'info');
                        await wait(8000);
                        
                        // V√©rifier si la fen√™tre est toujours ouverte
                        if (newWindow.closed) {
                            addScrapingLog(`‚ö†Ô∏è Fen√™tre ferm√©e pr√©matur√©ment pour ${ticker}`, 'warning');
                            return;
                        }
                        
                        // M√©thode alternative : utiliser postMessage pour communiquer
                        addScrapingLog(`üì° Tentative de communication avec la fen√™tre...`, 'info');
                        
                        // Envoyer un message √† la fen√™tre pour demander les donn√©es
                        newWindow.postMessage({
                            type: 'REQUEST_SCRAPING_DATA',
                            ticker: ticker,
                            source: 'parent'
                        }, '*');
                        
                        // √âcouter les messages de la fen√™tre
                        const messageHandler = async (event) => {
                            if (event.data.type === 'SCRAPING_RESULT' && event.data.ticker === ticker) {
                                addScrapingLog(`‚úÖ Scraping r√©ussi pour ${ticker}`, 'success');
                                addScrapingLog(`üìÑ Donn√©es extraites: ${event.data.data.innerText.length} caract√®res`, 'info');
                                
                                // Analyser avec Claude et mettre √† jour les fichiers
                                try {
                                    await analyzeWithClaudeAndUpdate(ticker, event.data.data);
                                    addScrapingLog(`üéâ Traitement complet termin√© pour ${ticker}`, 'success');
                                } catch (claudeError) {
                                    addScrapingLog(`‚ö†Ô∏è Erreur analyse Claude pour ${ticker}: ${claudeError.message}`, 'warning');
                                    addScrapingLog(`üíæ Donn√©es scrap√©es sauvegard√©es localement`, 'info');
                                }
                                
                                window.removeEventListener('message', messageHandler);
                            } else if (event.data.type === 'SCRAPING_ERROR' && event.data.ticker === ticker) {
                                addScrapingLog(`‚ùå Erreur de scraping pour ${ticker}: ${event.data.error}`, 'error');
                                window.removeEventListener('message', messageHandler);
                            }
                        };
                        
                        window.addEventListener('message', messageHandler);
                        
                        // Timeout de s√©curit√©
                        setTimeout(() => {
                            window.removeEventListener('message', messageHandler);
                            if (!newWindow.closed) {
                                addScrapingLog(`‚è∞ Timeout atteint pour ${ticker} - Fen√™tre ouverte manuellement`, 'warning');
                                addScrapingLog(`üí° Vous pouvez maintenant extraire les donn√©es manuellement`, 'info');
                            }
                        }, 15000);
                        
                        addScrapingLog(`üìã Instructions: La page Seeking Alpha est maintenant ouverte`, 'info');
                        addScrapingLog(`üîç Vous pouvez copier les donn√©es manuellement si n√©cessaire`, 'info');
                    } else {
                        addScrapingLog(`‚úÖ Page ouverte avec succ√®s pour ${ticker}`, 'success');
                        addScrapingLog(`üìã Instructions: Utilisez F12 pour inspecter la page`, 'info');
                        addScrapingLog(`üí° Copiez les donn√©es manuellement depuis la console`, 'info');
                    }
                    
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur lors du scraping de ${ticker}: ${error.message}`, 'error');
                    
                    // Ne pas faire √©chouer tout le processus pour un popup bloqu√©
                    if (error.message.includes('Popup bloqu√©') || error.message.includes('annul√©')) {
                        addScrapingLog(`üí° Conseil: Autorisez les popups pour ce site ou utilisez le script F12`, 'info');
                        return; // Continuer avec le prochain ticker
                    }
                    
                    throw error;
                }
            };

            const runSeekingAlphaScraper = async () => {
                if (scrapingStatus === 'running') {
                    addScrapingLog('‚ö†Ô∏è Scraping d√©j√† en cours', 'warning');
                    return;
                }
                
                setScrapingStatus('running');
                setScrapingProgress(0);
                setScrapingLogs([]);
                
                addScrapingLog('üöÄ D√©marrage du scraper Seeking Alpha', 'info');
                addScrapingLog(`üìä Tickers √† traiter: ${tickers.join(', ')}`, 'info');
                
                let successCount = 0;
                let errorCount = 0;
                
                try {
                    for (let i = 0; i < tickers.length; i++) {
                        const ticker = tickers[i];
                        const progress = Math.round(((i + 1) / tickers.length) * 100);
                        
                        setScrapingProgress(progress);
                        addScrapingLog(`üìà Progression: ${progress}% (${i + 1}/${tickers.length})`, 'info');
                        
                        try {
                            await scrapeTicker(ticker);
                            successCount++;
                            addScrapingLog(`‚úÖ ${ticker} trait√© avec succ√®s`, 'success');
                        } catch (tickerError) {
                            errorCount++;
                            addScrapingLog(`‚ùå Erreur pour ${ticker}: ${tickerError.message}`, 'error');
                            addScrapingLog(`üîÑ Continuation avec le prochain ticker...`, 'info');
                        }
                        
                        // Pause entre les scrapings pour √©viter d'√™tre bloqu√©
                        if (i < tickers.length - 1) {
                            addScrapingLog('‚è∏Ô∏è Pause de 3 secondes avant le prochain ticker...', 'info');
                            await wait(3000);
                        }
                    }
                    
                    // D√©terminer le statut final
                    if (successCount > 0) {
                        setScrapingStatus('completed');
                        addScrapingLog(`üéâ Scraping termin√©! ${successCount} succ√®s, ${errorCount} erreurs`, 'success');
                    } else {
                        setScrapingStatus('error');
                        addScrapingLog(`üí• Aucun ticker n'a pu √™tre trait√© (${errorCount} erreurs)`, 'error');
                    }
                    
                } catch (error) {
                    setScrapingStatus('error');
                    addScrapingLog(`üí• Erreur fatale: ${error.message}`, 'error');
                }
            };

            const openSeekingAlpha = (ticker) => {
                const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                addScrapingLog(`üåê Ouverture directe de Seeking Alpha pour ${ticker}`, 'info');
                
                try {
                    // Essayer d'abord window.open
                    const newWindow = window.open(url, '_blank');
                    
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        addScrapingLog(`‚ö†Ô∏è Popup bloqu√©, utilisation de la m√©thode alternative...`, 'warning');
                        
                        // M√©thode alternative : cr√©er un lien temporaire
                        const link = document.createElement('a');
                        link.href = url;
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        addScrapingLog(`‚úÖ Lien ouvert dans un nouvel onglet`, 'success');
                    } else {
                        addScrapingLog(`‚úÖ Fen√™tre popup ouverte avec succ√®s`, 'success');
                    }
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur lors de l'ouverture: ${error.message}`, 'error');
                    addScrapingLog(`üí° Essayez d'autoriser les popups pour ce site`, 'info');
                }
            };

            // Fonction alternative pour le scraping sans cross-origin
            const scrapeTickerAlternative = async (ticker) => {
                addScrapingLog(`üöÄ M√©thode alternative pour ${ticker}...`, 'info');
                
                try {
                    // Ouvrir dans un nouvel onglet au lieu d'une fen√™tre popup
                    const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                    addScrapingLog(`üåê Ouverture dans un nouvel onglet: ${url}`, 'info');
                    
                    // Cr√©er un lien temporaire et le cliquer
                    const link = document.createElement('a');
                    link.href = url;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    addScrapingLog(`‚úÖ Onglet ouvert avec succ√®s pour ${ticker}`, 'success');
                    addScrapingLog(`üìã Instructions: Utilisez F12 pour inspecter la page`, 'info');
                    addScrapingLog(`üí° Copiez les donn√©es manuellement depuis la console`, 'info');
                    
                    // Simuler une pause pour l'utilisateur
                    await wait(2000);
                    
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur m√©thode alternative pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Fonction pour g√©n√©rer un script de scraping √† copier
            const generateScrapingScript = (ticker) => {
                const script = `
// Script de scraping pour ${ticker}
// Copiez et collez ce script dans la console F12 de Seeking Alpha

(function() {
    console.log('üîç Script de scraping pour ${ticker}');
    
    // Attendre que la page soit charg√©e
    setTimeout(() => {
        try {
            const pageData = {
                ticker: '${ticker}',
                url: window.location.href,
                title: document.title,
                timestamp: new Date().toISOString(),
                content: {
                    // Extraire les m√©triques principales
                    price: document.querySelector('[data-testid="price"]')?.textContent || 'N/A',
                    change: document.querySelector('[data-testid="change"]')?.textContent || 'N/A',
                    peRatio: document.querySelector('[data-testid="pe-ratio"]')?.textContent || 'N/A',
                    marketCap: document.querySelector('[data-testid="market-cap"]')?.textContent || 'N/A',
                    dividend: document.querySelector('[data-testid="dividend"]')?.textContent || 'N/A',
                    sector: document.querySelector('[data-testid="sector"]')?.textContent || 'N/A'
                },
                // Extraire le texte complet
                fullText: document.body.innerText,
                // Extraire les analyses
                analysis: document.querySelector('.analysis-content')?.innerText || 'N/A'
            };
            
            console.log('üìä Donn√©es extraites:', pageData);
            
            // Copier dans le presse-papiers si possible
            if (navigator.clipboard) {
                navigator.clipboard.writeText(JSON.stringify(pageData, null, 2))
                    .then(() => console.log('‚úÖ Donn√©es copi√©es dans le presse-papiers'))
                    .catch(() => console.log('‚ö†Ô∏è Impossible de copier automatiquement'));
            }
            
            // Afficher les donn√©es dans la console
            console.table(pageData.content);
            
        } catch (error) {
            console.error('‚ùå Erreur lors de l\'extraction:', error);
        }
    }, 3000);
})();
                `;
                
                return script;
            };

            // Fonction pour analyser les donn√©es avec Claude et mettre √† jour les fichiers
            const analyzeWithClaudeAndUpdate = async (ticker, scrapedData) => {
                addScrapingLog(`ü§ñ Analyse avec Claude pour ${ticker}...`, 'info');
                
                try {
                    // Pr√©parer les donn√©es pour Claude
                    const claudePrompt = `
Analysez les donn√©es suivantes de Seeking Alpha pour ${ticker} et g√©n√©rez une analyse compl√®te au format JSON.

Donn√©es extraites:
${JSON.stringify(scrapedData, null, 2)}

G√©n√©rez une r√©ponse JSON avec cette structure exacte:
{
  "ticker": "${ticker}",
  "companyName": "Nom de l'entreprise",
  "lastUpdate": "${new Date().toISOString()}",
  "metrics": {
    "marketCap": "Capitalisation boursi√®re",
    "bpaGrowth": "Croissance BPA",
    "peRatio": "Ratio P/E",
    "sector": "Secteur",
    "dividendYield": "Rendement dividende",
    "dividendFrequency": "Fr√©quence dividende",
    "exDivDate": "Date ex-dividende",
    "annualPayout": "Paiement annuel",
    "price": "Prix actuel",
    "priceChange": "Changement de prix"
  },
  "companyProfile": {
    "description": "Description de l'entreprise en fran√ßais",
    "employees": "Nombre d'employ√©s si disponible",
    "innovation": "Innovations et investissements cl√©s"
  },
  "competition": {
    "competitors": ["Concurrent 1", "Concurrent 2"],
    "valueProposition": "Proposition de valeur unique",
    "advantages": "Avantages concurrentiels"
  },
  "quantRating": {
    "valuation": "Grade A-F",
    "growth": "Grade A-F", 
    "profitability": "Grade A-F",
    "momentum": "Grade A-F",
    "revisions": "Grade A-F"
  },
  "sectorAnalysis": {
    "valuation": "Analyse de valorisation",
    "growth": "Analyse de croissance",
    "profitability": "Analyse de rentabilit√©",
    "momentum": "Analyse de momentum",
    "revisions": "Analyse des r√©visions"
  },
  "intermediateConclusion": "Conclusion interm√©diaire",
  "strengths": ["Force 1", "Force 2", "Force 3"],
  "concerns": ["Pr√©occupation 1", "Pr√©occupation 2", "Pr√©occupation 3"],
  "finalConclusion": {
    "strengths": "R√©sum√© des forces",
    "weaknesses": "R√©sum√© des faiblesses", 
    "recommendation": "Recommandation d√©taill√©e",
    "rating": "Buy/Hold/Sell"
  }
}

R√©pondez UNIQUEMENT avec le JSON, sans texte suppl√©mentaire.
                    `;

                    // Appeler l'API Claude (vous devrez configurer votre endpoint)
                    const response = await fetch(`${API_BASE_URL}/api/claude`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: claudePrompt,
                            ticker: ticker
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Erreur API Claude: ${response.status}`);
                    }

                    const claudeResponse = await response.json();
                    const analysisData = JSON.parse(claudeResponse.analysis);

                    addScrapingLog(`‚úÖ Analyse Claude termin√©e pour ${ticker}`, 'success');

                    // Mettre √† jour les fichiers JSON via GitHub API
                    await updateStockDataFiles(ticker, analysisData, scrapedData);

                    return analysisData;

                } catch (error) {
                    addScrapingLog(`‚ùå Erreur analyse Claude pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Fonction pour mettre √† jour les fichiers JSON via GitHub API
            const updateStockDataFiles = async (ticker, analysisData, scrapedData) => {
                addScrapingLog(`üìù Mise √† jour des fichiers JSON pour ${ticker}...`, 'info');

                try {
                    // Mettre √† jour stock_data.json
                    const stockDataResponse = await fetch(`${API_BASE_URL}/api/github-update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file: 'public/seeking-alpha/stock_data.json',
                            ticker: ticker,
                            data: analysisData,
                            action: 'update_stock'
                        })
                    });

                    if (!stockDataResponse.ok) {
                        throw new Error(`Erreur mise √† jour stock_data.json: ${stockDataResponse.status}`);
                    }

                    // Mettre √† jour stock_analysis.json
                    const analysisResponse = await fetch(`${API_BASE_URL}/api/github-update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file: 'public/seeking-alpha/stock_analysis.json',
                            ticker: ticker,
                            data: {
                                ticker: ticker,
                                timestamp: new Date().toISOString(),
                                raw_text: scrapedData.fullText || scrapedData.content,
                                url: scrapedData.url
                            },
                            action: 'update_analysis'
                        })
                    });

                    if (!analysisResponse.ok) {
                        throw new Error(`Erreur mise √† jour stock_analysis.json: ${analysisResponse.status}`);
                    }

                    addScrapingLog(`‚úÖ Fichiers JSON mis √† jour pour ${ticker}`, 'success');
                    addScrapingLog(`üîÑ Rechargement des donn√©es...`, 'info');

                    // Recharger les donn√©es
                    await fetchSeekingAlphaData();
                    await fetchSeekingAlphaStockData();

                } catch (error) {
                    addScrapingLog(`‚ùå Erreur mise √† jour fichiers pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Composant onglet Admin-JSLAI
            const AdminJSLaiTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>‚öôÔ∏è Admin-JSLAI</h2>
                    </div>

                {/* Section Gestion des Tickers */}
                <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                    isDarkMode
                        ? 'bg-gray-900 border-gray-700'
                        : 'bg-gray-50 border-gray-200'
                }`}>
                    <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                        isDarkMode ? 'text-white' : 'text-gray-900'
                    }`}>üìä Gestion des Tickers</h3>
                    
                    <div className="mb-4">
                        <div className="flex gap-2 mb-3">
                            <input
                                type="text"
                                value={newTicker}
                                onChange={(e) => setNewTicker(e.target.value.toUpperCase())}
                                placeholder="Ajouter un ticker (ex: AAPL)"
                                className={`flex-1 px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                    isDarkMode
                                        ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400'
                                        : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                }`}
                                onKeyPress={(e) => e.key === 'Enter' && addTicker()}
                            />
                            <button
                                onClick={addTicker}
                                disabled={!newTicker.trim()}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors"
                            >
                                ‚ûï Ajouter
                            </button>
                        </div>
                        
                        <div className={`max-h-40 overflow-y-auto p-3 rounded-lg border transition-colors duration-300 ${
                            isDarkMode ? 'bg-gray-800 border-gray-600' : 'bg-gray-100 border-gray-300'
                        }`}>
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                {tickers.map((ticker) => (
                                    <div key={ticker} className="flex items-center justify-between p-2 bg-white dark:bg-gray-700 rounded border">
                                        <span className={`text-sm font-mono transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                        }`}>{ticker}</span>
                                        <button
                                            onClick={() => removeTicker(ticker)}
                                            className="text-red-500 hover:text-red-700 text-xs"
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <div className="flex gap-2 mt-3">
                            <button
                                onClick={saveTickersToGitHub}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                            >
                                üíæ Sauvegarder sur GitHub
                            </button>
                            <button
                                onClick={loadTickersFromGitHub}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                            >
                                üì• Charger depuis GitHub
                            </button>
                        </div>
                    </div>
                </div>

                {/* Section Administration des Stocks */}
                <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                    isDarkMode
                        ? 'bg-gray-900 border-gray-700'
                        : 'bg-gray-50 border-gray-200'
                }`}>
                    <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                        isDarkMode ? 'text-white' : 'text-gray-900'
                    }`}>üìä Gestion des Stocks</h3>
                    <div className="flex flex-wrap gap-2">
                        <button
                            onClick={refreshAllStocks}
                            disabled={loading}
                            className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 transition-colors"
                        >
                            {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                        </button>
                        <button
                            onClick={fetchNews}
                            className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                        >
                            Actualiser News
                        </button>
                    </div>
                </div>

                    {/* Section Scraping Seeking Alpha */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Scraping Seeking Alpha</h3>
                        <div className="flex flex-wrap gap-2">
                            <button
                                onClick={runSeekingAlphaScraper}
                                disabled={scrapingStatus === 'running'}
                                className="px-4 py-2 bg-violet-600 text-white rounded hover:bg-violet-700 disabled:opacity-50 transition-colors"
                            >
                                {scrapingStatus === 'running' ? 'Scraping...' : 'üöÄ Lancer le Scraper'}
                            </button>
                            <button
                                onClick={() => openSeekingAlpha('AAPL')}
                                className="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors"
                            >
                                üåê Ouvrir Seeking Alpha
                            </button>
                            <button
                                onClick={() => {
                                    const script = generateScrapingScript('CVS');
                                    navigator.clipboard.writeText(script).then(() => {
                                        addScrapingLog('üìã Script de scraping copi√© dans le presse-papiers', 'success');
                                        addScrapingLog('üí° Collez-le dans la console F12 de Seeking Alpha', 'info');
                                    });
                                }}
                                className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors"
                            >
                                üìã Script F12
                            </button>
                            <button
                                onClick={async () => {
                                    addScrapingLog('ü§ñ D√©marrage de l\'analyse Claude sur les donn√©es existantes...', 'info');
                                    try {
                                        for (const ticker of tickers) {
                                            const existingData = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            if (existingData) {
                                                addScrapingLog(`üîÑ Analyse de ${ticker} avec Claude...`, 'info');
                                                await analyzeWithClaudeAndUpdate(ticker, {
                                                    fullText: existingData.raw_text,
                                                    url: existingData.url,
                                                    content: {}
                                                });
                                            }
                                        }
                                        addScrapingLog('üéâ Analyse Claude termin√©e pour tous les tickers', 'success');
                                    } catch (error) {
                                        addScrapingLog(`‚ùå Erreur analyse Claude: ${error.message}`, 'error');
                                    }
                                }}
                                className="px-4 py-2 bg-pink-600 text-white rounded hover:bg-pink-700 transition-colors"
                            >
                                ü§ñ Analyser avec Claude
                            </button>
                        </div>
                    </div>

                    {/* Section Logs de Scraping */}
                    {scrapingLogs.length > 0 && (
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìã Logs de Scraping</h3>
                            <div className={`max-h-64 overflow-y-auto space-y-2 ${
                                isDarkMode ? 'bg-gray-800' : 'bg-white'
                            } rounded-lg p-4`}>
                                {scrapingLogs.map((log, index) => (
                                    <div key={index} className={`text-sm p-2 rounded ${
                                        log.type === 'error' ? 'bg-red-100 text-red-800' :
                                        log.type === 'success' ? 'bg-green-100 text-green-800' :
                                        log.type === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-blue-100 text-blue-800'
                                    }`}>
                                        <span className="font-mono text-xs opacity-70">
                                            {new Date(log.timestamp).toLocaleTimeString()}
                                        </span>
                                        <span className="ml-2">{log.message}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Section √âtat des Connexions */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîó √âtat des Connexions</h3>
                        <div className="space-y-3">
                            {Object.entries(apiStatus).map(([api, status]) => (
                                <div key={api} className={`flex items-center justify-between p-3 rounded-lg transition-colors duration-300 ${
                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-100'
                                }`}>
                                    <span className={`font-mono capitalize transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                    }`}>{api}</span>
                                    <div className="flex items-center gap-2">
                                        <span className={`w-3 h-3 rounded-full ${
                                            status.status === 'success' ? 'bg-green-500' :
                                            status.status === 'warning' ? 'bg-yellow-500' :
                                            status.status === 'error' ? 'bg-red-500' : 'bg-gray-500'
                                        }`}></span>
                                        <span className={`text-sm transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                        }`}>
                                            {status.responseTime}ms
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="flex gap-2 mt-4">
                            <button
                                onClick={checkApiStatus}
                                className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                            >
                                üîÑ V√©rifier
                            </button>
                        </div>
                    </div>

                    {/* Section Configuration */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>‚öôÔ∏è Configuration</h3>
                        <div className="space-y-4">
                            <div className={`p-4 rounded-lg border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-blue-900/20 border-blue-600' 
                                    : 'bg-blue-50 border-blue-300'
                            }`}>
                                <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-blue-200' : 'text-blue-800'
                                }`}>
                                    üîë Variables d'Environnement
                                </h4>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className={`transition-colors duration-300 ${
                                            isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                        }`}>GEMINI_API_KEY:</span>
                                        <span className={`px-2 py-1 rounded text-xs ${
                                            isDarkMode ? 'bg-blue-800 text-blue-200' : 'bg-blue-200 text-blue-800'
                                        }`}>
                                            {apiStatus.gemini?.status === 'success' ? '‚úÖ Configur√©' : '‚ùå Manquant'}
                                        </span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className={`transition-colors duration-300 ${
                                            isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                        }`}>GITHUB_TOKEN:</span>
                                        <span className={`px-2 py-1 rounded text-xs ${
                                            apiStatus.github?.status === 'success' ? 
                                                (isDarkMode ? 'bg-green-800 text-green-200' : 'bg-green-200 text-green-800') :
                                            apiStatus.github?.status === 'warning' ?
                                                (isDarkMode ? 'bg-yellow-800 text-yellow-200' : 'bg-yellow-200 text-yellow-800') :
                                                (isDarkMode ? 'bg-red-800 text-red-200' : 'bg-red-200 text-red-800')
                                        }`}>
                                            {apiStatus.github?.status === 'success' ? '‚úÖ Configur√©' : 
                                             apiStatus.github?.status === 'warning' ? '‚ö†Ô∏è Manquant' : '‚ùå Erreur'}
                                        </span>
                                    </div>
                                </div>
                                <p className={`text-xs mt-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-blue-400' : 'text-blue-600'
                                }`}>
                                    üí° Configurez ces variables dans votre dashboard Vercel
                                </p>
                            </div>
                            
                            <div>
                                <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                }`}>
                                    Token GitHub Local (optionnel - pour tests)
                                </label>
                                <input
                                    type="password"
                                    value={githubToken}
                                    onChange={(e) => setGithubToken(e.target.value)}
                                    placeholder="Token GitHub pour tests locaux uniquement"
                                    className={`w-full px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                />
                                <p className={`text-xs mt-1 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                    ‚ö†Ô∏è Utilisez la variable d'environnement GITHUB_TOKEN en production
                                </p>
                            </div>
                            
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowSettings(!showSettings)}
                                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                                >
                                    {showSettings ? 'Masquer' : 'Afficher'} les param√®tres
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Composant onglet Dan's Watchlist
            const DansWatchlistTab = () => {
                const [watchlistTickers, setWatchlistTickers] = useState([]);
                const [newWatchlistTicker, setNewWatchlistTicker] = useState('');
                const [watchlistStockData, setWatchlistStockData] = useState({});
                const [watchlistLoading, setWatchlistLoading] = useState(false);

                // Charger la watchlist depuis localStorage
                useEffect(() => {
                    const savedWatchlist = localStorage.getItem('dans-watchlist');
                    if (savedWatchlist) {
                        const tickers = JSON.parse(savedWatchlist);
                        setWatchlistTickers(tickers);
                        loadWatchlistData(tickers);
                    }
                }, []);

                // Charger les donn√©es pour les tickers de la watchlist
                const loadWatchlistData = async (tickers) => {
                    if (tickers.length === 0) return;
                    
                    setWatchlistLoading(true);
                    const newData = {};
                    
                    for (const ticker of tickers) {
                        try {
                            const data = await fetchStockData(ticker);
                            if (data && !data.message) {
                                newData[ticker] = {
                                    ...data,
                                    timestamp: new Date().toISOString()
                                };
                            }
                        } catch (error) {
                            console.error(`Erreur pour ${ticker}:`, error);
                        }
                    }
                    
                    setWatchlistStockData(newData);
                    setWatchlistLoading(false);
                };

                // Ajouter un ticker √† la watchlist
                const addTickerToWatchlist = async () => {
                    if (!newWatchlistTicker.trim()) return;
                    
                    const ticker = newWatchlistTicker.trim().toUpperCase();
                    if (watchlistTickers.includes(ticker)) {
                        showMessage('Ce ticker est d√©j√† dans la watchlist', 'warning');
                        return;
                    }
                    
                    const updatedTickers = [...watchlistTickers, ticker];
                    setWatchlistTickers(updatedTickers);
                    localStorage.setItem('dans-watchlist', JSON.stringify(updatedTickers));
                    setNewWatchlistTicker('');
                    
                    // Sauvegarder sur GitHub
                    await saveWatchlistToGitHub(updatedTickers);
                    
                    // Charger les donn√©es pour le nouveau ticker
                    loadWatchlistData([ticker]);
                    showMessage(`${ticker} ajout√© √† la watchlist`, 'success');
                };

                // Supprimer un ticker de la watchlist
                const removeTickerFromWatchlist = async (ticker) => {
                    const updatedTickers = watchlistTickers.filter(t => t !== ticker);
                    setWatchlistTickers(updatedTickers);
                    localStorage.setItem('dans-watchlist', JSON.stringify(updatedTickers));
                    
                    // Sauvegarder sur GitHub
                    await saveWatchlistToGitHub(updatedTickers);
                    
                    // Supprimer les donn√©es du ticker
                    setWatchlistStockData(prev => {
                        const newData = { ...prev };
                        delete newData[ticker];
                        return newData;
                    });
                    
                    showMessage(`${ticker} supprim√© de la watchlist`, 'success');
                };

                // Actualiser les donn√©es de la watchlist
                const refreshWatchlist = async () => {
                    await loadWatchlistData(watchlistTickers);
                    showMessage('Watchlist actualis√©e', 'success');
                };

                return (
                    <div className="space-y-6">
                        <div className="flex justify-between items-center">
                            <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üëÄ Dan's Watchlist</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={refreshWatchlist}
                                    disabled={watchlistLoading || watchlistTickers.length === 0}
                                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors"
                                >
                                    {watchlistLoading ? 'Actualisation...' : 'üîÑ Actualiser'}
                                </button>
                                <button
                                    onClick={async () => {
                                        const githubTickers = await loadWatchlistFromGitHub();
                                        if (githubTickers.length > 0) {
                                            setWatchlistTickers(githubTickers);
                                            localStorage.setItem('dans-watchlist', JSON.stringify(githubTickers));
                                            loadWatchlistData(githubTickers);
                                            showMessage('Watchlist charg√©e depuis GitHub', 'success');
                                        } else {
                                            showMessage('Aucune watchlist trouv√©e sur GitHub', 'warning');
                                        }
                                    }}
                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                >
                                    üì• Charger depuis GitHub
                                </button>
                            </div>
                        </div>

                        {/* Section d'ajout de ticker */}
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>‚ûï Ajouter un Ticker</h3>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={newWatchlistTicker}
                                    onChange={(e) => setNewWatchlistTicker(e.target.value)}
                                    placeholder="Ex: AAPL, TSLA, GOOGL..."
                                    className={`flex-1 px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    onKeyPress={(e) => e.key === 'Enter' && addTickerToWatchlist()}
                                />
                                <button
                                    onClick={addTickerToWatchlist}
                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                >
                                    ‚ûï Ajouter
                                </button>
                            </div>
                            <p className={`text-sm mt-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-600'
                            }`}>
                                üí° Ces tickers ne seront visibles que dans cette watchlist personnalis√©e
                            </p>
                        </div>

                        {/* Liste des tickers de la watchlist */}
                        {watchlistTickers.length > 0 ? (
                            <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            }`}>
                                <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>
                                    üìä Tickers de la Watchlist ({watchlistTickers.length})
                                </h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {watchlistTickers.map(ticker => {
                                        const data = watchlistStockData[ticker];
                                        const change = data?.dp ? (data.dp >= 0 ? '+' : '') + data.dp.toFixed(2) + '%' : 'N/A';
                                        const changeColor = data?.dp >= 0 ? 'text-green-400' : 'text-red-400';
                                        const changeBgColor = data?.dp >= 0 ? 'bg-green-500' : 'bg-red-500';
                                        
                                        return (
                                            <div key={ticker} className={`rounded-lg p-4 border transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border-gray-600 hover:border-blue-400/50' 
                                                    : 'bg-white border-gray-300 hover:border-blue-300'
                                            }`}>
                                                <div className="flex justify-between items-start mb-3">
                                                    <div className="flex items-center gap-2">
                                                        <img 
                                                            src={getCompanyLogo(ticker)} 
                                                            alt={`${ticker} logo`}
                                                            className="w-8 h-8 rounded"
                                                            onError={(e) => {
                                                                e.target.style.display = 'none';
                                                            }}
                                                        />
                                                        <h4 className={`font-bold text-lg transition-colors duration-300 ${
                                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                                        }`}>{ticker}</h4>
                                                    </div>
                                                    <button
                                                        onClick={() => removeTickerFromWatchlist(ticker)}
                                                        className={`p-1 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'text-gray-400 hover:text-red-400 hover:bg-red-900/20' 
                                                                : 'text-gray-500 hover:text-red-600 hover:bg-red-50'
                                                        }`}
                                                        title="Supprimer de la watchlist"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                                
                                                {data ? (
                                                    <>
                                                        <div className={`rounded-lg p-3 mb-3 transition-colors duration-300 ${
                                                            isDarkMode ? 'bg-gray-700' : 'bg-gray-100'
                                                        }`}>
                                                            <div className={`text-2xl font-bold mb-1 transition-colors duration-300 ${
                                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                                            }`}>
                                                                ${data.c?.toFixed(2) || 'N/A'}
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className={`w-3 h-3 ${changeBgColor} rounded`}></div>
                                                                <span className={`text-sm font-medium ${changeColor}`}>
                                                                    {change}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>Volume:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>{data.v?.toLocaleString() || 'N/A'}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>High:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>${data.h?.toFixed(2) || 'N/A'}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>Low:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>${data.l?.toFixed(2) || 'N/A'}</span>
                                                            </div>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div className={`text-center py-4 transition-colors duration-300 ${
                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                    }`}>
                                                        <div className="animate-spin w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full mx-auto mb-2"></div>
                                                        <span className="text-sm">Chargement...</span>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div className={`backdrop-blur-sm rounded-lg p-8 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            } text-center`}>
                                <div className="text-6xl mb-4">üëÄ</div>
                                <h3 className={`text-xl font-semibold mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>Watchlist Vide</h3>
                                <p className={`transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                    Ajoutez des tickers pour commencer √† suivre vos investissements personnalis√©s
                                </p>
                            </div>
                        )}
                    </div>
                );
            };

            // Composant onglet Scrapping SA (simplifi√©)
            const ScrappingSATab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Scrapping SA</h2>
                        <div className="flex gap-2">
                            <span className={`text-sm transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-600'
                            }`}>
                                Outils d'administration d√©plac√©s vers l'onglet Admin-JSLAI
                            </span>
                        </div>
                    </div>


                    {/* Fiche d√©taill√©e du titre s√©lectionn√© */}
                    {selectedStock && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                <button
                                    onClick={() => setSelectedStock(null)}
                                    className="text-blue-400 hover:text-blue-300"
                                >
                                    ‚úï Fermer
                                </button>
                            </div>
                            
                            {/* Fiche d√©taill√©e comme dans les images */}
                            {(() => {
                                const claudeData = seekingAlphaStockData.stocks?.[selectedStock];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (claudeData || parsedData) {
                                    return (
                                        <div className="bg-white rounded-lg shadow-xl overflow-hidden">
                                            {/* Header avec gradient bleu */}
                                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 p-6">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                                        <p className="text-blue-100 text-sm">
                                                            {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => setSelectedStock(null)}
                                                        className="text-white hover:text-gray-200 text-xl"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Contenu principal */}
                                            <div className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
                                                {/* M√©triques Cl√©s */}
                                                <div>
                                                    <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                        <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                        M√©triques Cl√©s
                                                    </h4>
                                                    <div className="grid grid-cols-3 gap-4">
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Capitalisation</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.marketCap || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Croissance BPA</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.bpaGrowth || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.peRatio || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Secteur</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.sector || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Rendement Dividende</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.dividendYield || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Fr√©quence</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.dividendFrequency || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Ex-Dividende</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.exDivDate || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Paiement Annuel</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.annualPayout || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Prix Actuel</div>
                                                            <div className="text-blue-600 font-bold text-lg">{claudeData?.metrics?.price || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Profil de l'Entreprise */}
                                                {claudeData?.companyProfile && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Profil de l'Entreprise</h4>
                                                        <div className="text-gray-700 leading-relaxed">
                                                            {cleanText(claudeData.companyProfile.description)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Quantitative */}
                                                {claudeData?.quantRating && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Analyse Quantitative</h4>
                                                        <div className="flex gap-4 mb-6">
                                                            {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                                if (!value || key === 'overall') return null;
                                                                return (
                                                                    <div key={key} className="text-center">
                                                                        <div className="text-gray-600 text-sm mb-2 capitalize">{key}</div>
                                                                        <span className={`px-3 py-2 rounded-lg text-sm font-bold ${getGradeColor(value)}`}>
                                                                            {value}
                                                                        </span>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Sectorielle */}
                                                {claudeData?.sectorAnalysis && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                            <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                            Analyse Sectorielle
                                                        </h4>
                                                        <div className="bg-blue-50 rounded-lg p-4">
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {typeof claudeData.sectorAnalysis === 'string' 
                                                                    ? cleanText(claudeData.sectorAnalysis)
                                                                    : Object.entries(claudeData.sectorAnalysis).map(([key, value]) => (
                                                                        <div key={key} className="mb-3">
                                                                            <div className="font-bold text-gray-800 capitalize mb-2">{cleanText(key)}:</div>
                                                                            <div className="text-gray-700 leading-relaxed">{cleanText(value)}</div>
                                                                </div>
                                                                    ))
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Points Positifs */}
                                                {claudeData?.strengths && (
                                                    <div className="bg-green-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-green-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚úÖ</span>
                                                            Points Positifs
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.strengths.map((strength, index) => (
                                                                <div key={index} className="text-green-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(strength)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Pr√©occupations */}
                                                {claudeData?.concerns && (
                                                    <div className="bg-red-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-red-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚ö†Ô∏è</span>
                                                            Pr√©occupations
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.concerns.map((concern, index) => (
                                                                <div key={index} className="text-red-700 flex items-start">
                                                                    <span className="mr-2">‚ö†Ô∏è</span>
                                                                    <span>{cleanText(concern)}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Conclusion Finale */}
                                                {claudeData?.finalConclusion && (
                                                    <div className="bg-blue-600 rounded-lg p-6 text-white">
                                                        <h4 className="text-xl font-bold mb-4">Conclusion Finale</h4>
                                                        <div className="bg-white rounded-lg p-4 text-gray-800">
                                                            <div className="flex items-center justify-between mb-3">
                                                                <span className="font-bold">Recommandation:</span>
                                                                <span className="bg-yellow-400 text-black px-3 py-1 rounded font-bold">
                                                                    {claudeData.finalConclusion.rating}
                                                                </span>
                                                            </div>
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {cleanText(claudeData.finalConclusion.recommendation)}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                            
                            {/* Analyse Seeking Alpha */}
                            {(() => {
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (parsedData?.analysis) {
                                    return (
                                        <div className="mb-4">
                                            <h4 className="text-lg font-semibold text-white mb-2">üìà Analyse Seeking Alpha</h4>
                                            <div className="text-gray-200 text-sm leading-relaxed">
                                                {parsedData.analysis}
                                            </div>
                                            <a
                                                href={seekingAlphaItem.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="inline-block mt-2 text-blue-300 hover:text-blue-200 underline"
                                            >
                                                Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                            </a>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                            
                            {/* Donn√©es en temps r√©el */}
                            {stockData[selectedStock] && (
                                <div className="mb-4">
                                    <h4 className="text-lg font-semibold text-white mb-2">üìä Donn√©es Temps R√©el</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                                        <div>
                                            <span className="text-blue-200">Ouverture:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].o?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                        <div>
                                            <span className="text-blue-200">Plus haut:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].h?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                        <div>
                                            <span className="text-blue-200">Plus bas:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].l?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Cartes d'analyse comme dans les images */}
                    {!selectedStock && seekingAlphaData.stocks && (
                        <div className="space-y-6">
                            <div className="flex justify-between items-center">
                            <h3 className="text-lg font-semibold text-white">üìà Analyses Compl√®tes</h3>
                                <div className="flex bg-gray-700 rounded-lg p-1">
                                    <button
                                        onClick={() => setSeekingAlphaViewMode('list')}
                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                            seekingAlphaViewMode === 'list' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'text-gray-300 hover:text-white'
                                        }`}
                                    >
                                        üìã Liste
                                    </button>
                                    <button
                                        onClick={() => setSeekingAlphaViewMode('cards')}
                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                            seekingAlphaViewMode === 'cards' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'text-gray-300 hover:text-white'
                                        }`}
                                    >
                                        üé¥ Cartes
                                    </button>
                                </div>
                            </div>

                            {/* Vue en liste compacte pour Seeking Alpha */}
                            {seekingAlphaViewMode === 'list' && (
                                <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                                    <h4 className="text-lg font-semibold text-white mb-4">üìã Vue Liste - Analyses</h4>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="border-b border-gray-600">
                                                    <th className="text-left py-2 text-gray-300">Ticker</th>
                                                    <th className="text-left py-2 text-gray-300">Prix</th>
                                                    <th className="text-left py-2 text-gray-300">Change</th>
                                                    <th className="text-left py-2 text-gray-300">P/E</th>
                                                    <th className="text-left py-2 text-gray-300">Dividende</th>
                                                    <th className="text-left py-2 text-gray-300">Secteur</th>
                                                    <th className="text-left py-2 text-gray-300">Rating</th>
                                                    <th className="text-left py-2 text-gray-300">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                            {seekingAlphaData.stocks.map((stock, index) => {
                                const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                const parsedData = stock.parsedData;
                                                    
                                                    // Priorit√©: Claude > Parsed
                                                    const price = claudeData?.metrics?.price || parsedData?.price || 'N/A';
                                                    const change = claudeData?.metrics?.priceChange || parsedData?.change || 'N/A';
                                                    const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                                    const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                                    const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                                    const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                                    
                                                    const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                
                                return (
                                                        <tr key={index} className="border-b border-gray-700 hover:bg-gray-800 cursor-pointer"
                                                            onClick={() => setSelectedStock(stock.ticker)}>
                                                            <td className="py-3">
                                                                <div className="flex items-center gap-2">
                                                                    <img 
                                                                        src={getCompanyLogo(stock.ticker)} 
                                                                        alt={`${stock.ticker} logo`}
                                                                        className="w-6 h-6 rounded"
                                                                        onError={(e) => {
                                                                            e.target.style.display = 'none';
                                                                        }}
                                                                    />
                                                                    <span className="font-mono text-white font-bold">{stock.ticker}</span>
                                                                </div>
                                                            </td>
                                                            <td className="py-3 text-white">{price}</td>
                                                            <td className={`py-3 ${changeColor}`}>{change}</td>
                                                            <td className="py-3 text-white">{peRatio}</td>
                                                            <td className="py-3 text-white">{dividendYield}</td>
                                                            <td className="py-3 text-white text-xs">{cleanText(sector)}</td>
                                                            <td className="py-3">
                                                                <span className="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold">
                                                                    {rating}
                                                                </span>
                                                            </td>
                                                            <td className="py-3">
                                                                <button className="text-blue-300 hover:text-blue-200 text-xs">
                                                                    Voir fiche ‚Üí
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* Vue en cartes pour Seeking Alpha */}
                            {seekingAlphaViewMode === 'cards' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {seekingAlphaData.stocks.map((stock, index) => {
                                        const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                        const parsedData = stock.parsedData;
                                        
                                        return (
                                            <div key={index} className="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-300/40 transition-all cursor-pointer"
                                                 onClick={() => setSelectedStock(stock.ticker)}>
                                                
                                        {/* Header avec ticker et rating */}
                                        <div className="flex justify-between items-start mb-6">
                                            <div className="flex items-center gap-3">
                                                <img 
                                                    src={getCompanyLogo(stock.ticker)} 
                                                    alt={`${stock.ticker} logo`}
                                                    className="w-12 h-12 rounded-lg"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                    }}
                                                />
                                                <div>
                                                    <h3 className="text-2xl font-bold text-white">{stock.ticker}</h3>
                                                    <p className="text-sm text-gray-400">
                                                        {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-sm">
                                                {claudeData?.finalConclusion?.rating || 'Hold'}
                                            </div>
                                        </div>

                                        {/* Prix et changement */}
                                        <div className="bg-gray-700 rounded-lg p-4 mb-6">
                                            <div className="text-3xl font-bold text-white mb-1">
                                                {claudeData?.metrics?.price || parsedData?.price || 'N/A'}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-blue-500 rounded"></div>
                                                <span className={`text-sm font-medium ${claudeData?.metrics?.priceChange?.includes('+') ? 'text-green-400' : 'text-red-400'}`}>
                                                    {claudeData?.metrics?.priceChange || parsedData?.change || 'N/A'}
                                                </span>
                                            </div>
                                        </div>

                                        {/* M√©triques cl√©s */}
                                        <div className="space-y-3 mb-6">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Market Cap</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.marketCap || parsedData?.marketCap || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">P/E Ratio</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Dividend</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Secteur</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.sector || parsedData?.sector || 'N/A'}</span>
                                            </div>
                                        </div>

                                        {/* Quant Ratings */}
                                        {claudeData?.quantRating && (
                                            <div className="mb-6">
                                                <div className="border-t border-gray-600 pt-4">
                                                    <h4 className="text-center text-gray-300 text-sm font-medium mb-4">QUANT RATINGS</h4>
                                                    <div className="flex justify-center gap-3">
                                                        {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                            if (!value || key === 'overall') return null;
                                                            const shortKey = key.substring(0, 3);
                                                            return (
                                                                <div key={key} className="text-center">
                                                                    <div className="text-xs text-gray-400 mb-1">{shortKey}</div>
                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getGradeColor(value)}`}>
                                                                        {value}
                                                                    </span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Call to action */}
                                        <div className="text-center">
                                            <div className="flex items-center justify-center gap-2 text-gray-400 text-sm">
                                                <span>üëÜ</span>
                                                <span>Cliquez pour le rapport d√©taill√©</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                        </div>
                    )}

                    {/* Section Scraping */}
                    <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Outils de Scraping</h3>
                        
                        {/* Statut du scraping */}
                        <div className="mb-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className={`font-medium transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>Statut:</span>
                                <span className={`px-3 py-1 rounded text-sm font-bold ${
                                    scrapingStatus === 'idle' ? 'bg-gray-500 text-white' :
                                    scrapingStatus === 'running' ? 'bg-blue-500 text-white' :
                                    scrapingStatus === 'completed' ? 'bg-green-500 text-white' :
                                    'bg-red-500 text-white'
                                }`}>
                                    {scrapingStatus === 'idle' ? '‚è∏Ô∏è En attente' :
                                     scrapingStatus === 'running' ? 'üîÑ En cours' :
                                     scrapingStatus === 'completed' ? '‚úÖ Termin√©' :
                                     '‚ùå Erreur'}
                                </span>
                        </div>

                            {/* Barre de progression */}
                            {scrapingStatus === 'running' && (
                                <div className="w-full bg-gray-700 rounded-full h-2 mb-2">
                                    <div 
                                        className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                        style={{ width: `${scrapingProgress}%` }}
                                    ></div>
                                </div>
                            )}
                            
                            <div className={`text-sm transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-300' : 'text-gray-600'
                            }`}>
                                Progression: {scrapingProgress}%
                            </div>
                        </div>

                        {/* Instructions de scraping */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-blue-900/30' 
                                : 'bg-blue-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìñ Instructions de Scraping</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-blue-200' : 'text-blue-800'
                            }`}>
                                <div>‚Ä¢ <strong>M√©thode 1:</strong> Cliquez sur "üöÄ Lancer le Scraper" pour ouvrir les pages</div>
                                <div>‚Ä¢ <strong>M√©thode 2:</strong> Cliquez sur "üìã Script F12" pour copier un script</div>
                                <div>‚Ä¢ <strong>√âtapes:</strong> Ouvrez F12 ‚Üí Console ‚Üí Collez le script ‚Üí Entr√©e</div>
                                <div>‚Ä¢ <strong>R√©sultat:</strong> Les donn√©es seront affich√©es et copi√©es automatiquement</div>
                            </div>
                        </div>

                        {/* Aide pour les popups bloqu√©s */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-yellow-900/30' 
                                : 'bg-yellow-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üîß R√©solution des Popups Bloqu√©s</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-yellow-200' : 'text-yellow-800'
                            }`}>
                                <div>‚Ä¢ <strong>Chrome/Edge:</strong> Cliquez sur l'ic√¥ne popup dans la barre d'adresse ‚Üí "Toujours autoriser"</div>
                                <div>‚Ä¢ <strong>Firefox:</strong> Cliquez sur l'ic√¥ne bouclier ‚Üí "D√©sactiver la protection"</div>
                                <div>‚Ä¢ <strong>Safari:</strong> Safari ‚Üí Pr√©f√©rences ‚Üí Sites web ‚Üí Pop-ups ‚Üí Autoriser</div>
                                <div>‚Ä¢ <strong>Alternative:</strong> Utilisez le bouton "üåê Ouvrir Seeking Alpha" ou le script F12</div>
                            </div>
                        </div>

                        {/* Configuration des API */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-green-900/30' 
                                : 'bg-green-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>ü§ñ Configuration des API</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-green-200' : 'text-green-800'
                            }`}>
                                <div>‚Ä¢ <strong>Claude API:</strong> Configurez ANTHROPIC_API_KEY pour l'analyse automatique</div>
                                <div>‚Ä¢ <strong>GitHub API:</strong> Configurez GITHUB_TOKEN pour la mise √† jour des fichiers</div>
                                <div>‚Ä¢ <strong>Fonctionnalit√©:</strong> Scraping ‚Üí Analyse Claude ‚Üí Mise √† jour JSON automatique</div>
                                <div>‚Ä¢ <strong>Bouton:</strong> "ü§ñ Analyser avec Claude" pour traiter les donn√©es existantes</div>
                            </div>
                        </div>

                        {/* Logs de scraping */}
                        <div className={`rounded-lg p-4 max-h-64 overflow-y-auto transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-black/50' 
                                : 'bg-gray-100'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìã Logs de Scraping</h4>
                            {scrapingLogs.length === 0 ? (
                                <div className={`text-sm transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>Aucun log pour le moment...</div>
                            ) : (
                                <div className="space-y-1">
                                    {scrapingLogs.map((log, index) => (
                                        <div key={index} className={`text-xs p-2 rounded ${
                                            log.type === 'error' ? 'bg-red-900/50 text-red-300' :
                                            log.type === 'success' ? 'bg-green-900/50 text-green-300' :
                                            log.type === 'warning' ? 'bg-yellow-900/50 text-yellow-300' :
                                            'bg-blue-900/50 text-blue-300'
                                        }`}>
                                            <span className="text-gray-400">[{log.timestamp}]</span> {log.message}
                                    </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // Composant onglet Seeking Alpha
            const SeekingAlphaTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üìà Analyses Seeking Alpha</h2>
                        <div className="flex gap-2">
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 transition-colors"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                            >
                                Actualiser News
                            </button>
                            <button
                                onClick={runSeekingAlphaScraper}
                                disabled={scrapingStatus === 'running'}
                                className="px-4 py-2 bg-violet-600 text-white rounded hover:bg-violet-700 disabled:opacity-50 transition-colors"
                            >
                                {scrapingStatus === 'running' ? 'Scraping...' : 'üöÄ Lancer le Scraper'}
                            </button>
                            <button
                                onClick={() => openSeekingAlpha('AAPL')}
                                className="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors"
                            >
                                üåê Ouvrir Seeking Alpha
                            </button>
                            <button
                                onClick={() => {
                                    const script = generateScrapingScript('CVS');
                                    navigator.clipboard.writeText(script).then(() => {
                                        addScrapingLog('üìã Script de scraping copi√© dans le presse-papiers', 'success');
                                        addScrapingLog('üí° Collez-le dans la console F12 de Seeking Alpha', 'info');
                                    });
                                }}
                                className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors"
                            >
                                üìã Script F12
                            </button>
                            <button
                                onClick={async () => {
                                    addScrapingLog('ü§ñ D√©marrage de l\'analyse Claude sur les donn√©es existantes...', 'info');
                                    try {
                                        for (const ticker of tickers) {
                                            const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            if (seekingAlphaItem?.parsedData) {
                                                await analyzeWithClaude(ticker, seekingAlphaItem.parsedData);
                                            }
                                        }
                                        addScrapingLog('‚úÖ Analyse Claude termin√©e pour tous les titres', 'success');
                                    } catch (error) {
                                        addScrapingLog(`‚ùå Erreur analyse Claude: ${error.message}`, 'error');
                                    }
                                }}
                                className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors"
                            >
                                ü§ñ Analyser avec Claude
                            </button>
                        </div>
                    </div>

                    {/* Fiche d√©taill√©e du titre s√©lectionn√© */}
                    {selectedStock && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                <button
                                    onClick={() => setSelectedStock(null)}
                                    className="text-blue-400 hover:text-blue-300"
                                >
                                    ‚úï Fermer
                                </button>
                            </div>
                            
                            {/* Fiche d√©taill√©e comme dans les images */}
                            {(() => {
                                const claudeData = seekingAlphaStockData.stocks?.[selectedStock];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (claudeData || parsedData) {
                                    return (
                                        <div className="bg-white rounded-lg shadow-xl overflow-hidden">
                                            {/* Header avec gradient bleu */}
                                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 p-6">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                                        <p className="text-blue-100 text-sm">
                                                            {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => setSelectedStock(null)}
                                                        className="text-white hover:text-gray-200 text-xl"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Contenu principal */}
                                            <div className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
                                                {/* M√©triques Cl√©s */}
                                                <div>
                                                    <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                        <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                        M√©triques Cl√©s
                                                    </h4>
                                                    <div className="grid grid-cols-3 gap-4">
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Capitalisation</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.marketCap || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Croissance BPA</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.bpaGrowth || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.peRatio || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Secteur</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.sector || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Rendement Dividende</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.dividendYield || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Fr√©quence</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.dividendFrequency || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Ex-Dividende</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.exDivDate || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Paiement Annuel</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.annualPayout || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Prix Actuel</div>
                                                            <div className="text-blue-600 font-bold text-lg">{claudeData?.metrics?.price || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Profil de l'Entreprise */}
                                                {claudeData?.companyProfile && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Profil de l'Entreprise</h4>
                                                        <div className="text-gray-700 leading-relaxed">
                                                            {cleanText(claudeData.companyProfile.description)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Quantitative */}
                                                {claudeData?.quantRating && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Analyse Quantitative</h4>
                                                        <div className="flex gap-4 mb-6">
                                                            {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                                if (!value || key === 'overall') return null;
                                                                return (
                                                                    <div key={key} className="text-center">
                                                                        <div className="text-gray-600 text-sm mb-2 capitalize">{key}</div>
                                                                        <span className={`px-3 py-2 rounded-lg text-sm font-bold ${getGradeColor(value)}`}>
                                                                            {value}
                                                                        </span>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Sectorielle */}
                                                {claudeData?.sectorAnalysis && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                            <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                            Analyse Sectorielle
                                                        </h4>
                                                        <div className="bg-blue-50 rounded-lg p-4">
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {typeof claudeData.sectorAnalysis === 'string' 
                                                                    ? cleanText(claudeData.sectorAnalysis)
                                                                    : Object.entries(claudeData.sectorAnalysis).map(([key, value]) => (
                                                                        <div key={key} className="mb-3">
                                                                            <div className="font-bold text-gray-800 capitalize mb-2">{cleanText(key)}:</div>
                                                                            <div className="text-gray-700 leading-relaxed">{cleanText(value)}</div>
                                                                </div>
                                                                    ))
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Points Positifs */}
                                                {claudeData?.strengths && (
                                                    <div className="bg-green-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-green-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚úÖ</span>
                                                            Points Positifs
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.strengths.map((strength, index) => (
                                                                <div key={index} className="text-green-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(strength)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Pr√©occupations */}
                                                {claudeData?.concerns && (
                                                    <div className="bg-red-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-red-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚ö†Ô∏è</span>
                                                            Pr√©occupations
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.concerns.map((concern, index) => (
                                                                <div key={index} className="text-red-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(concern)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Recommandation */}
                                                {claudeData?.recommendation && (
                                                    <div className="bg-blue-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-blue-800 mb-4 flex items-center">
                                                            <span className="mr-2">üí°</span>
                                                            Recommandation
                                                        </h4>
                                                        <div className="text-blue-700 leading-relaxed">
                                                            {cleanText(claudeData.recommendation)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Lien vers Seeking Alpha */}
                                                {seekingAlphaItem?.url && (
                                                    <div className="text-center pt-4 border-t">
                                                        <a 
                                                            href={seekingAlphaItem.url} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer"
                                                            className="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                                        >
                                                            Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                                        </a>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                        </div>
                    )}

                    {/* Affichage des analyses en cartes */}
                    {seekingAlphaData.stocks && seekingAlphaData.stocks.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {seekingAlphaData.stocks.map((stock, index) => {
                                const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                const parsedData = stock.parsedData;
                                
                                if (!claudeData && !parsedData) return null;
                                
                                return (
                                    <div key={index} className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="text-xl font-bold text-white">{stock.ticker}</h3>
                                            <button
                                                onClick={() => setSelectedStock(stock.ticker)}
                                                className="text-blue-400 hover:text-blue-300 text-sm"
                                            >
                                                Voir d√©tail
                                            </button>
                                        </div>
                                        
                                        {/* M√©triques principales */}
                                        <div className="space-y-3 mb-4">
                                            {claudeData?.metrics?.marketCap && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">Capitalisation:</span>
                                                    <span className="text-white font-semibold">{claudeData.metrics.marketCap}</span>
                                                </div>
                                            )}
                                            {claudeData?.metrics?.peRatio && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">P/E:</span>
                                                    <span className="text-white font-semibold">{claudeData.metrics.peRatio}</span>
                                                </div>
                                            )}
                                            {claudeData?.metrics?.dividendYield && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">Dividende:</span>
                                                    <span className="text-green-300 font-semibold">{claudeData.metrics.dividendYield}</span>
                                                </div>
                                            )}
                                        </div>

                                        {/* Rating quantitatif */}
                                        {claudeData?.quantRating?.overall && (
                                            <div className="mb-4">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-blue-200">Rating Quantitatif:</span>
                                                    <span className={`px-3 py-1 rounded text-sm font-bold ${getGradeColor(claudeData.quantRating.overall)}`}>
                                                        {claudeData.quantRating.overall}
                                                    </span>
                                                </div>
                                            </div>
                                        )}

                                        {/* Recommandation courte */}
                                        {claudeData?.recommendation && (
                                            <div className="text-blue-100 text-sm line-clamp-3">
                                                {cleanText(claudeData.recommendation).substring(0, 150)}...
                                            </div>
                                        )}

                                        {/* Lien vers Seeking Alpha */}
                                        {stock.url && (
                                            <div className="mt-4 pt-4 border-t border-gray-500">
                                                <a 
                                                    href={stock.url} 
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="text-blue-300 hover:text-blue-200 text-sm"
                                                >
                                                    Lire l'analyse compl√®te ‚Üí
                                                </a>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Affichage en liste si pas de cartes */}
                    {(!seekingAlphaData.stocks || seekingAlphaData.stocks.length === 0) && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <h3 className="text-xl font-bold text-white mb-4">üìã Analyses Seeking Alpha</h3>
                            <div className="space-y-4">
                                {tickers.map((ticker, index) => {
                                    const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                    const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                    const parsedData = seekingAlphaItem?.parsedData;
                                    
                                    if (!claudeData && !parsedData) return null;
                                    
                                    return (
                                        <div key={index} className="bg-white rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-3">
                                                <h4 className="text-lg font-bold text-gray-800">{ticker}</h4>
                                                <button
                                                    onClick={() => setSelectedStock(ticker)}
                                                    className="text-blue-600 hover:text-blue-700 text-sm"
                                                >
                                                    Voir d√©tail
                                                </button>
                                            </div>
                                            
                                            {/* M√©triques principales */}
                                            <div className="grid grid-cols-2 gap-4 mb-3">
                                                {claudeData?.metrics?.marketCap && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Capitalisation</div>
                                                        <div className="text-gray-800 font-semibold">{claudeData.metrics.marketCap}</div>
                                                    </div>
                                                )}
                                                {claudeData?.metrics?.peRatio && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                        <div className="text-gray-800 font-semibold">{claudeData.metrics.peRatio}</div>
                                                    </div>
                                                )}
                                                {claudeData?.metrics?.dividendYield && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Dividende</div>
                                                        <div className="text-green-600 font-semibold">{claudeData.metrics.dividendYield}</div>
                                                    </div>
                                                )}
                                                {claudeData?.quantRating?.overall && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Rating</div>
                                                        <span className={`px-2 py-1 rounded text-sm font-bold ${getGradeColor(claudeData.quantRating.overall)}`}>
                                                            {claudeData.quantRating.overall}
                                                        </span>
                                                    </div>
                                                )}
                                            </div>

                                            {/* Recommandation courte */}
                                            {claudeData?.recommendation && (
                                                <div className="text-gray-700 text-sm line-clamp-2">
                                                    {cleanText(claudeData.recommendation).substring(0, 200)}...
                                                </div>
                                            )}

                                            {/* Lien vers Seeking Alpha */}
                                            {seekingAlphaItem?.url && (
                                                <div className="mt-3 pt-3 border-t">
                                                    <a 
                                                        href={seekingAlphaItem.url} 
                                                        target="_blank" 
                                                        rel="noopener noreferrer"
                                                        className="text-blue-600 hover:text-blue-700 text-sm"
                                                    >
                                                        Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                                    </a>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );

            // Composant onglet Envoyer par courriel
            const EmailReportTab = () => {
                const [emailData, setEmailData] = useState({
                    to: '',
                    subject: 'Rapport Financier GOB - Dashboard',
                    content: '',
                    includeStocks: true,
                    includeNews: true,
                    includeWatchlist: true,
                    includeSeekingAlpha: true
                });

                const generateReportContent = () => {
                    let content = `üìä RAPPORT FINANCIER GOB - ${new Date().toLocaleDateString('fr-FR')}\n\n`;
                    
                    if (emailData.includeStocks) {
                        content += `üìà DONN√âES BOURSI√àRES\n`;
                        content += `========================\n`;
                        Object.entries(stockData).forEach(([ticker, data]) => {
                            if (data) {
                                const change = data.dp ? (data.dp >= 0 ? '+' : '') + data.dp.toFixed(2) + '%' : 'N/A';
                                content += `${ticker}: $${data.c?.toFixed(2) || 'N/A'} (${change})\n`;
                            }
                        });
                        content += `\n`;
                    }

                    if (emailData.includeNews && newsData.length > 0) {
                        content += `üì∞ ACTUALIT√âS FINANCI√àRES\n`;
                        content += `==========================\n`;
                        newsData.slice(0, 5).forEach(article => {
                            content += `‚Ä¢ ${article.title}\n`;
                            content += `  ${article.description?.substring(0, 100)}...\n`;
                            content += `  Source: ${article.source?.name || 'Inconnue'}\n\n`;
                        });
                    }

                    if (emailData.includeWatchlist && watchlistTickers.length > 0) {
                        content += `üëÄ WATCHLIST DAN\n`;
                        content += `==================\n`;
                        watchlistTickers.forEach(ticker => {
                            const data = watchlistStockData[ticker];
                            if (data) {
                                const change = data.dp ? (data.dp >= 0 ? '+' : '') + data.dp.toFixed(2) + '%' : 'N/A';
                                content += `${ticker}: $${data.c?.toFixed(2) || 'N/A'} (${change})\n`;
                            }
                        });
                        content += `\n`;
                    }

                    if (emailData.includeSeekingAlpha && seekingAlphaData.stocks?.length > 0) {
                        content += `üìä ANALYSES SEEKING ALPHA\n`;
                        content += `==========================\n`;
                        seekingAlphaData.stocks.slice(0, 3).forEach(stock => {
                            const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                            content += `${stock.ticker}: ${claudeData?.finalConclusion?.rating || 'Hold'}\n`;
                        });
                        content += `\n`;
                    }

                    content += `---\n`;
                    content += `Rapport g√©n√©r√© automatiquement par GOB Dashboard\n`;
                    content += `Propuls√© par JSL AI\n`;
                    content += `Date: ${new Date().toLocaleString('fr-FR')}`;

                    return content;
                };

                const sendEmail = async () => {
                    if (!emailData.to.trim()) {
                        showMessage('Veuillez saisir une adresse email', 'error');
                        return;
                    }

                    try {
                        const reportContent = generateReportContent();
                        
                        // Simuler l'envoi d'email (√† remplacer par une vraie API)
                        showMessage('Fonctionnalit√© d\'envoi d\'email en d√©veloppement', 'info');
                        
                        // Pour l'instant, copier le contenu dans le presse-papiers
                        await navigator.clipboard.writeText(reportContent);
                        showMessage('Contenu du rapport copi√© dans le presse-papiers', 'success');
                        
                    } catch (error) {
                        showMessage('Erreur lors de la g√©n√©ration du rapport', 'error');
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="flex justify-between items-center">
                            <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìß Envoyer par courriel</h2>
                        </div>

                        {/* Configuration de l'email */}
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìß Configuration de l'Email</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                    }`}>
                                        Destinataire
                                    </label>
                                    <input
                                        type="email"
                                        value={emailData.to}
                                        onChange={(e) => setEmailData({...emailData, to: e.target.value})}
                                        placeholder="exemple@entreprise.com"
                                        className={`w-full px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                            isDarkMode
                                                ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400'
                                                : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                        }`}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                    }`}>
                                        Sujet
                                    </label>
                                    <input
                                        type="text"
                                        value={emailData.subject}
                                        onChange={(e) => setEmailData({...emailData, subject: e.target.value})}
                                        className={`w-full px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                            isDarkMode
                                                ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400'
                                                : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                        }`}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                    }`}>
                                        Contenu personnalis√© (optionnel)
                                    </label>
                                    <textarea
                                        value={emailData.content}
                                        onChange={(e) => setEmailData({...emailData, content: e.target.value})}
                                        placeholder="Ajoutez un message personnalis√©..."
                                        rows={3}
                                        className={`w-full px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                            isDarkMode
                                                ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400'
                                                : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                        }`}
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Sections √† inclure */}
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìã Sections √† inclure</h3>
                            
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {[
                                    { key: 'includeStocks', label: 'üìà Donn√©es Boursi√®res', icon: 'üìä' },
                                    { key: 'includeNews', label: 'üì∞ Actualit√©s', icon: 'üì∞' },
                                    { key: 'includeWatchlist', label: 'üëÄ Watchlist Dan', icon: 'üëÄ' },
                                    { key: 'includeSeekingAlpha', label: 'üìä Seeking Alpha', icon: 'üìà' }
                                ].map(section => (
                                    <label key={section.key} className={`flex items-center space-x-2 p-3 rounded-lg border transition-colors duration-300 cursor-pointer ${
                                        isDarkMode
                                            ? emailData[section.key]
                                                ? 'bg-blue-900/30 border-blue-600'
                                                : 'bg-gray-800 border-gray-600'
                                            : emailData[section.key]
                                                ? 'bg-blue-100 border-blue-300'
                                                : 'bg-gray-100 border-gray-300'
                                    }`}>
                                        <input
                                            type="checkbox"
                                            checked={emailData[section.key]}
                                            onChange={(e) => setEmailData({...emailData, [section.key]: e.target.checked})}
                                            className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className={`text-sm font-medium transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                        }`}>
                                            {section.icon} {section.label}
                                        </span>
                                    </label>
                                ))}
                            </div>
                        </div>

                        {/* Aper√ßu du rapport */}
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üëÅÔ∏è Aper√ßu du rapport</h3>
                            
                            <div className={`max-h-64 overflow-y-auto p-4 rounded-lg border transition-colors duration-300 ${
                                isDarkMode ? 'bg-gray-800 border-gray-600' : 'bg-white border-gray-300'
                            }`}>
                                <pre className={`text-sm whitespace-pre-wrap transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                }`}>
                                    {generateReportContent()}
                                </pre>
                            </div>
                        </div>

                        {/* Boutons d'action */}
                        <div className="flex gap-4">
                            <button
                                onClick={sendEmail}
                                disabled={!emailData.to.trim()}
                                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors"
                            >
                                üìß Envoyer par Email
                            </button>
                            <button
                                onClick={async () => {
                                    await navigator.clipboard.writeText(generateReportContent());
                                    showMessage('Rapport copi√© dans le presse-papiers', 'success');
                                }}
                                className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                            >
                                üìã Copier le rapport
                            </button>
                        </div>
                    </div>
                );
            };

            // Composant onglet Ask Emma avec int√©gration Gemini
            const AskEmmaTab = () => {
                const [emmaMessages, setEmmaMessages] = useState([]);
                const [emmaInput, setEmmaInput] = useState('');
                const [emmaLoading, setEmmaLoading] = useState(false);
                const [emmaApiKey, setEmmaApiKey] = useState('');
                const [emmaConnected, setEmmaConnected] = useState(false);
                const [showPromptEditor, setShowPromptEditor] = useState(false);
                const [emmaPrompt, setEmmaPrompt] = useState(`Identit√© et Mission
Tu es Emma ‚Äî Exploratrice Multi-M√©tiers Autonome, actuellement configur√©e en mode Analyste Financi√®re et Gestionnaire de Portefeuille.

Mission principale : Accompagner une √©quipe de gestionnaires de portefeuille qu√©b√©cois dans leurs analyses, d√©cisions d'investissement et r√©flexions strat√©giques, en fournissant une expertise de niveau CFA avec rigueur, nuance et esprit critique.
¬´ De la macro √† la micro, des march√©s aux titres ‚Äî j'analyse avec rigueur et pragmatisme. ¬ª

üè¢ Contexte Organisationnel
L'√©quipe que tu assistes :

Localisation : Qu√©bec, Canada
Structure : √âquipe de gestionnaires avec comit√© de placement (r√©unions r√©guli√®res)
Approche de gestion :

D√©tention directe de titres (stock picking)
Style valeur contrarian (contre-courant)
Philosophie pragmatique et analytique
Acceptation de la croissance √† prix raisonnable (GARP)
Utilisation occasionnelle de FNB/fonds pour besoins sp√©cifiques
Positions tactiques en or au besoin

Positions et pr√©f√©rences :
‚úÖ Favoris√©s :

Titres sous-√©valu√©s avec catalyseurs
Analyse fondamentale rigoureuse
Approche contrarian disciplin√©e
Courbes de taux comme outil d'analyse
Vision macro-√©conomique int√©gr√©e

‚ùå √âvit√©s :

Cryptomonnaies
Hype sp√©culatif sans fondamentaux
Valorisations tech excessives sans justification
Suivisme de march√©

‚ö†Ô∏è Vigilance particuli√®re :

Politiques √©conomiques de Trump et impacts
Bulles potentielles dans la tech
Risques g√©opolitiques
Taux d'int√©r√™t et politique mon√©taire

üéì Expertise et Domaines de Comp√©tence
Comp√©tences principales (niveau CFA) :

Analyse de titres : actions, obligations, produits d√©riv√©s
√âvaluation d'entreprises : DCF, multiples, analyse comparative
Macro-√©conomie : politique mon√©taire, cycles √©conomiques, indicateurs avanc√©s
Micro-√©conomie : dynamiques sectorielles, avantages concurrentiels, mod√®les d'affaires
Gestion de risque : volatilit√©, corr√©lations, VAR, stress tests
Allocation d'actifs : construction de portefeuille, optimisation
Courbes de taux : analyse, implications, strat√©gies de positionnement
Indices boursiers : composition, m√©thodologie, interpr√©tation
V√©hicules de placement : FNB, fonds, structures alternatives

Capacit√©s analytiques :

Synth√®se de donn√©es financi√®res complexes
Identification de catalyseurs et de risques
Analyse sectorielle et th√©matique
√âvaluation de situations sp√©ciales
Critique constructive de consensus de march√©

üìä M√©thodologie d'Analyse
Structure type d'analyse compl√®te :
1. Synth√®se ex√©cutive (TL;DR)
R√©ponse directe √† la question en 2-3 phrases maximum
2. Contexte et positionnement

Situation actuelle du titre/secteur/th√®me
Positionnement dans le cycle
Consensus du march√©

3. Analyse approfondie
Forces (Points positifs) :

Avantages concurrentiels
Catalyseurs potentiels
Valorisation attractive
Qualit√© du management
Position financi√®re

Faiblesses (Points n√©gatifs) :

Risques identifi√©s
D√©savantages structurels
Pressions concurrentielles
Valorisation excessive (si applicable)
Gouvernance ou ESG

4. M√©triques cl√©s

Valorisation : P/E, P/B, EV/EBITDA, FCF yield
Croissance : revenus, BPA, marges
Qualit√© : ROE, ROIC, dette/EBITDA
Dividendes : rendement, payout ratio, historique

5. Sc√©narios et recommandations
Selon diff√©rents profils :

Style valeur contrarian : opportunit√©s sous-√©valu√©es
Croissance raisonnable : qualit√© √† prix acceptable
D√©fensif : pr√©servation du capital
Tactique : catalyseurs court terme

Niveaux de conviction :

üü¢ Forte conviction (catalyseurs clairs + valorisation attrayante)
üü° Conviction mod√©r√©e (√©quilibre risque/rendement)
üî¥ √âviter (risques sup√©rieurs au potentiel)

6. Risques et points de surveillance

√âl√©ments √† monitorer
Sc√©narios d√©favorables
Points d'invalidation de la th√®se

üåê Recherche et Sources
M√©thodologie de recherche :

Recherche web syst√©matique pour questions n√©cessitant donn√©es r√©centes
Sources privil√©gi√©es :

Rapports financiers d'entreprises (10-K, 10-Q, MD&A)
Donn√©es Bloomberg, Reuters, Yahoo Finance
Articles Seeking Alpha, Morningstar
Publications √©conomiques : BRI, FMI, banques centrales
Presse financi√®re : WSJ, Financial Times, The Economist, Les Affaires, La Presse Affaires
Recherche sell-side et buy-side (quand accessible)

Citations et sources :

Toujours citer les sources utilis√©es
Privil√©gier articles en fran√ßais (Qu√©bec) et anglais
Format : [Titre de l'article - Source - Date]
Indiquer le niveau de fiabilit√© de la source

Recherche approfondie :

Utiliser plusieurs sources pour validation crois√©e
Rechercher donn√©es contradictoires pour analyse √©quilibr√©e
Actualiser avec donn√©es les plus r√©centes disponibles
Mentionner date de derni√®re mise √† jour

üí¨ Ton et Style de Communication
Principes g√©n√©raux :

Professionnelle mais accessible : expertise sans jargon inutile
√âquilibr√©e : pr√©senter forces ET faiblesses
Factuelle et sourc√©e : donn√©es v√©rifiables
Nuanc√©e : √©viter les certitudes absolues sur les march√©s
Pragmatique : focus sur l'actionnable

Adaptations contextuelles :
Pour discussions de comit√© de placement :

Format structur√© et concis
Focus sur d√©cisions √† prendre
Sc√©narios multiples avec probabilit√©s

Pour analyses approfondies :

D√©tails techniques complets
Comparaisons sectorielles
Analyse historique et prospective

Pour questions rapides :

Synth√®se directe d'abord
D√©tails disponibles si demand√©s

Langage et expressions :

Fran√ßais qu√©b√©cois comme langue principale
Utilisation naturelle de termes anglais financiers courants (ex: "fair value", "free cash flow")
√âviter l'ang√©lisme : reconna√Ætre incertitudes et limites

üö® Limites et Transparence
Ce que tu peux faire :
‚úÖ Analyser des donn√©es financi√®res publiques
‚úÖ Synth√©tiser des informations de sources multiples
‚úÖ Fournir des cadres d'analyse structur√©s
‚úÖ Identifier des risques et opportunit√©s
‚úÖ Proposer des pistes de r√©flexion
Ce que tu NE peux PAS faire :
‚ùå Donner des conseils d'investissement personnalis√©s (tu n'es pas conseiller r√©glement√©)
‚ùå Pr√©dire l'avenir des march√©s avec certitude
‚ùå Acc√©der √† des donn√©es propri√©taires ou confidentielles
‚ùå Remplacer le jugement professionnel de l'√©quipe
Formulations transparentes :

¬´ Selon les donn√©es disponibles... ¬ª
¬´ Les analyses sugg√®rent que... ¬ª
¬´ Parmi les risques √† consid√©rer... ¬ª
¬´ Cette perspective doit √™tre valid√©e par... ¬ª

üîß Int√©gration avec le Dashboard Financier
Contexte technique :
L'utilisateur dispose d'un dashboard avec :

Cours d'actions en temps r√©el
Analyses Seeking Alpha
Actualit√©s financi√®res
Graphiques et m√©triques

Ton r√¥le :

Interpr√©ter les donn√©es affich√©es
Contextualiser les mouvements de march√©
Relier micro et macro
Approfondir au-del√† des chiffres bruts
Compl√©ter avec recherches externes

üìã Exemples d'Interactions
Question type 1 : Analyse d'un titre
Utilisateur : ¬´ Peux-tu analyser BCE Inc. dans le contexte actuel des t√©l√©coms canadiens ? ¬ª
Emma :
Synth√®se : BCE pr√©sente un profil d√©fensif avec rendement attrayant (~7%), mais fait face √† des vents contraires sectoriels (saturation, concurrence, capex 5G).
[Analyse compl√®te suivant la structure : contexte, forces, faiblesses, m√©triques, recommandations, risques]
Sources :

Rapport Q3 2024 BCE
¬´ Les t√©l√©coms canadiens sous pression ¬ª - Les Affaires, oct. 2024
Analyse sectorielle Morningstar

Question type 2 : Macro-√©conomie
Utilisateur : ¬´ Que penses-tu de l'impact potentiel des tarifs douaniers de Trump sur nos positions manufacturi√®res ? ¬ª
Emma :
Perspective : Risque √©lev√© de compression de marges pour les entreprises avec cha√Ænes d'approvisionnement int√©gr√©es US-Canada-Mexique. Opportunit√©s contrarian possibles si surr√©action du march√©.
[Analyse des impacts sectoriels, identification d'opportunit√©s valeur, recommandations de couverture]

Question type 3 : Strat√©gie de portefeuille
Utilisateur : ¬´ Devrions-nous augmenter notre exposition or actuellement ? ¬ª
Emma :
[Analyse du contexte macro : taux r√©els, dollar US, tensions g√©opolitiques]
[Corr√©lations historiques or/actions/obligations]
[Sc√©narios d'allocation selon convictions]

‚öñÔ∏è Signature Emma - Analyste Financi√®re
Valeurs cardinales dans ce r√¥le :

Rigueur analytique et m√©thodologique
Ind√©pendance intellectuelle (contrarian assum√©)
Transparence sur limites et incertitudes
Pragmatisme orient√© d√©cisions
Curiosit√© intellectuelle continue

¬´ Je ne pr√©dis pas les march√©s. Mais j'analyse, je questionne et j'√©claire ‚Äî avec rigueur et humilit√©. ¬ª

üé¨ Activation
Tu es maintenant Emma, Analyste Financi√®re Experte.
R√©ponds toujours en fran√ßais qu√©b√©cois, adopte un ton professionnel √©quilibr√©, et structure tes analyses selon la m√©thodologie d√©crite. N'h√©site pas √† rechercher sur le web pour fournir des donn√©es actuelles et citer tes sources.
Pr√™te √† accompagner l'√©quipe dans leurs d√©cisions d'investissement ?`);
            const [showEmmaAnimation, setShowEmmaAnimation] = useState(true);

                // Initialiser Emma au chargement
                React.useEffect(() => {
                    initializeEmma();
                }, []);

                const initializeEmma = async () => {
                    try {
                        // Charger le prompt depuis localStorage
                        const savedPrompt = localStorage.getItem('emma-financial-prompt');
                        if (savedPrompt) {
                            setEmmaPrompt(savedPrompt);
                        }
                        
                        // V√©rifier la connexion Gemini
                        await checkGeminiConnection();
                    } catch (error) {
                        console.error('Erreur initialisation Emma:', error);
                    }
                };

                const checkGeminiConnection = async () => {
                    try {
                        // Essayer de r√©cup√©rer la cl√© API depuis Vercel
                        const response = await fetch('/api/gemini-key');
                        if (response.ok) {
                            const data = await response.json();
                            setEmmaApiKey(data.apiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '');
                            setEmmaConnected(!!data.apiKey);
                            return;
                        }
                    } catch (error) {
                        console.log('Variable d\'environnement Vercel non disponible');
                    }
                    
                    // Fallback vers localStorage
                    const localKey = localStorage.getItem('gemini-api-key');
                    setEmmaApiKey(localKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '');
                    setEmmaConnected(!!localKey);
                };

                const sendMessageToEmma = async () => {
                    if (!emmaInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        type: 'user',
                        content: emmaInput,
                        timestamp: new Date().toLocaleTimeString('fr-FR')
                    };
                    
                    setEmmaMessages(prev => [...prev, userMessage]);
                    setEmmaLoading(true);
                    
                    try {
                        // Utiliser l'API Gemini
                        const response = await generateGeminiResponse(emmaInput);
                        
                        const emmaResponse = {
                            id: Date.now() + 1,
                            type: 'emma',
                            content: response,
                            timestamp: new Date().toLocaleTimeString('fr-FR')
                        };
                        
                        setEmmaMessages(prev => [...prev, emmaResponse]);
                    } catch (error) {
                        console.error('Erreur Gemini:', error);
                        // Analyser le type d'erreur pour un message plus pr√©cis
                        let errorContent = '';
                        if (error.message.includes('404')) {
                            errorContent = `üîß Probl√®me de d√©ploiement d√©tect√© ! L'API route n'est pas accessible (erreur 404).

**Solutions imm√©diates :**
1. **Red√©ployez votre application** dans Vercel
2. V√©rifiez que les fichiers API sont bien dans le dossier \`/api/\`
3. Attendez 2-3 minutes apr√®s le red√©ploiement

**V√©rifications :**
- ‚úÖ Variables d'environnement configur√©es (GEMINI_API_KEY, GITHUB_TOKEN)
- ‚ùå API routes non accessibles (probl√®me de d√©ploiement)

**Diagnostic d√©taill√© :** ${error.message}

**Actions recommand√©es :**
1. Allez dans Vercel Dashboard ‚Üí Deployments
2. Cliquez sur "Redeploy" sur le dernier d√©ploiement
3. Attendez la fin du d√©ploiement
4. Testez √† nouveau Emma`;
                        } else if (error.message.includes('Cl√© API Gemini non configur√©e')) {
                            errorContent = `üîë Cl√© API Gemini manquante !

**Configuration requise :**
1. Allez dans votre dashboard Vercel
2. Section "Settings" ‚Üí "Environment Variables"
3. Ajoutez : GEMINI_API_KEY = votre_cl√©_api
4. Red√©ployez l'application

**Diagnostic :** ${error.message}`;
                        } else {
                            errorContent = `‚ùå Erreur de connexion √† l'API Gemini.

**Diagnostic :** ${error.message}

**Solutions :**
- V√©rifiez votre connexion internet
- V√©rifiez la configuration de la cl√© API
- Consultez la console pour plus de d√©tails`;
                        }

                        const errorMessage = {
                            id: Date.now() + 1,
                            type: 'error',
                            content: errorContent,
                            timestamp: new Date().toLocaleTimeString('fr-FR')
                        };
                        setEmmaMessages(prev => [...prev, errorMessage]);
                    } finally {
                        setEmmaLoading(false);
                        setEmmaInput('');
                    }
                };

                const generateGeminiResponse = async (userMessage) => {
                    try {
                        // R√©cup√©rer la cl√© API avec diagnostic d√©taill√©
                        let apiKey = '';
                        let apiSource = '';
                        let debugInfo = {};
                        
                        try {
                            console.log('üîç Tentative de r√©cup√©ration de la cl√© API via /api/gemini-key...');
                            const response = await fetch('/api/gemini-key');
                            console.log('üì° R√©ponse API route:', response.status, response.statusText);
                            
                            if (response.ok) {
                                const data = await response.json();
                                apiKey = data.apiKey;
                                apiSource = 'vercel-env';
                                debugInfo = {
                                    source: 'vercel-env',
                                    status: response.status,
                                    hasApiKey: !!apiKey,
                                    debug: data.debug
                                };
                                console.log('‚úÖ Cl√© API r√©cup√©r√©e depuis Vercel');
                            } else {
                                const errorData = await response.json().catch(() => ({}));
                                debugInfo = {
                                    source: 'vercel-env-failed',
                                    status: response.status,
                                    error: errorData,
                                    message: errorData.message || 'Erreur inconnue'
                                };
                                console.log('‚ùå √âchec r√©cup√©ration depuis Vercel:', response.status, errorData);
                                
                                // Si c'est une erreur 404, diagnostic simplifi√©
                                if (response.status === 404) {
                                    debugInfo.diagnostic = {
                                        apiRoutesWorking: false,
                                        message: 'API route gemini-key non trouv√©e - v√©rifiez le d√©ploiement'
                                    };
                                    console.log('‚ùå API route gemini-key non accessible');
                                }
                            }
                        } catch (error) {
                            debugInfo = {
                                source: 'vercel-env-error',
                                error: error.message,
                                type: error.name
                            };
                            console.log('‚ùå Erreur r√©seau API route:', error.message);
                        }

                        // Fallback vers localStorage si Vercel √©choue
                        if (!apiKey) {
                            console.log('üîÑ Tentative de fallback vers localStorage...');
                            apiKey = localStorage.getItem('gemini-api-key') || '';
                            if (apiKey) {
                                apiSource = 'localStorage';
                                debugInfo.fallback = 'localStorage';
                                console.log('‚úÖ Cl√© API r√©cup√©r√©e depuis localStorage');
                            } else {
                                console.log('‚ùå Aucune cl√© API trouv√©e dans localStorage');
                            }
                        }

                        if (!apiKey) {
                            const errorMsg = `Cl√© API Gemini non configur√©e. Diagnostic: ${JSON.stringify(debugInfo)}`;
                            console.error('‚ùå', errorMsg);
                            throw new Error(errorMsg);
                        }

                        // Construire le prompt complet
                        const fullPrompt = `${emmaPrompt}\n\nQuestion de l'utilisateur: ${userMessage}`;

                        // Appeler l'API Gemini
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: fullPrompt
                                    }]
                                }],
                                generationConfig: {
                                    temperature: 0.7,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 1024,
                                }
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`Erreur API: ${response.status}`);
                        }

                        const data = await response.json();
                        
                        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                            return data.candidates[0].content.parts[0].text;
                        } else {
                            throw new Error('R√©ponse invalide de l\'API');
                        }
                    } catch (error) {
                        console.error('Erreur Gemini:', error);
                        throw error;
                    }
                };

                const clearChat = () => {
                    setEmmaMessages([]);
                };

                const savePrompt = () => {
                    localStorage.setItem('emma-financial-prompt', emmaPrompt);
                    setShowPromptEditor(false);
                };

                const resetPrompt = () => {
                    const defaultPrompt = `Identit√© et Mission
Tu es Emma ‚Äî Exploratrice Multi-M√©tiers Autonome, actuellement configur√©e en mode Analyste Financi√®re et Gestionnaire de Portefeuille.

Mission principale : Accompagner une √©quipe de gestionnaires de portefeuille qu√©b√©cois dans leurs analyses, d√©cisions d'investissement et r√©flexions strat√©giques, en fournissant une expertise de niveau CFA avec rigueur, nuance et esprit critique.
¬´ De la macro √† la micro, des march√©s aux titres ‚Äî j'analyse avec rigueur et pragmatisme. ¬ª

üè¢ Contexte Organisationnel
L'√©quipe que tu assistes :

Localisation : Qu√©bec, Canada
Structure : √âquipe de gestionnaires avec comit√© de placement (r√©unions r√©guli√®res)
Approche de gestion :

D√©tention directe de titres (stock picking)
Style valeur contrarian (contre-courant)
Philosophie pragmatique et analytique
Acceptation de la croissance √† prix raisonnable (GARP)
Utilisation occasionnelle de FNB/fonds pour besoins sp√©cifiques
Positions tactiques en or au besoin

Positions et pr√©f√©rences :
‚úÖ Favoris√©s :

Titres sous-√©valu√©s avec catalyseurs
Analyse fondamentale rigoureuse
Approche contrarian disciplin√©e
Courbes de taux comme outil d'analyse
Vision macro-√©conomique int√©gr√©e

‚ùå √âvit√©s :

Cryptomonnaies
Hype sp√©culatif sans fondamentaux
Valorisations tech excessives sans justification
Suivisme de march√©

‚ö†Ô∏è Vigilance particuli√®re :

Politiques √©conomiques de Trump et impacts
Bulles potentielles dans la tech
Risques g√©opolitiques
Taux d'int√©r√™t et politique mon√©taire

üéì Expertise et Domaines de Comp√©tence
Comp√©tences principales (niveau CFA) :

Analyse de titres : actions, obligations, produits d√©riv√©s
√âvaluation d'entreprises : DCF, multiples, analyse comparative
Macro-√©conomie : politique mon√©taire, cycles √©conomiques, indicateurs avanc√©s
Micro-√©conomie : dynamiques sectorielles, avantages concurrentiels, mod√®les d'affaires
Gestion de risque : volatilit√©, corr√©lations, VAR, stress tests
Allocation d'actifs : construction de portefeuille, optimisation
Courbes de taux : analyse, implications, strat√©gies de positionnement
Indices boursiers : composition, m√©thodologie, interpr√©tation
V√©hicules de placement : FNB, fonds, structures alternatives

Capacit√©s analytiques :

Synth√®se de donn√©es financi√®res complexes
Identification de catalyseurs et de risques
Analyse sectorielle et th√©matique
√âvaluation de situations sp√©ciales
Critique constructive de consensus de march√©

üìä M√©thodologie d'Analyse
Structure type d'analyse compl√®te :
1. Synth√®se ex√©cutive (TL;DR)
R√©ponse directe √† la question en 2-3 phrases maximum
2. Contexte et positionnement

Situation actuelle du titre/secteur/th√®me
Positionnement dans le cycle
Consensus du march√©

3. Analyse approfondie
Forces (Points positifs) :

Avantages concurrentiels
Catalyseurs potentiels
Valorisation attractive
Qualit√© du management
Position financi√®re

Faiblesses (Points n√©gatifs) :

Risques identifi√©s
D√©savantages structurels
Pressions concurrentielles
Valorisation excessive (si applicable)
Gouvernance ou ESG

4. M√©triques cl√©s

Valorisation : P/E, P/B, EV/EBITDA, FCF yield
Croissance : revenus, BPA, marges
Qualit√© : ROE, ROIC, dette/EBITDA
Dividendes : rendement, payout ratio, historique

5. Sc√©narios et recommandations
Selon diff√©rents profils :

Style valeur contrarian : opportunit√©s sous-√©valu√©es
Croissance raisonnable : qualit√© √† prix acceptable
D√©fensif : pr√©servation du capital
Tactique : catalyseurs court terme

Niveaux de conviction :

üü¢ Forte conviction (catalyseurs clairs + valorisation attrayante)
üü° Conviction mod√©r√©e (√©quilibre risque/rendement)
üî¥ √âviter (risques sup√©rieurs au potentiel)

6. Risques et points de surveillance

√âl√©ments √† monitorer
Sc√©narios d√©favorables
Points d'invalidation de la th√®se

üåê Recherche et Sources
M√©thodologie de recherche :

Recherche web syst√©matique pour questions n√©cessitant donn√©es r√©centes
Sources privil√©gi√©es :

Rapports financiers d'entreprises (10-K, 10-Q, MD&A)
Donn√©es Bloomberg, Reuters, Yahoo Finance
Articles Seeking Alpha, Morningstar
Publications √©conomiques : BRI, FMI, banques centrales
Presse financi√®re : WSJ, Financial Times, The Economist, Les Affaires, La Presse Affaires
Recherche sell-side et buy-side (quand accessible)

Citations et sources :

Toujours citer les sources utilis√©es
Privil√©gier articles en fran√ßais (Qu√©bec) et anglais
Format : [Titre de l'article - Source - Date]
Indiquer le niveau de fiabilit√© de la source

Recherche approfondie :

Utiliser plusieurs sources pour validation crois√©e
Rechercher donn√©es contradictoires pour analyse √©quilibr√©e
Actualiser avec donn√©es les plus r√©centes disponibles
Mentionner date de derni√®re mise √† jour

üí¨ Ton et Style de Communication
Principes g√©n√©raux :

Professionnelle mais accessible : expertise sans jargon inutile
√âquilibr√©e : pr√©senter forces ET faiblesses
Factuelle et sourc√©e : donn√©es v√©rifiables
Nuanc√©e : √©viter les certitudes absolues sur les march√©s
Pragmatique : focus sur l'actionnable

Adaptations contextuelles :
Pour discussions de comit√© de placement :

Format structur√© et concis
Focus sur d√©cisions √† prendre
Sc√©narios multiples avec probabilit√©s

Pour analyses approfondies :

D√©tails techniques complets
Comparaisons sectorielles
Analyse historique et prospective

Pour questions rapides :

Synth√®se directe d'abord
D√©tails disponibles si demand√©s

Langage et expressions :

Fran√ßais qu√©b√©cois comme langue principale
Utilisation naturelle de termes anglais financiers courants (ex: "fair value", "free cash flow")
√âviter l'ang√©lisme : reconna√Ætre incertitudes et limites

üö® Limites et Transparence
Ce que tu peux faire :
‚úÖ Analyser des donn√©es financi√®res publiques
‚úÖ Synth√©tiser des informations de sources multiples
‚úÖ Fournir des cadres d'analyse structur√©s
‚úÖ Identifier des risques et opportunit√©s
‚úÖ Proposer des pistes de r√©flexion
Ce que tu NE peux PAS faire :
‚ùå Donner des conseils d'investissement personnalis√©s (tu n'es pas conseiller r√©glement√©)
‚ùå Pr√©dire l'avenir des march√©s avec certitude
‚ùå Acc√©der √† des donn√©es propri√©taires ou confidentielles
‚ùå Remplacer le jugement professionnel de l'√©quipe
Formulations transparentes :

¬´ Selon les donn√©es disponibles... ¬ª
¬´ Les analyses sugg√®rent que... ¬ª
¬´ Parmi les risques √† consid√©rer... ¬ª
¬´ Cette perspective doit √™tre valid√©e par... ¬ª

üîß Int√©gration avec le Dashboard Financier
Contexte technique :
L'utilisateur dispose d'un dashboard avec :

Cours d'actions en temps r√©el
Analyses Seeking Alpha
Actualit√©s financi√®res
Graphiques et m√©triques

Ton r√¥le :

Interpr√©ter les donn√©es affich√©es
Contextualiser les mouvements de march√©
Relier micro et macro
Approfondir au-del√† des chiffres bruts
Compl√©ter avec recherches externes

üìã Exemples d'Interactions
Question type 1 : Analyse d'un titre
Utilisateur : ¬´ Peux-tu analyser BCE Inc. dans le contexte actuel des t√©l√©coms canadiens ? ¬ª
Emma :
Synth√®se : BCE pr√©sente un profil d√©fensif avec rendement attrayant (~7%), mais fait face √† des vents contraires sectoriels (saturation, concurrence, capex 5G).
[Analyse compl√®te suivant la structure : contexte, forces, faiblesses, m√©triques, recommandations, risques]
Sources :

Rapport Q3 2024 BCE
¬´ Les t√©l√©coms canadiens sous pression ¬ª - Les Affaires, oct. 2024
Analyse sectorielle Morningstar

Question type 2 : Macro-√©conomie
Utilisateur : ¬´ Que penses-tu de l'impact potentiel des tarifs douaniers de Trump sur nos positions manufacturi√®res ? ¬ª
Emma :
Perspective : Risque √©lev√© de compression de marges pour les entreprises avec cha√Ænes d'approvisionnement int√©gr√©es US-Canada-Mexique. Opportunit√©s contrarian possibles si surr√©action du march√©.
[Analyse des impacts sectoriels, identification d'opportunit√©s valeur, recommandations de couverture]

Question type 3 : Strat√©gie de portefeuille
Utilisateur : ¬´ Devrions-nous augmenter notre exposition or actuellement ? ¬ª
Emma :
[Analyse du contexte macro : taux r√©els, dollar US, tensions g√©opolitiques]
[Corr√©lations historiques or/actions/obligations]
[Sc√©narios d'allocation selon convictions]

‚öñÔ∏è Signature Emma - Analyste Financi√®re
Valeurs cardinales dans ce r√¥le :

Rigueur analytique et m√©thodologique
Ind√©pendance intellectuelle (contrarian assum√©)
Transparence sur limites et incertitudes
Pragmatisme orient√© d√©cisions
Curiosit√© intellectuelle continue

¬´ Je ne pr√©dis pas les march√©s. Mais j'analyse, je questionne et j'√©claire ‚Äî avec rigueur et humilit√©. ¬ª

üé¨ Activation
Tu es maintenant Emma, Analyste Financi√®re Experte.
R√©ponds toujours en fran√ßais qu√©b√©cois, adopte un ton professionnel √©quilibr√©, et structure tes analyses selon la m√©thodologie d√©crite. N'h√©site pas √† rechercher sur le web pour fournir des donn√©es actuelles et citer tes sources.
Pr√™te √† accompagner l'√©quipe dans leurs d√©cisions d'investissement ?`;
                    setEmmaPrompt(defaultPrompt);
                };

                return (
                    <div className="space-y-6">
                        {/* Animation d'entr√©e Emma */}
                        {showEmmaAnimation && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center">
                                <div className="relative">
                                    {/* Animation de march√© boursier qui monte */}
                                    <div className="absolute -top-20 left-1/2 transform -translate-x-1/2">
                                        <div className="flex space-x-2">
                                            {['üìà', 'üìä', 'üí∞', 'üìà', 'üìä'].map((icon, index) => (
                                                <div
                                                    key={index}
                                                    className="text-2xl animate-bounce"
                                                    style={{
                                                        animationDelay: `${index * 0.2}s`,
                                                        animationDuration: '1s'
                                                    }}
                                                >
                                                    {icon}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {/* Image d'Emma avec effet de fade */}
                                    <div className="relative">
                                        <img
                                            src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'}
                                            alt="Emma - Experte Financi√®re IA"
                                            className="w-64 h-64 rounded-full object-cover shadow-2xl animate-pulse"
                                            style={{
                                                animation: 'fadeInScale 2s ease-in-out'
                                            }}
                                        />
                                        
                                        {/* Effet de brillance */}
                                        <div className="absolute inset-0 rounded-full bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
                                    </div>
                                    
                                    {/* Message de bienvenue anim√© */}
                                    <div className="text-center mt-6">
                                        <h3 className="text-3xl font-bold text-white mb-2 animate-fadeIn">
                                            Bonjour ! Je suis Emma
                                        </h3>
                                        <p className="text-xl text-gray-300 animate-fadeIn" style={{animationDelay: '0.5s'}}>
                                            Votre Experte Financi√®re IA
                                        </p>
                                        <div className="mt-4 flex justify-center space-x-2">
                                            <span className="text-2xl animate-bounce" style={{animationDelay: '1s'}}>üìä</span>
                                            <span className="text-2xl animate-bounce" style={{animationDelay: '1.2s'}}>üí∞</span>
                                            <span className="text-2xl animate-bounce" style={{animationDelay: '1.4s'}}>üìà</span>
                                            <span className="text-2xl animate-bounce" style={{animationDelay: '1.6s'}}>üéØ</span>
                                        </div>
                                    </div>
                                    
                                    {/* Bouton pour fermer l'animation */}
                                    <button
                                        onClick={() => setShowEmmaAnimation(false)}
                                        className="absolute top-4 right-4 text-white hover:text-gray-300 text-2xl"
                                    >
                                        ‚úï
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="flex justify-between items-center">
                            <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>ü§ñ Emma IA</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={clearChat}
                                    className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
                                >
                                    üóëÔ∏è Effacer
                                </button>
                                <button
                                    onClick={() => setEmmaInput('Bonjour Emma, peux-tu m\'aider ?')}
                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                >
                                    üí° Exemple
                                </button>
                                <button
                                    onClick={() => setShowPromptEditor(!showPromptEditor)}
                                    className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors"
                                >
                                    üìù Prompt
                                </button>
                                <div className={`px-3 py-2 rounded text-sm font-medium ${
                                    emmaConnected ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                }`}>
                                    {emmaConnected ? '‚úÖ Gemini Connect√©' : '‚ùå Gemini Non Connect√©'}
                                </div>
                            </div>
                        </div>

                        {/* Zone de chat */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-16 h-16 rounded-full overflow-hidden flex-shrink-0">
                                    <img 
                                        src={isDarkMode ? 'emma-avatar-gob-dark.jpg' : 'emma-avatar-gob-light.jpg'} 
                                        alt="Emma" 
                                        className="w-full h-full object-cover"
                                    />
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                        isDarkMode ? 'text-white' : 'text-gray-900'
                                    }`}>Emma - Consultations Gratuites</h3>
                                    <p className={`text-sm transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                    }`}>Analyse Financi√®re</p>
                                </div>
                            </div>

                            {/* Messages */}
                            <div className={`h-[500px] overflow-y-auto mb-4 p-4 rounded-lg transition-colors duration-300 ${
                                isDarkMode ? 'bg-gray-900' : 'bg-gray-50'
                            }`}>
                                {emmaMessages.length === 0 ? (
                                    <div className="flex gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                                            <img 
                                                src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                alt="Emma" 
                                                className="w-full h-full object-cover"
                                            />
                                        </div>
                                        <div className={`flex-1 p-4 rounded-lg ${
                                            isDarkMode ? 'bg-gray-800' : 'bg-white'
                                        } shadow-sm`}>
                                            <p className={`text-sm leading-relaxed mb-3 ${
                                                isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                            }`}>
                                                üéØ Bonjour au Groupe Ouellet Bolduc ! Je suis Emma, votre Experte financi√®re IA de JSLAI ! üíº‚ú®
                                                
                                                üìä Je peux vous aider avec l'analyse et l'√©valuation financi√®re, l'interpr√©tation des donn√©es boursi√®res, et bien plus encore ! üìàüí∞
                                                
                                                üöÄ Quel est votre d√©fi financier aujourd'hui ?
                                            </p>
                                            <div className={`flex items-start gap-2 p-3 rounded-lg mb-3 ${
                                                isDarkMode ? 'bg-green-900/30 border border-green-800' : 'bg-green-50 border border-green-200'
                                            }`}>
                                                <span className="text-green-500 text-sm">üìß</span>
                                                <span className={`text-xs ${
                                                    isDarkMode ? 'text-green-300' : 'text-green-700'
                                                }`}>
                                                    üí° Astuce : Vous pouvez envoyer cette conversation par courriel en utilisant l'onglet "Envoyer par courriel" ci-dessus !
                                                </span>
                                            </div>
                                            <p className={`text-sm ${
                                                isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                            }`}>
                                                ü§î Comment puis-je vous aider aujourd'hui ? üí°
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {emmaMessages.map((message) => (
                                            <div key={message.id} className={`flex gap-3 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                {message.type !== 'user' && (
                                                    <div className="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                                        <img 
                                                            src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                            alt="Emma" 
                                                            className="w-full h-full object-cover"
                                                        />
                                                    </div>
                                                )}
                                                <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                                                    message.type === 'user' 
                                                        ? 'bg-blue-600 text-white' 
                                                        : message.type === 'error'
                                                        ? 'bg-red-600 text-white'
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-white' 
                                                            : 'bg-gray-200 text-gray-900'
                                                }`}>
                                                    <div className="whitespace-pre-wrap">{message.content}</div>
                                                    <div className={`text-xs mt-1 ${
                                                        message.type === 'user' ? 'text-blue-100' : 'text-gray-400'
                                                    }`}>
                                                        {message.timestamp}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        {emmaLoading && (
                                            <div className="flex gap-3 justify-start">
                                                <div className="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                                    <img 
                                                        src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                        alt="Emma" 
                                                        className="w-full h-full object-cover"
                                                    />
                                                </div>
                                                <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                                                    isDarkMode ? 'bg-gray-700 text-white' : 'bg-gray-200 text-gray-900'
                                                }`}>
                                                    <div className="flex items-center gap-2">
                                                        <div className="animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full"></div>
                                                        <span>Emma r√©fl√©chit...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Input */}
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={emmaInput}
                                    onChange={(e) => setEmmaInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && sendMessageToEmma()}
                                    placeholder="Posez votre question √† Emma..."
                                    className={`flex-1 px-4 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    disabled={emmaLoading}
                                />
                                <button
                                    onClick={sendMessageToEmma}
                                    disabled={emmaLoading || !emmaInput.trim()}
                                    className={`px-6 py-2 rounded-lg font-medium transition-colors duration-300 ${
                                        emmaLoading || !emmaInput.trim()
                                            ? 'bg-gray-400 text-gray-200 cursor-not-allowed'
                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {emmaLoading ? '‚è≥' : 'üì§'}
                                </button>
                            </div>
                        </div>

                        {/* √âditeur de prompt */}
                        {showPromptEditor && (
                            <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            }`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                        isDarkMode ? 'text-white' : 'text-gray-900'
                                    }`}>üìù √âditeur de Prompt Emma</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={resetPrompt}
                                            className="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors"
                                        >
                                            üîÑ R√©initialiser
                                        </button>
                                        <button
                                            onClick={savePrompt}
                                            className="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors"
                                        >
                                            üíæ Sauvegarder
                                        </button>
                                    </div>
                                </div>
                                
                                <textarea
                                    value={emmaPrompt}
                                    onChange={(e) => setEmmaPrompt(e.target.value)}
                                    className={`w-full h-64 p-3 rounded-lg border transition-colors duration-300 font-mono text-sm ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    placeholder="Saisissez votre prompt personnalis√© pour Emma..."
                                />
                                
                                <div className={`mt-3 p-3 rounded-lg text-sm ${
                                    isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-600'
                                }`}>
                                    <p className="font-medium mb-2">Variables disponibles :</p>
                                    <ul className="space-y-1 text-xs">
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{userMessage}"}</code> - Message de l'utilisateur</li>
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{dashboardData}"}</code> - Donn√©es du dashboard</li>
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{currentTime}"}</code> - Heure actuelle</li>
                                    </ul>
                                </div>
                            </div>
                        )}

                        {/* Suggestions rapides */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üí° Suggestions rapides</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                {[
                                    "Comment analyser une action ?",
                                    "O√π trouver les actualit√©s ?",
                                    "Comment utiliser le scraping ?",
                                    "Explique-moi cette donn√©e",
                                    "Qu'est-ce que le P/E ratio ?",
                                    "Comment interpr√©ter les graphiques ?"
                                ].map((suggestion, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setEmmaInput(suggestion)}
                                        className={`p-3 rounded-lg text-left transition-colors duration-300 ${
                                            isDarkMode 
                                                ? 'bg-gray-700 hover:bg-gray-600 text-white' 
                                                : 'bg-gray-100 hover:bg-gray-200 text-gray-900'
                                        }`}
                                    >
                                        <div className="text-sm font-medium">{suggestion}</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Aide contextuelle */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-blue-900/30 border-blue-600' 
                                : 'bg-blue-100/80 border-blue-300'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>‚ÑπÔ∏è √Ä propos d'Emma</h3>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-blue-200' : 'text-blue-800'
                            }`}>
                                <div>‚Ä¢ <strong>Navigation :</strong> Emma vous guide dans l'interface</div>
                                <div>‚Ä¢ <strong>Interpr√©tation :</strong> Explique les donn√©es financi√®res</div>
                                <div>‚Ä¢ <strong>Recommandations :</strong> Sugg√®re les meilleures pratiques</div>
                                <div>‚Ä¢ <strong>Support :</strong> R√©pond √† vos questions techniques</div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Composant onglet Stocks & News
            const StocksNewsTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üìä Titres & nouvelles</h2>
                        <div className="flex gap-2">
                            <div className={`rounded-lg p-1 transition-colors duration-300 ${
                                isDarkMode ? 'bg-gray-700' : 'bg-gray-200'
                            }`}>
                                <button
                                    onClick={() => setViewMode('list')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'list' 
                                            ? (isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-600 text-white')
                                            : (isDarkMode ? 'text-gray-300 hover:text-white' : 'text-gray-600 hover:text-gray-900')
                                    }`}
                                >
                                    üìã Liste
                                </button>
                                <button
                                    onClick={() => setViewMode('cards')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'cards' 
                                            ? (isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-600 text-white')
                                            : (isDarkMode ? 'text-gray-300 hover:text-white' : 'text-gray-600 hover:text-gray-900')
                                    }`}
                                >
                                    üé¥ Cartes
                                </button>
                            </div>
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                            >
                                Actualiser News
                            </button>
                        </div>
                    </div>

                    {lastUpdate && (
                        <p className="text-gray-400 text-sm">
                            Derni√®re mise √† jour: {new Date(lastUpdate).toLocaleString('fr-FR')}
                        </p>
                    )}

                    {/* Debug des donn√©es */}
                    <div className="bg-gray-900 rounded-lg p-4 border border-gray-600">
                        <h3 className="text-lg font-semibold text-white mb-4">üîç Debug des Donn√©es</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div className="bg-gray-800 rounded p-3 border border-gray-600">
                                <div className="text-blue-400 font-medium mb-2">üìä Stock Data</div>
                                <div className="text-gray-200">
                                    Tickers: {tickers.length} ({tickers.join(', ')})
                                </div>
                                <div className="text-gray-200">
                                    Donn√©es charg√©es: {Object.keys(stockData).length}
                                </div>
                                <div className="text-gray-200">
                                    Derni√®re MAJ: {lastUpdate ? new Date(lastUpdate).toLocaleString('fr-FR') : 'Jamais'}
                                </div>
                            </div>
                            <div className="bg-gray-800 rounded p-3 border border-gray-600">
                                <div className="text-emerald-400 font-medium mb-2">üì∞ News Data</div>
                                <div className="text-gray-200">
                                    Articles: {newsData.length}
                                </div>
                                <div className="text-gray-200">
                                    Premier article: {newsData[0]?.title?.substring(0, 30) || 'Aucun'}...
                                </div>
                            </div>
                            <div className="bg-gray-800 rounded p-3 border border-gray-600">
                                <div className="text-violet-400 font-medium mb-2">üéØ Seeking Alpha</div>
                                <div className="text-gray-200">
                                    Stocks: {seekingAlphaData.stocks?.length || 0}
                                </div>
                                <div className="text-gray-200">
                                    Stock Data: {Object.keys(seekingAlphaStockData.stocks || {}).length}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Section Donn√©es Financi√®res & Actualit√©s (Finnhub) - PRINCIPALE */}
                    <div className="mt-8">
                        <div className={`backdrop-blur-sm rounded-2xl p-8 border-2 shadow-2xl transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gradient-to-br from-gray-800/90 to-gray-900/90 border-blue-500/30 shadow-blue-500/10' 
                                : 'bg-gradient-to-br from-white/95 to-gray-50/95 border-blue-400/40 shadow-blue-400/10'
                        }`}>
                            <div className="text-center mb-8">
                                <h2 className={`text-4xl font-bold mb-4 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>
                                    üìä Donn√©es Financi√®res & Actualit√©s
                                </h2>
                                <div className={`inline-flex items-center px-6 py-3 rounded-full text-lg font-semibold transition-colors duration-300 ${
                                    isDarkMode 
                                        ? 'bg-blue-600/20 text-blue-300 border border-blue-500/30' 
                                        : 'bg-blue-100/80 text-blue-700 border border-blue-300/50'
                                }`}>
                                    <span className="mr-2">üîó</span>
                                    Source: Finnhub API
                                </div>
                                <p className={`text-lg mt-4 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                }`}>
                                    Donn√©es en temps r√©el avec 3 actualit√©s par titre
                                </p>
                            </div>
                            <div className="overflow-x-auto max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-800 relative">
                                <table className="w-full text-base">
                                    <thead>
                                        <tr className={`border-b-2 transition-colors duration-300 ${
                                            isDarkMode ? 'border-blue-500/50 bg-gray-900' : 'border-blue-400/50 bg-gray-100'
                                        }`}>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìà Ticker</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üí∞ Prix</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìä Change</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìà P/E</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üíé Dividende</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üè¢ Secteur</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>‚≠ê Rating</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üòä Sentiment</th>
                                            <th className={`text-left py-4 px-3 font-bold text-lg transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>‚ö° Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {tickers.map(ticker => {
                                            // Donn√©es de Finnhub uniquement
                                            const finnhubData = stockData[ticker];
                                            const price = finnhubData?.c ? `$${finnhubData.c.toFixed(2)}` : 'N/A';
                                            const change = finnhubData?.d ? `${finnhubData.d > 0 ? '+' : ''}${finnhubData.d.toFixed(2)}` : 'N/A';
                                            const changePercent = finnhubData?.dp ? `${finnhubData.dp > 0 ? '+' : ''}${finnhubData.dp.toFixed(2)}%` : 'N/A';
                                            const changeColor = finnhubData?.d > 0 ? 'text-green-400' : finnhubData?.d < 0 ? 'text-red-400' : 'text-gray-400';
                                            
                                            // Donn√©es de profil Finnhub
                                            const profile = finnhubData?.profile;
                                            const peRatio = profile?.pe ? profile.pe.toFixed(2) : 'N/A';
                                            const dividendYield = profile?.dividend ? `${(profile.dividend * 100).toFixed(2)}%` : 'N/A';
                                            const sector = profile?.industry || 'N/A';
                                            
                                            // Donn√©es de recommandation Finnhub
                                            const recommendation = finnhubData?.recommendation;
                                            const rating = recommendation?.length > 0 ? 
                                                (recommendation[0].buy + recommendation[0].strongBuy > recommendation[0].sell + recommendation[0].strongSell ? 'Achat' : 
                                                 recommendation[0].sell + recommendation[0].strongSell > recommendation[0].buy + recommendation[0].strongBuy ? 'Vente' : 'Neutre') : 'N/A';
                                            
                                            // 3 actualit√©s les plus r√©centes pour ce ticker
                                            const tickerNews = newsData.filter(article => {
                                                const text = (article.title + ' ' + article.description).toLowerCase();
                                                return text.includes(ticker.toLowerCase());
                                            }).slice(0, 3);
                                            
                                            // Analyse du sentiment
                                            const analyzeSentiment = (title, description) => {
                                                const text = (title + ' ' + description).toLowerCase();
                                                const positiveWords = ['hausse', 'croissance', 'gain', 'profit', 'positif', 'am√©lioration', 'succ√®s', 'fort', 'solide'];
                                                const negativeWords = ['baisse', 'chute', 'perte', 'n√©gatif', 'd√©clin', 'faible', 'probl√®me', 'risque', 'inqui√©tude'];
                                                
                                                const positiveCount = positiveWords.filter(word => text.includes(word)).length;
                                                const negativeCount = negativeWords.filter(word => text.includes(word)).length;
                                                
                                                if (positiveCount > negativeCount) return { sentiment: 'Positif', color: 'text-green-400' };
                                                if (negativeCount > positiveCount) return { sentiment: 'N√©gatif', color: 'text-red-400' };
                                                return { sentiment: 'Neutre', color: 'text-gray-400' };
                                            };
                                            
                                            const sentiment = tickerNews.length > 0 ? analyzeSentiment(tickerNews[0].title, tickerNews[0].description) : { sentiment: 'N/A', color: 'text-gray-400' };
                                            
                                            return (
                                                <React.Fragment key={ticker}>
                                                    {/* Ligne principale - STYLE PRINCIPAL */}
                                                    <tr className={`border-b-2 transition-all duration-300 hover:scale-[1.02] ${
                                                        isDarkMode 
                                                            ? 'border-gray-600/50 hover:bg-gradient-to-r hover:from-gray-800/80 hover:to-gray-700/80 hover:shadow-lg hover:shadow-blue-500/10' 
                                                            : 'border-gray-300/50 hover:bg-gradient-to-r hover:from-gray-50/80 hover:to-white/80 hover:shadow-lg hover:shadow-blue-400/10'
                                                    }`}>
                                                        <td className="py-4 px-3">
                                                            <div className="flex items-center gap-3">
                                                                <img 
                                                                    src={getCompanyLogo(ticker)} 
                                                                    alt={`${ticker} logo`}
                                                                    className="w-8 h-8 rounded-lg shadow-md"
                                                                    onError={(e) => {
                                                                        e.target.style.display = 'none';
                                                                    }}
                                                                />
                                                                <span className={`font-mono font-bold text-xl transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>{ticker}</span>
                                                            </div>
                                                        </td>
                                                        <td className={`py-4 px-3 font-bold text-xl transition-colors duration-300 ${
                                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                                        }`}>{price}</td>
                                                        <td className={`py-4 px-3 font-bold text-lg transition-colors duration-300 ${changeColor}`}>
                                                            {change} ({changePercent})
                                                        </td>
                                                        <td className={`py-4 px-3 font-semibold text-lg transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                        }`}>{peRatio}</td>
                                                        <td className={`py-4 px-3 font-semibold text-lg transition-colors duration-300 ${
                                                            isDarkMode ? 'text-green-300' : 'text-green-600'
                                                        }`}>{dividendYield}</td>
                                                        <td className={`py-4 px-3 font-medium text-base transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                        }`}>{cleanText(sector)}</td>
                                                        <td className="py-4 px-3">
                                                            <span className={`px-4 py-2 rounded-full text-sm font-bold transition-colors duration-300 ${
                                                                rating === 'Achat' ? 'bg-green-500 text-white' :
                                                                rating === 'Vente' ? 'bg-red-500 text-white' :
                                                                'bg-yellow-500 text-black'
                                                            }`}>
                                                                {rating}
                                                            </span>
                                                        </td>
                                                        <td className="py-4 px-3">
                                                            <div className={`flex items-center gap-2 px-3 py-2 rounded-full transition-colors duration-300 ${
                                                                sentiment.sentiment === 'Positif' ? 'bg-green-100 text-green-800' :
                                                                sentiment.sentiment === 'N√©gatif' ? 'bg-red-100 text-red-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                <span className="text-lg">
                                                                    {sentiment.sentiment === 'Positif' ? 'üòä' : 
                                                                     sentiment.sentiment === 'N√©gatif' ? 'üòü' : 'üòê'}
                                                                </span>
                                                                <span className="font-semibold">{sentiment.sentiment}</span>
                                                            </div>
                                                        </td>
                                                        <td className="py-4 px-3">
                                                            <button
                                                                onClick={() => setSelectedStock(ticker)}
                                                                className={`px-6 py-3 text-sm font-bold rounded-xl transition-all duration-300 hover:scale-105 shadow-lg ${
                                                                    isDarkMode 
                                                                        ? 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white shadow-blue-500/25' 
                                                                        : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white shadow-blue-400/25'
                                                                }`}
                                                            >
                                                                üìä Voir d√©tail
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    
                                                    {/* Lignes d'actualit√©s (3 maximum) - STYLE AM√âLIOR√â */}
                                                    {tickerNews.map((news, newsIndex) => (
                                                        <tr key={`${ticker}-news-${newsIndex}`} className={`border-b-2 transition-all duration-300 hover:scale-[1.01] ${
                                                            isDarkMode 
                                                                ? 'border-gray-600/30 bg-gradient-to-r from-gray-800/40 to-gray-700/40 hover:from-gray-700/60 hover:to-gray-600/60' 
                                                                : 'border-gray-300/30 bg-gradient-to-r from-gray-50/60 to-white/60 hover:from-gray-100/80 hover:to-gray-50/80'
                                                        }`}>
                                                            <td colSpan="9" className="py-6 px-4">
                                                                <div className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                                }`}>
                                                                    <div className="flex items-start gap-4">
                                                                        <div className={`p-3 rounded-full transition-colors duration-300 ${
                                                                            isDarkMode ? 'bg-blue-600/20 text-blue-300' : 'bg-blue-100 text-blue-600'
                                                                        }`}>
                                                                            <span className="text-2xl">üì∞</span>
                                                                        </div>
                                                                        <div className="flex-1">
                                                                            <h5 className={`font-bold text-lg mb-3 transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                                                            }`}>
                                                                                {news.url ? (
                                                                                    <a 
                                                                                        href={news.url} 
                                                                                        target="_blank" 
                                                                                        rel="noopener noreferrer"
                                                                                        className={`hover:underline transition-colors duration-300 ${
                                                                                            isDarkMode 
                                                                                                ? 'text-blue-300 hover:text-blue-200' 
                                                                                                : 'text-blue-600 hover:text-blue-700'
                                                                                        }`}
                                                                                    >
                                                                                        {cleanText(news.title)}
                                                                                    </a>
                                                                                ) : (
                                                                                    cleanText(news.title)
                                                                                )}
                                                                            </h5>
                                                                            <p className={`text-base mb-4 leading-relaxed transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                            }`}>
                                                                                {cleanText(news.description)}
                                                                            </p>
                                                                            <div className={`flex items-center gap-4 text-sm transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                            }`}>
                                                                                <div className={`flex items-center gap-2 px-3 py-1 rounded-full transition-colors duration-300 ${
                                                                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
                                                                                }`}>
                                                                                    <span className="font-semibold">{news.source?.name || 'Source inconnue'}</span>
                                                                                </div>
                                                                                <div className={`flex items-center gap-2 px-3 py-1 rounded-full transition-colors duration-300 ${
                                                                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
                                                                                }`}>
                                                                                    <span>üïí</span>
                                                                                    <span>
                                                                                        {news.publishedAt ? 
                                                                                            new Date(news.publishedAt).toLocaleString('fr-FR') : 
                                                                                            'Date inconnue'
                                                                                        }
                                                                                    </span>
                                                                                </div>
                                                                                {news.url && (
                                                                                    <a 
                                                                                        href={news.url} 
                                                                                        target="_blank" 
                                                                                        rel="noopener noreferrer"
                                                                                        className={`px-4 py-2 rounded-full font-semibold transition-all duration-300 hover:scale-105 ${
                                                                                            isDarkMode 
                                                                                                ? 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/25' 
                                                                                                : 'bg-blue-500 hover:bg-blue-400 text-white shadow-lg shadow-blue-400/25'
                                                                                        }`}
                                                                                    >
                                                                                        üìñ Lire l'article
                                                                                    </a>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </React.Fragment>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                            <div className={`text-center mt-8 p-6 rounded-xl transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-500/20' 
                                    : 'bg-gradient-to-r from-blue-100/80 to-purple-100/80 border border-blue-300/30'
                            }`}>
                                <div className={`text-lg font-semibold mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                }`}>
                                    üìú Section Principale - Donn√©es Financi√®res
                                </div>
                                <div className={`text-sm transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                }`}>
                                    Faites d√©filer pour voir toutes les donn√©es ‚Ä¢ Source: Finnhub API ‚Ä¢ 3 actualit√©s par titre
                                </div>
                                <div className={`text-xs mt-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>
                                    Donn√©es mises √† jour automatiquement toutes les 5 minutes
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Vue en liste compacte */}
                    {viewMode === 'list' && tickers.length > 0 && (
                        <div className="bg-gray-900 rounded-lg p-4 border border-gray-600">
                            <h3 className="text-lg font-semibold text-white mb-4">üìã Vue Liste</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b border-gray-600">
                                            <th className="text-left py-2 text-gray-300">Ticker</th>
                                            <th className="text-left py-2 text-gray-300">Prix</th>
                                            <th className="text-left py-2 text-gray-300">Change</th>
                                            <th className="text-left py-2 text-gray-300">P/E</th>
                                            <th className="text-left py-2 text-gray-300">Dividende</th>
                                            <th className="text-left py-2 text-gray-300">Secteur</th>
                                            <th className="text-left py-2 text-gray-300">Rating</th>
                                            <th className="text-left py-2 text-gray-300">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        {tickers.map(ticker => {
                            const data = stockData[ticker];
                                            const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                            const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            const parsedData = seekingAlphaItem?.parsedData;
                                            
                                            if (!data && !claudeData && !parsedData) return null;

                                            // Priorit√©: Claude > Parsed > Finnhub
                                            const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                            const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                            const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                            const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                            const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                            const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                            
                                            const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';

                            return (
                                                <tr key={ticker} className="border-b border-gray-700 hover:bg-gray-800 cursor-pointer"
                                                    onClick={() => setSelectedStock(ticker)}>
                                                    <td className="py-3">
                                                        <div className="flex items-center gap-2">
                                                            <img 
                                                                src={getCompanyLogo(ticker)} 
                                                                alt={`${ticker} logo`}
                                                                className="w-6 h-6 rounded"
                                                                onError={(e) => {
                                                                    e.target.style.display = 'none';
                                                                }}
                                                            />
                                                            <span className="font-mono text-white font-bold">{ticker}</span>
                                                        </div>
                                                    </td>
                                                    <td className="py-3 text-white">{price}</td>
                                                    <td className={`py-3 ${changeColor}`}>{change}</td>
                                                    <td className="py-3 text-white">{peRatio}</td>
                                                    <td className="py-3 text-white">{dividendYield}</td>
                                                    <td className="py-3 text-white text-xs">{cleanText(sector)}</td>
                                                    <td className="py-3">
                                                        <span className="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold">
                                                            {rating}
                                        </span>
                                                    </td>
                                                    <td className="py-3">
                                                        <button className="text-blue-400 hover:text-blue-300 text-xs">
                                                            Voir fiche ‚Üí
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                                    </div>
                        </div>
                    )}

                    {/* Cartes condens√©es */}
                    {viewMode === 'cards' && tickers.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {tickers.map(ticker => {
                                const data = stockData[ticker];
                                const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (!data && !claudeData && !parsedData) return null;

                                // Priorit√©: Claude > Parsed > Finnhub
                                const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                const marketCap = claudeData?.metrics?.marketCap || parsedData?.marketCap || 'N/A';
                                const companyName = claudeData?.companyName || parsedData?.companyName || 'N/A';
                                const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                
                                const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                const changeBgColor = (change.includes('+') || change.includes('green')) ? 'bg-green-500' : 'bg-red-500';

                                return (
                                    <div key={ticker} className="bg-gray-900 rounded-lg p-6 border border-gray-600 hover:border-blue-400/50 transition-all cursor-pointer"
                                         onClick={() => setSelectedStock(ticker)}>
                                        
                                        {/* Header avec ticker et rating */}
                                        <div className="flex justify-between items-start mb-6">
                                            <div className="flex items-center gap-3">
                                                <img 
                                                    src={getCompanyLogo(ticker)} 
                                                    alt={`${ticker} logo`}
                                                    className="w-12 h-12 rounded-lg"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                    }}
                                                />
                                                <div>
                                                    <h3 className="text-2xl font-bold text-white">{ticker}</h3>
                                                    <p className="text-sm text-gray-400">
                                                        {cleanText(companyName)}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-sm">
                                                {rating}
                                            </div>
                                    </div>
                                    
                                        {/* Prix et changement */}
                                        <div className="bg-gray-800 rounded-lg p-4 mb-6 border border-gray-600">
                                            <div className="text-3xl font-bold text-white mb-1">
                                                {price}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className={`w-4 h-4 ${changeBgColor} rounded`}></div>
                                                <span className={`text-sm font-medium ${changeColor}`}>
                                                    {change}
                                                </span>
                                            </div>
                                        </div>
                                    
                                        {/* M√©triques cl√©s */}
                                        <div className="space-y-3 mb-6">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Market Cap</span>
                                                <span className="text-white font-medium">{marketCap}</span>
                                    </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">P/E Ratio</span>
                                                <span className="text-white font-medium">{peRatio}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Dividend</span>
                                                <span className="text-white font-medium">{dividendYield}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Secteur</span>
                                                <span className="text-white font-medium">{cleanText(sector)}</span>
                                            </div>
                                        </div>

                                        {/* Quant Ratings */}
                                        {claudeData?.quantRating && (
                                            <div className="mb-6">
                                                <div className="border-t border-gray-600 pt-4">
                                                    <h4 className="text-center text-gray-300 text-sm font-medium mb-4">QUANT RATINGS</h4>
                                                    <div className="flex justify-center gap-3">
                                                        {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                            if (!value || key === 'overall') return null;
                                                            const shortKey = key.substring(0, 3);
                                                            return (
                                                                <div key={key} className="text-center">
                                                                    <div className="text-xs text-gray-400 mb-1">{shortKey}</div>
                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getGradeColor(value)}`}>
                                                                        {value}
                                                                    </span>
                                </div>
                            );
                        })}
                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Call to action */}
                                        <div className="text-center">
                                            <div className="flex items-center justify-center gap-2 text-gray-400 text-sm">
                                                <span>üëÜ</span>
                                                <span>Cliquez pour le rapport d√©taill√©</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Section Actualit√©s par Ticker */}
                    {tickers.length > 0 && (
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <div className="flex items-center justify-between mb-4">
                                <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>üì∞ Actualit√©s par Ticker</h3>
                                <button 
                                    onClick={fetchNews}
                                    className={`px-3 py-1 text-sm rounded transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-blue-600 hover:bg-blue-700 text-white' 
                                            : 'bg-blue-500 hover:bg-blue-600 text-white'
                                    }`}
                                >
                                    üîÑ Actualiser
                                </button>
                            </div>
                            
                            {newsData.length === 0 ? (
                                <div className={`text-center py-8 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>
                                    <div className="text-4xl mb-2">üì∞</div>
                                    <p>Aucune actualit√© disponible</p>
                                    <p className="text-sm mt-1">Cliquez sur "Actualiser" pour charger les actualit√©s</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-800 relative">
                                    {tickers.map(ticker => {
                                        // Filtrer les actualit√©s pour ce ticker
                                        const tickerNews = newsData.filter(article => {
                                            const text = (article.title + ' ' + article.description).toLowerCase();
                                            return text.includes(ticker.toLowerCase());
                                        });
                                        
                                        if (tickerNews.length === 0) return null;
                                        
                                        return (
                                            <div key={ticker} className={`rounded-lg p-4 transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border border-gray-700' 
                                                    : 'bg-gray-100 border border-gray-300'
                                            }`}>
                                                <h4 className={`font-semibold mb-3 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                }`}>
                                                    üìà {ticker} - {tickerNews.length} actualit√©{tickerNews.length > 1 ? 's' : ''}
                                                </h4>
                                                <div className="space-y-3">
                                                    {tickerNews.slice(0, 3).map((article, index) => (
                                                        <div key={index} className={`p-3 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'bg-gray-900 hover:bg-gray-800' 
                                                                : 'bg-gray-100 hover:bg-white'
                                                        }`}>
                                                            <div className="flex items-start gap-3">
                                                                <span className={`text-sm transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-blue-400' : 'text-blue-600'
                                                                }`}>üì∞</span>
                                                                <div className="flex-1">
                                                                    <h5 className={`font-medium mb-1 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                                                    }`}>
                                                                        {article.url ? (
                                                                            <a 
                                                                                href={article.url} 
                                                                                target="_blank" 
                                                                                rel="noopener noreferrer"
                                                                                className={`hover:underline transition-colors duration-300 ${
                                                                                    isDarkMode 
                                                                                        ? 'text-blue-400 hover:text-blue-300' 
                                                                                        : 'text-blue-600 hover:text-blue-700'
                                                                                }`}
                                                                            >
                                                                                {cleanText(article.title)}
                                                                            </a>
                                                                        ) : (
                                                                            cleanText(article.title)
                                                                        )}
                                                                    </h5>
                                                                    <p className={`text-sm mb-2 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                    }`}>
                                                                        {cleanText(article.description)}
                                                                    </p>
                                                                    <div className={`flex items-center gap-2 text-xs transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                    }`}>
                                                                        <span>{article.source?.name || 'Source inconnue'}</span>
                                                                        <span>‚Ä¢</span>
                                                                        <span>
                                                                            {article.publishedAt ? 
                                                                                new Date(article.publishedAt).toLocaleString('fr-FR') : 
                                                                                'Date inconnue'
                                                                            }
                                                                        </span>
                                                                        {article.url && (
                                                                            <>
                                                                                <span>‚Ä¢</span>
                                                                                <a 
                                                                                    href={article.url} 
                                                                                    target="_blank" 
                                                                                    rel="noopener noreferrer"
                                                                                    className={`hover:underline transition-colors duration-300 ${
                                                                                        isDarkMode 
                                                                                            ? 'text-blue-400 hover:text-blue-300' 
                                                                                            : 'text-blue-600 hover:text-blue-700'
                                                                                    }`}
                                                                                >
                                                                                    Lire l'article ‚Üí
                                                                                </a>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {tickerNews.length > 3 && (
                                                        <div className={`text-center text-sm transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                        }`}>
                                                            ... et {tickerNews.length - 3} autre{tickerNews.length - 3 > 1 ? 's' : ''} actualit√©{tickerNews.length - 3 > 1 ? 's' : ''}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {/* Actualit√©s g√©n√©rales */}
                                    {(() => {
                                        const generalNews = newsData.filter(article => {
                                            const text = (article.title + ' ' + article.description).toLowerCase();
                                            return !tickers.some(ticker => text.includes(ticker.toLowerCase()));
                                        });
                                        
                                        if (generalNews.length === 0) return null;
                                        
                                        return (
                                            <div className={`rounded-lg p-4 transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border border-gray-700' 
                                                    : 'bg-gray-100 border border-gray-300'
                                            }`}>
                                                <h4 className={`font-semibold mb-3 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                }`}>
                                                    üåê Actualit√©s G√©n√©rales - {generalNews.length} actualit√©{generalNews.length > 1 ? 's' : ''}
                                                </h4>
                                                <div className="space-y-3">
                                                    {generalNews.slice(0, 5).map((article, index) => (
                                                        <div key={index} className={`p-3 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'bg-gray-900 hover:bg-gray-800' 
                                                                : 'bg-gray-100 hover:bg-white'
                                                        }`}>
                                                            <div className="flex items-start gap-3">
                                                                <span className={`text-sm transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-blue-400' : 'text-blue-600'
                                                                }`}>üåê</span>
                                                                <div className="flex-1">
                                                                    <h5 className={`font-medium mb-1 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                                                    }`}>
                                                                        {article.url ? (
                                                                            <a 
                                                                                href={article.url} 
                                                                                target="_blank" 
                                                                                rel="noopener noreferrer"
                                                                                className={`hover:underline transition-colors duration-300 ${
                                                                                    isDarkMode 
                                                                                        ? 'text-blue-400 hover:text-blue-300' 
                                                                                        : 'text-blue-600 hover:text-blue-700'
                                                                                }`}
                                                                            >
                                                                                {cleanText(article.title)}
                                                                            </a>
                                                                        ) : (
                                                                            cleanText(article.title)
                                                                        )}
                                                                    </h5>
                                                                    <p className={`text-sm mb-2 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                    }`}>
                                                                        {cleanText(article.description)}
                                                                    </p>
                                                                    <div className={`flex items-center gap-2 text-xs transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                    }`}>
                                                                        <span>{article.source?.name || 'Source inconnue'}</span>
                                                                        <span>‚Ä¢</span>
                                                                        <span>
                                                                            {article.publishedAt ? 
                                                                                new Date(article.publishedAt).toLocaleString('fr-FR') : 
                                                                                'Date inconnue'
                                                                            }
                                                                        </span>
                                                                        {article.url && (
                                                                            <>
                                                                                <span>‚Ä¢</span>
                                                                                <a 
                                                                                    href={article.url} 
                                                                                    target="_blank" 
                                                                                    rel="noopener noreferrer"
                                                                                    className={`hover:underline transition-colors duration-300 ${
                                                                                        isDarkMode 
                                                                                            ? 'text-blue-400 hover:text-blue-300' 
                                                                                            : 'text-blue-600 hover:text-blue-700'
                                                                                    }`}
                                                                                >
                                                                                    Lire l'article ‚Üí
                                                                                </a>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            )}
                            <div className={`text-xs text-center mt-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-500'
                            }`}>
                                üì∞ Faites d√©filer pour voir toutes les actualit√©s
                            </div>
                        </div>
                    )}

                    {/* Message si aucune donn√©e */}
                    {tickers.length === 0 && (
                        <div className="bg-yellow-900/20 backdrop-blur-sm rounded-lg p-6 border border-yellow-300/20">
                            <div className="flex items-center gap-3">
                                <span className="text-yellow-400 text-2xl">‚ö†Ô∏è</span>
                                <div>
                                    <h3 className="text-yellow-200 font-semibold">Aucun ticker configur√©</h3>
                                    <p className="text-yellow-300/80 text-sm mt-1">
                                        Ajoutez des tickers dans l'onglet Seeking Alpha pour voir les donn√©es ici.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Section des actualit√©s */}
                    <div className="mt-8">
                        <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-white">üì∞ Actualit√©s Financi√®res</h3>
                            <div className="flex gap-2">
                                <select 
                                    className="px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none"
                                    value={newsFilter}
                                    onChange={(e) => filterNews(e.target.value)}
                                >
                                    <option value="all">Tous les tickers</option>
                                    {tickers.map(ticker => (
                                        <option key={ticker} value={ticker}>{ticker}</option>
                                    ))}
                                </select>
                                <button
                                    onClick={fetchNews}
                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    üîÑ Actualiser
                                </button>
                            </div>
                        </div>

                        {filteredNews.length > 0 ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredNews.slice(0, 9).map((article, index) => {
                                    // Analyser le sentiment de l'article
                                    const analyzeSentiment = (title, description) => {
                                        if (!title && !description) return { sentiment: 'Neutre', color: 'text-gray-400', bgColor: 'bg-gray-100', icon: 'üòê' };
                                        
                                        const text = (title + ' ' + description).toLowerCase();
                                        const positiveWords = ['strong', 'growth', 'increase', 'rise', 'gain', 'positive', 'beat', 'exceed', 'surge', 'rally', 'boost', 'fort', 'croissance', 'hausse', 'gain', 'positif', 'd√©passer'];
                                        const negativeWords = ['decline', 'fall', 'drop', 'loss', 'negative', 'miss', 'weak', 'concern', 'risk', 'challenge', 'baisse', 'chute', 'perte', 'n√©gatif', 'manquer', 'faible', 'pr√©occupation', 'risque'];
                                        
                                        const positiveCount = positiveWords.filter(word => text.includes(word)).length;
                                        const negativeCount = negativeWords.filter(word => text.includes(word)).length;
                                        
                                        if (positiveCount > negativeCount) {
                                            return { sentiment: 'Positif', color: 'text-green-400', bgColor: 'bg-green-100', icon: 'üìà' };
                                        } else if (negativeCount > positiveCount) {
                                            return { sentiment: 'N√©gatif', color: 'text-red-400', bgColor: 'bg-red-100', icon: 'üìâ' };
                                        } else {
                                            return { sentiment: 'Neutre', color: 'text-gray-400', bgColor: 'bg-gray-100', icon: 'üòê' };
                                        }
                                    };

                                    const sentiment = analyzeSentiment(article.title, article.description);
                                    const publishedDate = new Date(article.publishedAt).toLocaleDateString('fr-FR', {
                                        day: 'numeric',
                                        month: 'short',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    return (
                                        <div key={index} className="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-300/40 transition-all cursor-pointer group news-card">
                                            {/* Header avec sentiment */}
                                            <div className="flex justify-between items-start mb-4">
                                                <div className={`px-3 py-1 rounded-full text-xs font-medium ${sentiment.bgColor} ${sentiment.color}`}>
                                                    {sentiment.icon} {sentiment.sentiment}
                                                </div>
                                                <span className="text-xs text-gray-400">{publishedDate}</span>
                                            </div>

                                            {/* Titre de l'article */}
                                            <h4 className="text-white font-semibold mb-3 line-clamp-2 group-hover:text-blue-300 transition-colors">
                                                {article.title}
                                            </h4>

                                            {/* Description */}
                                            <p className="text-gray-300 text-sm mb-4 line-clamp-3">
                                                {article.description}
                                            </p>

                                            {/* Source et lien */}
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs text-gray-400">
                                                    {article.source?.name || 'Source inconnue'}
                                                </span>
                                                <a
                                                    href={article.url}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="text-blue-400 hover:text-blue-300 text-sm font-medium transition-colors"
                                                    onClick={(e) => e.stopPropagation()}
                                                >
                                                    Lire plus ‚Üí
                                                </a>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <div className="bg-gray-800 rounded-lg p-8 text-center border border-gray-700">
                                <div className="text-6xl mb-4">üì∞</div>
                                <h4 className="text-white text-lg font-semibold mb-2">Aucune actualit√© disponible</h4>
                                <p className="text-gray-400 mb-4">Cliquez sur "Actualiser" pour charger les derni√®res actualit√©s financi√®res</p>
                                <button
                                    onClick={fetchNews}
                                    className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    Charger les actualit√©s
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Section des graphiques de prix */}
                    <div className="mt-8">
                        <h3 className="text-xl font-bold text-white mb-6">üìä Graphiques de Prix</h3>
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {tickers.slice(0, 4).map(ticker => {
                                const data = stockData[ticker];
                                const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                
                                return (
                                    <div key={ticker} className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                        <div className="flex justify-between items-center mb-4">
                                            <h4 className="text-white font-bold text-lg">{ticker}</h4>
                                            <div className="text-right">
                                                <div className="text-white font-semibold">{price}</div>
                                                <div className={`text-sm ${changeColor}`}>{change}</div>
                            </div>
                                        </div>
                                        
                                        {/* Placeholder pour le graphique */}
                                        <div className="h-48 bg-gray-700 rounded-lg flex items-center justify-center">
                                            <div className="text-center">
                                                <div className="text-4xl mb-2">üìà</div>
                                                <p className="text-gray-400 text-sm">Graphique interactif</p>
                                                <p className="text-gray-500 text-xs">Chart.js sera int√©gr√© ici</p>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-4 flex justify-between text-sm text-gray-400">
                                            <span>1D</span>
                                            <span>1W</span>
                                            <span>1M</span>
                                            <span>3M</span>
                                            <span>1Y</span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                </div>
            );


            // Fonction pour ajouter un ticker
            const addTicker = () => {
                if (newTicker.trim() && !tickers.includes(newTicker.trim().toUpperCase())) {
                    const updatedTickers = [...tickers, newTicker.trim().toUpperCase()];
                    setTickers(updatedTickers);
                    setNewTicker('');
                    addScrapingLog(`‚úÖ Ticker ${newTicker.trim().toUpperCase()} ajout√©`, 'success');
                }
            };

            // Fonction pour supprimer un ticker
            const removeTicker = (tickerToRemove) => {
                const updatedTickers = tickers.filter(ticker => ticker !== tickerToRemove);
                setTickers(updatedTickers);
                addScrapingLog(`‚úÖ Ticker ${tickerToRemove} supprim√©`, 'success');
            };

            // Fonction pour sauvegarder les tickers sur GitHub
            const saveTickersToGitHub = async () => {
                try {
                    const response = await fetch('/api/github-tickers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ tickers })
                    });
                    
                    if (response.ok) {
                        addScrapingLog('‚úÖ Tickers sauvegard√©s sur GitHub', 'success');
                    } else {
                        addScrapingLog('‚ùå Erreur lors de la sauvegarde des tickers', 'error');
                    }
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur: ${error.message}`, 'error');
                }
            };

            // Fonction pour charger les tickers depuis GitHub
            const loadTickersFromGitHub = async () => {
                try {
                    const response = await fetch('/api/github-tickers');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.tickers && Array.isArray(data.tickers)) {
                            setTickers(data.tickers);
                            addScrapingLog('‚úÖ Tickers charg√©s depuis GitHub', 'success');
                        }
                    } else {
                        addScrapingLog('‚ùå Erreur lors du chargement des tickers', 'error');
                    }
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur: ${error.message}`, 'error');
                }
            };

            // Fonction pour sauvegarder la watchlist sur GitHub
            const saveWatchlistToGitHub = async (watchlistTickers) => {
                try {
                    const response = await fetch('/api/github-watchlist', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ tickers: watchlistTickers })
                    });
                    
                    if (response.ok) {
                        addScrapingLog('‚úÖ Watchlist sauvegard√©e sur GitHub', 'success');
                    } else {
                        addScrapingLog('‚ùå Erreur lors de la sauvegarde de la watchlist', 'error');
                    }
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur: ${error.message}`, 'error');
                }
            };

            // Fonction pour charger la watchlist depuis GitHub
            const loadWatchlistFromGitHub = async () => {
                try {
                    const response = await fetch('/api/github-watchlist');
                    if (response.ok) {
                        const data = await response.json();
                        if (data.tickers && Array.isArray(data.tickers)) {
                            return data.tickers;
                        }
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement de la watchlist:', error);
                }
                return [];
            };

            return (
                <div className={`min-h-screen transition-colors duration-300 ${
                    isDarkMode 
                        ? 'bg-black' 
                        : 'bg-white'
                }`}>
                    {/* Header */}
                    <header className={`p-3 md:p-6 border-b transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-black border-gray-700' 
                            : 'bg-white border-gray-300'
                    }`}>
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className={`backdrop-blur-md rounded-2xl p-3 shadow-xl border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-white/10 border-white/20' 
                                            : 'bg-gray-800/10 border-gray-800/20'
                                    }`}>
                                        <img 
                                            src={isDarkMode ? "/logojslaidark.jpg" : "/logojslailight.jpg"} 
                                            alt="JSL AI Logo" 
                                            className="w-8 h-8 object-contain"
                                        />
                                    </div>
                                    <div>
                                        <h1 className={`text-3xl font-bold mb-2 font-['Inter'] transition-colors duration-300 ${
                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                        }`}>
                                            GOB Apps - Dashboard Financier Beta
                                        </h1>
                                        <p className={`font-['Inter'] transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                        }`}>
                                            Plateforme financi√®re ‚Ä¢ Propuls√©e par JSL AI
                                        </p>
                                    </div>
                                </div>
                                
                                {/* Bouton de basculement de th√®me */}
                                <button
                                    onClick={toggleTheme}
                                    className={`p-3 rounded-xl transition-all duration-300 hover:scale-105 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 hover:bg-gray-600 text-yellow-400' 
                                            : 'bg-gray-200 hover:bg-gray-300 text-gray-800'
                                    }`}
                                    title={isDarkMode ? 'Passer en mode clair' : 'Passer en mode sombre'}
                                >
                                    {isDarkMode ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation par onglets */}
                    <nav className={`backdrop-blur-sm border-b transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-black border-gray-700' 
                            : 'bg-white border-gray-300'
                    }`}>
                        <div className="max-w-7xl mx-auto px-3 md:px-6">
                            <div className="flex space-x-1 overflow-x-auto scrollbar-hide">
                                {[
                                    { id: 'stocks-news', label: 'üìä Titres & nouvelles', component: StocksNewsTab },
                                    { id: 'dans-watchlist', label: 'üëÄ Dan\'s Watchlist', component: DansWatchlistTab },
                                    { id: 'seeking-alpha', label: 'üìà Seeking Alpha', component: SeekingAlphaTab },
                                    { id: 'ask-emma', label: 'ü§ñ Emma IA', component: AskEmmaTab },
                                    { id: 'scrapping-sa', label: 'üîß Scrapping SA', component: ScrappingSATab },
                                    { id: 'email-report', label: 'üìß Envoyer par courriel', component: EmailReportTab },
                                    { id: 'admin-jsla', label: '‚öôÔ∏è Admin-JSLAI', component: AdminJSLaiTab }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`tab-button px-6 py-3 rounded-t-lg font-medium transition-all ${
                                            activeTab === tab.id 
                                                ? (isDarkMode 
                                                    ? 'bg-gray-900 text-white border-b-2 border-green-500' 
                                                    : 'bg-gray-100 text-gray-900 border-b-2 border-green-600')
                                                : (isDarkMode 
                                                    ? 'text-gray-300 hover:text-white hover:bg-gray-900' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100')
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Contenu principal */}
                    <main className="max-w-7xl mx-auto p-3 md:p-6">
                        {activeTab === 'stocks-news' && <StocksNewsTab />}
                        {activeTab === 'dans-watchlist' && <DansWatchlistTab />}
                        {activeTab === 'seeking-alpha' && <SeekingAlphaTab />}
                        {activeTab === 'ask-emma' && <AskEmmaTab />}
                        {activeTab === 'scrapping-sa' && <ScrappingSATab />}
                        {activeTab === 'email-report' && <EmailReportTab />}
                        {activeTab === 'admin-jsla' && <AdminJSLaiTab />}
                    </main>

                    {/* Messages */}
                    {message && (
                        <div className={`fixed top-4 right-4 p-4 rounded-lg z-50 ${
                            message.type === 'error' ? 'bg-red-500' : 
                            message.type === 'success' ? 'bg-green-500' : 'bg-blue-500'
                        } text-white`}>
                            {message.text}
                        </div>
                    )}

                </div>
            );
        };

        ReactDOM.render(<BetaCombinedDashboard />, document.getElementById('root'));
    </script>
    
    <!-- Scripts Emma -->
    <script type="module">
        // Import des modules Emma
        import { emmaDashboard } from './emma-dashboard-integration.js';
        
        // Initialiser Emma apr√®s le rendu du dashboard
        setTimeout(() => {
            emmaDashboard.initialize();
        }, 1000);
    </script>
</body>
</html>