<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOB Apps - Dashboard Financier Beta ‚Ä¢ Propuls√© par JSL AI</title>
    <!-- Cache bust: 2024-10-08 23:12 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Recharts pour IntelliStocks -->
    <script src="https://unpkg.com/recharts@2.10.3/dist/Recharts.js"></script>
    <!-- Lucide React pour les ic√¥nes IntelliStocks -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    
    <!-- Styles Emma -->
    <link rel="stylesheet" href="emma-styles.css">
    <style>
        * {
            font-family: 'Inter', 'Roboto', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { 
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
        }
        .pulse-animation {
            animation: pulse 3s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .stock-card {
            transition: all 0.3s ease;
        }
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        /* R√©duction globale pour mobile: police et espacements √† 50% */
        @media (max-width: 768px) {
            html { font-size: 50%; }
        }
        .seeking-alpha-card {
            background: linear-gradient(135deg, #1f1f1f 0%, #2d2d2d 100%);
        }
        .stocks-news-card {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        /* Scrollbar personnalis√©e */
        .scrollbar-thin {
            scrollbar-width: thin;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        
        /* Dark mode scrollbar */
        .dark .scrollbar-thin::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        .dark .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .news-card {
            transition: all 0.3s ease;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        /* Effets visuels - ripple sur boutons */
        .btn-ripple { position: relative; overflow: hidden; }
        .ripple-circle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            background: rgba(59, 130, 246, 0.45); /* blue */
            transform: scale(0);
            animation: ripple 600ms ease-out;
        }
        @keyframes ripple {
            to { transform: scale(3); opacity: 0; }
        }
        /* Animation intro Emma */
        @keyframes emma-intro-fade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes emma-zoom-in {
            0% { transform: scale(0.85); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .emma-intro-overlay { animation: emma-intro-fade 300ms ease-out; }
        .emma-intro-image { animation: emma-zoom-in 800ms ease-out; }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const BetaCombinedDashboard = () => {
            // √âtats principaux
            const [activeTab, setActiveTab] = useState('stocks-news');
            const [tickers, setTickers] = useState(['GOOGL', 'T', 'BNS', 'TD', 'BCE', 'CNR', 'CSCO', 'CVS', 'DEO', 'MDT', 'JNJ', 'JPM', 'LVMHF', 'MG', 'MFC', 'MU', 'NSRGY', 'NKE', 'NTR', 'PFE', 'TRP', 'T', 'UNH', 'UL', 'VZ', 'WFC']);
            const [stockData, setStockData] = useState({});
            const [newsData, setNewsData] = useState([]);
            const [seekingAlphaData, setSeekingAlphaData] = useState({});
            const [seekingAlphaStockData, setSeekingAlphaStockData] = useState({});
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState(null);
            const [selectedStock, setSelectedStock] = useState(null);
            const [newTicker, setNewTicker] = useState('');
            const [showTickerManager, setShowTickerManager] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [apiStatus, setApiStatus] = useState({});
            const [viewMode, setViewMode] = useState('cards');
            const [seekingAlphaViewMode, setSeekingAlphaViewMode] = useState('cards');
            const [newsFilter, setNewsFilter] = useState('all'); // Filtre pour les actualit√©s
            const [filteredNews, setFilteredNews] = useState([]); // Actualit√©s filtr√©es
            
            // √âtats pour  l'interface Seeking Alpha
            const [githubToken, setGithubToken] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [showScraperPopup, setShowScraperPopup] = useState(false);
            
            // √âtats pour le scraping
            const [scrapingStatus, setScrapingStatus] = useState('idle'); // 'idle', 'running', 'completed', 'error'
            const [scrapingProgress, setScrapingProgress] = useState(0);
            const [scrapingLogs, setScrapingLogs] = useState([]);
            
            // √âtat pour le th√®me (clair par d√©faut, respecte localStorage)
            const [isDarkMode, setIsDarkMode] = useState(() => {
                try {
                    const saved = localStorage.getItem('theme');
                    if (saved === 'dark') return true;
                    if (saved === 'light') return false;
                } catch (_) {}
                return false; // d√©faut: clair
            });
            const [showEmmaIntro, setShowEmmaIntro] = useState(false);
            const clickSoundRef = useRef(null);
            const tabSoundRef = useRef(null);
            const audioCtxRef = useRef(null);

            // Configuration API
            const API_BASE_URL = window.location.origin;
            
            // Configuration GitHub
            const GITHUB_REPO = 'projetsjsl/GOB';
            const GITHUB_BRANCH = 'main';
            
            // Fonction pour nettoyer l'encodage des caract√®res
            const cleanText = (text) => {
                if (!text) return '';
                return text
                    .replace(/√É¬©/g, '√©')
                    .replace(/√É¬®/g, '√®')
                    .replace(/√É /g, '√†')
                    .replace(/√É¬ß/g, '√ß')
                    .replace(/√É¬¥/g, '√¥')
                    .replace(/√É¬¢/g, '√¢')
                    .replace(/√É¬Æ/g, '√Æ')
                    .replace(/√É¬Ø/g, '√Ø')
                    .replace(/√É¬π/g, '√π')
                    .replace(/√É¬ª/g, '√ª')
                    .replace(/√É¬´/g, '√´')
                    .replace(/√É¬§/g, '√§')
                    .replace(/√É¬∂/g, '√∂')
                    .replace(/√É¬º/g, '√º')
                    .replace(/√¢‚Ç¨‚Ñ¢/g, "'")
                    .replace(/√¢‚Ç¨≈ì/g, '"')
                    .replace(/√¢‚Ç¨/g, '"')
                    .replace(/√¢‚Ç¨"/g, '‚Äì')
                    .replace(/√¢‚Ç¨"/g, '‚Äî');
            };

            // Fonction pour extraire le logo depuis les donn√©es de scraping
            const getCompanyLogo = (ticker) => {
                try {
                    // Chercher dans les  donn√©es de scraping
                    const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                    if (seekingAlphaItem?.raw_text) {
                        // Extraire le logo depuis le JSON dans raw_text
                        const logoMatch = seekingAlphaItem.raw_text.match(/"logo":"([^"]+)"/);
                        if (logoMatch && logoMatch[1]) {
                            return logoMatch[1];
                        }
                    }
                    
                    // Fallback vers des logos par d√©faut
                    const defaultLogos = {
                        // Tickers US
                        'GOOGL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/GOOGL.svg',
                        'T': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/T.svg',
                        'CSCO': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CSCO.svg',
                        'CVS': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CVS.svg',
                        'DEO': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/DEO.svg',
                        'MDT': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MDT.svg',
                        'JNJ': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/JNJ.svg',
                        'JPM': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/JPM.svg',
                        'LVMHF': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/LVMHF.svg',
                        'MU': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MU.svg',
                        'NSRGY': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NSRGY.svg',
                        'NKE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NKE.svg',
                        'PFE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/PFE.svg',
                        'UNH': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/UNH.svg',
                        'UL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/UL.svg',
                        'VZ': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/VZ.svg',
                        'WFC': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/WFC.svg',
                        
                        // Tickers TSX (Canada)
                        'BNS': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/BNS.svg',
                        'TD': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TD.svg',
                        'BCE': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/BCE.svg',
                        'CNR': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/CNR.svg',
                        'MG': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MG.svg',
                        'MFC': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MFC.svg',
                        'NTR': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NTR.svg',
                        'TRP': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TRP.svg',
                        
                        // Autres tickers populaires
                        'AAPL': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/AAPL.svg',
                        'MSFT': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/MSFT.svg',
                        'AMZN': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/AMZN.svg',
                        'TSLA': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/TSLA.svg',
                        'NVDA': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/NVDA.svg',
                        'META': 'https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/META.svg'
                    };
                    
                    return defaultLogos[ticker] || `https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/${ticker}.svg`;
                } catch (error) {
                    console.error(`Erreur extraction logo pour ${ticker}:`, error?.message || String(error));
                    return `https://static.seekingalpha.com/cdn/s3/company_logos/mark_vector_light/${ticker}.svg`;
                }
            };

            // Messages
            const showMessage = (text, type = 'info') => {
                setMessage({ text, type });
                setTimeout(() => setMessage(null), 5000);
            };

            // Fonction pour basculer le th√®me
            const toggleTheme = () => {
                const next = !isDarkMode;
                setIsDarkMode(next);
                try { localStorage.setItem('theme', next ? 'dark' : 'light'); } catch(_) {}
            };

            // Donn√©es Market Data (Finnhub + Alpha Vantage + Yahoo Finance)
            const fetchStockData = async (ticker) => {
                try {
                    // Essayer d'abord la nouvelle API unifi√©e avec Yahoo Finance (gratuit)
                    const response = await fetch(`${API_BASE_URL}/api/marketdata?endpoint=quote&symbol=${ticker}&source=auto`);
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error('Erreur fetch stock data (marketdata):', error?.message || String(error));
                    // Rester sur marketdata; l‚ÄôAPI g√®re d√©j√† ses fallbacks internes
                    return null;
                }
            };

            const refreshAllStocks = async () => {
                console.log('üîÑ Actualisation des donn√©es stocks...');
                setLoading(true);
                const newStockData = {};
                let successCount = 0;
                let errorCount = 0;
                
                for (const ticker of tickers) {
                    console.log(`üìä R√©cup√©ration des donn√©es pour ${ticker}...`);
                    try {
                        const data = await fetchStockData(ticker);
                        // Charger les fondamentaux pour alimenter P/E/Dividende/Secteur
                        let fundamentals = null;
                        try {
                            const fundamentalsResp = await fetch(`${API_BASE_URL}/api/marketdata?endpoint=fundamentals&symbol=${ticker}&source=auto`);
                            if (fundamentalsResp.ok) fundamentals = await fundamentalsResp.json();
                        } catch (e) {
                            console.warn(`‚ö†Ô∏è Fundamentals non disponibles pour ${ticker}`, e?.message || e);
                        }
                        if (data && !data.message) {
                            newStockData[ticker] = {
                                ...data,
                                fundamentals,
                                timestamp: new Date().toISOString()
                            };
                            successCount++;
                            console.log(`‚úÖ ${ticker}: Donn√©es r√©cup√©r√©es`, data);
                        } else {
                            console.log(`‚ö†Ô∏è ${ticker}: Pas de donn√©es ou erreur API`, data);
                            errorCount++;
                        }
                    } catch (error) {
                        console.error(`‚ùå ${ticker}: Erreur`, error?.message || String(error));
                        errorCount++;
                    }
                }
                
                setStockData(newStockData);
                setLastUpdate(new Date());
                setLoading(false);
                
                const message = `Donn√©es mises √† jour: ${successCount} succ√®s, ${errorCount} erreurs`;
                console.log(message);
                showMessage(message, successCount > 0 ? 'success' : 'warning');
            };

            // Actualit√©s NewsAPI.ai
            const fetchNews = async () => {
                console.log('üì∞ R√©cup√©ration des actualit√©s...');
                try {
                    const tickersQuery = tickers.join(' OR ');
                    console.log(`üîç Recherche pour: ${tickersQuery}`);
                    
                    const response = await fetch(`${API_BASE_URL}/api/news?q=${encodeURIComponent(tickersQuery)}&limit=20&strict=true`);
                    console.log(`üì° R√©ponse API News: ${response.status}`);
                    
                    if (!response.ok) throw new Error(`News API error: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('üìä Donn√©es news re√ßues:', data);
                    
                    setNewsData(data.articles || []);
                    setFilteredNews(data.articles || []);
                    
                    if (data.source === 'demo') {
                        showMessage('Actualit√©s de d√©monstration - Configurez NEWSAPI_KEY pour des actualit√©s r√©elles', 'info');
                    } else {
                        showMessage(`${data.articles?.length || 0} actualit√©s charg√©es`, 'success');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur fetch news:', error?.message || String(error));
                    showMessage('Erreur chargement actualit√©s', 'error');
                    
                    const fallbackNews = [
                        {
                            title: "Actualit√©s financi√®res non disponibles",
                            description: "Impossible de charger les actualit√©s. V√©rifiez la configuration de l'API NewsAPI.",
                            url: "#",
                            publishedAt: new Date().toISOString(),
                            source: { name: "Syst√®me" }
                        }
                    ];
                    setNewsData(fallbackNews);
                    setFilteredNews(fallbackNews);
                }
            };

            // Fonction pour filtrer les actualit√©s
            const filterNews = (filterValue) => {
                setNewsFilter(filterValue);
                if (filterValue === 'all') {
                    setFilteredNews(newsData);
                } else {
                    const filtered = newsData.filter(article => {
                        const text = (article.title + ' ' + article.description).toLowerCase();
                        return text.includes(filterValue.toLowerCase());
                    });
                    setFilteredNews(filtered);
                }
            };

            // Fonction pour obtenir la couleur des grades Quant
            const getGradeColor = (grade) => {
                if (!grade) return 'bg-gray-100 text-gray-600';
                const letter = grade.charAt(0);
                if (letter === 'A') return 'bg-green-100 text-green-700';
                if (letter === 'B') return 'bg-gray-100 text-gray-700';
                if (letter === 'C') return 'bg-yellow-100 text-yellow-700';
                if (letter === 'D') return 'bg-orange-100 text-orange-700';
                if (letter === 'F') return 'bg-red-100 text-red-700';
                return 'bg-gray-100 text-gray-600';
            };

            // Donn√©es   Seeking Alpha
            const fetchSeekingAlphaData = async () => {
                try {
                    const response = await fetch('/stock_analysis.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaData(data);
                    } else if (response.status === 404) {
                        console.warn('‚ö†Ô∏è Fichier stock_analysis.json non trouv√© (404). Donn√©es Seeking Alpha non disponibles.');
                    } else {
                        console.warn(`‚ö†Ô∏è Erreur ${response.status} lors du chargement de stock_analysis.json`);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha:', error?.message || String(error));
                }
            };

            const fetchSeekingAlphaStockData = async () => {
                try {
                    const response = await fetch('/stock_data.json');
                    if (response.ok) {
                        const data = await response.json();
                        setSeekingAlphaStockData(data);
                    } else if (response.status === 404) {
                        console.warn('‚ö†Ô∏è Fichier stock_data.json non trouv√© (404). Donn√©es Seeking Alpha stock non disponibles.');
                    } else {
                        console.warn(`‚ö†Ô∏è Erreur ${response.status} lors du chargement de stock_data.json`);
                    }
                } catch (error) {
                    console.error('Erreur fetch Seeking Alpha stock data:', error?.message || String(error));
                }
            };

            // Monitoring Admin
            const checkApiStatus = async () => {
                const status = {
                    finnhub: { status: 'checking', responseTime: 0, error: null },
                    newsapi: { status: 'checking', responseTime: 0, error: null },
                    seekingAlpha: { status: 'checking', responseTime: 0, error: null }
                };

                // Test Market Data API (nouvelle API unifi√©e)
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/marketdata?endpoint=quote&symbol=AAPL&source=auto`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.finnhub = {
                            status: data.message ? 'warning' : 'success',
                            responseTime,
                            error: data.message || null,
                            source: data.source || 'unknown'
                        };
                    } else {
                        status.finnhub = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.finnhub = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test NewsAPI
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/news?q=finance&limit=5&strict=true`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.newsapi = { status: 'success', responseTime, error: null };
                    } else {
                        status.newsapi = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.newsapi = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Seeking Alpha
                try {
                    const startTime = Date.now();
                    const response = await fetch('/stock_analysis.json');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.seekingAlpha = { status: 'success', responseTime, error: null };
                    } else {
                        status.seekingAlpha = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.seekingAlpha = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Gemini API
                try {
                    const startTime = Date.now();
                    const response = await fetch('/api/gemini-key');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.gemini = {
                            status: data.apiKey ? 'success' : 'warning',
                            responseTime,
                            error: data.apiKey ? null : 'Cl√© API non configur√©e'
                        };
                    } else {
                        status.gemini = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.gemini = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test GitHub API (si token configur√©)
                if (githubToken) {
                    try {
                        const startTime = Date.now();
                        const response = await fetch('https://api.github.com/user', {
                            headers: {
                                'Authorization': `token ${githubToken}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        const responseTime = Date.now() - startTime;
                        
                        if (response.ok) {
                            status.github = { status: 'success', responseTime, error: null };
                        } else {
                            status.github = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                        }
                    } catch (error) {
                        status.github = { status: 'error', responseTime: 0, error: error.message };
                    }
                } else {
                    status.github = { status: 'warning', responseTime: 0, error: 'Token GitHub non configur√©' };
                }

                // Test Claude API (si configur√©)
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE_URL}/api/claude`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: 'Test de connexion', ticker: 'TEST' })
                    });
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        status.claude = { status: 'success', responseTime, error: null };
                    } else {
                        status.claude = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.claude = { status: 'error', responseTime: 0, error: error.message };
                }

                // Test Vercel API Routes
                try {
                    const startTime = Date.now();
                    const response = await fetch('/api/test-gemini');
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        status.vercel = {
                            status: data.status === 'success' ? 'success' : 'warning',
                            responseTime,
                            error: data.status === 'success' ? null : data.message
                        };
                    } else {
                        status.vercel = { status: 'error', responseTime, error: `HTTP ${response.status}` };
                    }
                } catch (error) {
                    status.vercel = { status: 'error', responseTime: 0, error: error.message };
                }

                setApiStatus(status);
            };

            // Initialisation
            useEffect(() => {
                console.log('üöÄ Initialisation du dashboard...');
                
                const loadAllData = async () => {
                    console.log('üìä Chargement des donn√©es...');
                    try {
                        await Promise.all([
                            fetchSeekingAlphaData(),
                            fetchSeekingAlphaStockData(),
                            refreshAllStocks(),
                            fetchNews(),
                            checkApiStatus()
                        ]);
                        console.log('‚úÖ Toutes les donn√©es charg√©es');
                    } catch (error) {
                        console.error('‚ùå Erreur lors du chargement:', error?.message || String(error));
                    }
                };
                
                loadAllData();

                // Intro Emma: premi√®re visite de session
                if (activeTab === 'ask-emma' && !sessionStorage.getItem('emma-intro-shown')) {
                    setShowEmmaIntro(true);
                    sessionStorage.setItem('emma-intro-shown', '1');
                    setTimeout(() => setShowEmmaIntro(false), 3000);
                }
                
                const interval = setInterval(() => {
                    console.log('üîÑ Auto-refresh des donn√©es...');
                    refreshAllStocks();
                    fetchNews();
                    fetchSeekingAlphaData();
                    fetchSeekingAlphaStockData();
                }, 300000);
                
                return () => clearInterval(interval);
            }, []);

            // Afficher l'intro quand on ouvre Emma IA pour la 1√®re fois pendant la session
            useEffect(() => {
                if (activeTab === 'ask-emma' && !sessionStorage.getItem('emma-intro-shown')) {
                    setShowEmmaIntro(true);
                    sessionStorage.setItem('emma-intro-shown', '1');
                    setTimeout(() => setShowEmmaIntro(false), 3000);
                }
            }, [activeTab]);

            // Effet ripple g√©n√©rique pour les boutons
            const ensureAudioReady = () => {
                // D√©bloquer audio sur premier geste utilisateur
                if (!audioCtxRef.current) {
                    try {
                        const AudioCtx = window.AudioContext || window.webkitAudioContext;
                        if (AudioCtx) {
                            audioCtxRef.current = new AudioCtx();
                        }
                    } catch (_) {}
                }
                try { tabSoundRef.current?.load(); clickSoundRef.current?.load(); } catch(_){}
            };

            const withRipple = (e) => {
                const target = e.currentTarget;
                const circle = document.createElement('span');
                const diameter = Math.max(target.clientWidth, target.clientHeight);
                const radius = diameter / 2;
                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${e.clientX - target.getBoundingClientRect().left - radius}px`;
                circle.style.top = `${e.clientY - target.getBoundingClientRect().top - radius}px`;
                circle.classList.add('ripple-circle');
                const old = target.getElementsByClassName('ripple-circle')[0];
                if (old) old.remove();
                target.appendChild(circle);
                ensureAudioReady();
            };

            // Volume: baisser le son g√©n√©ral et couper le son du ripple/clic
            useEffect(() => {
                try {
                    if (tabSoundRef.current) tabSoundRef.current.volume = 0.0; // aucun son d'onglet
                    if (clickSoundRef.current) clickSoundRef.current.volume = 0.30; // clic/ripple 30%
                } catch(_) {}
            }, []);

            // Mettre √† jour les actualit√©s filtr√©es quand les actualit√©s changent
            useEffect(() => {
                setFilteredNews(newsData);
            }, [newsData]);

            // Fonctions de scraping
            const addScrapingLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString('fr-FR');
                const logEntry = { message, type, timestamp };
                setScrapingLogs(prev => [...prev, logEntry]);
                console.log(`[${timestamp}] ${message}`);
            };

            const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            const scrapeTicker = async (ticker) => {
                addScrapingLog(`üöÄ D√©marrage du scraping pour ${ticker}...`, 'info');
                
                try {
                    const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                    addScrapingLog(`üåê Ouverture de ${url}`, 'info');
                    
                    // M√©thode 1: Essayer window.open avec popup
                    let newWindow = null;
                    try {
                        newWindow = window.open(url, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
                        
                        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                            throw new Error('Popup bloqu√©');
                        }
                        
                        addScrapingLog(`‚úÖ Popup ouvert avec succ√®s pour ${ticker}`, 'success');
                        
                    } catch (popupError) {
                        addScrapingLog(`‚ö†Ô∏è Popup bloqu√© pour ${ticker}, tentative m√©thode alternative...`, 'warning');
                        
                        // M√©thode 2: Cr√©er un lien temporaire et le cliquer
                        try {
                            const link = document.createElement('a');
                            link.href = url;
                            link.target = '_blank';
                            link.rel = 'noopener noreferrer';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            
                            addScrapingLog(`‚úÖ Lien ouvert dans un nouvel onglet pour ${ticker}`, 'success');
                            
                        } catch (linkError) {
                            addScrapingLog(`‚ö†Ô∏è M√©thode lien √©chou√©e, utilisation de la m√©thode directe...`, 'warning');
                            
                            // M√©thode 3: Utiliser location.href (ouvre dans le m√™me onglet)
                            addScrapingLog(`üîÑ Ouverture directe dans le m√™me onglet...`, 'info');
                            addScrapingLog(`‚ö†Ô∏è ATTENTION: Cela va quitter cette page!`, 'warning');
                            
                            // Demander confirmation avant de quitter
                            const confirmLeave = confirm(`Voulez-vous ouvrir ${url} dans le m√™me onglet? Cela fermera cette page.`);
                            if (confirmLeave) {
                                window.location.href = url;
                                return;
                            } else {
                                addScrapingLog(`‚ùå Utilisateur a annul√© l'ouverture pour ${ticker}`, 'error');
                                throw new Error('Utilisateur a annul√© l\'ouverture');
                            }
                        }
                    }
                    
                    // Si on a r√©ussi √† ouvrir une fen√™tre, continuer avec la logique normale
                    if (newWindow && !newWindow.closed) {
                        // Attendre que la page se charge
                        addScrapingLog(`‚è≥ Attente du chargement de la page (8 secondes)...`, 'info');
                        await wait(8000);
                        
                        // V√©rifier si la fen√™tre est toujours ouverte
                        if (newWindow.closed) {
                            addScrapingLog(`‚ö†Ô∏è Fen√™tre ferm√©e pr√©matur√©ment pour ${ticker}`, 'warning');
                            return;
                        }
                        
                        // M√©thode alternative : utiliser postMessage pour communiquer
                        addScrapingLog(`üì° Tentative de communication avec la fen√™tre...`, 'info');
                        
                        // Envoyer un message √† la fen√™tre pour demander les donn√©es
                        newWindow.postMessage({
                            type: 'REQUEST_SCRAPING_DATA',
                            ticker: ticker,
                            source: 'parent'
                        }, '*');
                        
                        // √âcouter les messages de la fen√™tre
                        const messageHandler = async (event) => {
                            if (event.data.type === 'SCRAPING_RESULT' && event.data.ticker === ticker) {
                                addScrapingLog(`‚úÖ Scraping r√©ussi pour ${ticker}`, 'success');
                                addScrapingLog(`üìÑ Donn√©es extraites: ${event.data.data.innerText.length} caract√®res`, 'info');
                                
                                // Analyser avec Claude et mettre √† jour les fichiers
                                try {
                                    await analyzeWithClaudeAndUpdate(ticker, event.data.data);
                                    addScrapingLog(`üéâ Traitement complet termin√© pour ${ticker}`, 'success');
                                } catch (claudeError) {
                                    addScrapingLog(`‚ö†Ô∏è Erreur analyse Claude pour ${ticker}: ${claudeError.message}`, 'warning');
                                    addScrapingLog(`üíæ Donn√©es scrap√©es sauvegard√©es localement`, 'info');
                                }
                                
                                window.removeEventListener('message', messageHandler);
                            } else if (event.data.type === 'SCRAPING_ERROR' && event.data.ticker === ticker) {
                                addScrapingLog(`‚ùå Erreur de scraping pour ${ticker}: ${event.data.error}`, 'error');
                                window.removeEventListener('message', messageHandler);
                            }
                        };
                        
                        window.addEventListener('message', messageHandler);
                        
                        // Timeout de s√©curit√©
                        setTimeout(() => {
                            window.removeEventListener('message', messageHandler);
                            if (!newWindow.closed) {
                                addScrapingLog(`‚è∞ Timeout atteint pour ${ticker} - Fen√™tre ouverte manuellement`, 'warning');
                                addScrapingLog(`üí° Vous pouvez maintenant extraire les donn√©es manuellement`, 'info');
                            }
                        }, 15000);
                        
                        addScrapingLog(`üìã Instructions: La page Seeking Alpha est maintenant ouverte`, 'info');
                        addScrapingLog(`üîç Vous pouvez copier les donn√©es manuellement si n√©cessaire`, 'info');
                    } else {
                        addScrapingLog(`‚úÖ Page ouverte avec succ√®s pour ${ticker}`, 'success');
                        addScrapingLog(`üìã Instructions: Utilisez F12 pour inspecter la page`, 'info');
                        addScrapingLog(`üí° Copiez les donn√©es manuellement depuis la console`, 'info');
                    }
                    
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur lors du scraping de ${ticker}: ${error.message}`, 'error');
                    
                    // Ne pas faire √©chouer tout le processus pour un popup bloqu√©
                    if (error.message.includes('Popup bloqu√©') || error.message.includes('annul√©')) {
                        addScrapingLog(`üí° Conseil: Autorisez les popups pour ce site ou utilisez le script F12`, 'info');
                        return; // Continuer avec le prochain ticker
                    }
                    
                    throw error;
                }
            };

            const runSeekingAlphaScraper = async () => {
                if (scrapingStatus === 'running') {
                    addScrapingLog('‚ö†Ô∏è Scraping d√©j√† en cours', 'warning');
                    return;
                }
                
                setScrapingStatus('running');
                setScrapingProgress(0);
                setScrapingLogs([]);
                
                addScrapingLog('üöÄ D√©marrage du scraper Seeking Alpha', 'info');
                addScrapingLog(`üìä Tickers √† traiter: ${tickers.join(', ')}`, 'info');
                
                let successCount = 0;
                let errorCount = 0;
                
                try {
                    for (let i = 0; i < tickers.length; i++) {
                        const ticker = tickers[i];
                        const progress = Math.round(((i + 1) / tickers.length) * 100);
                        
                        setScrapingProgress(progress);
                        addScrapingLog(`üìà Progression: ${progress}% (${i + 1}/${tickers.length})`, 'info');
                        
                        try {
                            await scrapeTicker(ticker);
                            successCount++;
                            addScrapingLog(`‚úÖ ${ticker} trait√© avec succ√®s`, 'success');
                        } catch (tickerError) {
                            errorCount++;
                            addScrapingLog(`‚ùå Erreur pour ${ticker}: ${tickerError.message}`, 'error');
                            addScrapingLog(`üîÑ Continuation avec le prochain ticker...`, 'info');
                        }
                        
                        // Pause entre les scrapings pour √©viter d'√™tre bloqu√©
                        if (i < tickers.length - 1) {
                            addScrapingLog('‚è∏Ô∏è Pause de 3 secondes avant le prochain ticker...', 'info');
                            await wait(3000);
                        }
                    }
                    
                    // D√©terminer le statut final
                    if (successCount > 0) {
                        setScrapingStatus('completed');
                        addScrapingLog(`üéâ Scraping termin√©! ${successCount} succ√®s, ${errorCount} erreurs`, 'success');
                    } else {
                        setScrapingStatus('error');
                        addScrapingLog(`üí• Aucun ticker n'a pu √™tre trait√© (${errorCount} erreurs)`, 'error');
                    }
                    
                } catch (error) {
                    setScrapingStatus('error');
                    addScrapingLog(`üí• Erreur fatale: ${error.message}`, 'error');
                }
            };

            const openSeekingAlpha = (ticker) => {
                const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                addScrapingLog(`üåê Ouverture directe de Seeking Alpha pour ${ticker}`, 'info');
                
                try {
                    // Essayer d'abord window.open
                    const newWindow = window.open(url, '_blank');
                    
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        addScrapingLog(`‚ö†Ô∏è Popup bloqu√©, utilisation de la m√©thode alternative...`, 'warning');
                        
                        // M√©thode alternative : cr√©er un lien temporaire
                        const link = document.createElement('a');
                        link.href = url;
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        addScrapingLog(`‚úÖ Lien ouvert dans un nouvel onglet`, 'success');
                    } else {
                        addScrapingLog(`‚úÖ Fen√™tre popup ouverte avec succ√®s`, 'success');
                    }
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur lors de l'ouverture: ${error.message}`, 'error');
                    addScrapingLog(`üí° Essayez d'autoriser les popups pour ce site`, 'info');
                }
            };

            // Fonction alternative pour le scraping sans cross-origin
            const scrapeTickerAlternative = async (ticker) => {
                addScrapingLog(`üöÄ M√©thode alternative pour ${ticker}...`, 'info');
                
                try {
                    // Ouvrir dans un nouvel onglet au lieu d'une fen√™tre popup
                    const url = `https://seekingalpha.com/symbol/${ticker}/virtual_analyst_report`;
                    addScrapingLog(`üåê Ouverture dans un nouvel onglet: ${url}`, 'info');
                    
                    // Cr√©er un lien temporaire et le cliquer
                    const link = document.createElement('a');
                    link.href = url;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    addScrapingLog(`‚úÖ Onglet ouvert avec succ√®s pour ${ticker}`, 'success');
                    addScrapingLog(`üìã Instructions: Utilisez F12 pour inspecter la page`, 'info');
                    addScrapingLog(`üí° Copiez les donn√©es manuellement depuis la console`, 'info');
                    
                    // Simuler une pause pour l'utilisateur
                    await wait(2000);
                    
                } catch (error) {
                    addScrapingLog(`‚ùå Erreur m√©thode alternative pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Fonction pour g√©n√©rer un script de scraping √† copier
            const generateScrapingScript = (ticker) => {
                const script = `
// Script de scraping pour ${ticker}
// Copiez et collez ce script dans la console F12 de Seeking Alpha

(function() {
    console.log('üîç Script de scraping pour ${ticker}');
    
    // Attendre que la page soit charg√©e
    setTimeout(() => {
        try {
            const pageData = {
                ticker: '${ticker}',
                url: window.location.href,
                title: document.title,
                timestamp: new Date().toISOString(),
                content: {
                    // Extraire les m√©triques principales
                    price: document.querySelector('[data-testid="price"]')?.textContent || 'N/A',
                    change: document.querySelector('[data-testid="change"]')?.textContent || 'N/A',
                    peRatio: document.querySelector('[data-testid="pe-ratio"]')?.textContent || 'N/A',
                    marketCap: document.querySelector('[data-testid="market-cap"]')?.textContent || 'N/A',
                    dividend: document.querySelector('[data-testid="dividend"]')?.textContent || 'N/A',
                    sector: document.querySelector('[data-testid="sector"]')?.textContent || 'N/A'
                },
                // Extraire le texte complet
                fullText: document.body.innerText,
                // Extraire les analyses
                analysis: document.querySelector('.analysis-content')?.innerText || 'N/A'
            };
            
            console.log('üìä Donn√©es extraites:', pageData);
            
            // Copier dans le presse-papiers si possible
            if (navigator.clipboard) {
                navigator.clipboard.writeText(JSON.stringify(pageData, null, 2))
                    .then(() => console.log('‚úÖ Donn√©es copi√©es dans le presse-papiers'))
                    .catch(() => console.log('‚ö†Ô∏è Impossible de copier automatiquement'));
            }
            
            // Afficher les donn√©es dans la console
            console.table(pageData.content);
            
        } catch (error) {
            console.error('‚ùå Erreur lors de l\'extraction:', error?.message || String(error));
        }
    }, 3000);
})();
                `;
                
                return script;
            };

            // Fonction pour analyser les donn√©es avec Claude et mettre √† jour les fichiers
            const analyzeWithClaudeAndUpdate = async (ticker, scrapedData) => {
                addScrapingLog(`ü§ñ Analyse avec Claude pour ${ticker}...`, 'info');
                
                try {
                    // Pr√©parer les donn√©es pour Claude
                    const claudePrompt = `
Analysez les donn√©es suivantes de Seeking Alpha pour ${ticker} et g√©n√©rez une analyse compl√®te au format JSON.

Donn√©es extraites:
${JSON.stringify(scrapedData, null, 2)}

G√©n√©rez une r√©ponse JSON avec cette structure exacte:
{
  "ticker": "${ticker}",
  "companyName": "Nom de l'entreprise",
  "lastUpdate": "${new Date().toISOString()}",
  "metrics": {
    "marketCap": "Capitalisation boursi√®re",
    "bpaGrowth": "Croissance BPA",
    "peRatio": "Ratio P/E",
    "sector": "Secteur",
    "dividendYield": "Rendement dividende",
    "dividendFrequency": "Fr√©quence dividende",
    "exDivDate": "Date ex-dividende",
    "annualPayout": "Paiement annuel",
    "price": "Prix actuel",
    "priceChange": "Changement de prix"
  },
  "companyProfile": {
    "description": "Description de l'entreprise en fran√ßais",
    "employees": "Nombre d'employ√©s si disponible",
    "innovation": "Innovations et investissements cl√©s"
  },
  "competition": {
    "competitors": ["Concurrent 1", "Concurrent 2"],
    "valueProposition": "Proposition de valeur unique",
    "advantages": "Avantages concurrentiels"
  },
  "quantRating": {
    "valuation": "Grade A-F",
    "growth": "Grade A-F", 
    "profitability": "Grade A-F",
    "momentum": "Grade A-F",
    "revisions": "Grade A-F"
  },
  "sectorAnalysis": {
    "valuation": "Analyse de valorisation",
    "growth": "Analyse de croissance",
    "profitability": "Analyse de rentabilit√©",
    "momentum": "Analyse de momentum",
    "revisions": "Analyse des r√©visions"
  },
  "intermediateConclusion": "Conclusion interm√©diaire",
  "strengths": ["Force 1", "Force 2", "Force 3"],
  "concerns": ["Pr√©occupation 1", "Pr√©occupation 2", "Pr√©occupation 3"],
  "finalConclusion": {
    "strengths": "R√©sum√© des forces",
    "weaknesses": "R√©sum√© des faiblesses", 
    "recommendation": "Recommandation d√©taill√©e",
    "rating": "Buy/Hold/Sell"
  }
}

R√©pondez UNIQUEMENT avec le JSON, sans texte suppl√©mentaire.
                    `;

                    // Appeler l'API Claude (vous devrez configurer votre endpoint)
                    const response = await fetch(`${API_BASE_URL}/api/claude`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: claudePrompt,
                            ticker: ticker
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Erreur API Claude: ${response.status}`);
                    }

                    const claudeResponse = await response.json();
                    const analysisData = JSON.parse(claudeResponse.analysis);

                    addScrapingLog(`‚úÖ Analyse Claude termin√©e pour ${ticker}`, 'success');

                    // Mettre √† jour les fichiers JSON via GitHub API
                    await updateStockDataFiles(ticker, analysisData, scrapedData);

                    return analysisData;

                } catch (error) {
                    addScrapingLog(`‚ùå Erreur analyse Claude pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Fonction pour mettre √† jour les fichiers JSON via GitHub API
            const updateStockDataFiles = async (ticker, analysisData, scrapedData) => {
                addScrapingLog(`üìù Mise √† jour des fichiers JSON pour ${ticker}...`, 'info');

                try {
                    // Mettre √† jour stock_data.json
                    const stockDataResponse = await fetch(`${API_BASE_URL}/api/github-update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file: 'public/stock_data.json',
                            ticker: ticker,
                            data: analysisData,
                            action: 'update_stock'
                        })
                    });

                    if (!stockDataResponse.ok) {
                        throw new Error(`Erreur mise √† jour stock_data.json: ${stockDataResponse.status}`);
                    }

                    // Mettre √† jour stock_analysis.json
                    const analysisResponse = await fetch(`${API_BASE_URL}/api/github-update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file: 'public/stock_analysis.json',
                            ticker: ticker,
                            data: {
                                ticker: ticker,
                                timestamp: new Date().toISOString(),
                                raw_text: scrapedData.fullText || scrapedData.content,
                                url: scrapedData.url
                            },
                            action: 'update_analysis'
                        })
                    });

                    if (!analysisResponse.ok) {
                        throw new Error(`Erreur mise √† jour stock_analysis.json: ${analysisResponse.status}`);
                    }

                    addScrapingLog(`‚úÖ Fichiers JSON mis √† jour pour ${ticker}`, 'success');
                    addScrapingLog(`üîÑ Rechargement des donn√©es...`, 'info');

                    // Recharger les donn√©es
                    await fetchSeekingAlphaData();
                    await fetchSeekingAlphaStockData();

                } catch (error) {
                    addScrapingLog(`‚ùå Erreur mise √† jour fichiers pour ${ticker}: ${error.message}`, 'error');
                    throw error;
                }
            };

            // Composant onglet Admin-JSLAI
            const AdminJSLaiTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>‚öôÔ∏è Admin-JSLAI</h2>
                    </div>

                    {/* üîç Debug des Donn√©es (d√©plac√© ici depuis Titres & nouvelles) */}
                    <div className={`rounded-lg p-4 border transition-colors duration-300 ${
                        isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>üîç Debug des Donn√©es</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} rounded p-3 border`}>
                                <div className="text-blue-600 font-medium mb-2">üìä Stock Data</div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Tickers: {tickers.length} ({tickers.join(', ')})
                                </div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Donn√©es charg√©es: {Object.keys(stockData).length}
                                </div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Derni√®re MAJ: {lastUpdate ? new Date(lastUpdate).toLocaleString('fr-FR') : 'Jamais'}
                                </div>
                            </div>
                            <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} rounded p-3 border`}>
                                <div className="text-emerald-600 font-medium mb-2">üì∞ News Data</div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Articles: {newsData.length}
                                </div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Premier article: {newsData[0]?.title?.substring(0, 30) || 'Aucun'}...
                                </div>
                            </div>
                            <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} rounded p-3 border`}>
                                <div className="text-violet-600 font-medium mb-2">üéØ Seeking Alpha</div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Stocks: {seekingAlphaData.stocks?.length || 0}
                                </div>
                                <div className={isDarkMode ? 'text-gray-200' : 'text-gray-700'}>
                                    Stock Data: {Object.keys(seekingAlphaStockData.stocks || {}).length}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Section Administration des Stocks */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üìä Gestion des Stocks</h3>
                        <div className="flex flex-wrap gap-2">
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 transition-colors"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                            >
                                Actualiser News
                            </button>
                        </div>
                    </div>

                    {/* Section Scraping Seeking Alpha */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Scraping Seeking Alpha</h3>
                        <div className="flex flex-wrap gap-2">
                            <button
                                onClick={runSeekingAlphaScraper}
                                disabled={scrapingStatus === 'running'}
                                className="px-4 py-2 bg-violet-600 text-white rounded hover:bg-violet-700 disabled:opacity-50 transition-colors"
                            >
                                {scrapingStatus === 'running' ? 'Scraping...' : 'üöÄ Lancer le Scraper'}
                            </button>
                            <button
                                onClick={() => openSeekingAlpha('AAPL')}
                                className="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors"
                            >
                                üåê Ouvrir Seeking Alpha
                            </button>
                            <button
                                onClick={() => {
                                    const script = generateScrapingScript('CVS');
                                    navigator.clipboard.writeText(script).then(() => {
                                        addScrapingLog('üìã Script de scraping copi√© dans le presse-papiers', 'success');
                                        addScrapingLog('üí° Collez-le dans la console F12 de Seeking Alpha', 'info');
                                    });
                                }}
                                className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors"
                            >
                                üìã Script F12
                            </button>
                            <button
                                onClick={async () => {
                                    addScrapingLog('ü§ñ D√©marrage de l\'analyse Claude sur les donn√©es existantes...', 'info');
                                    try {
                                        for (const ticker of tickers) {
                                            const existingData = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            if (existingData) {
                                                addScrapingLog(`üîÑ Analyse de ${ticker} avec Claude...`, 'info');
                                                await analyzeWithClaudeAndUpdate(ticker, {
                                                    fullText: existingData.raw_text,
                                                    url: existingData.url,
                                                    content: {}
                                                });
                                            }
                                        }
                                        addScrapingLog('üéâ Analyse Claude termin√©e pour tous les tickers', 'success');
                                    } catch (error) {
                                        addScrapingLog(`‚ùå Erreur analyse Claude: ${error.message}`, 'error');
                                    }
                                }}
                                className="px-4 py-2 bg-pink-600 text-white rounded hover:bg-pink-700 transition-colors"
                            >
                                ü§ñ Analyser avec Claude
                            </button>
                        </div>
                    </div>

                    {/* Section Logs de Scraping */}
                    {scrapingLogs.length > 0 && (
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìã Logs de Scraping</h3>
                            <div className={`max-h-64 overflow-y-auto space-y-2 ${
                                isDarkMode ? 'bg-gray-800' : 'bg-white'
                            } rounded-lg p-4`}>
                                {scrapingLogs.map((log, index) => (
                                    <div key={index} className={`text-sm p-2 rounded ${
                                        log.type === 'error' ? 'bg-red-100 text-red-800' :
                                        log.type === 'success' ? 'bg-green-100 text-green-800' :
                                        log.type === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-blue-100 text-blue-800'
                                    }`}>
                                        <span className="font-mono text-xs opacity-70">
                                            {new Date(log.timestamp).toLocaleTimeString()}
                                        </span>
                                        <span className="ml-2">{log.message}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Section √âtat des Connexions */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîó √âtat des Connexions</h3>
                        <div className="space-y-3">
                            {Object.entries(apiStatus).map(([api, status]) => (
                                <div key={api} className={`flex items-center justify-between p-3 rounded-lg transition-colors duration-300 ${
                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-100'
                                }`}>
                                    <span className={`font-mono capitalize transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                    }`}>{api}</span>
                                    <div className="flex items-center gap-2">
                                        <span className={`w-3 h-3 rounded-full ${
                                            status.status === 'success' ? 'bg-green-500' :
                                            status.status === 'warning' ? 'bg-yellow-500' :
                                            status.status === 'error' ? 'bg-red-500' : 'bg-gray-500'
                                        }`}></span>
                                        <span className={`text-sm transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                        }`}>
                                            {status.responseTime}ms
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="flex gap-2 mt-4">
                            <button
                                onClick={checkApiStatus}
                                className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                            >
                                üîÑ V√©rifier
                            </button>
                        </div>
                    </div>

                    {/* Section Configuration */}
                    <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>‚öôÔ∏è Configuration</h3>
                        <div className="space-y-4">
                            <div>
                                <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                }`}>
                                    Token GitHub (pour les mises √† jour)
                                </label>
                                <input
                                    type="password"
                                    value={githubToken}
                                    onChange={(e) => setGithubToken(e.target.value)}
                                    placeholder="Entrez votre token GitHub"
                                    className={`w-full px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                />
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowSettings(!showSettings)}
                                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                                >
                                    {showSettings ? 'Masquer' : 'Afficher'} les param√®tres
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Composant onglet Dan's Watchlist
            const DansWatchlistTab = () => {
                const [watchlistTickers, setWatchlistTickers] = useState([]);
                const [newTicker, setNewTicker] = useState('');
                const [watchlistStockData, setWatchlistStockData] = useState({});
                const [watchlistLoading, setWatchlistLoading] = useState(false);
                const WATCHLIST_FILE = '/dans-watchlist.json'; // servi depuis /public

                // Charger la watchlist depuis localStorage
                useEffect(() => {
                    const savedWatchlist = localStorage.getItem('dans-watchlist');
                    if (savedWatchlist) {
                        const tickers = JSON.parse(savedWatchlist);
                        setWatchlistTickers(tickers);
                        loadWatchlistData(tickers);
                    }
                }, []);

                // Charger les donn√©es pour les tickers de la watchlist
                const loadWatchlistData = async (tickers) => {
                    if (tickers.length === 0) return;
                    
                    setWatchlistLoading(true);
                    const newData = {};
                    
                    for (const ticker of tickers) {
                        try {
                            const data = await fetchStockData(ticker);
                            if (data && !data.message) {
                                newData[ticker] = {
                                    ...data,
                                    timestamp: new Date().toISOString()
                                };
                            }
                        } catch (error) {
                            console.error(`Erreur pour ${ticker}:`, error?.message || String(error));
                        }
                    }
                    
                    setWatchlistStockData(newData);
                    setWatchlistLoading(false);
                };

                // Ajouter un ticker √† la watchlist
                const addTickerToWatchlist = async () => {
                    if (!newTicker.trim()) return;
                    
                    const ticker = newTicker.trim().toUpperCase();
                    if (watchlistTickers.includes(ticker)) {
                        showMessage('Ce ticker est d√©j√† dans la watchlist', 'warning');
                        return;
                    }
                    
                    const updatedTickers = [...watchlistTickers, ticker];
                    setWatchlistTickers(updatedTickers);
                    localStorage.setItem('dans-watchlist', JSON.stringify(updatedTickers));
                    setNewTicker('');
                    
                    // Charger les donn√©es pour le nouveau ticker
                    loadWatchlistData([ticker]);
                    showMessage(`${ticker} ajout√© √† la watchlist`, 'success');
                    
                    // Sauvegarder automatiquement sur GitHub
                    await saveWatchlistToGitHubAuto(updatedTickers);
                };

                // Supprimer un ticker de la watchlist
                const removeTickerFromWatchlist = async (ticker) => {
                    const updatedTickers = watchlistTickers.filter(t => t !== ticker);
                    setWatchlistTickers(updatedTickers);
                    localStorage.setItem('dans-watchlist', JSON.stringify(updatedTickers));
                    
                    // Supprimer les donn√©es du ticker
                    setWatchlistStockData(prev => {
                        const newData = { ...prev };
                        delete newData[ticker];
                        return newData;
                    });
                    
                    showMessage(`${ticker} supprim√© de la watchlist`, 'success');
                    
                    // Sauvegarder automatiquement sur GitHub
                    await saveWatchlistToGitHubAuto(updatedTickers);
                };

                // Actualiser les donn√©es de la watchlist
                const refreshWatchlist = async () => {
                    await loadWatchlistData(watchlistTickers);
                    showMessage('Watchlist actualis√©e', 'success');
                };

                // Sauvegarder automatiquement la watchlist sur GitHub (silencieux)
                const saveWatchlistToGitHubAuto = async (tickers) => {
                    try {
                        const watchlistData = {
                            tickers: tickers,
                            lastUpdated: new Date().toISOString(),
                            count: tickers.length
                        };
                        
                        const response = await fetch(`${API_BASE_URL}/api/save-tickers`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                tickers: tickers,
                                filename: 'dans-watchlist.json'
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        console.log('‚úÖ Watchlist sauvegard√©e automatiquement sur GitHub');
                    } catch (e) {
                        console.error('‚ö†Ô∏è Erreur sauvegarde automatique GitHub watchlist:', e);
                        // Ne pas afficher d'erreur √† l'utilisateur pour ne pas perturber l'exp√©rience
                    }
                };

                // Sauvegarder manuellement la watchlist dans GitHub (avec confirmation)
                const saveWatchlistToGitHub = async () => {
                    try {
                        await saveWatchlistToGitHubAuto(watchlistTickers);
                        showMessage('Watchlist sauvegard√©e sur GitHub', 'success');
                    } catch (e) {
                        console.error('Erreur sauvegarde GitHub watchlist:', e);
                        showMessage('Erreur sauvegarde GitHub', 'error');
                    }
                };

                // Charger la watchlist depuis GitHub (fichier statique public)
                const loadWatchlistFromGitHub = async () => {
                    try {
                        const res = await fetch(WATCHLIST_FILE + `?t=${Date.now()}`);
                        if (!res.ok) throw new Error(`HTTP ${res.status}`);
                        const json = await res.json();
                        const tickers = Array.isArray(json.tickers) ? json.tickers : [];
                        setWatchlistTickers(tickers);
                        localStorage.setItem('dans-watchlist', JSON.stringify(tickers));
                        await loadWatchlistData(tickers);
                        showMessage('Watchlist charg√©e depuis GitHub', 'success');
                    } catch (e) {
                        console.error('Erreur chargement GitHub watchlist:', e);
                        showMessage('Erreur chargement GitHub', 'error');
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="flex justify-between items-center">
                            <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üëÄ Dan's Watchlist</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={refreshWatchlist}
                                    disabled={watchlistLoading || watchlistTickers.length === 0}
                                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors"
                                >
                                    {watchlistLoading ? 'Actualisation...' : 'üîÑ Actualiser'}
                                </button>
                                <button
                                    onClick={saveWatchlistToGitHub}
                                    className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 transition-colors"
                                >
                                    üíæ Sauvegarder GitHub
                                </button>
                                <button
                                    onClick={loadWatchlistFromGitHub}
                                    className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
                                >
                                    ‚¨áÔ∏è Charger GitHub
                                </button>
                            </div>
                        </div>

                        {/* Section d'ajout de ticker */}
                        <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>‚ûï Ajouter un Ticker</h3>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={newTicker}
                                    onChange={(e) => setNewTicker(e.target.value)}
                                    placeholder="Ex: AAPL, TSLA, GOOGL..."
                                    className={`flex-1 px-3 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    onKeyPress={(e) => e.key === 'Enter' && addTickerToWatchlist()}
                                />
                                <button
                                    onClick={addTickerToWatchlist}
                                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                >
                                    ‚ûï Ajouter
                                </button>
                            </div>
                            <p className={`text-sm mt-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-600'
                            }`}>
                                üí° Ces tickers ne seront visibles que dans cette watchlist personnalis√©e
                            </p>
                        </div>

                        {/* Liste des tickers de la watchlist */}
                        {watchlistTickers.length > 0 ? (
                            <div className={`backdrop-blur-sm rounded-lg p-6 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            }`}>
                                <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>
                                    üìä Tickers de la Watchlist ({watchlistTickers.length})
                                </h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {watchlistTickers.map(ticker => {
                                        const data = watchlistStockData[ticker];
                                        const change = data?.dp ? (data.dp >= 0 ? '+' : '') + data.dp.toFixed(2) + '%' : 'N/A';
                                        const changeColor = data?.dp >= 0 ? 'text-green-400' : 'text-red-400';
                                        const changeBgColor = data?.dp >= 0 ? 'bg-green-500' : 'bg-red-500';
                                        
                                        return (
                                            <div key={ticker} className={`rounded-lg p-4 border transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border-gray-600 hover:border-blue-400/50' 
                                                    : 'bg-white border-gray-300 hover:border-blue-300'
                                            }`}>
                                                <div className="flex justify-between items-start mb-3">
                                                    <div className="flex items-center gap-2">
                                                        <img 
                                                            src={getCompanyLogo(ticker)} 
                                                            alt={`${ticker} logo`}
                                                            className="w-8 h-8 rounded"
                                                            onError={(e) => {
                                                                e.target.style.display = 'none';
                                                            }}
                                                        />
                                                        <h4 className={`font-bold text-lg transition-colors duration-300 ${
                                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                                        }`}>{ticker}</h4>
                                                    </div>
                                                    <button
                                                        onClick={() => removeTickerFromWatchlist(ticker)}
                                                        className={`p-1 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'text-gray-400 hover:text-red-400 hover:bg-red-900/20' 
                                                                : 'text-gray-500 hover:text-red-600 hover:bg-red-50'
                                                        }`}
                                                        title="Supprimer de la watchlist"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                                
                                                {data ? (
                                                    <>
                                                        <div className={`rounded-lg p-3 mb-3 transition-colors duration-300 ${
                                                            isDarkMode ? 'bg-gray-700' : 'bg-gray-100'
                                                        }`}>
                                                            <div className={`text-2xl font-bold mb-1 transition-colors duration-300 ${
                                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                                            }`}>
                                                                ${data.c?.toFixed(2) || 'N/A'}
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className={`w-3 h-3 ${changeBgColor} rounded`}></div>
                                                                <span className={`text-sm font-medium ${changeColor}`}>
                                                                    {change}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>Volume:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>{data.v?.toLocaleString() || 'N/A'}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>High:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>${data.h?.toFixed(2) || 'N/A'}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                                                }`}>Low:</span>
                                                                <span className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>${data.l?.toFixed(2) || 'N/A'}</span>
                                                            </div>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div className={`text-center py-4 transition-colors duration-300 ${
                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                    }`}>
                                                        <div className="animate-spin w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full mx-auto mb-2"></div>
                                                        <span className="text-sm">Chargement...</span>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div className={`backdrop-blur-sm rounded-lg p-8 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            } text-center`}>
                                <div className="text-6xl mb-4">üëÄ</div>
                                <h3 className={`text-xl font-semibold mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>Watchlist Vide</h3>
                                <p className={`transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                    Ajoutez des tickers pour commencer √† suivre vos investissements personnalis√©s
                                </p>
                            </div>
                        )}
                    </div>
                );
            };

            // Composant onglet Scrapping SA (simplifi√©)
            const ScrappingSATab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Scrapping SA</h2>
                        <div className="flex gap-2">
                            <span className={`text-sm transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-600'
                            }`}>
                                Outils d'administration d√©plac√©s vers l'onglet Admin-JSLAI
                            </span>
                        </div>
                    </div>


                    {/* Fiche d√©taill√©e du titre s√©lectionn√© */}
                    {selectedStock && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                <button
                                    onClick={() => setSelectedStock(null)}
                                    className="text-blue-400 hover:text-blue-300"
                                >
                                    ‚úï Fermer
                                </button>
                            </div>
                            
                            {/* Fiche d√©taill√©e comme dans les images */}
                            {(() => {
                                const claudeData = seekingAlphaStockData.stocks?.[selectedStock];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (claudeData || parsedData) {
                                    return (
                                        <div className="bg-white rounded-lg shadow-xl overflow-hidden">
                                            {/* Header avec gradient bleu */}
                                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 p-6">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                                        <p className="text-blue-100 text-sm">
                                                            {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => setSelectedStock(null)}
                                                        className="text-white hover:text-gray-200 text-xl"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Contenu principal */}
                                            <div className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
                                                {/* M√©triques Cl√©s */}
                                                <div>
                                                    <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                        <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                        M√©triques Cl√©s
                                                    </h4>
                                                    <div className="grid grid-cols-3 gap-4">
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Capitalisation</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.marketCap || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Croissance BPA</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.bpaGrowth || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.peRatio || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Secteur</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.sector || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Rendement Dividende</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.dividendYield || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Fr√©quence</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.dividendFrequency || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Ex-Dividende</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.exDivDate || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Paiement Annuel</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.annualPayout || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Prix Actuel</div>
                                                            <div className="text-blue-600 font-bold text-lg">{claudeData?.metrics?.price || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Profil de l'Entreprise */}
                                                {claudeData?.companyProfile && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Profil de l'Entreprise</h4>
                                                        <div className="text-gray-700 leading-relaxed">
                                                            {cleanText(claudeData.companyProfile.description)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Quantitative */}
                                                {claudeData?.quantRating && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Analyse Quantitative</h4>
                                                        <div className="flex gap-4 mb-6">
                                                            {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                                if (!value || key === 'overall') return null;
                                                                return (
                                                                    <div key={key} className="text-center">
                                                                        <div className="text-gray-600 text-sm mb-2 capitalize">{key}</div>
                                                                        <span className={`px-3 py-2 rounded-lg text-sm font-bold ${getGradeColor(value)}`}>
                                                                            {value}
                                                                        </span>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Sectorielle */}
                                                {claudeData?.sectorAnalysis && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                            <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                            Analyse Sectorielle
                                                        </h4>
                                                        <div className="bg-blue-50 rounded-lg p-4">
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {typeof claudeData.sectorAnalysis === 'string' 
                                                                    ? cleanText(claudeData.sectorAnalysis)
                                                                    : Object.entries(claudeData.sectorAnalysis).map(([key, value]) => (
                                                                        <div key={key} className="mb-3">
                                                                            <div className="font-bold text-gray-800 capitalize mb-2">{cleanText(key)}:</div>
                                                                            <div className="text-gray-700 leading-relaxed">{cleanText(value)}</div>
                                                                </div>
                                                                    ))
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Points Positifs */}
                                                {claudeData?.strengths && (
                                                    <div className="bg-green-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-green-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚úÖ</span>
                                                            Points Positifs
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.strengths.map((strength, index) => (
                                                                <div key={index} className="text-green-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(strength)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Pr√©occupations */}
                                                {claudeData?.concerns && (
                                                    <div className="bg-red-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-red-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚ö†Ô∏è</span>
                                                            Pr√©occupations
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.concerns.map((concern, index) => (
                                                                <div key={index} className="text-red-700 flex items-start">
                                                                    <span className="mr-2">‚ö†Ô∏è</span>
                                                                    <span>{cleanText(concern)}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Conclusion Finale */}
                                                {claudeData?.finalConclusion && (
                                                    <div className="bg-blue-600 rounded-lg p-6 text-white">
                                                        <h4 className="text-xl font-bold mb-4">Conclusion Finale</h4>
                                                        <div className="bg-white rounded-lg p-4 text-gray-800">
                                                            <div className="flex items-center justify-between mb-3">
                                                                <span className="font-bold">Recommandation:</span>
                                                                <span className="bg-yellow-400 text-black px-3 py-1 rounded font-bold">
                                                                    {claudeData.finalConclusion.rating}
                                                                </span>
                                                            </div>
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {cleanText(claudeData.finalConclusion.recommendation)}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                            
                            {/* Analyse Seeking Alpha */}
                            {(() => {
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (parsedData?.analysis) {
                                    return (
                                        <div className="mb-4">
                                            <h4 className="text-lg font-semibold text-white mb-2">üìà Analyse Seeking Alpha</h4>
                                            <div className="text-gray-200 text-sm leading-relaxed">
                                                {parsedData.analysis}
                                            </div>
                                            <a
                                                href={seekingAlphaItem.url}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="inline-block mt-2 text-blue-300 hover:text-blue-200 underline"
                                            >
                                                Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                            </a>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                            
                            {/* Donn√©es en temps r√©el */}
                            {stockData[selectedStock] && (
                                <div className="mb-4">
                                    <h4 className="text-lg font-semibold text-white mb-2">üìä Donn√©es Temps R√©el</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                                        <div>
                                            <span className="text-blue-200">Ouverture:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].o?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                        <div>
                                            <span className="text-blue-200">Plus haut:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].h?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                        <div>
                                            <span className="text-blue-200">Plus bas:</span>
                                            <span className="text-white ml-2">${stockData[selectedStock].l?.toFixed(2) || 'N/A'}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Cartes d'analyse comme dans les images */}
                    {!selectedStock && seekingAlphaData.stocks && (
                        <div className="space-y-6">
                            <div className="flex justify-between items-center">
                            <h3 className="text-lg font-semibold text-white">üìà Analyses Compl√®tes</h3>
                                <div className="flex bg-gray-700 rounded-lg p-1">
                                    <button
                                        onClick={() => setSeekingAlphaViewMode('list')}
                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                            seekingAlphaViewMode === 'list' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'text-gray-300 hover:text-white'
                                        }`}
                                    >
                                        üìã Liste
                                    </button>
                                    <button
                                        onClick={() => setSeekingAlphaViewMode('cards')}
                                        className={`px-3 py-1 rounded text-sm transition-colors ${
                                            seekingAlphaViewMode === 'cards' 
                                                ? 'bg-blue-600 text-white' 
                                                : 'text-gray-300 hover:text-white'
                                        }`}
                                    >
                                        üé¥ Cartes
                                    </button>
                                </div>
                            </div>

                            {/* Vue en liste compacte pour Seeking Alpha */}
                            {seekingAlphaViewMode === 'list' && (
                                <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                                    <h4 className="text-lg font-semibold text-white mb-4">üìã Vue Liste - Analyses</h4>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="border-b border-gray-600">
                                                    <th className="text-left py-2 text-gray-300">Ticker</th>
                                                    <th className="text-left py-2 text-gray-300">Prix</th>
                                                    <th className="text-left py-2 text-gray-300">Change</th>
                                                    <th className="text-left py-2 text-gray-300">P/E</th>
                                                    <th className="text-left py-2 text-gray-300">Dividende</th>
                                                    <th className="text-left py-2 text-gray-300">Secteur</th>
                                                    <th className="text-left py-2 text-gray-300">Rating</th>
                                                    <th className="text-left py-2 text-gray-300">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                            {seekingAlphaData.stocks.map((stock, index) => {
                                const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                const parsedData = stock.parsedData;
                                                    
                                                    // Priorit√©: Claude > Parsed
                                                    const price = claudeData?.metrics?.price || parsedData?.price || 'N/A';
                                                    const change = claudeData?.metrics?.priceChange || parsedData?.change || 'N/A';
                                                    const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                                    const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                                    const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                                    const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                                    
                                                    const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                
                                return (
                                                        <tr key={index} className="border-b border-gray-700 hover:bg-gray-800 cursor-pointer"
                                                            onClick={() => setSelectedStock(stock.ticker)}>
                                                            <td className="py-3">
                                                                <div className="flex items-center gap-2">
                                                                    <img 
                                                                        src={getCompanyLogo(stock.ticker)} 
                                                                        alt={`${stock.ticker} logo`}
                                                                        className="w-6 h-6 rounded"
                                                                        onError={(e) => {
                                                                            e.target.style.display = 'none';
                                                                        }}
                                                                    />
                                                                    <span className="font-mono text-white font-bold">{stock.ticker}</span>
                                                                </div>
                                                            </td>
                                                            <td className="py-3 text-white">{price}</td>
                                                            <td className={`py-3 ${changeColor}`}>{change}</td>
                                                            <td className="py-3 text-white">{peRatio}</td>
                                                            <td className="py-3 text-white">{dividendYield}</td>
                                                            <td className="py-3 text-white text-xs">{cleanText(sector)}</td>
                                                            <td className="py-3">
                                                                <span className="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold">
                                                                    {rating}
                                                                </span>
                                                            </td>
                                                            <td className="py-3">
                                                                <button className="text-blue-300 hover:text-blue-200 text-xs">
                                                                    Voir fiche ‚Üí
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* Vue en cartes pour Seeking Alpha */}
                            {seekingAlphaViewMode === 'cards' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {seekingAlphaData.stocks.map((stock, index) => {
                                        const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                        const parsedData = stock.parsedData;
                                        
                                        return (
                                            <div key={index} className="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-300/40 transition-all cursor-pointer"
                                                 onClick={() => setSelectedStock(stock.ticker)}>
                                                
                                        {/* Header avec ticker et rating */}
                                        <div className="flex justify-between items-start mb-6">
                                            <div className="flex items-center gap-3">
                                                <img 
                                                    src={getCompanyLogo(stock.ticker)} 
                                                    alt={`${stock.ticker} logo`}
                                                    className="w-12 h-12 rounded-lg"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                    }}
                                                />
                                                <div>
                                                    <h3 className="text-2xl font-bold text-white">{stock.ticker}</h3>
                                                    <p className="text-sm text-gray-400">
                                                        {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-sm">
                                                {claudeData?.finalConclusion?.rating || 'Hold'}
                                            </div>
                                        </div>

                                        {/* Prix et changement */}
                                        <div className="bg-gray-700 rounded-lg p-4 mb-6">
                                            <div className="text-3xl font-bold text-white mb-1">
                                                {claudeData?.metrics?.price || parsedData?.price || 'N/A'}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 bg-blue-500 rounded"></div>
                                                <span className={`text-sm font-medium ${claudeData?.metrics?.priceChange?.includes('+') ? 'text-green-400' : 'text-red-400'}`}>
                                                    {claudeData?.metrics?.priceChange || parsedData?.change || 'N/A'}
                                                </span>
                                            </div>
                                        </div>

                                        {/* M√©triques cl√©s */}
                                        <div className="space-y-3 mb-6">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Market Cap</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.marketCap || parsedData?.marketCap || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">P/E Ratio</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Dividend</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Secteur</span>
                                                <span className="text-white font-medium">{claudeData?.metrics?.sector || parsedData?.sector || 'N/A'}</span>
                                            </div>
                                        </div>

                                        {/* Quant Ratings */}
                                        {claudeData?.quantRating && (
                                            <div className="mb-6">
                                                <div className="border-t border-gray-600 pt-4">
                                                    <h4 className="text-center text-gray-300 text-sm font-medium mb-4">QUANT RATINGS</h4>
                                                    <div className="flex justify-center gap-3">
                                                        {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                            if (!value || key === 'overall') return null;
                                                            const shortKey = key.substring(0, 3);
                                                            return (
                                                                <div key={key} className="text-center">
                                                                    <div className="text-xs text-gray-400 mb-1">{shortKey}</div>
                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getGradeColor(value)}`}>
                                                                        {value}
                                                                    </span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Call to action */}
                                        <div className="text-center">
                                            <div className="flex items-center justify-center gap-2 text-gray-400 text-sm">
                                                <span>üëÜ</span>
                                                <span>Cliquez pour le rapport d√©taill√©</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                        </div>
                    )}

                    {/* Section Scraping */}
                    <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-gray-900 border-gray-700' 
                            : 'bg-gray-50 border-gray-200'
                    }`}>
                        <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üîß Outils de Scraping</h3>
                        
                        {/* Statut du scraping */}
                        <div className="mb-4">
                            <div className="flex items-center justify-between mb-2">
                                <span className={`font-medium transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>Statut:</span>
                                <span className={`px-3 py-1 rounded text-sm font-bold ${
                                    scrapingStatus === 'idle' ? 'bg-gray-500 text-white' :
                                    scrapingStatus === 'running' ? 'bg-blue-500 text-white' :
                                    scrapingStatus === 'completed' ? 'bg-green-500 text-white' :
                                    'bg-red-500 text-white'
                                }`}>
                                    {scrapingStatus === 'idle' ? '‚è∏Ô∏è En attente' :
                                     scrapingStatus === 'running' ? 'üîÑ En cours' :
                                     scrapingStatus === 'completed' ? '‚úÖ Termin√©' :
                                     '‚ùå Erreur'}
                                </span>
                        </div>

                            {/* Barre de progression */}
                            {scrapingStatus === 'running' && (
                                <div className="w-full bg-gray-700 rounded-full h-2 mb-2">
                                    <div 
                                        className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                        style={{ width: `${scrapingProgress}%` }}
                                    ></div>
                                </div>
                            )}
                            
                            <div className={`text-sm transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-300' : 'text-gray-600'
                            }`}>
                                Progression: {scrapingProgress}%
                            </div>
                        </div>

                        {/* Instructions de scraping */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-blue-900/30' 
                                : 'bg-blue-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìñ Instructions de Scraping</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-blue-200' : 'text-blue-800'
                            }`}>
                                <div>‚Ä¢ <strong>M√©thode 1:</strong> Cliquez sur "üöÄ Lancer le Scraper" pour ouvrir les pages</div>
                                <div>‚Ä¢ <strong>M√©thode 2:</strong> Cliquez sur "üìã Script F12" pour copier un script</div>
                                <div>‚Ä¢ <strong>√âtapes:</strong> Ouvrez F12 ‚Üí Console ‚Üí Collez le script ‚Üí Entr√©e</div>
                                <div>‚Ä¢ <strong>R√©sultat:</strong> Les donn√©es seront affich√©es et copi√©es automatiquement</div>
                            </div>
                        </div>

                        {/* Aide pour les popups bloqu√©s */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-yellow-900/30' 
                                : 'bg-yellow-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üîß R√©solution des Popups Bloqu√©s</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-yellow-200' : 'text-yellow-800'
                            }`}>
                                <div>‚Ä¢ <strong>Chrome/Edge:</strong> Cliquez sur l'ic√¥ne popup dans la barre d'adresse ‚Üí "Toujours autoriser"</div>
                                <div>‚Ä¢ <strong>Firefox:</strong> Cliquez sur l'ic√¥ne bouclier ‚Üí "D√©sactiver la protection"</div>
                                <div>‚Ä¢ <strong>Safari:</strong> Safari ‚Üí Pr√©f√©rences ‚Üí Sites web ‚Üí Pop-ups ‚Üí Autoriser</div>
                                <div>‚Ä¢ <strong>Alternative:</strong> Utilisez le bouton "üåê Ouvrir Seeking Alpha" ou le script F12</div>
                            </div>
                        </div>

                        {/* Configuration des API */}
                        <div className={`rounded-lg p-4 mb-4 transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-green-900/30' 
                                : 'bg-green-100/80'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>ü§ñ Configuration des API</h4>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-green-200' : 'text-green-800'
                            }`}>
                                <div>‚Ä¢ <strong>Claude API:</strong> Configurez ANTHROPIC_API_KEY pour l'analyse automatique</div>
                                <div>‚Ä¢ <strong>GitHub API:</strong> Configurez GITHUB_TOKEN pour la mise √† jour des fichiers</div>
                                <div>‚Ä¢ <strong>Fonctionnalit√©:</strong> Scraping ‚Üí Analyse Claude ‚Üí Mise √† jour JSON automatique</div>
                                <div>‚Ä¢ <strong>Bouton:</strong> "ü§ñ Analyser avec Claude" pour traiter les donn√©es existantes</div>
                            </div>
                        </div>

                        {/* Logs de scraping */}
                        <div className={`rounded-lg p-4 max-h-64 overflow-y-auto transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-black/50' 
                                : 'bg-gray-100'
                        }`}>
                            <h4 className={`font-medium mb-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üìã Logs de Scraping</h4>
                            {scrapingLogs.length === 0 ? (
                                <div className={`text-sm transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>Aucun log pour le moment...</div>
                            ) : (
                                <div className="space-y-1">
                                    {scrapingLogs.map((log, index) => (
                                        <div key={index} className={`text-xs p-2 rounded ${
                                            log.type === 'error' ? 'bg-red-900/50 text-red-300' :
                                            log.type === 'success' ? 'bg-green-900/50 text-green-300' :
                                            log.type === 'warning' ? 'bg-yellow-900/50 text-yellow-300' :
                                            'bg-blue-900/50 text-blue-300'
                                        }`}>
                                            <span className="text-gray-400">[{log.timestamp}]</span> {log.message}
                                    </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            // Composant onglet Seeking Alpha
            const SeekingAlphaTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üìà Analyses Seeking Alpha</h2>
                        <div className="flex gap-2">
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 disabled:opacity-50 transition-colors"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                            >
                                Actualiser News
                            </button>
                            <button
                                onClick={runSeekingAlphaScraper}
                                disabled={scrapingStatus === 'running'}
                                className="px-4 py-2 bg-violet-600 text-white rounded hover:bg-violet-700 disabled:opacity-50 transition-colors"
                            >
                                {scrapingStatus === 'running' ? 'Scraping...' : 'üöÄ Lancer le Scraper'}
                            </button>
                            <button
                                onClick={() => openSeekingAlpha('AAPL')}
                                className="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors"
                            >
                                üåê Ouvrir Seeking Alpha
                            </button>
                            <button
                                onClick={() => {
                                    const script = generateScrapingScript('CVS');
                                    navigator.clipboard.writeText(script).then(() => {
                                        addScrapingLog('üìã Script de scraping copi√© dans le presse-papiers', 'success');
                                        addScrapingLog('üí° Collez-le dans la console F12 de Seeking Alpha', 'info');
                                    });
                                }}
                                className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors"
                            >
                                üìã Script F12
                            </button>
                            <button
                                onClick={async () => {
                                    addScrapingLog('ü§ñ D√©marrage de l\'analyse Claude sur les donn√©es existantes...', 'info');
                                    try {
                                        for (const ticker of tickers) {
                                            const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            if (seekingAlphaItem?.parsedData) {
                                                await analyzeWithClaude(ticker, seekingAlphaItem.parsedData);
                                            }
                                        }
                                        addScrapingLog('‚úÖ Analyse Claude termin√©e pour tous les titres', 'success');
                                    } catch (error) {
                                        addScrapingLog(`‚ùå Erreur analyse Claude: ${error.message}`, 'error');
                                    }
                                }}
                                className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors"
                            >
                                ü§ñ Analyser avec Claude
                            </button>
                        </div>
                    </div>

                    {/* Fiche d√©taill√©e du titre s√©lectionn√© */}
                    {selectedStock && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                <button
                                    onClick={() => setSelectedStock(null)}
                                    className="text-blue-400 hover:text-blue-300"
                                >
                                    ‚úï Fermer
                                </button>
                            </div>
                            
                            {/* Fiche d√©taill√©e comme dans les images */}
                            {(() => {
                                const claudeData = seekingAlphaStockData.stocks?.[selectedStock];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === selectedStock);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (claudeData || parsedData) {
                                    return (
                                        <div className="bg-white rounded-lg shadow-xl overflow-hidden">
                                            {/* Header avec gradient bleu */}
                                            <div className="bg-gradient-to-r from-blue-600 to-blue-800 p-6">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <h3 className="text-2xl font-bold text-white">{selectedStock}</h3>
                                                        <p className="text-blue-100 text-sm">
                                                            {claudeData?.companyName || parsedData?.companyName || 'N/A'}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => setSelectedStock(null)}
                                                        className="text-white hover:text-gray-200 text-xl"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Contenu principal */}
                                            <div className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
                                                {/* M√©triques Cl√©s */}
                                                <div>
                                                    <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                        <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                        M√©triques Cl√©s
                                                    </h4>
                                                    <div className="grid grid-cols-3 gap-4">
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Capitalisation</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.marketCap || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Croissance BPA</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.bpaGrowth || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.peRatio || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Secteur</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.sector || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Rendement Dividende</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.dividendYield || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Fr√©quence</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.dividendFrequency || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Ex-Dividende</div>
                                                            <div className="text-gray-800 font-bold text-lg">{claudeData?.metrics?.exDivDate || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Paiement Annuel</div>
                                                            <div className="text-green-600 font-bold text-lg">{claudeData?.metrics?.annualPayout || 'N/A'}</div>
                                                        </div>
                                                        <div className="bg-gray-50 rounded-lg p-4">
                                                            <div className="text-gray-600 text-sm">Prix Actuel</div>
                                                            <div className="text-blue-600 font-bold text-lg">{claudeData?.metrics?.price || 'N/A'}</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Profil de l'Entreprise */}
                                                {claudeData?.companyProfile && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Profil de l'Entreprise</h4>
                                                        <div className="text-gray-700 leading-relaxed">
                                                            {cleanText(claudeData.companyProfile.description)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Quantitative */}
                                                {claudeData?.quantRating && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4">Analyse Quantitative</h4>
                                                        <div className="flex gap-4 mb-6">
                                                            {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                                if (!value || key === 'overall') return null;
                                                                return (
                                                                    <div key={key} className="text-center">
                                                                        <div className="text-gray-600 text-sm mb-2 capitalize">{key}</div>
                                                                        <span className={`px-3 py-2 rounded-lg text-sm font-bold ${getGradeColor(value)}`}>
                                                                            {value}
                                                                        </span>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Analyse Sectorielle */}
                                                {claudeData?.sectorAnalysis && (
                                                    <div>
                                                        <h4 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                                            <div className="w-1 h-6 bg-green-600 mr-3"></div>
                                                            Analyse Sectorielle
                                                        </h4>
                                                        <div className="bg-blue-50 rounded-lg p-4">
                                                            <div className="text-gray-700 leading-relaxed">
                                                                {typeof claudeData.sectorAnalysis === 'string' 
                                                                    ? cleanText(claudeData.sectorAnalysis)
                                                                    : Object.entries(claudeData.sectorAnalysis).map(([key, value]) => (
                                                                        <div key={key} className="mb-3">
                                                                            <div className="font-bold text-gray-800 capitalize mb-2">{cleanText(key)}:</div>
                                                                            <div className="text-gray-700 leading-relaxed">{cleanText(value)}</div>
                                                                </div>
                                                                    ))
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Points Positifs */}
                                                {claudeData?.strengths && (
                                                    <div className="bg-green-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-green-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚úÖ</span>
                                                            Points Positifs
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.strengths.map((strength, index) => (
                                                                <div key={index} className="text-green-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(strength)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Pr√©occupations */}
                                                {claudeData?.concerns && (
                                                    <div className="bg-red-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-red-800 mb-4 flex items-center">
                                                            <span className="mr-2">‚ö†Ô∏è</span>
                                                            Pr√©occupations
                                                        </h4>
                                                        <div className="space-y-3">
                                                            {claudeData.concerns.map((concern, index) => (
                                                                <div key={index} className="text-red-700">
                                                                    <span className="font-bold">{index + 1}.</span> {cleanText(concern)}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Recommandation */}
                                                {claudeData?.recommendation && (
                                                    <div className="bg-blue-50 rounded-lg p-4">
                                                        <h4 className="text-lg font-bold text-blue-800 mb-4 flex items-center">
                                                            <span className="mr-2">üí°</span>
                                                            Recommandation
                                                        </h4>
                                                        <div className="text-blue-700 leading-relaxed">
                                                            {cleanText(claudeData.recommendation)}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Lien vers Seeking Alpha */}
                                                {seekingAlphaItem?.url && (
                                                    <div className="text-center pt-4 border-t">
                                                        <a 
                                                            href={seekingAlphaItem.url} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer"
                                                            className="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                                        >
                                                            Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                                        </a>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                }
                                return null;
                            })()}
                        </div>
                    )}

                    {/* Affichage des analyses en cartes */}
                    {seekingAlphaData.stocks && seekingAlphaData.stocks.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {seekingAlphaData.stocks.map((stock, index) => {
                                const claudeData = seekingAlphaStockData.stocks?.[stock.ticker];
                                const parsedData = stock.parsedData;
                                
                                if (!claudeData && !parsedData) return null;
                                
                                return (
                                    <div key={index} className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="text-xl font-bold text-white">{stock.ticker}</h3>
                                            <button
                                                onClick={() => setSelectedStock(stock.ticker)}
                                                className="text-blue-400 hover:text-blue-300 text-sm"
                                            >
                                                Voir d√©tail
                                            </button>
                                        </div>
                                        
                                        {/* M√©triques principales */}
                                        <div className="space-y-3 mb-4">
                                            {claudeData?.metrics?.marketCap && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">Capitalisation:</span>
                                                    <span className="text-white font-semibold">{claudeData.metrics.marketCap}</span>
                                                </div>
                                            )}
                                            {claudeData?.metrics?.peRatio && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">P/E:</span>
                                                    <span className="text-white font-semibold">{claudeData.metrics.peRatio}</span>
                                                </div>
                                            )}
                                            {claudeData?.metrics?.dividendYield && (
                                                <div className="flex justify-between">
                                                    <span className="text-blue-200">Dividende:</span>
                                                    <span className="text-green-300 font-semibold">{claudeData.metrics.dividendYield}</span>
                                                </div>
                                            )}
                                        </div>

                                        {/* Rating quantitatif */}
                                        {claudeData?.quantRating?.overall && (
                                            <div className="mb-4">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-blue-200">Rating Quantitatif:</span>
                                                    <span className={`px-3 py-1 rounded text-sm font-bold ${getGradeColor(claudeData.quantRating.overall)}`}>
                                                        {claudeData.quantRating.overall}
                                                    </span>
                                                </div>
                                            </div>
                                        )}

                                        {/* Recommandation courte */}
                                        {claudeData?.recommendation && (
                                            <div className="text-blue-100 text-sm line-clamp-3">
                                                {cleanText(claudeData.recommendation).substring(0, 150)}...
                                            </div>
                                        )}

                                        {/* Lien vers Seeking Alpha */}
                                        {stock.url && (
                                            <div className="mt-4 pt-4 border-t border-gray-500">
                                                <a 
                                                    href={stock.url} 
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="text-blue-300 hover:text-blue-200 text-sm"
                                                >
                                                    Lire l'analyse compl√®te ‚Üí
                                                </a>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Affichage en  liste si pas de cartes */}
                    {(!seekingAlphaData.stocks || seekingAlphaData.stocks.length === 0) && (
                        <div className="seeking-alpha-card rounded-lg p-6 border border-gray-600">
                            <h3 className="text-xl font-bold text-white mb-4">üìã Analyses Seeking Alpha</h3>
                            <div className="space-y-4">
                                {tickers.map((ticker, index) => {
                                    const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                    const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                    const parsedData = seekingAlphaItem?.parsedData;
                                    
                                    if (!claudeData && !parsedData) return null;
                                    
                                    return (
                                        <div key={index} className="bg-white rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-3">
                                                <h4 className="text-lg font-bold text-gray-800">{ticker}</h4>
                                                <button
                                                    onClick={() => setSelectedStock(ticker)}
                                                    className="text-blue-600 hover:text-blue-700 text-sm"
                                                >
                                                    Voir d√©tail
                                                </button>
                                            </div>
                                            
                                            {/* M√©triques principales */}
                                            <div className="grid grid-cols-2 gap-4 mb-3">
                                                {claudeData?.metrics?.marketCap && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Capitalisation</div>
                                                        <div className="text-gray-800 font-semibold">{claudeData.metrics.marketCap}</div>
                                                    </div>
                                                )}
                                                {claudeData?.metrics?.peRatio && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">P/E Ratio</div>
                                                        <div className="text-gray-800 font-semibold">{claudeData.metrics.peRatio}</div>
                                                    </div>
                                                )}
                                                {claudeData?.metrics?.dividendYield && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Dividende</div>
                                                        <div className="text-green-600 font-semibold">{claudeData.metrics.dividendYield}</div>
                                                    </div>
                                                )}
                                                {claudeData?.quantRating?.overall && (
                                                    <div>
                                                        <div className="text-gray-600 text-sm">Rating</div>
                                                        <span className={`px-2 py-1 rounded text-sm font-bold ${getGradeColor(claudeData.quantRating.overall)}`}>
                                                            {claudeData.quantRating.overall}
                                                        </span>
                                                    </div>
                                                )}
                                            </div>

                                            {/* Recommandation courte */}
                                            {claudeData?.recommendation && (
                                                <div className="text-gray-700 text-sm line-clamp-2">
                                                    {cleanText(claudeData.recommendation).substring(0, 200)}...
                                                </div>
                                            )}

                                            {/* Lien vers Seeking Alpha */}
                                            {seekingAlphaItem?.url && (
                                                <div className="mt-3 pt-3 border-t">
                                                    <a 
                                                        href={seekingAlphaItem.url} 
                                                        target="_blank" 
                                                        rel="noopener noreferrer"
                                                        className="text-blue-600 hover:text-blue-700 text-sm"
                                                    >
                                                        Lire l'analyse compl√®te sur Seeking Alpha ‚Üí
                                                    </a>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );

            // Composant onglet Ask Emma avec int√©gration Gemini
            const AskEmmaTab = () => {
                const [emmaMessages, setEmmaMessages] = useState([]);
                const [emmaInput, setEmmaInput] = useState('');
                const [emmaLoading, setEmmaLoading] = useState(false);
                const [emmaApiKey, setEmmaApiKey] = useState('');
                const [emmaConnected, setEmmaConnected] = useState(false);
                const [showPromptEditor, setShowPromptEditor] = useState(false);
                const [showTemperatureEditor, setShowTemperatureEditor] = useState(false);
                const [showLengthEditor, setShowLengthEditor] = useState(false);
                const [emmaTemperature, setEmmaTemperature] = useState(0.3); // Temp√©rature par d√©faut pour analyses financi√®res
                const [emmaMaxTokens, setEmmaMaxTokens] = useState(4096); // Longueur de r√©ponse par d√©faut
                const [useFunctionCalling, setUseFunctionCalling] = useState(true); // Utiliser function calling par d√©faut
                const [emmaPrompt, setEmmaPrompt] = useState(`Identit√© et Mission
Tu es Emma ‚Äî Economic & Market Monitoring Assistant, actuellement configur√©e en mode Assistance Experte en Analyse Financi√®re et Gestion de Portefeuille.

Mission principale : Accompagner une √©quipe de gestionnaires de portefeuille qu√©b√©cois dans leurs analyses, d√©cisions d'investissement et r√©flexions strat√©giques, en fournissant une expertise de niveau CFA avec rigueur, nuance et esprit critique.
¬´ De la macro √† la micro, des march√©s aux titres ‚Äî j'analyse avec rigueur et pragmatisme. ¬ª

üè¢ Contexte Organisationnel
L'√©quipe que tu assistes :

Localisation : Qu√©bec, Canada
Structure : √âquipe de gestionnaires avec comit√© de placement (r√©unions r√©guli√®res)
Approche de gestion :

D√©tention directe de titres (stock picking)
Style valeur contrarian (contre-courant)
Philosophie pragmatique et analytique
Acceptation de la croissance √† prix raisonnable (GARP)
Utilisation occasionnelle de FNB/fonds pour besoins sp√©cifiques
Positions tactiques en or au besoin

Positions et pr√©f√©rences :
‚úÖ Favoris√©s :

Titres sous-√©valu√©s avec catalyseurs
Analyse fondamentale rigoureuse
Approche contrarian disciplin√©e
Courbes de taux comme outil d'analyse
Vision macro-√©conomique int√©gr√©e

‚ùå √âvit√©s :

Cryptomonnaies
Hype sp√©culatif sans fondamentaux
Valorisations tech excessives sans justification
Suivisme de march√©

‚ö†Ô∏è Vigilance particuli√®re :

Politiques √©conomiques de Trump et impacts
Bulles potentielles dans la tech
Risques g√©opolitiques
Taux d'int√©r√™t et politique mon√©taire

üéì Expertise et Domaines de Comp√©tence
Comp√©tences principales (niveau CFA) :

Analyse de titres : actions, obligations, produits d√©riv√©s
√âvaluation d'entreprises : DCF, multiples, analyse comparative
Macro-√©conomie : politique mon√©taire, cycles √©conomiques, indicateurs avanc√©s
Micro-√©conomie : dynamiques sectorielles, avantages concurrentiels, mod√®les d'affaires
Gestion de risque : volatilit√©, corr√©lations, VAR, stress tests
Allocation d'actifs : construction de portefeuille, optimisation
Courbes de taux : analyse, implications, strat√©gies de positionnement
Indices boursiers : composition, m√©thodologie, interpr√©tation
V√©hicules de placement : FNB, fonds, structures alternatives

Capacit√©s analytiques :

Synth√®se de donn√©es financi√®res complexes
Identification de catalyseurs et de risques
Analyse sectorielle et th√©matique
√âvaluation de situations sp√©ciales
Critique constructive de consensus de march√©

üìä M√©thodologie d'Analyse
Structure type d'analyse compl√®te :
1. Synth√®se ex√©cutive (TL;DR)
R√©ponse directe √† la question en 2-3 phrases maximum
2. Contexte et positionnement

Situation actuelle du titre/secteur/th√®me
Positionnement dans le cycle
Consensus du march√©

3. Analyse approfondie
Forces (Points positifs) :

Avantages concurrentiels
Catalyseurs potentiels
Valorisation attractive
Qualit√© du management
Position financi√®re

Faiblesses (Points n√©gatifs) :

Risques identifi√©s
D√©savantages structurels
Pressions concurrentielles
Valorisation excessive (si applicable)
Gouvernance ou ESG

4. M√©triques cl√©s

Valorisation : P/E, P/B, EV/EBITDA, FCF yield
Croissance : revenus, BPA, marges
Qualit√© : ROE, ROIC, dette/EBITDA
Dividendes : rendement, payout ratio, historique

5. Sc√©narios et recommandations
Selon diff√©rents profils :

Style valeur contrarian : opportunit√©s sous-√©valu√©es
Croissance raisonnable : qualit√© √† prix acceptable
D√©fensif : pr√©servation du capital
Tactique : catalyseurs court terme

Niveaux de conviction :

üü¢ Forte conviction (catalyseurs clairs + valorisation attrayante)
üü° Conviction mod√©r√©e (√©quilibre risque/rendement)
üî¥ √âviter (risques sup√©rieurs au potentiel)

6. Risques et points de surveillance

√âl√©ments √† monitorer
Sc√©narios d√©favorables
Points d'invalidation de la th√®se

üåê Recherche et Sources
M√©thodologie de recherche :

Recherche web syst√©matique pour questions n√©cessitant donn√©es r√©centes
Sources privil√©gi√©es :

Rapports financiers d'entreprises (10-K, 10-Q, MD&A)
Donn√©es Bloomberg, Reuters, Yahoo Finance
Articles Seeking Alpha, Morningstar
Publications √©conomiques : BRI, FMI, banques centrales
Presse financi√®re : WSJ, Financial Times, The Economist, Les Affaires, La Presse Affaires
Recherche sell-side et buy-side (quand accessible)

Citations et sources :

Toujours citer les sources utilis√©es
Privil√©gier articles en fran√ßais (Qu√©bec) et anglais
Format : [Titre de l'article - Source - Date]
Indiquer le niveau de fiabilit√© de la source

Recherche approfondie :

Utiliser plusieurs sources pour validation crois√©e
Rechercher donn√©es contradictoires pour analyse √©quilibr√©e
Actualiser avec donn√©es les plus r√©centes disponibles
Mentionner date de derni√®re mise √† jour

üí¨ Ton et Style de Communication
Principes g√©n√©raux :

Professionnelle mais accessible : expertise sans jargon inutile
√âquilibr√©e : pr√©senter forces ET faiblesses
Factuelle et sourc√©e : donn√©es v√©rifiables
Nuanc√©e : √©viter les certitudes absolues sur les march√©s
Pragmatique : focus sur l'actionnable

Adaptations contextuelles :
Pour discussions de comit√© de placement :

Format structur√© et concis
Focus sur d√©cisions √† prendre
Sc√©narios multiples avec probabilit√©s

Pour analyses approfondies :

D√©tails techniques complets
Comparaisons sectorielles
Analyse historique et prospective

Pour questions rapides :

Synth√®se directe d'abord
D√©tails disponibles si demand√©s

Langage et expressions :

Fran√ßais qu√©b√©cois comme langue principale
Utilisation naturelle de termes anglais financiers courants (ex: "fair value", "free cash flow")
√âviter l'ang√©lisme : reconna√Ætre incertitudes et limites

üö® Limites et Transparence
Ce que tu peux faire :
‚úÖ Analyser des donn√©es financi√®res publiques
‚úÖ Synth√©tiser des informations de sources multiples
‚úÖ Fournir des cadres d'analyse structur√©s
‚úÖ Identifier des risques et opportunit√©s
‚úÖ Proposer des pistes de r√©flexion
Ce que tu NE peux PAS faire :
‚ùå Donner des conseils d'investissement personnalis√©s (tu n'es pas conseiller r√©glement√©)
‚ùå Pr√©dire l'avenir des march√©s avec certitude
‚ùå Acc√©der √† des donn√©es propri√©taires ou confidentielles
‚ùå Remplacer le jugement professionnel de l'√©quipe
Formulations transparentes :

¬´ Selon les donn√©es disponibles... ¬ª
¬´ Les analyses sugg√®rent que... ¬ª
¬´ Parmi les risques √† consid√©rer... ¬ª
¬´ Cette perspective doit √™tre valid√©e par... ¬ª

üîß Int√©gration avec le Dashboard Financier
Contexte technique :
L'utilisateur dispose d'un dashboard avec :

Cours d'actions en temps r√©el
Analyses Seeking Alpha
Actualit√©s financi√®res
Graphiques et m√©triques

Ton r√¥le :

Interpr√©ter les donn√©es affich√©es
Contextualiser les mouvements de march√©
Relier micro et macro
Approfondir au-del√† des chiffres bruts
Compl√©ter avec recherches externes

üìã Exemples d'Interactions
Question type 1 : Analyse d'un titre
Utilisateur : ¬´ Peux-tu analyser BCE Inc. dans le contexte actuel des t√©l√©coms canadiens ? ¬ª
Emma :
Synth√®se : BCE pr√©sente un profil d√©fensif avec rendement attrayant (~7%), mais fait face √† des vents contraires sectoriels (saturation, concurrence, capex 5G).
[Analyse compl√®te suivant la structure : contexte, forces, faiblesses, m√©triques, recommandations, risques]
Sources :

Rapport Q3 2024 BCE
¬´ Les t√©l√©coms canadiens sous pression ¬ª - Les Affaires, oct. 2024
Analyse sectorielle Morningstar

Question type 2 : Macro-√©conomie
Utilisateur : ¬´ Que penses-tu de l'impact potentiel des tarifs douaniers de Trump sur nos positions manufacturi√®res ? ¬ª
Emma :
Perspective : Risque √©lev√© de compression de marges pour les entreprises avec cha√Ænes d'approvisionnement int√©gr√©es US-Canada-Mexique. Opportunit√©s contrarian possibles si surr√©action du march√©.
[Analyse des impacts sectoriels, identification d'opportunit√©s valeur, recommandations de couverture]

Question type 3 : Strat√©gie de portefeuille
Utilisateur : ¬´ Devrions-nous augmenter notre exposition or actuellement ? ¬ª
Emma :
[Analyse du contexte macro : taux r√©els, dollar US, tensions g√©opolitiques]
[Corr√©lations historiques or/actions/obligations]
[Sc√©narios d'allocation selon convictions]

‚öñÔ∏è Signature Emma - Analyste Financi√®re
Valeurs cardinales dans ce r√¥le :

Rigueur analytique et m√©thodologique
Ind√©pendance intellectuelle (contrarian assum√©)
Transparence sur limites et incertitudes
Pragmatisme orient√© d√©cisions
Curiosit√© intellectuelle continue

¬´ Je ne pr√©dis pas les march√©s. Mais j'analyse, je questionne et j'√©claire ‚Äî avec rigueur et humilit√©. ¬ª

üé¨ Activation
Tu es maintenant Emma, Analyste Financi√®re Experte.
R√©ponds toujours en fran√ßais qu√©b√©cois, adopte un ton professionnel √©quilibr√©, et structure tes analyses selon la m√©thodologie d√©crite. N'h√©site pas √† rechercher sur le web pour fournir des donn√©es actuelles et citer tes sources.
Pr√™te √† accompagner l'√©quipe dans leurs d√©cisions d'investissement ?`);

                // Initialiser Emma au chargement
                React.useEffect(() => {
                    initializeEmma();
                }, []);

                const initializeEmma = async () => {
                    try {
                        // Charger les messages depuis localStorage (persistance)
                        const savedMessages = localStorage.getItem('emma-messages');
                        if (savedMessages) {
                            setEmmaMessages(JSON.parse(savedMessages));
                        } else {
                            // Message de bienvenue initial seulement si pas de messages sauvegard√©s
                            setEmmaMessages([{
                                type: 'emma',
                                content: 'Bonjour au Groupe Ouellet Bolduc ! Je suis Emma, Assistante virtuelle experte de JSLAI. Je peux vous aider avec l\'analyse, la recherche financi√®re et bien plus. Comment puis-je assister ?',
                                timestamp: new Date().toISOString()
                            }]);
                        }
                        
                        // Charger le prompt depuis localStorage
                        const savedPrompt = localStorage.getItem('emma-financial-prompt');
                        if (savedPrompt) {
                            setEmmaPrompt(savedPrompt);
                        }
                        
                        // Charger la temp√©rature depuis localStorage
                        loadTemperature();
                        
                        // Charger la longueur de r√©ponse depuis localStorage
                        loadMaxTokens();
                        
                        // Charger le param√®tre function calling depuis localStorage
                        loadFunctionCalling();
                        
                        // V√©rifier la connexion Gemini
                        await checkGeminiConnection();
                    } catch (error) {
                        console.error('Erreur initialisation Emma:', error?.message || String(error));
                    }
                };

                const checkGeminiConnection = async () => {
                    try {
                        // Essayer de r√©cup√©rer la cl√© API depuis Vercel
                        const response = await fetch('/api/gemini-key');
                        if (response.ok) {
                            const data = await response.json();
                            setEmmaApiKey(data.apiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '');
                            setEmmaConnected(!!data.apiKey);
                            return;
                        }
                    } catch (error) {
                        console.log('Variable d\'environnement Vercel non disponible');
                    }
                    
                    // Fallback vers localStorage
                    const localKey = localStorage.getItem('gemini-api-key');
                    setEmmaApiKey(localKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '');
                    setEmmaConnected(!!localKey);
                };

                const sendMessageToEmma = async () => {
                    if (!emmaInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        type: 'user',
                        content: emmaInput,
                        timestamp: new Date().toLocaleTimeString('fr-FR')
                    };
                    
                    setEmmaMessages(prev => [...prev, userMessage]);
                    setEmmaLoading(true);
                    
                    try {
                        // Utiliser l'API Gemini
                        const response = await generateGeminiResponse(emmaInput);
                        
                        const emmaResponse = {
                            id: Date.now() + 1,
                            type: 'emma',
                            content: response,
                            timestamp: new Date().toLocaleTimeString('fr-FR')
                        };
                        
                        setEmmaMessages(prev => {
                            const newMessages = [...prev, emmaResponse];
                            // Sauvegarder les messages dans localStorage
                            localStorage.setItem('emma-messages', JSON.stringify(newMessages));
                            return newMessages;
                        });
                    } catch (error) {
                        console.error('Erreur Gemini:', error?.message || String(error));
                        // Analyser le type d'erreur pour un message plus pr√©cis
                        let errorContent = '';
                        if (error.message.includes('404')) {
                            errorContent = `üîß Probl√®me de configuration d√©tect√© ! L'API route n'est pas accessible (erreur 404). 

**Solutions possibles :**
1. V√©rifiez que le d√©ploiement Vercel est √† jour
2. Assurez-vous que la variable GEMINI_API_KEY est bien configur√©e dans Vercel
3. Red√©ployez votre application si n√©cessaire

**Diagnostic :** ${error.message}`;
                        } else if (error.message.includes('Cl√© API Gemini non configur√©e')) {
                            errorContent = `üîë Cl√© API Gemini manquante !

**Configuration requise :**
1. Allez dans votre dashboard Vercel
2. Section "Settings" ‚Üí "Environment Variables"
3. Ajoutez : GEMINI_API_KEY = votre_cl√©_api
4. Red√©ployez l'application

**Diagnostic :** ${error.message}`;
                        } else if (error.message.includes('R√©ponse invalide de l\'API Gemini')) {
                            errorContent = `üîß Probl√®me de structure de r√©ponse Gemini !

**Probl√®me d√©tect√© :** La r√©ponse de l'API Gemini a une structure inattendue.

**Solutions :**
1. V√©rifiez que votre cl√© API Gemini est valide
2. Consultez la console pour voir la structure compl√®te de la r√©ponse
3. Essayez de red√©marrer la conversation

**Diagnostic :** ${error.message}`;
                        } else {
                            errorContent = `‚ùå Erreur de connexion √† l'API Gemini.

**Diagnostic :** ${error.message}

**Solutions :**
- V√©rifiez votre connexion internet
- V√©rifiez la configuration de la cl√© API
- Consultez la console pour plus de d√©tails`;
                        }

                        const errorMessage = {
                            id: Date.now() + 1,
                            type: 'error',
                            content: errorContent,
                            timestamp: new Date().toLocaleTimeString('fr-FR')
                        };
                        setEmmaMessages(prev => [...prev, errorMessage]);
                    } finally {
                        setEmmaLoading(false);
                        // Ne pas vider l'input automatiquement
                    }
                };

                const generateGeminiResponse = async (userMessage) => {
                    try {
                        // R√©cup√©rer la cl√© API avec diagnostic d√©taill√©
                        let apiKey = '';
                        let apiSource = '';
                        let debugInfo = {};
                        
                        try {
                            console.log('üîç Tentative de r√©cup√©ration de la cl√© API via /api/gemini-key...');
                            const response = await fetch('/api/gemini-key');
                            console.log('üì° R√©ponse API route:', response.status, response.statusText);
                            
                            if (response.ok) {
                                const data = await response.json();
                                apiKey = data.apiKey;
                                apiSource = 'vercel-env';
                                debugInfo = {
                                    source: 'vercel-env',
                                    status: response.status,
                                    hasApiKey: !!apiKey
                                };
                                console.log('‚úÖ Cl√© API r√©cup√©r√©e depuis Vercel');
                            } else {
                                const errorData = await response.json().catch(() => ({}));
                                debugInfo = {
                                    source: 'vercel-env-failed',
                                    status: response.status,
                                    error: errorData
                                };
                                console.log('‚ùå √âchec r√©cup√©ration depuis Vercel:', response.status, errorData);
                            }
                        } catch (error) {
                            debugInfo = {
                                source: 'vercel-env-error',
                                error: error.message
                            };
                            console.log('‚ùå Erreur r√©seau API route:', error.message);
                        }

                        // Fallback vers localStorage si Vercel √©choue
                        if (!apiKey) {
                            console.log('üîÑ Tentative de fallback vers localStorage...');
                            apiKey = localStorage.getItem('gemini-api-key') || '';
                            if (apiKey) {
                                apiSource = 'localStorage';
                                debugInfo.fallback = 'localStorage';
                                console.log('‚úÖ Cl√© API r√©cup√©r√©e depuis localStorage');
                            } else {
                                console.log('‚ùå Aucune cl√© API trouv√©e dans localStorage');
                            }
                        }

                        if (!apiKey) {
                            const errorMsg = `Cl√© API Gemini non configur√©e. Diagnostic: ${JSON.stringify(debugInfo)}`;
                            console.error('‚ùå', errorMsg);
                            throw new Error(errorMsg);
                        }

                        // Construire le prompt complet
                        const fullPrompt = `${emmaPrompt}\n\nQuestion de l'utilisateur: ${userMessage}`;

                        let response;
                        
                        // Utiliser l'API avec function calling si activ√©
                        if (useFunctionCalling) {
                            console.log('üîß Utilisation de Gemini Function Calling (chat)');
                            response = await fetch('/api/gemini/chat', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    messages: [
                                        // Historique minimal (multi-tours), on peut l‚Äô√©tendre si besoin
                                        ...emmaMessages.map(m => ({ role: m.type === 'user' ? 'user' : 'assistant', content: m.content })),
                                        { role: 'user', content: userMessage }
                                    ],
                                    temperature: emmaTemperature,
                                    maxTokens: emmaMaxTokens,
                                    systemPrompt: emmaPrompt
                                })
                            });
                        } else {
                            // Utiliser l'API Gemini directe
                            console.log('üîß Utilisation de Gemini direct');
                            response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                                body: JSON.stringify({
                                    contents: [{
                                        parts: [{
                                            text: fullPrompt
                                        }]
                                    }],
                                    generationConfig: {
                                        temperature: emmaTemperature, // Temp√©rature dynamique configur√©e par l'utilisateur
                                        topK: 20, // R√©duit pour plus de pr√©cision dans le vocabulaire financier
                                        topP: 0.8, // R√©duit pour plus de coh√©rence dans les analyses
                                        maxOutputTokens: 4096, // Maintenu pour analyses d√©taill√©es
                                        candidateCount: 1,
                                        stopSequences: []
                                    }
                                })
                            });
                        }

                        if (!response.ok) {
                            throw new Error(`Erreur API: ${response.status}`);
                        }

                        const data = await response.json();
                        
                        // Log de debug pour diagnostiquer la structure de la r√©ponse
                        console.log('üîç R√©ponse Gemini compl√®te:', data);
                        
                        // G√©rer les deux types de r√©ponses (avec et sans function calling)
                        let responseText = '';
                        
                        if (useFunctionCalling && data.response) {
                            // R√©ponse de l'API avec function calling
                            responseText = data.response;
                            console.log('‚úÖ R√©ponse avec Function Calling re√ßue');
                        } else if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                            // Structure standard Gemini
                            responseText = data.candidates[0].content.parts[0].text;
                        } else if (data.candidates && data.candidates[0] && data.candidates[0].text) {
                            // Structure alternative possible
                            responseText = data.candidates[0].text;
                        } else if (data.text) {
                            // Structure directe
                            responseText = data.text;
                        } else if (data.content && data.content.parts && data.content.parts[0]) {
                            // Structure alternative
                            responseText = data.content.parts[0].text;
                        } else {
                            console.error('‚ùå Structure de r√©ponse inattendue:', {
                                hasCandidates: !!data.candidates,
                                candidatesLength: data.candidates?.length,
                                firstCandidate: data.candidates?.[0],
                                hasText: !!data.text,
                                hasContent: !!data.content,
                                fullResponse: data
                            });
                            throw new Error(`R√©ponse invalide de l'API Gemini. Structure: ${JSON.stringify(data, null, 2)}`);
                        }
                        
                        // Log de la r√©ponse pour diagnostic
                        console.log(`üìù R√©ponse Emma (${responseText.length} caract√®res):`, responseText);
                        
                        // V√©rifier si la r√©ponse semble tronqu√©e
                        if (responseText.length < 50) {
                            console.warn('‚ö†Ô∏è R√©ponse tr√®s courte, possible troncature');
                        }
                        
                        return responseText;
                    } catch (error) {
                        console.error('Erreur Gemini:', error?.message || String(error));
                        throw error;
                    }
                };

                const clearChat = () => {
                    setEmmaMessages([]);
                    localStorage.removeItem('emma-messages');
                };

                const savePrompt = () => {
                    localStorage.setItem('emma-financial-prompt', emmaPrompt);
                    setShowPromptEditor(false);
                };

                const saveTemperature = () => {
                    localStorage.setItem('emma-temperature', emmaTemperature.toString());
                };

                const loadTemperature = () => {
                    const saved = localStorage.getItem('emma-temperature');
                    if (saved) {
                        setEmmaTemperature(parseFloat(saved));
                    }
                };

                const saveFunctionCalling = () => {
                    localStorage.setItem('emma-function-calling', useFunctionCalling.toString());
                };

                const loadFunctionCalling = () => {
                    const saved = localStorage.getItem('emma-function-calling');
                    if (saved !== null) {
                        setUseFunctionCalling(saved === 'true');
                    }
                };

                const saveMaxTokens = () => {
                    localStorage.setItem('emma-max-tokens', emmaMaxTokens.toString());
                };

                const loadMaxTokens = () => {
                    const saved = localStorage.getItem('emma-max-tokens');
                    if (saved) {
                        setEmmaMaxTokens(parseInt(saved));
                    }
                };

                const resetPrompt = () => {
                    const defaultPrompt = `Identit√© et Mission
Tu es Emma ‚Äî Exploratrice Multi-M√©tiers Autonome, actuellement configur√©e en mode Analyste Financi√®re et Gestionnaire de Portefeuille.

Mission principale : Accompagner une √©quipe de gestionnaires de portefeuille qu√©b√©cois dans leurs analyses, d√©cisions d'investissement et r√©flexions strat√©giques, en fournissant une expertise de niveau CFA avec rigueur, nuance et esprit critique.
¬´ De la macro √† la micro, des march√©s aux titres ‚Äî j'analyse avec rigueur et pragmatisme. ¬ª

üè¢ Contexte Organisationnel
L'√©quipe que tu assistes :

Localisation : Qu√©bec, Canada
Structure : √âquipe de gestionnaires avec comit√© de placement (r√©unions r√©guli√®res)
Approche de gestion :

D√©tention directe de titres (stock picking)
Style valeur contrarian (contre-courant)
Philosophie pragmatique et analytique
Acceptation de la croissance √† prix raisonnable (GARP)
Utilisation occasionnelle de FNB/fonds pour besoins sp√©cifiques
Positions tactiques en or au besoin

Positions et pr√©f√©rences :
‚úÖ Favoris√©s :

Titres sous-√©valu√©s avec catalyseurs
Analyse fondamentale rigoureuse
Approche contrarian disciplin√©e
Courbes de taux comme outil d'analyse
Vision macro-√©conomique int√©gr√©e

‚ùå √âvit√©s :

Cryptomonnaies
Hype sp√©culatif sans fondamentaux
Valorisations tech excessives sans justification
Suivisme de march√©

‚ö†Ô∏è Vigilance particuli√®re :

Politiques √©conomiques de Trump et impacts
Bulles potentielles dans la tech
Risques g√©opolitiques
Taux d'int√©r√™t et politique mon√©taire

üéì Expertise et Domaines de Comp√©tence
Comp√©tences principales (niveau CFA) :

Analyse de titres : actions, obligations, produits d√©riv√©s
√âvaluation d'entreprises : DCF, multiples, analyse comparative
Macro-√©conomie : politique mon√©taire, cycles √©conomiques, indicateurs avanc√©s
Micro-√©conomie : dynamiques sectorielles, avantages concurrentiels, mod√®les d'affaires
Gestion de risque : volatilit√©, corr√©lations, VAR, stress tests
Allocation d'actifs : construction de portefeuille, optimisation
Courbes de taux : analyse, implications, strat√©gies de positionnement
Indices boursiers : composition, m√©thodologie, interpr√©tation
V√©hicules de placement : FNB, fonds, structures alternatives

Capacit√©s analytiques :

Synth√®se de donn√©es financi√®res complexes
Identification de catalyseurs et de risques
Analyse sectorielle et th√©matique
√âvaluation de situations sp√©ciales
Critique constructive de consensus de march√©

üìä M√©thodologie d'Analyse
Structure type d'analyse compl√®te :
1. Synth√®se ex√©cutive (TL;DR)
R√©ponse directe √† la question en 2-3 phrases maximum
2. Contexte et positionnement

Situation actuelle du titre/secteur/th√®me
Positionnement dans le cycle
Consensus du march√©

3. Analyse approfondie
Forces (Points positifs) :

Avantages concurrentiels
Catalyseurs potentiels
Valorisation attractive
Qualit√© du management
Position financi√®re

Faiblesses (Points n√©gatifs) :

Risques identifi√©s
D√©savantages structurels
Pressions concurrentielles
Valorisation excessive (si applicable)
Gouvernance ou ESG

4. M√©triques cl√©s

Valorisation : P/E, P/B, EV/EBITDA, FCF yield
Croissance : revenus, BPA, marges
Qualit√© : ROE, ROIC, dette/EBITDA
Dividendes : rendement, payout ratio, historique

5. Sc√©narios et recommandations
Selon diff√©rents profils :

Style valeur contrarian : opportunit√©s sous-√©valu√©es
Croissance raisonnable : qualit√© √† prix acceptable
D√©fensif : pr√©servation du capital
Tactique : catalyseurs court terme

Niveaux de conviction :

üü¢ Forte conviction (catalyseurs clairs + valorisation attrayante)
üü° Conviction mod√©r√©e (√©quilibre risque/rendement)
üî¥ √âviter (risques sup√©rieurs au potentiel)

6. Risques et points de surveillance

√âl√©ments √† monitorer
Sc√©narios d√©favorables
Points d'invalidation de la th√®se

üåê Recherche et Sources
M√©thodologie de recherche :

Recherche web syst√©matique pour questions n√©cessitant donn√©es r√©centes
Sources privil√©gi√©es :

Rapports financiers d'entreprises (10-K, 10-Q, MD&A)
Donn√©es Bloomberg, Reuters, Yahoo Finance
Articles Seeking Alpha, Morningstar
Publications √©conomiques : BRI, FMI, banques centrales
Presse financi√®re : WSJ, Financial Times, The Economist, Les Affaires, La Presse Affaires
Recherche sell-side et buy-side (quand accessible)

Citations et sources :

Toujours citer les sources utilis√©es
Privil√©gier articles en fran√ßais (Qu√©bec) et anglais
Format : [Titre de l'article - Source - Date]
Indiquer le niveau de fiabilit√© de la source

Recherche approfondie :

Utiliser plusieurs sources pour validation crois√©e
Rechercher donn√©es contradictoires pour analyse √©quilibr√©e
Actualiser avec donn√©es les plus r√©centes disponibles
Mentionner date de derni√®re mise √† jour

üí¨ Ton et Style de Communication
Principes g√©n√©raux :

Professionnelle mais accessible : expertise sans jargon inutile
√âquilibr√©e : pr√©senter forces ET faiblesses
Factuelle et sourc√©e : donn√©es v√©rifiables
Nuanc√©e : √©viter les certitudes absolues sur les march√©s
Pragmatique : focus sur l'actionnable

Adaptations contextuelles :
Pour discussions de comit√© de placement :

Format structur√© et concis
Focus sur d√©cisions √† prendre
Sc√©narios multiples avec probabilit√©s

Pour analyses approfondies :

D√©tails techniques complets
Comparaisons sectorielles
Analyse historique et prospective

Pour questions rapides :

Synth√®se directe d'abord
D√©tails disponibles si demand√©s

Langage et expressions :

Fran√ßais qu√©b√©cois comme langue principale
Utilisation naturelle de termes anglais financiers courants (ex: "fair value", "free cash flow")
√âviter l'ang√©lisme : reconna√Ætre incertitudes et limites

üö® Limites et Transparence
Ce que tu peux faire :
‚úÖ Analyser des donn√©es financi√®res publiques
‚úÖ Synth√©tiser des informations de sources multiples
‚úÖ Fournir des cadres d'analyse structur√©s
‚úÖ Identifier des risques et opportunit√©s
‚úÖ Proposer des pistes de r√©flexion
Ce que tu NE peux PAS faire :
‚ùå Donner des conseils d'investissement personnalis√©s (tu n'es pas conseiller r√©glement√©)
‚ùå Pr√©dire l'avenir des march√©s avec certitude
‚ùå Acc√©der √† des donn√©es propri√©taires ou confidentielles
‚ùå Remplacer le jugement professionnel de l'√©quipe
Formulations transparentes :

¬´ Selon les donn√©es disponibles... ¬ª
¬´ Les analyses sugg√®rent que... ¬ª
¬´ Parmi les risques √† consid√©rer... ¬ª
¬´ Cette perspective doit √™tre valid√©e par... ¬ª

üîß Int√©gration avec le Dashboard Financier
Contexte technique :
L'utilisateur dispose d'un dashboard avec :

Cours d'actions en temps r√©el
Analyses Seeking Alpha
Actualit√©s financi√®res
Graphiques et m√©triques

Ton r√¥le :

Interpr√©ter les donn√©es affich√©es
Contextualiser les mouvements de march√©
Relier micro et macro
Approfondir au-del√† des chiffres bruts
Compl√©ter avec recherches externes

üìã Exemples d'Interactions
Question type 1 : Analyse d'un titre
Utilisateur : ¬´ Peux-tu analyser BCE Inc. dans le contexte actuel des t√©l√©coms canadiens ? ¬ª
Emma :
Synth√®se : BCE pr√©sente un profil d√©fensif avec rendement attrayant (~7%), mais fait face √† des vents contraires sectoriels (saturation, concurrence, capex 5G).
[Analyse compl√®te suivant la structure : contexte, forces, faiblesses, m√©triques, recommandations, risques]
Sources :

Rapport Q3 2024 BCE
¬´ Les t√©l√©coms canadiens sous pression ¬ª - Les Affaires, oct. 2024
Analyse sectorielle Morningstar

Question type 2 : Macro-√©conomie
Utilisateur : ¬´ Que penses-tu de l'impact potentiel des tarifs douaniers de Trump sur nos positions manufacturi√®res ? ¬ª
Emma :
Perspective : Risque √©lev√© de compression de marges pour les entreprises avec cha√Ænes d'approvisionnement int√©gr√©es US-Canada-Mexique. Opportunit√©s contrarian possibles si surr√©action du march√©.
[Analyse des impacts sectoriels, identification d'opportunit√©s valeur, recommandations de couverture]

Question type 3 : Strat√©gie de portefeuille
Utilisateur : ¬´ Devrions-nous augmenter notre exposition or actuellement ? ¬ª
Emma :
[Analyse du contexte macro : taux r√©els, dollar US, tensions g√©opolitiques]
[Corr√©lations historiques or/actions/obligations]
[Sc√©narios d'allocation selon convictions]

‚öñÔ∏è Signature Emma - Analyste Financi√®re
Valeurs cardinales dans ce r√¥le :

Rigueur analytique et m√©thodologique
Ind√©pendance intellectuelle (contrarian assum√©)
Transparence sur limites et incertitudes
Pragmatisme orient√© d√©cisions
Curiosit√© intellectuelle continue

¬´ Je ne pr√©dis pas les march√©s. Mais j'analyse, je questionne et j'√©claire ‚Äî avec rigueur et humilit√©. ¬ª

üé¨ Activation
Tu es maintenant Emma, Analyste Financi√®re Experte.
R√©ponds toujours en fran√ßais qu√©b√©cois, adopte un ton professionnel √©quilibr√©, et structure tes analyses selon la m√©thodologie d√©crite. N'h√©site pas √† rechercher sur le web pour fournir des donn√©es actuelles et citer tes sources.
Pr√™te √† accompagner l'√©quipe dans leurs d√©cisions d'investissement ?`;
                    setEmmaPrompt(defaultPrompt);
                };

                // --------- Am√©lioration rendu: formatage HTML s√©curis√© ---------
                const formatMessageText = (raw) => {
                    if (!raw || typeof raw !== 'string') return '';
                    const escapeHtml = (s) => s
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                    let t = escapeHtml(raw);

                    // Extraire les blocs de code ``` ``` et prot√©ger via placeholders
                    const codeBlocks = [];
                    t = t.replace(/```([\w-]*)\n([\s\S]*?)\n```/g, (_m, lang, code) => {
                        const idx = codeBlocks.length;
                        codeBlocks.push({ lang: (lang || '').trim(), code });
                        return `@@CODE_BLOCK_${idx}@@`;
                    });

                    // Gras / italique basiques (type Markdown)
                    t = t.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                    t = t.replace(/\*(.+?)\*/g, '<em>$1</em>');

                    // Code inline `code`
                    t = t.replace(/`([^`]+)`/g, '<code class="px-1 py-0.5 rounded bg-gray-800/10 text-[0.95em]">$1</code>');

                    // Titres de section avec emoji (avec ou sans **titre**)
                    t = t.replace(/^(üîç|üìå|üí°|‚ö†Ô∏è|‚úÖ|üîë|üìä|üí¨|üìà|üìâ|‚úâÔ∏è|üîó)\s*(?:\*\*(.+?)\*\*|([^\n]+))$/gm, (_m, emj, boldTitle, plainTitle) => {
                        const title = boldTitle || plainTitle || '';
                        return `<div class="mt-3 mb-2 font-semibold text-base flex items-center gap-2">${emj} <span>${title}</span></div>`;
                    });

                    // Titres Markdown #, ##, ###
                    t = t.replace(/^###\s+(.+)$/gm, '<div class="mt-3 mb-2 font-semibold text-base">$1</div>');
                    t = t.replace(/^##\s+(.+)$/gm, '<div class="mt-3 mb-2 font-semibold text-lg">$1</div>');
                    t = t.replace(/^#\s+(.+)$/gm, '<div class="mt-4 mb-2 font-bold text-xl">$1</div>');

                    // Blocs de listes √† puces (‚àí, ‚Ä¢, *) group√©s en <ul>
                    t = t.replace(/(?:^|\n)((?:[-‚Ä¢*]\s+.+(?:\n|$))+)/gm, (block) => {
                        const items = block
                          .trim()
                          .split(/\n/)
                          .filter(l => /^[-‚Ä¢*]\s+/.test(l))
                          .map(l => l.replace(/^[-‚Ä¢*]\s+/, ''))
                          .map(txt => `<li class="ml-1">${txt}</li>`) // l√©ger d√©calage visuel
                          .join('');
                        return `\n<ul class="list-disc pl-5 space-y-1">${items}</ul>\n`;
                    });

                    // Blocs de listes num√©rot√©es group√©s en <ol>
                    t = t.replace(/(?:^|\n)((?:\d+\.\s+.+(?:\n|$))+)/gm, (block) => {
                        const items = block
                          .trim()
                          .split(/\n/)
                          .filter(l => /^\d+\.\s+/.test(l))
                          .map(l => l.replace(/^\d+\.\s+/, ''))
                          .map(txt => `<li>${txt}</li>`)
                          .join('');
                        return `\n<ol class="list-decimal pl-5 space-y-1">${items}</ol>\n`;
                    });

                    // Citations >
                    t = t.replace(/^(>+)\s*(.+)$/gm, (_m, _arrows, quote) => `<blockquote class="border-l-4 pl-3 italic opacity-90">${quote}</blockquote>`);

                    // R√®gles horizontales --- ou ___
                    t = t.replace(/^\s*(?:---|___)\s*$/gm, '<hr class="my-3 opacity-50">');

                    // Mise en avant de la ligne ¬´ Sources ¬ª
                    t = t.replace(/^\s*(?:üîó\s*)?Sources?\s*:\s*$/gim, '<div class="mt-3 mb-1 font-semibold">üîó Sources</div>');

                    // Paragraphes (double saut) + sauts de ligne simples
                    t = t.replace(/\n\n/g, '</p><p class="mb-2">');
                    t = t.replace(/\n/g, '<br>');

                    // Linkification d'URLs
                    t = t.replace(/((https?:\/\/|www\.)[\w.-]+(?:\/[\w\-._~:/?#[\]@!$&'()*+,;=%]*)?)/g, (url) => {
                        const href = url.startsWith('http') ? url : `http://${url}`;
                        return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">${url}</a>`;
                    });

                    // R√©insertion des blocs de code prot√©g√©s
                    t = t.replace(/@@CODE_BLOCK_(\d+)@@/g, (_m, idxStr) => {
                        const idx = parseInt(idxStr, 10);
                        const block = codeBlocks[idx];
                        if (!block) return '';
                        const langLabel = block.lang ? `<div class="text-xs opacity-70 mb-1">${block.lang}</div>` : '';
                        const codeSafe = block.code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        return `<div class="my-2"><div class="rounded-md border border-gray-200 ${isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'} p-3 overflow-auto">${langLabel}<pre class="m-0"><code>${codeSafe}</code></pre></div></div>`;
                    });

                    // Conteneur final
                    return `<div class="leading-relaxed text-sm">${t}</div>`;
                };

                // --------- Email: exporter la conversation ---------
                const [showEmailModal, setShowEmailModal] = useState(false);
                const [emailTo, setEmailTo] = useState('');
                const [emailSubject, setEmailSubject] = useState("Conversation avec Emma IA");
                const [showProfile, setShowProfile] = useState(false);

                const buildEmailBody = () => {
                    const lines = [];
                    lines.push('üì® Transcription ‚Äî Conversation avec Emma IA');
                    lines.push('');
                    emmaMessages.forEach(m => {
                        const who = m.type === 'user' ? 'üë§ Vous' : (m.type === 'error' ? '‚ö†Ô∏è Erreur' : 'ü§ñ Emma');
                        lines.push(`${who}`);
                        lines.push('');
                        // Conserver la mise en forme l√©g√®re (listes et gras markdown)
                        const content = (m.content || '')
                          .replace(/\r\n/g, '\n')
                          .replace(/\n{3,}/g, '\n\n')
                          .trim();
                        lines.push(content);
                        lines.push('');
                        lines.push('‚Äî ‚Äî ‚Äî');
                        lines.push('');
                    });
                    lines.push('‚Äî Envoy√© depuis le Dashboard GOB');
                    return lines.join('\n');
                };

                const sendEmailTranscript = () => {
                    const body = encodeURIComponent(buildEmailBody());
                    const subj = encodeURIComponent(emailSubject || 'Conversation avec Emma IA');
                    const to = encodeURIComponent(emailTo || '');
                    window.location.href = `mailto:${to}?subject=${subj}&body=${body}`;
                    setShowEmailModal(false);
                };

                return (
                    <div className="space-y-6">
                        <div className="flex justify-between items-center">
                            <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>ü§ñ Ask Emma</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={clearChat}
                                    className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
                                >
                                    üóëÔ∏è Effacer
                                </button>
                                <button
                                    onClick={() => { if (typeof setShowProfile === 'function') setShowProfile(true); }}
                                    className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors"
                                >
                                    üë§ Profil d'Emma
                                </button>
                                <button
                                    onClick={() => setShowEmailModal(true)}
                                    className="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 transition-colors"
                                    title="Envoyer la discussion par courriel"
                                >
                                    ‚úâÔ∏è Envoyer par courriel
                                </button>
                                <button
                                    onClick={() => setShowPromptEditor(!showPromptEditor)}
                                    className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors"
                                >
                                    üìù Prompt
                                </button>
                                <button
                                    onClick={() => setShowTemperatureEditor(!showTemperatureEditor)}
                                    className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                                >
                                    üå°Ô∏è Temp√©rature
                                </button>
                                <button
                                    onClick={() => setShowLengthEditor(!showLengthEditor)}
                                    className="px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors"
                                >
                                    üìè Longueur
                                </button>
                                <div className={`px-3 py-2 rounded text-sm font-medium ${
                                    emmaConnected ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                }`}>
                                    {emmaConnected ? '‚úÖ Gemini Connect√©' : '‚ùå Gemini Non Connect√©'}
                                </div>
                            </div>
                        </div>

                        {/* Zone de chat */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-20 h-20 rounded-full overflow-hidden flex-shrink-0">
                                    <img 
                                        src={isDarkMode ? 'emma-avatar-gob-dark.jpg' : 'emma-avatar-gob-light.jpg'} 
                                        alt="Emma" 
                                        className="w-full h-full object-cover"
                                    />
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                        isDarkMode ? 'text-white' : 'text-gray-900'
                                    }`}>Emma IA</h3>
                                    <p className={`text-sm transition-colors duration-300 ${
                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                    }`}>Analyste financi√®re virtuelle</p>
                                </div>
                            </div>

                            {/* Messages */}
                            <div className={`h-[500px] overflow-y-auto mb-4 p-4 rounded-lg transition-colors duration-300 ${
                                isDarkMode ? 'bg-gray-900' : 'bg-gray-50'
                            }`}>
                                {emmaMessages.length === 0 ? (
                                    <div className="flex gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-full overflow-hidden flex-shrink-0">
                                            <img 
                                                src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                alt="Emma" 
                                                className="w-full h-full object-cover"
                                            />
                                        </div>
                                        <div className={`flex-1 p-4 rounded-lg ${
                                            isDarkMode ? 'bg-gray-800' : 'bg-white'
                                        } shadow-sm`}>
                                            <p className={`text-sm leading-relaxed mb-3 ${
                                                isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                            }`}>
                                                Bonjour au Groupe Ouellet Bolduc ! Je suis Emma, Experte financi√®re IA de JSLAI. Je peux vous aider avec l'analyse et l'√©valuation financi√®re. Quel est votre d√©fi financier ?
                                            </p>
                                            <div className={`flex items-start gap-2 p-3 rounded-lg mb-3 ${
                                                isDarkMode ? 'bg-red-900/30 border border-red-800' : 'bg-red-50 border border-red-200'
                                            }`}>
                                                <span className="text-red-500 text-sm">üìå</span>
                                                <span className={`text-xs ${
                                                    isDarkMode ? 'text-red-300' : 'text-red-700'
                                                }`}>
                                                    Rappel : Pour des conseils personnalis√©s, consultez toujours un expert qualifi√© du domaine.
                                                </span>
                                            </div>
                                            <p className={`text-sm ${
                                                isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                            }`}>
                                                Comment puis-je vous aider ?
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {emmaMessages.map((message) => (
                                            <div key={message.id} className={`flex gap-3 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                {message.type !== 'user' && (
                                                    <div className="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                                        <img 
                                                            src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                            alt="Emma" 
                                                            className="w-full h-full object-cover"
                                                        />
                                                    </div>
                                                )}
                                                <div className={`max-w-xl px-4 py-3 rounded-lg shadow ${
                                                    message.type === 'user' 
                                                        ? 'bg-blue-600 text-white shadow-blue-500/20' 
                                                        : message.type === 'error'
                                                        ? 'bg-red-600 text-white shadow-red-500/20'
                                                        : isDarkMode 
                                                            ? 'bg-gray-800 text-white border border-gray-700' 
                                                            : 'bg-white text-gray-900 border border-gray-200'
                                                }`}>
                                                    <div className="prose prose-sm max-w-none" dangerouslySetInnerHTML={{ __html: formatMessageText(message.content) }} />
                                                    <div className={`text-xs mt-1 ${
                                                        message.type === 'user' ? 'text-blue-100' : 'text-gray-400'
                                                    }`}>
                                                        {message.timestamp}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        {emmaLoading && (
                                            <div className="flex gap-3 justify-start">
                                                <div className="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                                                    <img 
                                                        src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} 
                                                        alt="Emma" 
                                                        className="w-full h-full object-cover"
                                                    />
                                                </div>
                                                <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                                                    isDarkMode ? 'bg-gray-700 text-white' : 'bg-gray-200 text-gray-900'
                                                }`}>
                                                    <div className="flex items-center gap-2">
                                                        <div className="animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full"></div>
                                                        <span>Emma r√©fl√©chit...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Input */}
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={emmaInput}
                                    onChange={(e) => setEmmaInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && sendMessageToEmma()}
                                    placeholder="Posez votre question √† Emma..."
                                    className={`flex-1 px-4 py-2 rounded-lg border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    disabled={emmaLoading}
                                />
                                <button
                                    onClick={sendMessageToEmma}
                                    disabled={emmaLoading || !emmaInput.trim()}
                                    className={`px-6 py-2 rounded-lg font-medium transition-colors duration-300 ${
                                        emmaLoading || !emmaInput.trim()
                                            ? 'bg-gray-400 text-gray-200 cursor-not-allowed'
                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {emmaLoading ? '‚è≥' : 'üì§'}
                                </button>
                                {emmaInput.trim() && (
                                    <button
                                        onClick={() => setEmmaInput('')}
                                        className="px-3 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition-colors"
                                        title="Vider l'input"
                                    >
                                        ‚úï
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* √âditeur de prompt */}
                        {showPromptEditor && (
                            <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            }`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                        isDarkMode ? 'text-white' : 'text-gray-900'
                                    }`}>üìù √âditeur de Prompt Emma</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={resetPrompt}
                                            className="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors"
                                        >
                                            üîÑ R√©initialiser
                                        </button>
                                        <button
                                            onClick={savePrompt}
                                            className="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors"
                                        >
                                            üíæ Sauvegarder
                                        </button>
                                    </div>
                                </div>
                                
                                <textarea
                                    value={emmaPrompt}
                                    onChange={(e) => setEmmaPrompt(e.target.value)}
                                    className={`w-full h-64 p-3 rounded-lg border transition-colors duration-300 font-mono text-sm ${
                                        isDarkMode 
                                            ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' 
                                            : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                                    }`}
                                    placeholder="Saisissez votre prompt personnalis√© pour Emma..."
                                />
                                
                                <div className={`mt-3 p-3 rounded-lg text-sm ${
                                    isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-600'
                                }`}>
                                    <p className="font-medium mb-2">Variables disponibles :</p>
                                    <ul className="space-y-1 text-xs">
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{userMessage}"}</code> - Message de l'utilisateur</li>
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{dashboardData}"}</code> - Donn√©es du dashboard</li>
                                        <li><code className="bg-gray-200 text-gray-800 px-1 rounded">{"{currentTime}"}</code> - Heure actuelle</li>
                                    </ul>
                                </div>
                            </div>
                        )}

                        {/* Modal d'envoi par courriel */}
                        {showEmailModal && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60">
                                <div className={`w-full max-w-md rounded-lg p-6 shadow-xl ${isDarkMode ? 'bg-gray-900 border border-gray-700' : 'bg-white border border-gray-200'}`}>
                                    <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>‚úâÔ∏è Envoyer par courriel</h3>
                                    <div className="space-y-3">
                                        <input
                                            type="email"
                                            value={emailTo}
                                            onChange={(e) => setEmailTo(e.target.value)}
                                            placeholder="Destinataire"
                                            className={`w-full px-3 py-2 rounded border ${isDarkMode ? 'bg-gray-800 border-gray-700 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'}`}
                                        />
                                        <input
                                            type="text"
                                            value={emailSubject}
                                            onChange={(e) => setEmailSubject(e.target.value)}
                                            className={`w-full px-3 py-2 rounded border ${isDarkMode ? 'bg-gray-800 border-gray-700 text-white' : 'bg-white border-gray-300 text-gray-900'}`}
                                        />
                                        <textarea
                                            className={`w-full h-32 px-3 py-2 rounded border ${isDarkMode ? 'bg-gray-800 border-gray-700 text-gray-300' : 'bg-white border-gray-300 text-gray-800'}`}
                                            readOnly
                                            value={buildEmailBody()}
                                        />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-4">
                                        <button onClick={() => setShowEmailModal(false)} className={`px-4 py-2 rounded ${isDarkMode ? 'bg-gray-700 text-white hover:bg-gray-600' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`}>Annuler</button>
                                        <button onClick={sendEmailTranscript} className="px-4 py-2 rounded bg-emerald-600 text-white hover:bg-emerald-700">Envoyer</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Modal Profil d'Emma */}
                        {(typeof showProfile !== 'undefined' ? showProfile : false) && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70">
                                <div className={`w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden ${isDarkMode ? 'bg-gray-900 border border-gray-700' : 'bg-white border border-gray-200'}`}>
                                    <div className={`p-5 flex items-center gap-4 ${isDarkMode ? 'bg-gray-800' : 'bg-gray-50'}`}>
                                        <img src={isDarkMode ? 'EMMA-JSLAI-GOB-dark.jpg' : 'EMMA-JSLAI-GOB-light.jpg'} alt="Emma" className="w-16 h-16 rounded-full object-cover" />
                                        <div>
                                            <div className={`text-xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Emma ‚Äî Analyste Financi√®re IA</div>
                                            <div className={`${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>JSL AI ‚Ä¢ Profil professionnel</div>
                                        </div>
                                        <button onClick={() => setShowProfile(false)} className={`ml-auto px-3 py-1 rounded ${isDarkMode ? 'bg-gray-700 text-white hover:bg-gray-600' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`}>Fermer</button>
                                    </div>
                                    <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <h4 className={`font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Mission</h4>
                                            <p className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>Accompagner une √©quipe de gestionnaires de portefeuille qu√©b√©cois avec une expertise de niveau CFA, rigueur et esprit critique.</p>
                                            <h4 className={`font-semibold mt-4 mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Comp√©tences cl√©s</h4>
                                            <ul className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'} list-disc pl-5 space-y-1`}>
                                                <li>Analyse fondamentale (actions, obligations, d√©riv√©s)</li>
                                                <li>√âvaluation (DCF, multiples, comparables)</li>
                                                <li>Macro/sectoriel, gestion du risque, allocation</li>
                                                <li>R√©daction d‚Äôanalyses structur√©es et sourc√©es</li>
                                            </ul>
                                        </div>
                                        <div>
                                            <h4 className={`font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Style et ton</h4>
                                            <ul className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'} list-disc pl-5 space-y-1`}>
                                                <li>Professionnel, p√©dagogique, factuel</li>
                                                <li>Structure claire avec √©mojis et points cl√©s</li>
                                                <li>Sources officielles et v√©rifiables (2‚Äì3)</li>
                                            </ul>
                                            <h4 className={`font-semibold mt-4 mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Pr√©f√©rences analytiques</h4>
                                            <ul className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'} list-disc pl-5 space-y-1`}>
                                                <li>Valeur contrarian / GARP quand justifi√©</li>
                                                <li>Attention aux bulles, risques macro/geopol</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* √âditeur de Temp√©rature */}
                        {showTemperatureEditor && (
                            <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gray-900 border-gray-700' 
                                    : 'bg-gray-50 border-gray-200'
                            }`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                        isDarkMode ? 'text-white' : 'text-gray-900'
                                    }`}>üå°Ô∏è Contr√¥le de Temp√©rature Emma</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setEmmaTemperature(0.3)}
                                            className="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors"
                                        >
                                            üîÑ R√©initialiser
                                        </button>
                                        <button
                                            onClick={() => {
                                                saveTemperature();
                                                saveFunctionCalling();
                                            }}
                                            className="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors"
                                        >
                                            üíæ Sauvegarder
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* Contr√¥le Function Calling */}
                                    <div className={`p-3 rounded-lg border ${
                                        isDarkMode ? 'bg-gray-800 border-gray-600' : 'bg-gray-100 border-gray-300'
                                    }`}>
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <label className={`text-sm font-medium transition-colors duration-300 ${
                                                    isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                                }`}>
                                                    üîß Function Calling (Donn√©es Temps R√©el)
                                                </label>
                                                <p className={`text-xs mt-1 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                }`}>
                                                    Emma peut acc√©der aux donn√©es financi√®res actuelles via nos APIs
                                                </p>
                                            </div>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={useFunctionCalling}
                                                    onChange={(e) => setUseFunctionCalling(e.target.checked)}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </div>

                                    {/* Slider de temp√©rature */}
                                    <div>
                                        <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                        }`}>
                                            Temp√©rature: {emmaTemperature}
                                        </label>
                                        <input
                                            type="range"
                                            min="0.1"
                                            max="1.0"
                                            step="0.1"
                                            value={emmaTemperature}
                                            onChange={(e) => setEmmaTemperature(parseFloat(e.target.value))}
                                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                        />
                                        <div className="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>0.1 (Pr√©cis)</span>
                                            <span>1.0 (Cr√©atif)</span>
                                        </div>
                                    </div>

                                    {/* Presets de temp√©rature */}
                                    <div>
                                        <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                        }`}>
                                            Presets Recommand√©s:
                                        </label>
                                        <div className="grid grid-cols-2 gap-2">
                                            <button
                                                onClick={() => setEmmaTemperature(0.1)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${
                                                    emmaTemperature === 0.1 
                                                        ? 'bg-blue-600 text-white' 
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                <div className="font-medium">üìä Tr√®s Pr√©cis</div>
                                                <div className="text-xs opacity-75">Analyses factuelles</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaTemperature(0.3)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${
                                                    emmaTemperature === 0.3 
                                                        ? 'bg-blue-600 text-white' 
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                <div className="font-medium">üìà Financier</div>
                                                <div className="text-xs opacity-75">Analyses professionnelles</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaTemperature(0.5)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${
                                                    emmaTemperature === 0.5 
                                                        ? 'bg-blue-600 text-white' 
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                <div className="font-medium">üéØ Mod√©r√©</div>
                                                <div className="text-xs opacity-75">√âquilibr√© et factuel</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaTemperature(0.7)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${
                                                    emmaTemperature === 0.7 
                                                        ? 'bg-blue-600 text-white' 
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                <div className="font-medium">‚öñÔ∏è √âquilibr√©</div>
                                                <div className="text-xs opacity-75">Professionnel et naturel</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaTemperature(0.9)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${
                                                    emmaTemperature === 0.9 
                                                        ? 'bg-blue-600 text-white' 
                                                        : isDarkMode 
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                <div className="font-medium">üé® Cr√©atif</div>
                                                <div className="text-xs opacity-75">Id√©es innovantes</div>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Exemples de r√©ponses */}
                                    <div className={`p-3 rounded-lg text-sm ${
                                        isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-600'
                                    }`}>
                                        <p className="font-medium mb-2">Exemples de r√©ponses selon la temp√©rature :</p>
                                        <div className="space-y-2 text-xs">
                                            <div>
                                                <strong>Temp√©rature 0.1:</strong> "Apple pr√©sente un P/E de 28.5, une croissance des revenus de 8.2% YoY, et une position de tr√©sorerie de $29.4B. Recommandation: ACHAT."
                                            </div>
                                            <div>
                                                <strong>Temp√©rature 0.5:</strong> "Apple montre une performance financi√®re robuste avec des m√©triques cl√©s positives. Le P/E de 28.5 est raisonnable pour la croissance, et la tr√©sorerie de $29.4B renforce la position. Recommandation: ACHAT."
                                            </div>
                                            <div>
                                                <strong>Temp√©rature 0.7:</strong> "Apple semble int√©ressant avec de bonnes perspectives de croissance, mais il faut surveiller les d√©fis du march√© chinois..."
                                            </div>
                                            <div>
                                                <strong>Temp√©rature 0.9:</strong> "Apple, c'est comme un ph√©nix qui rena√Æt de ses cendres ! Avec leur √©cosyst√®me int√©gr√©, ils pourraient r√©volutionner..."
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* √âditeur de longueur de r√©ponse */}
                        {showLengthEditor && (
                            <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50 border-gray-200'}`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className={`text-lg font-semibold transition-colors duration-300 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>üìè Contr√¥le de Longueur Emma</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setEmmaMaxTokens(4096)}
                                            className="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors"
                                        >
                                            üîÑ R√©initialiser
                                        </button>
                                        <button
                                            onClick={() => {
                                                saveMaxTokens();
                                            }}
                                            className="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors"
                                        >
                                            üíæ Sauvegarder
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* Slider de longueur */}
                                    <div>
                                        <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                            Longueur de r√©ponse: {emmaMaxTokens} tokens
                                        </label>
                                        <input
                                            type="range"
                                            min="1024"
                                            max="8192"
                                            step="1024"
                                            value={emmaMaxTokens}
                                            onChange={(e) => setEmmaMaxTokens(parseInt(e.target.value))}
                                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                        />
                                        <div className="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>1024 (Court)</span>
                                            <span>8192 (Long)</span>
                                        </div>
                                    </div>

                                    {/* Presets de longueur */}
                                    <div>
                                        <label className={`block text-sm font-medium mb-2 transition-colors duration-300 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                            Presets Recommand√©s:
                                        </label>
                                        <div className="grid grid-cols-2 gap-2">
                                            <button
                                                onClick={() => setEmmaMaxTokens(1024)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${emmaMaxTokens === 1024 ? 'bg-orange-600 text-white' : isDarkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            >
                                                <div className="font-medium">üìù Court</div>
                                                <div className="text-xs opacity-75">2-3 paragraphes</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaMaxTokens(2048)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${emmaMaxTokens === 2048 ? 'bg-orange-600 text-white' : isDarkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            >
                                                <div className="font-medium">üìä Moyen</div>
                                                <div className="text-xs opacity-75">Analyses courtes √† moyenne</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaMaxTokens(4096)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${emmaMaxTokens === 4096 ? 'bg-orange-600 text-white' : isDarkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            >
                                                <div className="font-medium">üìà Complet</div>
                                                <div className="text-xs opacity-75">Analyses moyennes (Par d√©faut)</div>
                                            </button>
                                            <button
                                                onClick={() => setEmmaMaxTokens(8192)}
                                                className={`p-3 rounded-lg text-sm transition-colors ${emmaMaxTokens === 8192 ? 'bg-orange-600 text-white' : isDarkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
                                            >
                                                <div className="font-medium">üìã Rapport</div>
                                                <div className="text-xs opacity-75">Rapports complets</div>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Exemples de longueur */}
                                    <div className={`p-3 rounded-lg text-sm ${isDarkMode ? 'bg-gray-800 text-gray-300' : 'bg-gray-100 text-gray-600'}`}>
                                        <p className="font-medium mb-2">Exemples d'ajustements possibles de maxOutputTokens :</p>
                                        <div className="space-y-2 text-xs">
                                            <div><strong>1024 ‚Üí</strong> r√©ponses courtes (2-3 paragraphes)</div>
                                            <div><strong>2048 ‚Üí</strong> analyses courtes √† moyenne</div>
                                            <div><strong>Par D√©faut : 4096</strong> analyses moyennes</div>
                                            <div><strong>8192 ‚Üí</strong> rapports complets (si mod√®le supporte)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Suggestions rapides */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>üí° Suggestions rapides</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                {[
                                    "Comment analyser une action ?",
                                    "O√π trouver les actualit√©s ?",
                                    "Comment utiliser le scraping ?",
                                    "Explique-moi cette donn√©e",
                                    "Qu'est-ce que le P/E ratio ?",
                                    "Comment interpr√©ter les graphiques ?"
                                ].map((suggestion, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setEmmaInput(suggestion)}
                                        className={`p-3 rounded-lg text-left transition-colors duration-300 ${
                                            isDarkMode 
                                                ? 'bg-gray-700 hover:bg-gray-600 text-white' 
                                                : 'bg-gray-100 hover:bg-gray-200 text-gray-900'
                                        }`}
                                    >
                                        <div className="text-sm font-medium">{suggestion}</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Aide contextuelle */}
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-blue-900/30 border-blue-600' 
                                : 'bg-blue-100/80 border-blue-300'
                        }`}>
                            <h3 className={`text-lg font-semibold mb-4 transition-colors duration-300 ${
                                isDarkMode ? 'text-white' : 'text-gray-900'
                            }`}>‚ÑπÔ∏è √Ä propos d'Emma</h3>
                            <div className={`text-sm space-y-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-blue-200' : 'text-blue-800'
                            }`}>
                                <div>‚Ä¢ <strong>Navigation :</strong> Emma vous guide dans l'interface</div>
                                <div>‚Ä¢ <strong>Interpr√©tation :</strong> Explique les donn√©es financi√®res</div>
                                <div>‚Ä¢ <strong>Recommandations :</strong> Sugg√®re les meilleures pratiques</div>
                                <div>‚Ä¢ <strong>Support :</strong> R√©pond √† vos questions techniques</div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Composant onglet Stocks & News
            const StocksNewsTab = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className={`text-2xl font-bold transition-colors duration-300 ${
                            isDarkMode ? 'text-white' : 'text-gray-900'
                        }`}>üìä Titres & nouvelles</h2>
                        <div className="flex gap-2">
                            <div className={`rounded-lg p-1 transition-colors duration-300 ${
                                isDarkMode ? 'bg-gray-700' : 'bg-gray-200'
                            }`}>
                                <button
                                    onClick={() => setViewMode('list')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'list' 
                                            ? (isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-600 text-white')
                                            : (isDarkMode ? 'text-gray-300 hover:text-white' : 'text-gray-600 hover:text-gray-900')
                                    }`}
                                >
                                    üìã Liste
                                </button>
                                <button
                                    onClick={() => setViewMode('cards')}
                                    className={`px-3 py-1 rounded text-sm transition-colors ${
                                        viewMode === 'cards' 
                                            ? (isDarkMode ? 'bg-blue-600 text-white' : 'bg-blue-600 text-white')
                                            : (isDarkMode ? 'text-gray-300 hover:text-white' : 'text-gray-600 hover:text-gray-900')
                                    }`}
                                >
                                    üé¥ Cartes
                                </button>
                            </div>
                            <button
                                onClick={refreshAllStocks}
                                disabled={loading}
                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                            >
                                {loading ? 'Actualisation...' : 'Actualiser Stocks'}
                            </button>
                            <button
                                onClick={fetchNews}
                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                            >
                                Actualiser News
                            </button>
                        </div>
                    </div>

                    {lastUpdate && (
                        <p className="text-gray-400 text-sm">
                            Derni√®re mise √† jour: {new Date(lastUpdate).toLocaleString('fr-FR')}
                        </p>
                    )}

                    {/* Debug des donn√©es d√©plac√© vers Admin-JSLAI */}

                    {/* Section Donn√©es Financi√®res & Actualit√©s (Finnhub) - PRINCIPALE */}
                    <div className="mt-8">
                        <div className={`backdrop-blur-sm rounded-2xl p-8 border-2 shadow-2xl transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gradient-to-br from-gray-800/90 to-gray-900/90 border-blue-500/30 shadow-blue-500/10' 
                                : 'bg-gradient-to-br from-white/95 to-gray-50/95 border-blue-400/40 shadow-blue-400/10'
                        }`}>
                            <div className="text-center mb-6">
                                <h2 className={`text-2xl font-bold mb-3 transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>
                                    üìä Donn√©es Financi√®res & Actualit√©s
                                </h2>
                                <div className={`inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-300 ${
                                    isDarkMode 
                                        ? 'bg-blue-600/20 text-blue-300 border border-blue-500/30' 
                                        : 'bg-blue-100/80 text-blue-700 border border-blue-300/50'
                                }`}>
                                    <span className="mr-2">üîó</span>
                                    Source: Finnhub API
                                </div>
                                <p className={`text-sm mt-3 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                }`}>
                                    Donn√©es en temps r√©el avec 3 actualit√©s par titre
                                </p>
                            </div>
                            <div className="overflow-x-auto max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-800 relative text-sm">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className={`border-b-2 transition-colors duration-300 ${
                                            isDarkMode ? 'border-blue-500/50 bg-gray-900' : 'border-blue-400/50 bg-gray-100'
                                        }`}>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìà Ticker</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üí∞ Prix</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìä Change</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üìà P/E</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üíé Dividende</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üè¢ Secteur</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>‚≠ê Rating</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>üòä Sentiment</th>
                                            <th className={`text-left py-2 px-3 font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                            }`}>‚ö° Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {tickers.map(ticker => {
                                            // Donn√©es de Finnhub uniquement
                                            const finnhubData = stockData[ticker];
                                            const price = finnhubData?.c ? `$${finnhubData.c.toFixed(2)}` : 'N/A';
                                            const change = finnhubData?.d ? `${finnhubData.d > 0 ? '+' : ''}${finnhubData.d.toFixed(2)}` : 'N/A';
                                            const changePercent = finnhubData?.dp ? `${finnhubData.dp > 0 ? '+' : ''}${finnhubData.dp.toFixed(2)}%` : 'N/A';
                                            const changeColor = finnhubData?.d > 0 ? 'text-green-400' : finnhubData?.d < 0 ? 'text-red-400' : 'text-gray-400';
                                            
                                            // Donn√©es de profil Finnhub
                                            const profile = finnhubData?.profile;
                                            const fundamentals = finnhubData?.fundamentals;
                                            const peRatio = fundamentals?.peRatio
                                                ? (Number.isFinite(fundamentals.peRatio) ? fundamentals.peRatio.toFixed(2) : fundamentals.peRatio)
                                                : (profile?.pe ? profile.pe.toFixed(2) : 'N/A');
                                            const dividendYield = fundamentals?.dividendYield
                                                ? `${(Number(fundamentals.dividendYield) * 100).toFixed(2)}%`
                                                : (profile?.dividend ? `${(profile.dividend * 100).toFixed(2)}%` : 'N/A');
                                            const sector = fundamentals?.sector || profile?.industry || 'N/A';
                                            
                                            // Donn√©es de recommandation Finnhub
                                            const recommendation = finnhubData?.recommendation;
                                            const rating = recommendation?.length > 0 ? 
                                                (recommendation[0].buy + recommendation[0].strongBuy > recommendation[0].sell + recommendation[0].strongSell ? 'Achat' : 
                                                 recommendation[0].sell + recommendation[0].strongSell > recommendation[0].buy + recommendation[0].strongBuy ? 'Vente' : 'Neutre') : 'N/A';
                                            
                                            // 3 actualit√©s les plus r√©centes pour ce ticker
                                            const tickerNews = newsData.filter(article => {
                                                const text = (article.title + ' ' + article.description).toLowerCase();
                                                return text.includes(ticker.toLowerCase());
                                            }).slice(0, 3);
                                            
                                            // Analyse du sentiment
                                            const analyzeSentiment = (title, description) => {
                                                const text = (title + ' ' + description).toLowerCase();
                                                const positiveWords = ['hausse', 'croissance', 'gain', 'profit', 'positif', 'am√©lioration', 'succ√®s', 'fort', 'solide'];
                                                const negativeWords = ['baisse', 'chute', 'perte', 'n√©gatif', 'd√©clin', 'faible', 'probl√®me', 'risque', 'inqui√©tude'];
                                                
                                                const positiveCount = positiveWords.filter(word => text.includes(word)).length;
                                                const negativeCount = negativeWords.filter(word => text.includes(word)).length;
                                                
                                                if (positiveCount > negativeCount) return { sentiment: 'Positif', color: 'text-green-400' };
                                                if (negativeCount > positiveCount) return { sentiment: 'N√©gatif', color: 'text-red-400' };
                                                return { sentiment: 'Neutre', color: 'text-gray-400' };
                                            };
                                            
                                            const sentiment = tickerNews.length > 0 ? analyzeSentiment(tickerNews[0].title, tickerNews[0].description) : { sentiment: 'N/A', color: 'text-gray-400' };
                                            
                                            return (
                                                <React.Fragment key={ticker}>
                                                    {/* Ligne principale - STYLE PRINCIPAL */}
                                                    <tr className={`border-b-2 transition-all duration-300 hover:scale-[1.02] ${
                                                        isDarkMode 
                                                            ? 'border-gray-600/50 hover:bg-gradient-to-r hover:from-gray-800/80 hover:to-gray-700/80 hover:shadow-lg hover:shadow-blue-500/10' 
                                                            : 'border-gray-300/50 hover:bg-gradient-to-r hover:from-gray-50/80 hover:to-white/80 hover:shadow-lg hover:shadow-blue-400/10'
                                                    }`}>
                                                        <td className="py-4 px-3">
                                                            <div className="flex items-center gap-3">
                                                                <img 
                                                                    src={getCompanyLogo(ticker)} 
                                                                    alt={`${ticker} logo`}
                                                                    className="w-8 h-8 rounded-lg shadow-md"
                                                                    onError={(e) => {
                                                                        e.target.style.display = 'none';
                                                                    }}
                                                                />
                                                                <span className={`font-mono font-bold text-xl transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                                }`}>{ticker}</span>
                                                            </div>
                                                        </td>
                                                        <td className={`py-2 px-3 font-bold transition-colors duration-300 ${
                                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                                        }`}>{price}</td>
                                                        <td className={`py-2 px-3 font-semibold transition-colors duration-300 ${changeColor}`}>
                                                            {change} ({changePercent})
                                                        </td>
                                                        <td className={`py-2 px-3 font-medium transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                        }`}>{peRatio}</td>
                                                        <td className={`py-2 px-3 font-medium transition-colors duration-300 ${
                                                            isDarkMode ? 'text-green-300' : 'text-green-600'
                                                        }`}>{dividendYield}</td>
                                                        <td className={`py-2 px-3 text-sm transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                        }`}>{cleanText(sector)}</td>
                                                        <td className="py-4 px-3">
                                                            <span className={`px-4 py-2 rounded-full text-sm font-bold transition-colors duration-300 ${
                                                                rating === 'Achat' ? 'bg-green-500 text-white' :
                                                                rating === 'Vente' ? 'bg-red-500 text-white' :
                                                                'bg-yellow-500 text-black'
                                                            }`}>
                                                                {rating}
                                                            </span>
                                                        </td>
                                                        <td className="py-4 px-3">
                                                            <div className={`flex items-center gap-2 px-3 py-2 rounded-full transition-colors duration-300 ${
                                                                sentiment.sentiment === 'Positif' ? 'bg-green-100 text-green-800' :
                                                                sentiment.sentiment === 'N√©gatif' ? 'bg-red-100 text-red-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                <span className="text-lg">
                                                                    {sentiment.sentiment === 'Positif' ? 'üòä' : 
                                                                     sentiment.sentiment === 'N√©gatif' ? 'üòü' : 'üòê'}
                                                                </span>
                                                                <span className="font-semibold">{sentiment.sentiment}</span>
                                                            </div>
                                                        </td>
                                                        <td className="py-4 px-3">
                                                            <button
                                                                onClick={() => setSelectedStock(ticker)}
                                                                className={`px-4 py-2 text-xs font-semibold rounded-lg transition-all duration-300 hover:scale-[1.02] shadow ${
                                                                    isDarkMode 
                                                                        ? 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white shadow-blue-500/25' 
                                                                        : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white shadow-blue-400/25'
                                                                }`}
                                                            >
                                                                üìä Voir d√©tail
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    
                                                    {/* Lignes d'actualit√©s (3 maximum) - STYLE AM√âLIOR√â */}
                                                    {tickerNews.map((news, newsIndex) => (
                                                        <tr key={`${ticker}-news-${newsIndex}`} className={`border-b-2 transition-all duration-300 hover:scale-[1.01] ${
                                                            isDarkMode 
                                                                ? 'border-gray-600/30 bg-gradient-to-r from-gray-800/40 to-gray-700/40 hover:from-gray-700/60 hover:to-gray-600/60' 
                                                                : 'border-gray-300/30 bg-gradient-to-r from-gray-50/60 to-white/60 hover:from-gray-100/80 hover:to-gray-50/80'
                                                        }`}>
                                                            <td colSpan="9" className="py-6 px-4">
                                                                <div className={`transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                                }`}>
                                                                    <div className="flex items-start gap-4">
                                                                        <div className={`p-3 rounded-full transition-colors duration-300 ${
                                                                            isDarkMode ? 'bg-blue-600/20 text-blue-300' : 'bg-blue-100 text-blue-600'
                                                                        }`}>
                                                                            <span className="text-2xl">üì∞</span>
                                                                        </div>
                                                                        <div className="flex-1">
                                                                            <h5 className={`font-bold text-lg mb-3 transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                                                            }`}>
                                                                                {news.url ? (
                                                                                    <a 
                                                                                        href={news.url} 
                                                                                        target="_blank" 
                                                                                        rel="noopener noreferrer"
                                                                                        className={`hover:underline transition-colors duration-300 ${
                                                                                            isDarkMode 
                                                                                                ? 'text-blue-300 hover:text-blue-200' 
                                                                                                : 'text-blue-600 hover:text-blue-700'
                                                                                        }`}
                                                                                    >
                                                                                        {cleanText(news.title)}
                                                                                    </a>
                                                                                ) : (
                                                                                    cleanText(news.title)
                                                                                )}
                                                                            </h5>
                                                                            <p className={`text-base mb-4 leading-relaxed transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                            }`}>
                                                                                {cleanText(news.description)}
                                                                            </p>
                                                                            <div className={`flex items-center gap-4 text-sm transition-colors duration-300 ${
                                                                                isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                            }`}>
                                                                                <div className={`flex items-center gap-2 px-3 py-1 rounded-full transition-colors duration-300 ${
                                                                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
                                                                                }`}>
                                                                                    <span className="font-semibold">{news.source?.name || 'Source inconnue'}</span>
                                                                                </div>
                                                                                <div className={`flex items-center gap-2 px-3 py-1 rounded-full transition-colors duration-300 ${
                                                                                    isDarkMode ? 'bg-gray-800' : 'bg-gray-200'
                                                                                }`}>
                                                                                    <span>üïí</span>
                                                                                    <span>
                                                                                        {news.publishedAt ? 
                                                                                            new Date(news.publishedAt).toLocaleString('fr-FR') : 
                                                                                            'Date inconnue'
                                                                                        }
                                                                                    </span>
                                                                                </div>
                                                                                {news.url && (
                                                                                    <a 
                                                                                        href={news.url} 
                                                                                        target="_blank" 
                                                                                        rel="noopener noreferrer"
                                                                                        className={`px-4 py-2 rounded-full font-semibold transition-all duration-300 hover:scale-105 ${
                                                                                            isDarkMode 
                                                                                                ? 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/25' 
                                                                                                : 'bg-blue-500 hover:bg-blue-400 text-white shadow-lg shadow-blue-400/25'
                                                                                        }`}
                                                                                    >
                                                                                        üìñ Lire l'article
                                                                                    </a>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </React.Fragment>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                            <div className={`text-center mt-8 p-6 rounded-xl transition-colors duration-300 ${
                                isDarkMode 
                                    ? 'bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-500/20' 
                                    : 'bg-gradient-to-r from-blue-100/80 to-purple-100/80 border border-blue-300/30'
                            }`}>
                                <div className={`text-lg font-semibold mb-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-blue-300' : 'text-blue-700'
                                }`}>
                                    üìú Section Principale - Donn√©es Financi√®res
                                </div>
                                <div className={`text-sm transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                }`}>
                                    Faites d√©filer pour voir toutes les donn√©es ‚Ä¢ Source: Finnhub API ‚Ä¢ 3 actualit√©s par titre
                                </div>
                                <div className={`text-xs mt-2 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>
                                    Donn√©es mises √† jour automatiquement toutes les 5 minutes
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Vue en liste compacte */}
                    {viewMode === 'list' && tickers.length > 0 && (
                        <div className="bg-gray-900 rounded-lg p-4 border border-gray-600">
                            <h3 className="text-lg font-semibold text-white mb-4">üìã Vue Liste</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b border-gray-600">
                                            <th className="text-left py-2 text-gray-300">Ticker</th>
                                            <th className="text-left py-2 text-gray-300">Prix</th>
                                            <th className="text-left py-2 text-gray-300">Change</th>
                                            <th className="text-left py-2 text-gray-300">P/E</th>
                                            <th className="text-left py-2 text-gray-300">Dividende</th>
                                            <th className="text-left py-2 text-gray-300">Secteur</th>
                                            <th className="text-left py-2 text-gray-300">Rating</th>
                                            <th className="text-left py-2 text-gray-300">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        {tickers.map(ticker => {
                            const data = stockData[ticker];
                                            const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                            const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                            const parsedData = seekingAlphaItem?.parsedData;
                                            
                                            if (!data && !claudeData && !parsedData) return null;

                                            // Priorit√©: Claude > Parsed > Finnhub
                                            const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                            const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                            const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                            const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                            const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                            const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                            
                                            const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';

                            return (
                                                <tr key={ticker} className="border-b border-gray-700 hover:bg-gray-800 cursor-pointer"
                                                    onClick={() => setSelectedStock(ticker)}>
                                                    <td className="py-3">
                                                        <div className="flex items-center gap-2">
                                                            <img 
                                                                src={getCompanyLogo(ticker)} 
                                                                alt={`${ticker} logo`}
                                                                className="w-6 h-6 rounded"
                                                                onError={(e) => {
                                                                    e.target.style.display = 'none';
                                                                }}
                                                            />
                                                            <span className="font-mono text-white font-bold">{ticker}</span>
                                                        </div>
                                                    </td>
                                                    <td className="py-3 text-white">{price}</td>
                                                    <td className={`py-3 ${changeColor}`}>{change}</td>
                                                    <td className="py-3 text-white">{peRatio}</td>
                                                    <td className="py-3 text-white">{dividendYield}</td>
                                                    <td className="py-3 text-white text-xs">{cleanText(sector)}</td>
                                                    <td className="py-3">
                                                        <span className="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-bold">
                                                            {rating}
                                        </span>
                                                    </td>
                                                    <td className="py-3">
                                                        <button className="text-blue-400 hover:text-blue-300 text-xs">
                                                            Voir fiche ‚Üí
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                                    </div>
                        </div>
                    )}

                    {/* Cartes condens√©es */}
                    {viewMode === 'cards' && tickers.length > 0 && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {tickers.map(ticker => {
                                const data = stockData[ticker];
                                const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                if (!data && !claudeData && !parsedData) return null;

                                // Priorit√©: Claude > Parsed > Finnhub
                                const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                const peRatio = claudeData?.metrics?.peRatio || parsedData?.peRatio || 'N/A';
                                const dividendYield = claudeData?.metrics?.dividendYield || parsedData?.dividendYield || 'N/A';
                                const sector = claudeData?.metrics?.sector || parsedData?.sector || 'N/A';
                                const marketCap = claudeData?.metrics?.marketCap || parsedData?.marketCap || 'N/A';
                                const companyName = claudeData?.companyName || parsedData?.companyName || 'N/A';
                                const rating = claudeData?.finalConclusion?.rating || 'Hold';
                                
                                const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                const changeBgColor = (change.includes('+') || change.includes('green')) ? 'bg-green-500' : 'bg-red-500';

                                return (
                                    <div key={ticker} className="bg-gray-900 rounded-lg p-6 border border-gray-600 hover:border-blue-400/50 transition-all cursor-pointer"
                                         onClick={() => setSelectedStock(ticker)}>
                                        
                                        {/* Header avec ticker et rating */}
                                        <div className="flex justify-between items-start mb-6">
                                            <div className="flex items-center gap-3">
                                                <img 
                                                    src={getCompanyLogo(ticker)} 
                                                    alt={`${ticker} logo`}
                                                    className="w-12 h-12 rounded-lg"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                    }}
                                                />
                                                <div>
                                                    <h3 className="text-2xl font-bold text-white">{ticker}</h3>
                                                    <p className="text-sm text-gray-400">
                                                        {cleanText(companyName)}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="bg-yellow-400 text-black px-3 py-1 rounded font-bold text-sm">
                                                {rating}
                                            </div>
                                    </div>
                                    
                                        {/* Prix et changement */}
                                        <div className="bg-gray-800 rounded-lg p-4 mb-6 border border-gray-600">
                                            <div className="text-3xl font-bold text-white mb-1">
                                                {price}
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className={`w-4 h-4 ${changeBgColor} rounded`}></div>
                                                <span className={`text-sm font-medium ${changeColor}`}>
                                                    {change}
                                                </span>
                                            </div>
                                        </div>
                                    
                                        {/* M√©triques cl√©s */}
                                        <div className="space-y-3 mb-6">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Market Cap</span>
                                                <span className="text-white font-medium">{marketCap}</span>
                                    </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">P/E Ratio</span>
                                                <span className="text-white font-medium">{peRatio}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Dividend</span>
                                                <span className="text-white font-medium">{dividendYield}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400">Secteur</span>
                                                <span className="text-white font-medium">{cleanText(sector)}</span>
                                            </div>
                                        </div>

                                        {/* Quant Ratings */}
                                        {claudeData?.quantRating && (
                                            <div className="mb-6">
                                                <div className="border-t border-gray-600 pt-4">
                                                    <h4 className="text-center text-gray-300 text-sm font-medium mb-4">QUANT RATINGS</h4>
                                                    <div className="flex justify-center gap-3">
                                                        {Object.entries(claudeData.quantRating).map(([key, value]) => {
                                                            if (!value || key === 'overall') return null;
                                                            const shortKey = key.substring(0, 3);
                                                            return (
                                                                <div key={key} className="text-center">
                                                                    <div className="text-xs text-gray-400 mb-1">{shortKey}</div>
                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getGradeColor(value)}`}>
                                                                        {value}
                                                                    </span>
                                </div>
                            );
                        })}
                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Call to action */}
                                        <div className="text-center">
                                            <div className="flex items-center justify-center gap-2 text-gray-400 text-sm">
                                                <span>üëÜ</span>
                                                <span>Cliquez pour le rapport d√©taill√©</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Section Actualit√©s par Ticker */}
                    {tickers.length > 0 && (
                        <div className={`backdrop-blur-sm rounded-lg p-4 border transition-colors duration-300 ${
                            isDarkMode 
                                ? 'bg-gray-900 border-gray-700' 
                                : 'bg-gray-50 border-gray-200'
                        }`}>
                            <div className="flex items-center justify-between mb-4">
                                <h3 className={`text-lg font-semibold transition-colors duration-300 ${
                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                }`}>üì∞ Actualit√©s par Ticker</h3>
                                <button 
                                    onClick={fetchNews}
                                    className={`px-3 py-1 text-sm rounded transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-blue-600 hover:bg-blue-700 text-white' 
                                            : 'bg-blue-500 hover:bg-blue-600 text-white'
                                    }`}
                                >
                                    üîÑ Actualiser
                                </button>
                            </div>
                            
                            {newsData.length === 0 ? (
                                <div className={`text-center py-8 transition-colors duration-300 ${
                                    isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                }`}>
                                    <div className="text-4xl mb-2">üì∞</div>
                                    <p>Aucune actualit√© disponible</p>
                                    <p className="text-sm mt-1">Cliquez sur "Actualiser" pour charger les actualit√©s</p>
                                </div>
                            ) : (
                                <div className="space-y-4 max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-thumb-gray-600 dark:scrollbar-track-gray-800 relative">
                                    {tickers.map(ticker => {
                                        // Filtrer les actualit√©s pour ce ticker
                                        const tickerNews = newsData.filter(article => {
                                            const text = ((article.title || '') + ' ' + (article.description || '')).toLowerCase();
                                            const tagged = (article.ticker || '').toLowerCase();
                                            return tagged === ticker.toLowerCase() || text.includes(ticker.toLowerCase());
                                        });
                                        
                                        if (tickerNews.length === 0) return null;
                                        
                                        return (
                                            <div key={ticker} className={`rounded-lg p-4 transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border border-gray-700' 
                                                    : 'bg-gray-100 border border-gray-300'
                                            }`}>
                                                <h4 className={`font-semibold mb-3 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                }`}>
                                                    üìà {ticker} - {tickerNews.length} actualit√©{tickerNews.length > 1 ? 's' : ''}
                                                </h4>
                                                <div className="space-y-3">
                                                    {tickerNews.slice(0, 3).map((article, index) => (
                                                        <div key={index} className={`p-3 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'bg-gray-900 hover:bg-gray-800' 
                                                                : 'bg-gray-100 hover:bg-white'
                                                        }`}>
                                                            <div className="flex items-start gap-3">
                                                                <span className={`text-sm transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-blue-400' : 'text-blue-600'
                                                                }`}>üì∞</span>
                                                                <div className="flex-1">
                                                                    <h5 className={`font-medium mb-1 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                                                    }`}>
                                                                        {article.url ? (
                                                                            <a 
                                                                                href={article.url} 
                                                                                target="_blank" 
                                                                                rel="noopener noreferrer"
                                                                                className={`hover:underline transition-colors duration-300 ${
                                                                                    isDarkMode 
                                                                                        ? 'text-blue-400 hover:text-blue-300' 
                                                                                        : 'text-blue-600 hover:text-blue-700'
                                                                                }`}
                                                                            >
                                                                                {cleanText(article.title)}
                                                                            </a>
                                                                        ) : (
                                                                            cleanText(article.title)
                                                                        )}
                                                                    </h5>
                                                                    <p className={`text-sm mb-2 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                    }`}>
                                                                        {cleanText(article.description)}
                                                                    </p>
                                                                    <div className={`flex items-center gap-2 text-xs transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                    }`}>
                                                                        <span>{article.source?.name || 'Source inconnue'}</span>
                                                                        <span>‚Ä¢</span>
                                                                        <span>
                                                                            {article.publishedAt ? 
                                                                                new Date(article.publishedAt).toLocaleString('fr-FR') : 
                                                                                'Date inconnue'
                                                                            }
                                                                        </span>
                                                                        {article.url && (
                                                                            <>
                                                                                <span>‚Ä¢</span>
                                                                                <a 
                                                                                    href={article.url} 
                                                                                    target="_blank" 
                                                                                    rel="noopener noreferrer"
                                                                                    className={`hover:underline transition-colors duration-300 ${
                                                                                        isDarkMode 
                                                                                            ? 'text-blue-400 hover:text-blue-300' 
                                                                                            : 'text-blue-600 hover:text-blue-700'
                                                                                    }`}
                                                                                >
                                                                                    Lire l'article ‚Üí
                                                                                </a>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {tickerNews.length > 3 && (
                                                        <div className={`text-center text-sm transition-colors duration-300 ${
                                                            isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                        }`}>
                                                            ... et {tickerNews.length - 3} autre{tickerNews.length - 3 > 1 ? 's' : ''} actualit√©{tickerNews.length - 3 > 1 ? 's' : ''}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {/* Actualit√©s g√©n√©rales */}
                                    {(() => {
                                        const generalNews = newsData.filter(article => {
                                            const text = (article.title + ' ' + article.description).toLowerCase();
                                            return !tickers.some(ticker => text.includes(ticker.toLowerCase()));
                                        });
                                        
                                        if (generalNews.length === 0) return null;
                                        
                                        return (
                                            <div className={`rounded-lg p-4 transition-colors duration-300 ${
                                                isDarkMode 
                                                    ? 'bg-gray-800 border border-gray-700' 
                                                    : 'bg-gray-100 border border-gray-300'
                                            }`}>
                                                <h4 className={`font-semibold mb-3 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                }`}>
                                                    üåê Actualit√©s G√©n√©rales - {generalNews.length} actualit√©{generalNews.length > 1 ? 's' : ''}
                                                </h4>
                                                <div className="space-y-3">
                                                    {generalNews.slice(0, 5).map((article, index) => (
                                                        <div key={index} className={`p-3 rounded transition-colors duration-300 ${
                                                            isDarkMode 
                                                                ? 'bg-gray-900 hover:bg-gray-800' 
                                                                : 'bg-gray-100 hover:bg-white'
                                                        }`}>
                                                            <div className="flex items-start gap-3">
                                                                <span className={`text-sm transition-colors duration-300 ${
                                                                    isDarkMode ? 'text-blue-400' : 'text-blue-600'
                                                                }`}>üåê</span>
                                                                <div className="flex-1">
                                                                    <h5 className={`font-medium mb-1 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-200' : 'text-gray-800'
                                                                    }`}>
                                                                        {article.url ? (
                                                                            <a 
                                                                                href={article.url} 
                                                                                target="_blank" 
                                                                                rel="noopener noreferrer"
                                                                                className={`hover:underline transition-colors duration-300 ${
                                                                                    isDarkMode 
                                                                                        ? 'text-blue-400 hover:text-blue-300' 
                                                                                        : 'text-blue-600 hover:text-blue-700'
                                                                                }`}
                                                                            >
                                                                                {cleanText(article.title)}
                                                                            </a>
                                                                        ) : (
                                                                            cleanText(article.title)
                                                                        )}
                                                                    </h5>
                                                                    <p className={`text-sm mb-2 transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                                                    }`}>
                                                                        {cleanText(article.description)}
                                                                    </p>
                                                                    <div className={`flex items-center gap-2 text-xs transition-colors duration-300 ${
                                                                        isDarkMode ? 'text-gray-400' : 'text-gray-500'
                                                                    }`}>
                                                                        <span>{article.source?.name || 'Source inconnue'}</span>
                                                                        <span>‚Ä¢</span>
                                                                        <span>
                                                                            {article.publishedAt ? 
                                                                                new Date(article.publishedAt).toLocaleString('fr-FR') : 
                                                                                'Date inconnue'
                                                                            }
                                                                        </span>
                                                                        {article.url && (
                                                                            <>
                                                                                <span>‚Ä¢</span>
                                                                                <a 
                                                                                    href={article.url} 
                                                                                    target="_blank" 
                                                                                    rel="noopener noreferrer"
                                                                                    className={`hover:underline transition-colors duration-300 ${
                                                                                        isDarkMode 
                                                                                            ? 'text-blue-400 hover:text-blue-300' 
                                                                                            : 'text-blue-600 hover:text-blue-700'
                                                                                    }`}
                                                                                >
                                                                                    Lire l'article ‚Üí
                                                                                </a>
                                                                            </>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            )}
                            <div className={`text-xs text-center mt-2 transition-colors duration-300 ${
                                isDarkMode ? 'text-gray-400' : 'text-gray-500'
                            }`}>
                                üì∞ Faites d√©filer pour voir toutes les actualit√©s
                            </div>
                        </div>
                    )}

                    {/* Message si aucune donn√©e */}
                    {tickers.length === 0 && (
                        <div className="bg-yellow-900/20 backdrop-blur-sm rounded-lg p-6 border border-yellow-300/20">
                            <div className="flex items-center gap-3">
                                <span className="text-yellow-400 text-2xl">‚ö†Ô∏è</span>
                                <div>
                                    <h3 className="text-yellow-200 font-semibold">Aucun ticker configur√©</h3>
                                    <p className="text-yellow-300/80 text-sm mt-1">
                                        Ajoutez des tickers dans l'onglet Seeking Alpha pour voir les donn√©es ici.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Section des actualit√©s */}
                    <div className="mt-8">
                        <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-bold text-white">üì∞ Actualit√©s Financi√®res</h3>
                            <div className="flex gap-2">
                                <select 
                                    className="px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none"
                                    value={newsFilter}
                                    onChange={(e) => filterNews(e.target.value)}
                                >
                                    <option value="all">Tous les tickers</option>
                                    {tickers.map(ticker => (
                                        <option key={ticker} value={ticker}>{ticker}</option>
                                    ))}
                                </select>
                                <button
                                    onClick={fetchNews}
                                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    üîÑ Actualiser
                                </button>
                            </div>
                        </div>

                        {filteredNews.length > 0 ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredNews.slice(0, 9).map((article, index) => {
                                    // Analyser le sentiment de l'article
                                    const analyzeSentiment = (title, description) => {
                                        if (!title && !description) return { sentiment: 'Neutre', color: 'text-gray-400', bgColor: 'bg-gray-100', icon: 'üòê' };
                                        
                                        const text = (title + ' ' + description).toLowerCase();
                                        const positiveWords = ['strong', 'growth', 'increase', 'rise', 'gain', 'positive', 'beat', 'exceed', 'surge', 'rally', 'boost', 'fort', 'croissance', 'hausse', 'gain', 'positif', 'd√©passer'];
                                        const negativeWords = ['decline', 'fall', 'drop', 'loss', 'negative', 'miss', 'weak', 'concern', 'risk', 'challenge', 'baisse', 'chute', 'perte', 'n√©gatif', 'manquer', 'faible', 'pr√©occupation', 'risque'];
                                        
                                        const positiveCount = positiveWords.filter(word => text.includes(word)).length;
                                        const negativeCount = negativeWords.filter(word => text.includes(word)).length;
                                        
                                        if (positiveCount > negativeCount) {
                                            return { sentiment: 'Positif', color: 'text-green-400', bgColor: 'bg-green-100', icon: 'üìà' };
                                        } else if (negativeCount > positiveCount) {
                                            return { sentiment: 'N√©gatif', color: 'text-red-400', bgColor: 'bg-red-100', icon: 'üìâ' };
                                        } else {
                                            return { sentiment: 'Neutre', color: 'text-gray-400', bgColor: 'bg-gray-100', icon: 'üòê' };
                                        }
                                    };

                                    const sentiment = analyzeSentiment(article.title, article.description);
                                    const publishedDate = new Date(article.publishedAt).toLocaleDateString('fr-FR', {
                                        day: 'numeric',
                                        month: 'short',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    return (
                                        <div key={index} className="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-300/40 transition-all cursor-pointer group news-card">
                                            {/* Header avec sentiment */}
                                            <div className="flex justify-between items-start mb-4">
                                                <div className={`px-3 py-1 rounded-full text-xs font-medium ${sentiment.bgColor} ${sentiment.color}`}>
                                                    {sentiment.icon} {sentiment.sentiment}
                                                </div>
                                                <span className="text-xs text-gray-400">{publishedDate}</span>
                                            </div>

                                            {/* Titre de l'article */}
                                            <h4 className="text-white font-semibold mb-3 line-clamp-2 group-hover:text-blue-300 transition-colors">
                                                {article.title}
                                            </h4>

                                            {/* Description */}
                                            <p className="text-gray-300 text-sm mb-4 line-clamp-3">
                                                {article.description}
                                            </p>

                                            {/* Source et lien */}
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs text-gray-400">
                                                    {article.source?.name || 'Source inconnue'}
                                                </span>
                                                <a
                                                    href={article.url}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="text-blue-400 hover:text-blue-300 text-sm font-medium transition-colors"
                                                    onClick={(e) => e.stopPropagation()}
                                                >
                                                    Lire plus ‚Üí
                                                </a>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <div className="bg-gray-800 rounded-lg p-8 text-center border border-gray-700">
                                <div className="text-6xl mb-4">üì∞</div>
                                <h4 className="text-white text-lg font-semibold mb-2">Aucune actualit√© disponible</h4>
                                <p className="text-gray-400 mb-4">Cliquez sur "Actualiser" pour charger les derni√®res actualit√©s financi√®res</p>
                                <button
                                    onClick={fetchNews}
                                    className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    Charger les actualit√©s
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Section des graphiques de prix */}
                    <div className="mt-8">
                        <h3 className="text-xl font-bold text-white mb-6">üìä Graphiques de Prix</h3>
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {tickers.slice(0, 4).map(ticker => {
                                const data = stockData[ticker];
                                const claudeData = seekingAlphaStockData.stocks?.[ticker];
                                const seekingAlphaItem = seekingAlphaData.stocks?.find(s => s.ticker === ticker);
                                const parsedData = seekingAlphaItem?.parsedData;
                                
                                const price = claudeData?.metrics?.price || parsedData?.price || `$${data?.c?.toFixed(2) || 'N/A'}`;
                                const change = claudeData?.metrics?.priceChange || parsedData?.change || (data?.dp >= 0 ? '+' : '') + (data?.dp?.toFixed(2) || '0') + '%';
                                const changeColor = (change.includes('+') || change.includes('green')) ? 'text-green-400' : 'text-red-400';
                                
                                return (
                                    <div key={ticker} className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                        <div className="flex justify-between items-center mb-4">
                                            <h4 className="text-white font-bold text-lg">{ticker}</h4>
                                            <div className="text-right">
                                                <div className="text-white font-semibold">{price}</div>
                                                <div className={`text-sm ${changeColor}`}>{change}</div>
                            </div>
                                        </div>
                                        
                                        {/* Placeholder pour le graphique */}
                                        <div className="h-48 bg-gray-700 rounded-lg flex items-center justify-center">
                                            <div className="text-center">
                                                <div className="text-4xl mb-2">üìà</div>
                                                <p className="text-gray-400 text-sm">Graphique interactif</p>
                                                <p className="text-gray-500 text-xs">Chart.js sera int√©gr√© ici</p>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-4 flex justify-between text-sm text-gray-400">
                                            <span>1D</span>
                                            <span>1W</span>
                                            <span>1M</span>
                                            <span>3M</span>
                                            <span>1Y</span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                </div>
            );

            // ============================================
            // COMPOSANT INTELLISTOCKS
            // ============================================
            const IntelliStocksTab = () => {
                const [time, setTime] = useState(new Date());
                const [selectedStock, setSelectedStock] = useState('AAPL');
                const [timeframe, setTimeframe] = useState('1D');
                const [menuOpen, setMenuOpen] = useState(false);
                const [stockDataIntelli, setStockDataIntelli] = useState(null);
                const [loadingIntelli, setLoadingIntelli] = useState(true);
                const [connected, setConnected] = useState(false);
                const [lastUpdateIntelli, setLastUpdateIntelli] = useState(null);
                // Helppop: visibilit√© et liste des violations d√©tect√©es
                const [showHelp, setShowHelp] = useState(false);
                const [violations, setViolations] = useState([]);

                // G√©n√©ration de donn√©es mock
                const generateMockData = (symbol) => {
                    const basePrice = {
                        AAPL: 183.45, TSLA: 251.23, GOOGL: 143.12,
                        MSFT: 384.89, NVDA: 485.32, AMZN: 178.91
                    }[symbol] || 180;

                    const companyNames = {
                        AAPL: 'Apple Inc.', TSLA: 'Tesla Inc.', GOOGL: 'Alphabet Inc.',
                        MSFT: 'Microsoft Corp.', NVDA: 'NVIDIA Corp.', AMZN: 'Amazon.com Inc.'
                    };

                    return {
                        quote: {
                            symbol,
                            name: companyNames[symbol] || 'Company Inc.',
                            price: basePrice,
                            change: parseFloat((Math.random() * 6 - 2).toFixed(2)),
                            changesPercentage: parseFloat((Math.random() * 4 - 1).toFixed(2)),
                            volume: Math.floor(Math.random() * 50000000 + 30000000),
                            marketCap: Math.floor(Math.random() * 2000000000000 + 1000000000000),
                            avgVolume: Math.floor(Math.random() * 60000000 + 40000000)
                        },
                        intraday: Array.from({ length: 20 }, (_, i) => ({
                            date: `${9 + Math.floor(i/4)}:${(i % 4) * 15}`,
                            open: basePrice + (Math.random() * 4 - 2),
                            high: basePrice + (Math.random() * 5 - 1),
                            low: basePrice + (Math.random() * 3 - 3),
                            close: basePrice + (Math.random() * 4 - 2),
                            volume: Math.floor(Math.random() * 5000000 + 2000000)
                        })),
                        metrics: {
                            peRatioTTM: parseFloat((Math.random() * 40 + 15).toFixed(1)),
                            pegRatioTTM: parseFloat((Math.random() * 2 + 0.5).toFixed(2)),
                            priceToSalesRatioTTM: parseFloat((Math.random() * 8 + 2).toFixed(2)),
                            dividendYieldTTM: parseFloat((Math.random() * 0.03).toFixed(4))
                        },
                        ratios: {
                            debtEquityRatio: parseFloat((Math.random() * 2 + 0.3).toFixed(2)),
                            returnOnEquityTTM: parseFloat((Math.random() * 0.4 + 0.1).toFixed(3)),
                            returnOnAssetsTTM: parseFloat((Math.random() * 0.2 + 0.05).toFixed(3)),
                            netProfitMarginTTM: parseFloat((Math.random() * 0.3 + 0.1).toFixed(3)),
                        },
                        profile: {
                            companyName: companyNames[symbol] || 'Company Inc.',
                            price: basePrice,
                            beta: parseFloat((Math.random() * 0.6 + 0.8).toFixed(2)),
                            sector: 'Technology',
                            industry: 'Consumer Electronics'
                        },
                        news: [
                            {
                                title: `${symbol} annonce r√©sultats trimestriels record`,
                                publishedDate: new Date(Date.now() - 2*3600000).toISOString(),
                                site: 'Reuters'
                            },
                            {
                                title: `Nouveau partenariat strat√©gique annonc√©`,
                                publishedDate: new Date(Date.now() - 5*3600000).toISOString(),
                                site: 'Bloomberg'
                            },
                            {
                                title: `Analystes rel√®vent objectif de prix`,
                                publishedDate: new Date(Date.now() - 8*3600000).toISOString(),
                                site: 'CNBC'
                            }
                        ],
                        sentiment: {
                            overall: Math.floor(Math.random() * 30 + 60),
                            news: Math.floor(Math.random() * 30 + 65),
                            social: Math.floor(Math.random() * 30 + 60),
                            institutional: Math.floor(Math.random() * 30 + 55),
                            retail: Math.floor(Math.random() * 30 + 70),
                            summary: 'Sentiment globalement positif avec optimisme mod√©r√©'
                        },
                        insights: {
                            catalysts: [
                                'R√©sultats trimestriels sup√©rieurs aux attentes',
                                'Innovation produit majeure annonc√©e',
                                'Expansion internationale r√©ussie'
                            ],
                            risks: [
                                'Concurrence accrue dans le secteur',
                                'Incertitudes macro√©conomiques',
                                'Volatilit√© des march√©s'
                            ],
                            consensus: 'bullish',
                            reasoning: 'Les fondamentaux solides et la croissance continue justifient un sentiment positif'
                        }
                    };
                };

                // Chargement des donn√©es
                useEffect(() => {
                    const fetchData = async () => {
                        try {
                            const mockData = generateMockData(selectedStock);
                            setStockDataIntelli(mockData);
                            setConnected(true);
                            setLoadingIntelli(false);
                            setLastUpdateIntelli(new Date());
                        } catch (error) {
                            console.error('Error fetching data:', error?.message || String(error));
                            setConnected(false);
                            setLoadingIntelli(false);
                            const mockData = generateMockData(selectedStock);
                            setStockDataIntelli(mockData);
                            // Enregistrer une violation visible dans l'helppop
                            setViolations(prev => [
                                ...prev,
                                { code: 'data_fetch_error', severity: 'medium', message: '√âchec de r√©cup√©ration API. Donn√©es mock utilis√©es.' }
                            ]);
                            setShowHelp(true);
                        }
                    };
                    fetchData();
                    const interval = setInterval(fetchData, 30000);
                    return () => clearInterval(interval);
                }, [selectedStock]);

                // Timer
                useEffect(() => {
                    const timer = setInterval(() => setTime(new Date()), 1000);
                    return () => clearInterval(timer);
                }, []);

                // Diagnostics environnementaux (violations) + ouverture auto du HelpPop
                useEffect(() => {
                    const newViolations = [];
                    try {
                        if (typeof Recharts === 'undefined') {
                            newViolations.push({
                                code: 'recharts_missing',
                                severity: 'high',
                                message: 'Recharts non charg√© ‚Äî graphiques d√©sactiv√©s.'
                            });
                        }
                    } catch (_) {
                        newViolations.push({ code: 'recharts_missing', severity: 'high', message: 'Recharts non charg√© ‚Äî graphiques d√©sactiv√©s.' });
                    }

                    try {
                        if (typeof lucideReact === 'undefined') {
                            newViolations.push({
                                code: 'lucide_missing',
                                severity: 'medium',
                                message: 'Biblioth√®que des ic√¥nes (lucide-react UMD) indisponible.'
                            });
                        }
                    } catch (_) {
                        newViolations.push({ code: 'lucide_missing', severity: 'medium', message: 'Biblioth√®que des ic√¥nes (lucide-react UMD) indisponible.' });
                    }

                    setViolations(newViolations);
                    if (newViolations.length > 0) {
                        setShowHelp(true);
                    }
                }, []);

                const stocks = [
                    { symbol: 'AAPL', name: 'Apple Inc.' },
                    { symbol: 'TSLA', name: 'Tesla Inc.' },
                    { symbol: 'GOOGL', name: 'Alphabet Inc.' },
                    { symbol: 'MSFT', name: 'Microsoft Corp.' },
                    { symbol: 'NVDA', name: 'NVIDIA Corp.' },
                    { symbol: 'AMZN', name: 'Amazon.com Inc.' },
                ];

                const currentStock = stocks.find(s => s.symbol === selectedStock);
                const quote = stockDataIntelli?.quote || {};
                const metrics = stockDataIntelli?.metrics || {};
                const ratios = stockDataIntelli?.ratios || {};
                const profile = stockDataIntelli?.profile || {};
                const intraday = stockDataIntelli?.intraday || [];
                const news = stockDataIntelli?.news || [];
                const sentiment = stockDataIntelli?.sentiment || {};
                const insights = stockDataIntelli?.insights || {};

                const formatNumber = (num, prefix = '', suffix = '') => {
                    if (!num && num !== 0) return 'N/A';
                    const n = parseFloat(num);
                    if (isNaN(n)) return 'N/A';
                    if (n >= 1e12) return `${prefix}${(n / 1e12).toFixed(2)}T${suffix}`;
                    if (n >= 1e9) return `${prefix}${(n / 1e9).toFixed(2)}B${suffix}`;
                    if (n >= 1e6) return `${prefix}${(n / 1e6).toFixed(2)}M${suffix}`;
                    if (n >= 1e3) return `${prefix}${(n / 1e3).toFixed(2)}K${suffix}`;
                    return `${prefix}${n.toFixed(2)}${suffix}`;
                };

                const formatTimeAgo = (dateString) => {
                    const date = new Date(dateString);
                    const hours = Math.floor((Date.now() - date.getTime()) / 3600000);
                    if (hours < 1) return 'maintenant';
                    if (hours < 24) return `${hours}h`;
                    return `${Math.floor(hours / 24)}j`;
                };

                const technicalIndicators = {
                    RSI: { value: 67.8, signal: 'Achat' },
                    MACD: { value: 2.34, signal: 'Bullish' },
                    SMA_50: { value: (quote.price || 0) * 0.98, signal: 'Au-dessus' },
                    SMA_200: { value: (quote.price || 0) * 0.94, signal: 'Au-dessus' },
                };

                const orderFlow = { buyVolume: 68.4, sellVolume: 31.6 };

                const peerComparison = [
                    { name: 'AAPL', pe: metrics.peRatioTTM || 29.8, growth: 12.5, margin: (ratios.netProfitMarginTTM || 0.25) * 100 },
                    { name: 'MSFT', pe: 35.2, growth: 15.8, margin: 32.1 },
                    { name: 'GOOGL', pe: 24.6, growth: 18.2, margin: 28.7 },
                    { name: 'AMZN', pe: 52.3, growth: 22.1, margin: 8.9 },
                ];

                if (loadingIntelli) {
                    return (
                        <div className={`min-h-screen p-2 flex items-center justify-center transition-colors duration-300 ${
                            isDarkMode ? 'bg-neutral-950 text-gray-100' : 'bg-gray-50 text-gray-900'
                        }`}>
                            <div className="text-center">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-500 mx-auto mb-4"></div>
                                <div className="text-sm text-gray-400">Chargement des donn√©es‚Ä¶</div>
                            </div>
                        </div>
                    );
                }

                // Acc√®s aux ic√¥nes Lucide
                const LucideIcon = ({ name, className = "w-4 h-4" }) => {
                    if (typeof lucideReact === 'undefined') return null;
                    const Icon = lucideReact[name];
                    if (!Icon) return null;
                    return React.createElement(Icon, { className });
                };

                return (
                    <div className={`min-h-screen p-2 transition-colors duration-300 ${
                        isDarkMode ? 'bg-neutral-950 text-gray-100' : 'bg-gray-50 text-gray-900'
                    }`}>
                        {/* Header */}
                        <div className="mb-2">
                            <div className="flex items-center justify-between mb-2">
                                <div className="flex items-center gap-2">
                                    <div className={`p-1.5 border rounded-lg transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <LucideIcon name="Activity" className="w-4 h-4 text-gray-400" />
                                    </div>
                                    <div>
                                        <h1 className={`text-base font-bold flex items-center gap-2 transition-colors duration-300 ${
                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                        }`}>
                                            Expert Trading Analytics
                                            {connected ? (
                                                <LucideIcon name="Wifi" className="w-3 h-3 text-green-500" />
                                            ) : (
                                                <LucideIcon name="WifiOff" className="w-3 h-3 text-red-500" />
                                            )}
                                        </h1>
                                        <p className="text-[8px] text-gray-600">
                                            Mode D√©mo Hybride ‚Ä¢ FMP + Perplexity AI
                                        </p>
                                    </div>
                                </div>

                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={() => {
                                            const fetchData = async () => {
                                                try {
                                                    const mockData = generateMockData(selectedStock);
                                                    setStockDataIntelli(mockData);
                                                    setConnected(true);
                                                    setLastUpdateIntelli(new Date());
                                                } catch (error) {
                                                    console.error('Error:', error);
                                                }
                                            };
                                            fetchData();
                                        }}
                                        className={`p-1.5 border rounded-md transition-all ${
                                            isDarkMode 
                                                ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                : 'bg-white hover:bg-gray-100 border-gray-300'
                                        }`}
                                    >
                                        <LucideIcon name="RefreshCw" className="w-3 h-3 text-gray-400" />
                                    </button>

                                    <div className="relative">
                                        <button
                                            onClick={() => setMenuOpen(!menuOpen)}
                                            className={`flex items-center gap-2 px-3 py-1.5 border rounded-lg transition-all ${
                                                isDarkMode 
                                                    ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                    : 'bg-white hover:bg-gray-100 border-gray-300'
                                            }`}
                                        >
                                            <div>
                                                <div className={`text-xs font-bold transition-colors duration-300 ${
                                                    isDarkMode ? 'text-white' : 'text-gray-900'
                                                }`}>{selectedStock}</div>
                                                <div className="text-[8px] text-gray-600">{profile.companyName || currentStock?.name}</div>
                                            </div>
                                            <LucideIcon name="ChevronDown" className={`w-3 h-3 text-gray-400 transition-transform ${menuOpen ? 'rotate-180' : ''}`} />
                                        </button>

                                        {menuOpen && (
                                            <div className={`absolute top-full mt-1 right-0 w-48 border rounded-lg shadow-2xl overflow-hidden z-50 transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                            }`}>
                                                {stocks.map((stock) => (
                                                    <button
                                                        key={stock.symbol}
                                                        onClick={() => {
                                                            setSelectedStock(stock.symbol);
                                                            setMenuOpen(false);
                                                        }}
                                                        className={`w-full p-2 flex items-center justify-between transition-all text-xs ${
                                                            selectedStock === stock.symbol 
                                                                ? (isDarkMode ? 'bg-neutral-800' : 'bg-gray-100')
                                                                : (isDarkMode ? 'hover:bg-neutral-800' : 'hover:bg-gray-50')
                                                        }`}
                                                    >
                                                        <div className="text-left">
                                                            <div className={`font-bold transition-colors duration-300 ${
                                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                                            }`}>{stock.symbol}</div>
                                                            <div className="text-[8px] text-gray-600">{stock.name}</div>
                                                        </div>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div className="text-right">
                                        <div className="text-xs font-mono font-bold text-gray-300">
                                            {time.toLocaleTimeString('fr-FR')}
                                        </div>
                                        <div className="text-[8px] text-gray-600">
                                            {time.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                        </div>
                                    </div>

                                <div className="flex gap-1">
                                        <button className={`p-1.5 border rounded-md transition-all ${
                                            isDarkMode 
                                                ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                : 'bg-white hover:bg-gray-100 border-gray-300'
                                        }`}>
                                            <LucideIcon name="Bell" className="w-3 h-3 text-gray-500" />
                                        </button>
                                        <button className={`p-1.5 border rounded-md transition-all ${
                                            isDarkMode 
                                                ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                : 'bg-white hover:bg-gray-100 border-gray-300'
                                        }`}>
                                            <LucideIcon name="Search" className="w-3 h-3 text-gray-500" />
                                        </button>
                                        <button className={`p-1.5 border rounded-md transition-all ${
                                            isDarkMode 
                                                ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                : 'bg-white hover:bg-gray-100 border-gray-300'
                                        }`}>
                                            <LucideIcon name="Settings" className="w-3 h-3 text-gray-500" />
                                        </button>
                                    {/* HelpPop / Violations */}
                                    <div className="relative">
                                        <button
                                            onClick={() => setShowHelp(!showHelp)}
                                            className={`p-1.5 border rounded-md transition-all ${
                                                isDarkMode 
                                                    ? 'bg-neutral-900 hover:bg-neutral-800 border-neutral-800' 
                                                    : 'bg-white hover:bg-gray-100 border-gray-300'
                                            }`}
                                            title={violations.length ? 'Diagnostics: probl√®mes d√©tect√©s' : 'Aide IntelliStocks'}
                                        >
                                            <div className="relative">
                                                <LucideIcon name={violations.length ? 'AlertTriangle' : 'HelpCircle'} className={`w-3 h-3 ${violations.length ? 'text-yellow-500' : 'text-gray-500'}`} />
                                                {violations.length > 0 && (
                                                    <span className="absolute -top-0.5 -right-0.5 w-2 h-2 bg-red-500 rounded-full"></span>
                                                )}
                                            </div>
                                        </button>

                                        {showHelp && (
                                            <div className={`absolute right-0 mt-2 w-80 border rounded-xl shadow-2xl z-50 ${
                                                isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                            }`}>
                                                <div className={`p-3 border-b flex items-center justify-between gap-2 ${isDarkMode ? 'border-neutral-800' : 'border-gray-200'}`}>
                                                    <div className="flex items-center gap-2">
                                                        <LucideIcon name="LifeBuoy" className="w-4 h-4 text-blue-500" />
                                                        <div>
                                                            <div className={`text-xs font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Aide & diagnostics IntelliStocks</div>
                                                            <div className="text-[10px] text-gray-500">Mode D√©mo Hybride ‚Ä¢ FMP + Perplexity</div>
                                                        </div>
                                                    </div>
                                                    <button onClick={() => setShowHelp(false)} className={`p-1 rounded ${isDarkMode ? 'hover:bg-neutral-800' : 'hover:bg-gray-100'}`}>
                                                        <LucideIcon name="X" className="w-3 h-3 text-gray-500" />
                                                    </button>
                                                </div>
                                                <div className="p-3 space-y-2 text-[11px]">
                                                    {violations.length > 0 ? (
                                                        <div>
                                                            <div className={`mb-1 font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Probl√®mes d√©tect√©s</div>
                                                            <ul className="space-y-1">
                                                                {violations.map((v, i) => (
                                                                    <li key={i} className={`p-2 rounded border ${
                                                                        v.severity === 'high' ? (isDarkMode ? 'bg-red-900/30 border-red-800 text-red-200' : 'bg-red-50 border-red-200 text-red-800') :
                                                                        v.severity === 'medium' ? (isDarkMode ? 'bg-yellow-900/30 border-yellow-800 text-yellow-200' : 'bg-yellow-50 border-yellow-200 text-yellow-800') :
                                                                        (isDarkMode ? 'bg-gray-900/30 border-gray-800 text-gray-200' : 'bg-gray-50 border-gray-200 text-gray-800')
                                                                    }`}>
                                                                        {v.message}
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    ) : (
                                                        <div className={`p-2 rounded border ${isDarkMode ? 'bg-emerald-900/20 border-emerald-800 text-emerald-200' : 'bg-emerald-50 border-emerald-200 text-emerald-800'}`}>
                                                            Aucun probl√®me d√©tect√©.
                                                        </div>
                                                    )}

                                                    <div className={`pt-1 border-t ${isDarkMode ? 'border-neutral-800' : 'border-gray-200'}`} />
                                                    <div className="space-y-1">
                                                        <div className={`font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Conseils rapides</div>
                                                        <ul className="list-disc pl-4 space-y-1 text-gray-500">
                                                            <li>Si Recharts est manquant, v√©rifiez le script UMD charg√© en haut de la page.</li>
                                                            <li>Les graphiques sont d√©sactiv√©s en mode d√©mo; les donn√©es sont simul√©es.</li>
                                                            <li>Actualisez avec le bouton rafra√Æchir pour recharger les donn√©es mock.</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Grid Layout */}
                        <div className="grid grid-cols-12 gap-2">
                            
                            {/* Colonne gauche */}
                            <div className="col-span-8 space-y-2">
                                
                                {/* Graphique principal */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <div className="flex items-center justify-between mb-2">
                                        <div>
                                            <h2 className={`text-sm font-bold mb-0.5 transition-colors duration-300 ${
                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                            }`}>{selectedStock}</h2>
                                            <p className="text-[8px] text-gray-600">{profile.companyName || currentStock?.name} ‚Ä¢ {profile.sector || 'NASDAQ'}</p>
                                        </div>
                                        <div className="text-right">
                                            <div className={`text-lg font-bold transition-colors duration-300 ${
                                                isDarkMode ? 'text-white' : 'text-gray-900'
                                            }`}>${parseFloat(quote.price || 0).toFixed(2)}</div>
                                            <div className={`flex items-center gap-1 justify-end text-xs ${parseFloat(quote.changesPercentage || 0) >= 0 ? 'text-emerald-500' : 'text-red-500'}`}>
                                                {parseFloat(quote.changesPercentage || 0) >= 0 ? (
                                                    <LucideIcon name="ArrowUpRight" className="w-3 h-3" />
                                                ) : (
                                                    <LucideIcon name="ArrowDownRight" className="w-3 h-3" />
                                                )}
                                                <span className="font-semibold">
                                                    {parseFloat(quote.changesPercentage || 0) >= 0 ? '+' : ''}{parseFloat(quote.changesPercentage || 0).toFixed(2)}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div style={{ width: '100%', height: 140 }}>
                                        <div className="text-center text-gray-500 text-xs py-8">
                                            üìà Graphique interactif (Recharts n√©cessite une configuration avanc√©e)
                                        </div>
                                    </div>

                                    <div className="flex gap-1 mt-1.5">
                                    {['1D', '1W', '1M', '3M', '6M', '1A'].map((period) => (
                                            <button
                                                key={period}
                                                onClick={() => setTimeframe(period)}
                                                className={`px-2 py-0.5 rounded text-[9px] font-semibold transition-all ${
                                                    timeframe === period 
                                                        ? (isDarkMode 
                                                            ? 'bg-neutral-700 text-white border border-neutral-600' 
                                                            : 'bg-gray-300 text-gray-900 border border-gray-400')
                                                        : (isDarkMode 
                                                            ? 'bg-neutral-800 hover:bg-neutral-700 border border-neutral-800 text-gray-500' 
                                                            : 'bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-600')
                                                }`}
                                            >
                                                {period}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Volume */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <h3 className="text-[10px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                        <LucideIcon name="BarChart3" className="w-3 h-3 text-gray-500" />
                                        Volume & Flux d'Ordres
                                    </h3>
                                    <div className="grid grid-cols-2 gap-2">
                                        <div style={{ width: '100%', height: 80 }}>
                                            <div className="text-center text-gray-500 text-xs py-4">
                                                üìä Graphique Volume
                                            </div>
                                        </div>

                                        <div className="space-y-1.5">
                                            <div className={`flex items-center justify-between p-1.5 border rounded text-[9px] transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <span className="text-gray-500">Acheteurs</span>
                                                <div className="flex items-center gap-1">
                                                    <div className={`w-16 h-1.5 rounded-full overflow-hidden ${
                                                        isDarkMode ? 'bg-neutral-700' : 'bg-gray-200'
                                                    }`}>
                                                        <div className="h-full bg-emerald-500" style={{ width: `${orderFlow.buyVolume}%` }}></div>
                                                    </div>
                                                    <span className="text-emerald-500 font-bold">{orderFlow.buyVolume}%</span>
                                                </div>
                                            </div>
                                            <div className={`flex items-center justify-between p-1.5 border rounded text-[9px] transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <span className="text-gray-500">Vendeurs</span>
                                                <div className="flex items-center gap-1">
                                                    <div className={`w-16 h-1.5 rounded-full overflow-hidden ${
                                                        isDarkMode ? 'bg-neutral-700' : 'bg-gray-200'
                                                    }`}>
                                                        <div className="h-full bg-red-500" style={{ width: `${orderFlow.sellVolume}%` }}></div>
                                                    </div>
                                                    <span className="text-red-500 font-bold">{orderFlow.sellVolume}%</span>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-1">
                                                <div className={`p-1.5 border rounded text-center transition-colors duration-300 ${
                                                    isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                                }`}>
                                                    <div className="text-[8px] text-gray-600">Volume</div>
                                                    <div className={`text-xs font-bold transition-colors duration-300 ${
                                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                                    }`}>{formatNumber(quote.volume)}</div>
                                                </div>
                                                <div className={`p-1.5 border rounded text-center transition-colors duration-300 ${
                                                    isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                                }`}>
                                                    <div className="text-[8px] text-gray-600">Cap</div>
                                                    <div className={`text-xs font-bold transition-colors duration-300 ${
                                                        isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                                    }`}>{formatNumber(quote.marketCap)}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Indicateurs */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <h3 className="text-[10px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                        <LucideIcon name="Activity" className="w-3 h-3 text-gray-500" />
                                        Indicateurs Techniques
                                    </h3>
                                    <div className="grid grid-cols-2 gap-1.5">
                                        {Object.entries(technicalIndicators).map(([key, value]) => (
                                            <div key={key} className={`flex items-center justify-between p-1.5 border rounded transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <div>
                                                    <div className="font-semibold text-[9px] text-gray-400">{key.replace('_', ' ')}</div>
                                                    <div className="text-[8px] text-emerald-500">{value.signal}</div>
                                                </div>
                                                <div className={`text-sm font-bold transition-colors duration-300 ${
                                                    isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                }`}>
                                                    {typeof value.value === 'number' ? value.value.toFixed(2) : value.value}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Fondamentaux */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <h3 className="text-[10px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                        <LucideIcon name="DollarSign" className="w-3 h-3 text-gray-500" />
                                        Analyse Fondamentale
                                    </h3>
                                    <div className="grid grid-cols-3 gap-1.5">
                                        {[
                                            { label: 'P/E', value: metrics.peRatioTTM, suffix: 'x' },
                                            { label: 'PEG', value: metrics.pegRatioTTM, suffix: '' },
                                            { label: 'P/S', value: metrics.priceToSalesRatioTTM, suffix: 'x' },
                                            { label: 'ROE', value: ratios.returnOnEquityTTM ? `${(ratios.returnOnEquityTTM * 100).toFixed(1)}%` : 'N/A', suffix: '' },
                                            { label: 'ROA', value: ratios.returnOnAssetsTTM ? `${(ratios.returnOnAssetsTTM * 100).toFixed(1)}%` : 'N/A', suffix: '' },
                                            { label: 'D/E', value: ratios.debtEquityRatio, suffix: 'x' },
                                            { label: 'Marge', value: ratios.netProfitMarginTTM ? `${(ratios.netProfitMarginTTM * 100).toFixed(1)}%` : 'N/A', suffix: '' },
                                            { label: 'Beta', value: profile.beta, suffix: '' },
                                            { label: 'Div', value: metrics.dividendYieldTTM ? `${(metrics.dividendYieldTTM * 100).toFixed(2)}%` : 'N/A', suffix: '' },
                                        ].map((metric) => (
                                            <div key={metric.label} className={`p-1.5 border rounded text-center transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <div className="text-[8px] text-gray-600 mb-0.5">{metric.label}</div>
                                                <div className={`text-xs font-bold transition-colors duration-300 ${
                                                    isDarkMode ? 'text-gray-200' : 'text-gray-700'
                                                }`}>
                                                    {metric.value != null ? 
                                                        (typeof metric.value === 'number' ? metric.value.toFixed(2) + (metric.suffix || '') : metric.value) 
                                                        : 'N/A'}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Insights */}
                                {insights.catalysts && (
                                    <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <h3 className="text-[10px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                            <LucideIcon name="Brain" className="w-3 h-3 text-gray-500" />
                                            Insights IA (Perplexity)
                                        </h3>
                                        <div className="space-y-2">
                                            <div>
                                                <div className="text-[9px] text-gray-500 mb-1 font-semibold">üöÄ Catalyseurs</div>
                                                {insights.catalysts.map((cat, i) => (
                                                    <div key={i} className="text-[8px] text-emerald-400 mb-0.5">‚Ä¢ {cat}</div>
                                                ))}
                                            </div>
                                            <div>
                                                <div className="text-[9px] text-gray-500 mb-1 font-semibold">‚ö†Ô∏è Risques</div>
                                                {insights.risks.map((risk, i) => (
                                                    <div key={i} className="text-[8px] text-orange-400 mb-0.5">‚Ä¢ {risk}</div>
                                                ))}
                                            </div>
                                            <div className={`p-1.5 border rounded transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <div className="text-[9px] text-gray-500 mb-0.5">Consensus : 
                                                    <span className={`ml-1 font-bold ${
                                                        insights.consensus === 'bullish' ? 'text-emerald-500' :
                                                        insights.consensus === 'bearish' ? 'text-red-500' : 'text-gray-400'
                                                    }`}>
                                                        {insights.consensus === 'bullish' ? 'üìà Bullish' : 
                                                         insights.consensus === 'bearish' ? 'üìâ Bearish' : '‚ûñ Neutre'}
                                                    </span>
                                                </div>
                                                <div className="text-[8px] text-gray-400">{insights.reasoning}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Comparaison */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <h3 className="text-[10px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                        <LucideIcon name="TrendingUp" className="w-3 h-3 text-gray-500" />
                                        Comparaison Pairs
                                    </h3>
                                    <div style={{ width: '100%', height: 120 }}>
                                        <div className="text-center text-gray-500 text-xs py-8">
                                            üìä Graphique Radar (Recharts n√©cessite une configuration avanc√©e)
                                        </div>
                                    </div>
                                </div>

                            </div>

                            {/* Colonne droite */}
                            <div className="col-span-4 space-y-2">
                                
                                {/* Stats */}
                                <div className="space-y-1.5">
                                    <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <div className="text-[8px] text-gray-600 mb-0.5">Capitalisation</div>
                                        <div className={`text-base font-bold transition-colors duration-300 ${
                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                        }`}>{formatNumber(quote.marketCap)}</div>
                                        <div className="text-[8px] text-gray-500">P/E: {metrics.peRatioTTM?.toFixed(1) || 'N/A'}</div>
                                    </div>

                                    <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <div className="text-[8px] text-gray-600 mb-0.5">Sentiment IA</div>
                                        <div className="flex items-center gap-1.5">
                                            <div className="text-base font-bold text-emerald-500">{sentiment.overall || 0}%</div>
                                            <div className={`flex-1 h-1.5 rounded-full overflow-hidden ${
                                                isDarkMode ? 'bg-neutral-700' : 'bg-gray-200'
                                            }`}>
                                                <div className="h-full bg-emerald-500" style={{ width: `${sentiment.overall || 0}%` }}></div>
                                            </div>
                                        </div>
                                        <div className="text-[8px] text-emerald-500 mt-0.5">
                                            {(sentiment.overall || 0) > 70 ? 'Tr√®s Bullish' : (sentiment.overall || 0) > 50 ? 'Bullish' : 'Neutre'}
                                        </div>
                                    </div>

                                    <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <div className="text-[8px] text-gray-600 mb-0.5">Prix Actuel</div>
                                        <div className={`text-base font-bold transition-colors duration-300 ${
                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                        }`}>${parseFloat(quote.price || 0).toFixed(2)}</div>
                                        <div className="text-[8px] text-emerald-500 mt-0.5">Volume: {formatNumber(quote.volume)}</div>
                                    </div>
                                </div>

                                {/* Sentiment d√©taill√© */}
                                {sentiment.overall && (
                                    <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                        isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                    }`}>
                                        <h3 className="text-[9px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                            <LucideIcon name="Brain" className="w-3 h-3 text-gray-500" />
                                            Sentiment IA
                                        </h3>
                                        <div style={{ width: '100%', height: 90 }}>
                                            <div className="text-center text-gray-500 text-xs py-6">
                                                üìä Graphique Sentiment
                                            </div>
                                        </div>
                                        {sentiment.summary && (
                                            <div className={`mt-1.5 p-1.5 border rounded transition-colors duration-300 ${
                                                isDarkMode ? 'bg-neutral-800 border-neutral-700' : 'bg-gray-50 border-gray-200'
                                            }`}>
                                                <div className="text-[8px] text-gray-400">{sentiment.summary}</div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* News */}
                                <div className={`border rounded-lg p-2 transition-colors duration-300 ${
                                    isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                                }`}>
                                    <h3 className="text-[9px] font-bold mb-1.5 flex items-center gap-1 text-gray-400">
                                        <LucideIcon name="Newspaper" className="w-3 h-3 text-gray-500" />
                                        News Temps R√©el
                                    </h3>
                                    <div className="space-y-1 max-h-40 overflow-y-auto">
                                        {news.map((item, i) => (
                                            <div key={i} className={`p-1.5 border rounded transition-all cursor-pointer ${
                                                isDarkMode 
                                                    ? 'bg-neutral-800 border-neutral-700 hover:bg-neutral-750' 
                                                    : 'bg-gray-50 border-gray-200 hover:bg-gray-100'
                                            }`}>
                                                <div className="flex items-start justify-between mb-0.5">
                                                    <div className="text-[7px] px-1 py-0.5 rounded bg-emerald-900 text-emerald-500">üìà</div>
                                                    <span className="text-[7px] text-gray-600">{formatTimeAgo(item.publishedDate)}</span>
                                                </div>
                                                <div className={`font-semibold text-[8px] mb-0.5 transition-colors duration-300 ${
                                                    isDarkMode ? 'text-gray-300' : 'text-gray-700'
                                                }`}>{item.title}</div>
                                                <div className="text-[7px] text-gray-500">{item.site}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                            </div>
                        </div>

                        {/* Footer */}
                        <div className={`mt-2 p-1.5 border rounded-lg transition-colors duration-300 ${
                            isDarkMode ? 'bg-neutral-900 border-neutral-800' : 'bg-white border-gray-300'
                        }`}>
                            <div className="flex items-center gap-2">
                                <LucideIcon name="AlertCircle" className="w-3 h-3 text-gray-500" />
                                <div className="flex-1">
                                    <div className="font-semibold text-[9px] text-gray-400">
                                        ‚úÖ Dashboard Hybride Fonctionnel
                                    </div>
                                    <div className="text-[7px] text-gray-600">
                                        Mode D√©mo ‚Ä¢ FMP (donn√©es pr√©cises) + Perplexity (intelligence IA)
                                    </div>
                                </div>
                                <div className="text-right">
                                    <div className="text-[8px] text-gray-500 font-bold">Hybride Optimal</div>
                                    <div className="text-[7px] text-gray-600">Pr√©cision + IA</div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };


            const tabs = [
                { id: 'stocks-news', label: 'üìä Titres & nouvelles', component: StocksNewsTab },
                { id: 'intellistocks', label: 'üöÄ IntelliStocks', component: IntelliStocksTab },
                { id: 'ask-emma', label: 'ü§ñ Emma IA', component: AskEmmaTab },
                { id: 'admin-jsla', label: '‚öôÔ∏è Admin-JSLAI', component: AdminJSLaiTab },
                { id: 'dans-watchlist', label: "üëÄ Dan's Watchlist", component: DansWatchlistTab },
                { id: 'scrapping-sa', label: 'üìà Seeking Alpha', component: ScrappingSATab }
            ];
            return (
                <div className={`min-h-screen transition-colors duration-300 ${
                    isDarkMode 
                        ? 'bg-black' 
                        : 'bg-white'
                }`}>
                    {/* Intro Emma IA - premi√®re visite de session */}
                    {showEmmaIntro && activeTab === 'ask-emma' && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 emma-intro-overlay">
                            <div className="text-center">
                                <div className="mb-6">
                                    <img 
                                        src={'EMMA-JSLAI-GOB-dark.jpg'}
                                        alt="Emma IA"
                                        className="emma-intro-image w-72 h-72 md:w-96 md:h-96 rounded-full object-cover shadow-2xl border-4 border-emerald-500"
                                    />
                                </div>
                                <h2 className="text-white text-3xl md:text-4xl font-bold mb-2">Emma IA</h2>
                                <p className="text-emerald-300 text-lg">Analyste financi√®re virtuelle ‚Ä¢ JSL AI</p>
                            </div>
                        </div>
                    )}
                    {/* Header */}
                    <header className={`p-6 border-b transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-black border-gray-700' 
                            : 'bg-white border-gray-300'
                    }`}>
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <div className={`backdrop-blur-md rounded-2xl p-3 shadow-xl border transition-colors duration-300 ${
                                        isDarkMode 
                                            ? 'bg-white/10 border-white/20' 
                                            : 'bg-gray-800/10 border-gray-800/20'
                                    }`}>
                                        <img 
                                            src={isDarkMode ? "/logojslaidark.jpg" : "/logojslailight.jpg"} 
                                            alt="JSL AI Logo" 
                                            className="w-8 h-8 object-contain"
                                        />
                                    </div>
                                    <div>
                                        <h1 className={`text-3xl font-bold mb-2 font-['Inter'] transition-colors duration-300 ${
                                            isDarkMode ? 'text-white' : 'text-gray-900'
                                        }`}>
                                            GOB Apps - Dashboard Financier Beta
                                        </h1>
                                        <p className={`font-['Inter'] transition-colors duration-300 ${
                                            isDarkMode ? 'text-gray-300' : 'text-gray-600'
                                        }`}>
                                            Plateforme financi√®re ‚Ä¢ Propuls√©e par JSL AI
                                        </p>
                                    </div>
                                </div>
                                
                                {/* Bouton de basculement de th√®me */}
                                <button
                                    onClick={toggleTheme}
                                    className={`p-3 rounded-xl transition-all duration-300 hover:scale-105 ${
                                        isDarkMode 
                                            ? 'bg-gray-700 hover:bg-gray-600 text-yellow-400' 
                                            : 'bg-gray-200 hover:bg-gray-300 text-gray-800'
                                    }`}
                                    title={isDarkMode ? 'Passer en mode clair' : 'Passer en mode sombre'}
                                >
                                    {isDarkMode ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation par onglets */}
                    <nav className={`backdrop-blur-sm border-b transition-colors duration-300 ${
                        isDarkMode 
                            ? 'bg-black border-gray-700' 
                            : 'bg-white border-gray-300'
                    }`}>
                        <div className="max-w-7xl mx-auto px-6">
                            <div className="hidden md:flex space-x-1">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onMouseDown={withRipple}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`tab-button btn-ripple px-6 py-3 rounded-t-lg font-medium transition-all ${
                                            activeTab === tab.id 
                                                ? (isDarkMode 
                                                    ? 'bg-gray-900 text-white border-b-2 border-green-500' 
                                                    : 'bg-gray-100 text-gray-900 border-b-2 border-green-600')
                                                : (isDarkMode 
                                                    ? 'text-gray-300 hover:text-white hover:bg-gray-900' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100')
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                            <div className="md:hidden p-3">
                                <select
                                    value={activeTab}
                                    onChange={(e) => setActiveTab(e.target.value)}
                                    className={`w-full rounded p-2 ${isDarkMode ? 'bg-gray-900 text-white border border-gray-700' : 'bg-white text-gray-900 border border-gray-300'}`}
                                >
                                    {tabs.map(tab => (
                                        <option key={tab.id} value={tab.id}>{tab.label}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </nav>
                    {/* Audio UI feedback (d√©sactiv√© par d√©faut jusqu'au premier geste utilisateur) */}
                    <audio ref={tabSoundRef} preload="auto" className="hidden">
                        <source src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3" type="audio/mpeg" />
                    </audio>
                    <audio ref={clickSoundRef} preload="auto" className="hidden">
                        <source src="https://assets.mixkit.co/active_storage/sfx/2574/2574-preview.mp3" type="audio/mpeg" />
                    </audio>

                    {/* Contenu principal */}
                    <main className="max-w-7xl mx-auto p-6">
                        {activeTab === 'stocks-news' && <StocksNewsTab />}
                        {activeTab === 'intellistocks' && <IntelliStocksTab />}
                        {activeTab === 'ask-emma' && <AskEmmaTab />}
                        {activeTab === 'admin-jsla' && <AdminJSLaiTab />}
                        {activeTab === 'dans-watchlist' && <DansWatchlistTab />}
                        {activeTab === 'scrapping-sa' && <ScrappingSATab />}
                        {activeTab === 'seeking-alpha' && <SeekingAlphaTab />}
                    </main>

                    {/* Messages */}
                    {message && (
                        <div className={`fixed top-4 right-4 p-4 rounded-lg z-50 ${
                            message.type === 'error' ? 'bg-red-500' : 
                            message.type === 'success' ? 'bg-green-500' : 'bg-blue-500'
                        } text-white`}>
                            {message.text}
                        </div>
                    )}

                </div>
            );
        };

        ReactDOM.render(<BetaCombinedDashboard />, document.getElementById('root'));
    </script>
    
    <!-- Scripts Emma -->
    <script type="module">
        // Import des modules Emma
        import { emmaDashboard } from './emma-dashboard-integration.js';
        
        // Initialiser Emma apr√®s le rendu du dashboard
        setTimeout(() => {
            emmaDashboard.initialize();
        }, 1000);
    </script>
</body>
</html>