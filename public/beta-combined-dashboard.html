<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GOB Apps - Dashboard Financier Beta ‚Ä¢ Propuls√© par JSLAI</title>
    <!-- Version: 2.1.0 - JLab V2 with Synchronized Widgets - 2025-10-25 -->
    <!-- Favicon JLab -->
    <link rel="icon" type="image/png" href="/jlab.png">
    <link rel="apple-touch-icon" href="/jlab.png">
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1e293b" />
    <!-- Variable d'environnement VITE_GROUP_CHAT_URL pour ChatGPTGroupTab -->
    <meta name="vite-group-chat-url" content="" id="vite-group-chat-url-meta" />
    <!-- Cache bust: 2025-10-15 21:00 -->
    <!-- BUG #7 FIX: Pr√©charger logo JSLAI pour chargement imm√©diat -->
    <link rel="preload" href="/logojslaidark.jpg" as="image" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&family=Montserrat:wght@400;500;600;700;800;900&family=Georgia:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Avenir Pro 85 Heavy alternative: Montserrat Heavy (900) ou Avenir Next si disponible -->
    <!-- Note: Variables CSS th√®mes, animations, fonts, React Grid Layout et Emma components -->
    <!-- ont √©t√© extraits vers des fichiers CSS s√©par√©s et import√©s via gob-design-system.css -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Note: Babel Standalone utilis√© intentionnellement pour ce fichier standalone -->
    <!-- PRODUCTION NOTE: Babel Standalone is intentionally used for this standalone file -->
    <!-- The console warning "You are using the in-browser Babel transformer" is expected and can be ignored -->
    <!-- For production optimization, consider precompiling with: npm run build:babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>

    <!-- Fix for "exports is not defined" error when Babel transpiles modules -->
    <script>
        // Polyfill for CommonJS to prevent Babel and UMD errors
        // MUST run before React Grid Layout and any Babel transpilation
        (function() {
            // =================================================================
            // üõ°Ô∏è CRASH PREVENTION SHIELD v2
            // Fixes "TypeError: t.animate is not a function" (specifically on Window)
            // =================================================================
            const createMockAnimation = () => ({
                finished: Promise.resolve(),
                ready: Promise.resolve(),
                onfinish: null,
                cancel: () => {},
                play: () => {},
                pause: () => {},
                reverse: () => {},
                addEventListener: () => {},
                removeEventListener: () => {},
                currentTime: 0,
                startTime: 0,
                playbackRate: 1,
                playState: 'finished',
                id: 'mock-animation',
                pending: false,
                replaceState: 'active',
                effect: null,
                timeline: null,
                onremove: null,
                oncancel: null,
                commitStyles: () => {},
                persist: () => {},
                updatePlaybackRate: () => {}
            });

            // 1. Critical: Polyfill window.animate (The culprit identified in logs)
            if (typeof window !== 'undefined' && !window.animate) {
                window.animate = function(keyframes, options) {
                    console.warn('üõ°Ô∏è PREVENTED CRASH: window.animate called!', keyframes);
                    console.trace('üõ°Ô∏è Stack Trace for window.animate call:');
                    return createMockAnimation();
                };
            }

            // 2. Element.animate polyfill
            if (typeof Element !== 'undefined' && !Element.prototype.animate) {
                 Element.prototype.animate = function(keyframes, options) {
                    // console.log('Element.animate polyfill', this);
                    return createMockAnimation();
                };
            }

            // 3. Explicit Prototypes (Catch-all)
            [HTMLElement, SVGElement, Element].forEach(proto => {
                if (typeof proto !== 'undefined' && !proto.prototype.animate) {
                    proto.prototype.animate = function(keyframes, options) {
                        return createMockAnimation();
                    };
                }
            });

            // 4. Fallback ultime pour TOUS les objets (agressif mais n√©cessaire pour ce crash)
            // Utilise defineProperty pour √©viter d'√©num√©rer la propri√©t√© et causer des effets de bord
            if (!Object.prototype.animate) {
                Object.defineProperty(Object.prototype, 'animate', {
                    value: function(keyframes, options) {
                        console.warn('üõ°Ô∏è PREVENTED CRASH: Object.prototype.animate called on:', this);
                        return createMockAnimation();
                    },
                    writable: true,
                    configurable: true,
                    enumerable: false
                });
            }
            // =================================================================

            // GLOBAL FALLBACKS & COMPONENTS to prevent ReferenceErrors in components
            

            window.ENVIRONMENT = "production";
            window.NODE_ENV = "production";
            
            // Supabase Configuration (required for auth, roles, realtime)
            window.SUPABASE_URL = "https://boyuxgdplbpkknplxbxp.supabase.co";
            window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJveXV4Z2RwbGJwa2tucGx4YnhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMzU5MTQsImV4cCI6MjA3NTkxMTkxNH0.-M-QdpBFlDtg1CeA00VepQCNzGzvU-tISyVA0yCLBdw";
            window.ENV_CONFIG = {
                SUPABASE_URL: window.SUPABASE_URL,
                SUPABASE_ANON_KEY: window.SUPABASE_ANON_KEY
            };
            window.showSlashSuggestions = false;
            window.setShowSlashSuggestions = function() {};
            window.Icon = function(props) {
                var emoji = props.emoji || '';
                var size = props.size || 20;
                var className = props.className || '';
                if (typeof React === 'undefined') return emoji;
                return React.createElement('span', { 
                    className: 'inline-block ' + className, 
                    style: { fontSize: size + 'px' } 
                }, emoji);
            };
            window.extractMoveReason = window.extractMoveReason || function(ticker, change) {
                return "Analyse en cours...";
            };
            

            // Initialize Lucide icons if available
            if (window.lucide && window.lucide.createIcons) {
                try {
                    window.lucide.createIcons();
                } catch(e) {}
            }
            // Early LucideIcon/IconoirIcon polyfill - MUST be before component scripts
            window.IconoirIcon = function(props) {
                var name = props.name || 'Activity';
                var className = props.className || 'w-4 h-4';
                var iconMap = {
                    'Activity': 'activity', 'Wifi': 'wifi', 'RefreshCw': 'refresh-double',
                    'ChevronDown': 'nav-arrow-down', 'Bell': 'bell', 'Search': 'search',
                    'Settings': 'settings', 'X': 'xmark', 'Plus': 'plus', 'Minus': 'minus',
                    'PieChart': 'pie-chart', 'BarChart3': 'stat-up', 'TrendingUp': 'trending-up',
                    'TrendingDown': 'trending-down', 'Calendar': 'calendar', 'Star': 'star',
                    'Layout': 'view-grid', 'Grid3x3': 'view-grid', 'Newspaper': 'newspaper',
                    'Target': 'target', 'Fire': 'sparks', 'ArrowUpRight': 'arrow-tr',
                    'Database': 'database', 'Mail': 'mail', 'Monitor': 'pc-monitor'
                };
                var iconClass = iconMap[name] || 'activity';
                if (typeof React === 'undefined') {
                    return null;
                }
                return React.createElement('i', { 
                    className: 'iconoir-' + iconClass + ' ' + className, 
                    style: { fontSize: 'inherit' } 
                });
            };
            window.LucideIcon = window.IconoirIcon;

            // Add Admin button to header after dashboard loads
            window.addEventListener('dash:ready', function() {
                setTimeout(function() {
                    var header = document.querySelector('header') || document.querySelector('.header') || document.querySelector('[class*="header"]');
                    if (header && !document.getElementById('admin-btn')) {
                        var btn = document.createElement('button');
                        btn.id = 'admin-btn';
                        btn.innerHTML = 'üß©';
                        btn.title = 'Component Manager';
                        btn.style.cssText = 'position:fixed;top:10px;right:10px;z-index:9999;width:40px;height:40px;border-radius:10px;border:none;background:linear-gradient(135deg,#10b981,#059669);color:white;font-size:20px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.3);transition:transform 0.2s;';
                        btn.onmouseover = function() { this.style.transform = 'scale(1.1)'; };
                        btn.onmouseout = function() { this.style.transform = 'scale(1)'; };
                        btn.onclick = function() { if(window.openComponentManager) window.openComponentManager(); else alert('Component Manager not loaded'); };
                        document.body.appendChild(btn);
                    }
                }, 1000);
            });



            // Safe JSON fetch utility - handles non-JSON responses gracefully
            window.fetchJsonSafe = async function(url, opts = {}) {
                try {
                    const timeoutMs = typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 15000;
                    const fetchOpts = { ...opts };
                    delete fetchOpts.timeoutMs;

                    let controller = null;
                    let timeoutId = null;
                    if (!fetchOpts.signal && typeof AbortController !== 'undefined') {
                        controller = new AbortController();
                        fetchOpts.signal = controller.signal;
                        timeoutId = setTimeout(() => controller.abort(), timeoutMs);
                    }

                    const res = await fetch(url, fetchOpts);
                    const text = await res.text();
                    if (timeoutId) clearTimeout(timeoutId);
                    
                    if (!res.ok) {
                        console.error('[API] Error', res.status, url, text.slice(0, 200));
                        return { success: false, error: 'HTTP ' + res.status, data: null, status: res.status };
                    }
                    
                    const ct = res.headers.get('content-type') || '';
                    if (!ct.includes('application/json')) {
                        console.error('[API] Not JSON', url, ct, text.slice(0, 200));
                        return { success: false, error: 'Not JSON', data: null, status: res.status };
                    }
                    
                    try {
                        return JSON.parse(text);
                    } catch(e) {
                        console.error('[API] Invalid JSON', url, text.slice(0, 200));
                        return { success: false, error: 'Invalid JSON', data: null, status: res.status };
                    }
                } catch(e) {
                    console.error('[API] Fetch failed', url, e.message);
                    return { success: false, error: e.message, data: null };
                }
            };



            if (typeof window.exports === 'undefined') {
                window.exports = {};
            }
            if (typeof window.module === 'undefined') {
                window.module = { exports: window.exports };
            }

            // Add require polyfill for UMD modules
            
            // Unhandled Rejection Handler to keep console clean
            window.addEventListener("unhandledrejection", function(event) {
                console.warn("Unhandled promise rejection:", event.reason);
                event.preventDefault(); // Stop noise
            });

            // Global Error Boundary (UI Fallback)
            if (typeof window.require === 'undefined') {
                window.require = function(moduleName) {
                    // For react-grid-layout dependencies
                    if (moduleName === 'react') return window.React;
                    if (moduleName === 'react-dom') return window.ReactDOM;
                    if (moduleName === 'react-dom/client') return window.ReactDOM;
                    if (moduleName === 'prop-types') return window.PropTypes || {};
                    // React 18+ JSX runtime - return the React object which has jsx functions
                    if (moduleName === 'react/jsx-runtime' || moduleName === 'react/jsx-dev-runtime') {
                        return {
                            jsx: React.createElement,
                            jsxs: React.createElement,
                            Fragment: React.Fragment
                        };
                    }
                    if (moduleName === "@emotion/is-prop-valid") {
                        const fn = (p) => true;
                        fn.default = fn;
                        return fn;
                    }

                    console.warn('require() called for unknown module:', moduleName);



                    return {};
                };
            }

            // Make available in global scope for Babel
            self.exports = window.exports;
            self.module = window.module;
            self.require = window.require;
        })();
    </script>

    <!-- React Grid Layout v1.4.4 - CDN (reverted from broken npm bundle) -->
    <link rel="stylesheet" href="https://unpkg.com/react-grid-layout@1.4.4/css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/react-resizable@3.0.5/css/styles.css">
    <script src="https://unpkg.com/react-grid-layout@1.4.4/dist/react-grid-layout.min.js"></script>

    <!-- Verify and expose React Grid Layout -->
    <script>
        (function() {
            const moduleExports = (typeof window.module !== 'undefined' && window.module.exports)
                ? window.module.exports
                : null;

            if (typeof window.ReactGridLayout === 'undefined' && moduleExports) {
                window.ReactGridLayout = moduleExports;
                console.log('‚úÖ ReactGridLayout recovered from module.exports');
            }

            if (typeof window.ReactGridLayout === 'undefined') {
                console.warn('‚ö†Ô∏è ReactGridLayout not available');
                return;
            }

            // Check if exports are nested under .default (ES module bundle)
            if (window.ReactGridLayout.default && !window.ReactGridLayout.Responsive) {
                console.log('üîÑ ReactGridLayout: Flattening .default exports...');
                const defaultExports = window.ReactGridLayout.default;
                // Spread all default exports onto the main object
                Object.keys(defaultExports).forEach(key => {
                    if (key !== 'default') {
                        window.ReactGridLayout[key] = defaultExports[key];
                    }
                });
            }
            console.log('‚úÖ ReactGridLayout loaded successfully:', {
                hasResponsive: !!window.ReactGridLayout.Responsive,
                hasWidthProvider: !!window.ReactGridLayout.WidthProvider
            });
        })();
    </script>

    <!-- Performance Optimizer - R√©duit le temps de chargement -->
    <!-- Performance Optimizer - R√©duit le temps de chargement -->
    <script src="/js/dashboard/logger.js"></script>
    <!-- Performance Optimizer REMOVED (was causing widget hangs) -->
    <!-- <script src="/js/dashboard/performance-optimizer.js"></script> -->
    <!-- Tab Lazy Loader - Prepares on-demand loading -->
    <script src="/js/dashboard/tab-lazy-loader.js"></script>
    <!-- Lazy Widget Wrapper (Intersection Observer) -->
    <!-- <script src="/js/dashboard/components/LazyWidgetWrapper.js"></script> -->
    <!-- Optimized TradingView widget loader -->
    <!-- <script src="/js/dashboard/widget-loader-optimized.js"></script> -->

    <script src="/js/dashboard/constants.js"></script>
    <!-- Utilitaires partag√©s expos√©s globalement -->
    <script src="/js/dashboard/utils-shared.js"></script>
    <!-- Prompts briefing externalis√©s -->
    <script src="/js/dashboard/briefing-prompts.js"></script>
    <!-- Syst√®me de th√®mes -->
    <script src="/js/dashboard/theme-system.js"></script>
    
    <!-- ‚ö° ESSENTIAL COMPONENTS (Load first - required for initial view) -->
    <!-- Auto-Expand: Ajoute boutons fullscreen √† TOUTES les sections -->
    <script src="js/dashboard/components/shared/auto-expand-init.js"></script>
    <!-- Theme Selector Component -->
    <script type="text/babel" src="js/dashboard/components/ThemeSelector.js"></script>
    <script type="text/babel" src="js/dashboard/components/SecondaryNavBar.js"></script>
    <script type="text/babel" src="/js/dashboard/components/NewsBanner.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/FinVoxTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/EmmAIATab.js"></script>
    <!-- Terminal Emma IA Tab -->
    <script type="text/babel" src="js/dashboard/components/tabs/TerminalEmmaIATab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/FastGraphsTab.js"></script>
    <!-- GroupChat Tab (JSLAI RobotWeb Ultimate v5.0) -->
    <script type="text/babel" src="js/dashboard/components/tabs/GroupChatTab.js"></script>
    <!-- ChatGPT Group Tab (ChatGPT Group Chat Integration) -->
    <!-- <script type="text/babel" src="js/dashboard/components/tabs/ChatGPTGroupTab.js"></script> -->
    <!-- AdminJSLai Tab -->
    <script type="text/babel" src="js/dashboard/components/tabs/AdminJSLaiTab.js"></script>
    <!-- PlusTab Component -->
    <script type="text/babel" src="js/dashboard/components/tabs/PlusTab.js"></script>
    <!-- JLab Tabs -->
    <script type="text/babel" src="js/dashboard/components/tabs/JLabTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/JLabUnifiedTab.js"></script>

    <!-- Components needed by Grid Layout (load these first) -->
    <script type="text/babel" src="js/dashboard/components/tabs/StocksNewsTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/TradingViewWidgets.js"></script>
    <!-- TECH #1 FIX: Error Boundaries pour widgets -->
    <script type="text/babel" src="js/dashboard/components/ErrorBoundary.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/MarketsEconomyTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/AskEmmaTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/VoiceAssistantTab.js"></script>
    
    <!-- Script de test GOD MODE (disponible en console) -->
    <!-- <script src="/js/dashboard/test-god-mode-console.js"></script> -->
    <!-- Script de d√©bogage GOD MODE -->
    <!-- <script src="/js/dashboard/debug-god-mode.js"></script> -->
    <!-- Quick Fix GOD MODE -->
    <!-- <script src="/js/dashboard/quick-fix-god-mode.js"></script> -->
    <script>
        // Exposer les fonctions de d√©bogage globalement
        window.debugGodMode = function() {
            const script = document.createElement('script');
            script.src = '/js/dashboard/debug-god-mode.js';
            document.head.appendChild(script);
        };
        window.quickFixGodMode = function() {
            const script = document.createElement('script');
            script.src = '/js/dashboard/quick-fix-god-mode.js';
            document.head.appendChild(script);
        };
    </script>

    <!-- TradingView Lightweight Charts - Biblioth√®que officielle pour graphiques personnalis√©s -->
    <!-- <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script> -->
    <!-- Tailwind CSS - Compiled CSS file (production-ready, replaces CDN) -->
    <link rel="stylesheet" href="/css/tailwind.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Recharts - Bundled locally (prop-types included in bundle) -->
    <script src="/js/recharts-bundle.js"></script>
    <script>
        // CRITICAL: Expose Recharts immediately after script loads
        // This must run BEFORE Babel processes any scripts that use Recharts
        (function exposeRechartsNow() {
            function expose() {
                if (typeof Recharts === 'undefined') return false;
                
                window.Recharts = Recharts;
                if (Recharts.default) {
                    const r = Recharts.default;
                    window.Recharts = r;
                    Object.keys(r).forEach(k => {
                        if (!window.Recharts[k]) window.Recharts[k] = r[k];
                    });
                }
                if (!window.Recharts.LineChart && Recharts.LineChart) {
                    window.Recharts.LineChart = Recharts.LineChart;
                }
                if (!window.Recharts.ResponsiveContainer && Recharts.ResponsiveContainer) {
                    window.Recharts.ResponsiveContainer = Recharts.ResponsiveContainer;
                }
                
                if (window.Recharts && window.Recharts.LineChart && window.Recharts.ResponsiveContainer) {
                    console.log('‚úÖ Recharts expos√© et pr√™t');
                    // Dispatch event for components waiting for Recharts
                    window.dispatchEvent(new CustomEvent('recharts-ready'));
                    return true;
                }
                return false;
            }
            
            // Try immediately
            if (!expose()) {
                // Wait for script to fully load
                const check = setInterval(() => {
                    if (expose()) clearInterval(check);
                }, 10);
                setTimeout(() => clearInterval(check), 3000);
            }
        })();
    </script>
    <!-- PDF Export Dependencies -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> -->


    <!-- Iconoir - Beautiful open source icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir@main/css/iconoir.css">
    
    <!-- CurveWatch Components (custom yield curve visualization) -->
    <script type="text/babel" src="js/dashboard/components/CurveWatch/RateCards.js"></script>
    <script type="text/babel" src="js/dashboard/components/CurveWatch/YieldCurveChart.js"></script>
    <script type="text/babel" src="js/dashboard/components/CurveWatch/SpreadChart.js"></script>
    <script type="text/babel" src="js/dashboard/components/CurveWatch/HistoricalCompare.js"></script>
    <script type="text/babel" src="js/dashboard/components/CurveWatch/CurveWatchContainer.js"></script>
    <script type="text/babel" src="js/dashboard/components/CurveWatch/index.js"></script>

    <!-- Scripts Tab Seeking Alpha & Scraping -->
    <script type="text/babel" src="js/dashboard/components/tabs/YieldCurveTab.js"></script>
    <!-- YieldCurveLiteTab - Version simplifi√©e pour la grille DashboardGridWrapper -->
    <script type="text/babel" src="js/dashboard/components/tabs/YieldCurveLiteTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/EconomicCalendarTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/DansWatchlistTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/EmailBriefingsTab.js"></script>

    <script type="text/babel" src="js/dashboard/components/tabs/SeekingAlphaTab.js"></script>
    <script type="text/babel" src="js/dashboard/components/tabs/ScrappingSATab.js"></script>
    
    <!-- Styles des th√®mes -->
    <link rel="stylesheet" href="/css/themes.css">
    <!-- GOB Design System - Styles consolid√©s (tokens, spacing, accessibility, components, animations, fonts, etc.) -->
    <link rel="stylesheet" href="/css/gob-design-system.css">
    <!-- Google Fonts pour les polices personnalis√©es des th√®mes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Source+Sans+Pro:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Avenir+Next:wght@400;500;600;700&family=Inter:wght@400;500;600;700;800;900&family=Roboto:wght@400;500;700;900&family=Georgia:wght@400;700&display=swap" rel="stylesheet">

    <!-- Environment Configuration from env-config.js -->
    <script src="/js/env-config.js"></script>
    <!-- PERF #16 FIX: State Persistence pour √©viter rechargement complet -->
    <script src="/js/dashboard/state-persistence.js"></script>
    <!-- Mock API for Local Development -->
    <script src="/js/dashboard/mock-api.js"></script>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <!-- Roles & Permissions System -->
    <script src="/js/roles-permissions.js"></script>
    <!-- Toast Notification Manager (Global) -->
    <script src="/js/utils/toast-manager.js"></script>

    <!-- Script pour exposer les biblioth√®ques globalement -->
    <script>
        // Exposer Recharts globalement (CRITIQUE pour CurveWatch)
        // Recharts est charg√© via CDN, mais doit √™tre expos√© correctement
        (function() {
            // Attendre que Recharts soit charg√©
            function exposeRecharts() {
                // Si Recharts est disponible globalement (via CDN)
                if (typeof Recharts !== 'undefined') {
                    window.Recharts = Recharts;
                    // G√©rer le format UMD
                    if (Recharts.default) {
                        const recharts = Recharts.default;
                        window.Recharts = recharts;
                        // Copier aussi les exports au niveau sup√©rieur
                        Object.keys(recharts).forEach(key => {
                            if (!window.Recharts[key]) {
                                window.Recharts[key] = recharts[key];
                            }
                        });
                    }
                    console.log('‚úÖ Recharts expos√© globalement:', {
                        hasLineChart: !!(window.Recharts && window.Recharts.LineChart),
                        hasResponsiveContainer: !!(window.Recharts && window.Recharts.ResponsiveContainer)
                    });
                    return true;
                }
                return false;
            }
            
            // Essayer imm√©diatement
            if (!exposeRecharts()) {
                // Attendre le chargement de la page
                window.addEventListener('load', function() {
                    setTimeout(exposeRecharts, 100);
                });
                // V√©rifier p√©riodiquement
                const checkInterval = setInterval(() => {
                    if (exposeRecharts()) {
                        clearInterval(checkInterval);
                    }
                }, 100);
                // Arr√™ter apr√®s 5 secondes
                setTimeout(() => clearInterval(checkInterval), 5000);
            }
        })();

        // ============================================
        // INJECTION VARIABLE D'ENVIRONNEMENT VITE_GROUP_CHAT_URL
        // ============================================
        // Pour Babel inline, on doit passer la variable via un script
        // En production Vercel, cette variable sera inject√©e c√¥t√© serveur
        // En d√©veloppement, elle peut √™tre d√©finie dans window.importMetaEnv
        (function() {
            // Essayer de r√©cup√©rer depuis window.importMetaEnv (si d√©fini par Vite)
            const envChatUrl = (typeof window !== 'undefined' && window.importMetaEnv && window.importMetaEnv.VITE_GROUP_CHAT_URL)
                ? window.importMetaEnv.VITE_GROUP_CHAT_URL
                : '';
            
            // Injecter dans le meta tag pour que ChatGPTGroupTab.js puisse le lire
            const metaTag = document.getElementById('vite-group-chat-url-meta');
            if (metaTag && envChatUrl) {
                metaTag.setAttribute('content', envChatUrl);
            }
            
            // Exposer aussi via window pour acc√®s direct
            if (typeof window !== 'undefined') {
                window.importMetaEnv = window.importMetaEnv || {};
                if (envChatUrl) {
                    window.importMetaEnv.VITE_GROUP_CHAT_URL = envChatUrl;
                }
            }
        })();

        // OPTIMISATION: Gestionnaire d'erreur global am√©lior√© pour √©viter que les erreurs de scripts externes cassent l'application
        window.addEventListener('error', function (event) {
            // Ignorer les erreurs de scripts externes (extensions, etc.)
            if (event.filename && (event.filename.includes('share-modal') || event.filename.includes('extension'))) {
                console.warn('‚ö†Ô∏è Erreur ignor√©e depuis un script externe:', event.filename);
                event.preventDefault();
                return true;
            }
            // Filtre pour √©viter les erreurs TradingView r√©p√©titives
            const errorMsg = event.message || event.error?.message || 'Unknown error';
            const source = event.filename || 'unknown';

            // Ignore generic cross-origin script errors
            if (!event.filename && (errorMsg === 'Unknown error' || errorMsg === 'Script error.')) {
                return;
            }
            
            // Filtrer les erreurs TradingView r√©p√©titives (contentWindow, invalid environment)
            if (source.includes('tradingview.com') || source.includes('embed-widget')) {
                if (errorMsg.includes('contentWindow is not available') || 
                    errorMsg.includes('Invalid environment') ||
                    errorMsg.includes('Cannot listen to the event')) {
                    // Ces erreurs sont normales pour TradingView (sandbox restrictions)
                    // Logger seulement en mode debug pour √©viter la pollution de la console
                    if (window.DEBUG_MODE) {
                        console.debug(`[TradingView] ${errorMsg.substring(0, 100)}`);
                    }
                    return; // Ne pas logger ces erreurs r√©p√©titives
                }
            }

            // OPTIMISATION: Logger les erreurs dashboard pour debugging
            if (event.filename && event.filename.includes('dashboard')) {
                console.error('‚ùå Erreur dashboard:', errorMsg, 'at', event.filename + ':' + event.lineno);
                if (event.error && event.error.stack) {
                    console.error('Stack:', event.error.stack);
                }
            }
            // Log VM errors (from Babel transpilation)
            else if (!event.filename || event.filename.includes('VM')) {
                console.error('‚ùå Erreur transpilation:', errorMsg);
                if (event.error && event.error.stack) {
                    console.error('Stack:', event.error.stack);
                } else if (event.filename) {
                    console.error('Fichier:', event.filename, 'Ligne:', event.lineno);
                }
            }
        }, true);

        // Protection contre les addEventListener sur des √©l√©ments null
        const originalAddEventListener = EventTarget.prototype.addEventListener;
        EventTarget.prototype.addEventListener = function (type, listener, options) {
            if (this === null || this === undefined) {
                console.warn('‚ö†Ô∏è Tentative d\'ajouter un event listener sur un √©l√©ment null/undefined:', type);
                return;
            }
            return originalAddEventListener.call(this, type, listener, options);
        };

        // V√©rifier le chargement des biblioth√®ques
        window.addEventListener('load', function () {
            console.log('üìö V√©rification des biblioth√®ques:');
            console.log('Recharts disponible:', typeof window.Recharts !== 'undefined');
            console.log('Iconoir disponible:', document.querySelectorAll('[class*="iconoir-"]').length > 0);

            // Message informatif sur les avertissements de production
            // Note: Babel Standalone is used intentionally for this standalone file
            // For production optimization, consider precompiling with: npm run build:babel
            if (process.env.NODE_ENV === 'production') {
                console.log('‚ÑπÔ∏è Production mode: Consider using precompiled scripts for better performance');
            }
        });

        // ============================================
        // üîç FREEZE DIAGNOSTICS & FAILSAFE SYSTEM
        // ============================================
        (function() {
            'use strict';
            
            // Store last known freeze state
            window._freezeDiagnostics = {
                lastClickTime: Date.now(),
                clickCount: 0,
                blockerHistory: [],
                isMonitoring: false
            };

            // üîç DIAGNOSTIC: Identify what element is blocking clicks
            window.diagnoseFreeze = function() {
                console.log('üîç DIAGNOSE FREEZE - Running...');
                console.log('==================================================');
                
                // 1) What element is at center of screen?
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const topElement = document.elementFromPoint(centerX, centerY);
                
                console.log('üìç TOP ELEMENT at center:', topElement);
                if (topElement) {
                    console.log('   id:', topElement.id || '(none)');
                    console.log('   class:', topElement.className || '(none)');
                    console.log('   tagName:', topElement.tagName);
                    topElement.style.outline = '4px solid red';
                    console.log('   ‚úÖ Outlined in RED');
                }
                
                // 2) Check pointer-events on body, html, root
                const bodyPE = getComputedStyle(document.body).pointerEvents;
                const htmlPE = getComputedStyle(document.documentElement).pointerEvents;
                const root = document.querySelector('#root');
                const rootPE = root ? getComputedStyle(root).pointerEvents : 'N/A';
                
                console.log('\nüñ±Ô∏è POINTER-EVENTS:');
                console.log('   body:', bodyPE, bodyPE === 'none' ? '‚ùå BLOCKED!' : '‚úÖ');
                console.log('   html:', htmlPE, htmlPE === 'none' ? '‚ùå BLOCKED!' : '‚úÖ');
                console.log('   #root:', rootPE, rootPE === 'none' ? '‚ùå BLOCKED!' : '‚úÖ');
                
                // 3) Find all fixed/absolute overlays with high z-index
                const allElements = document.querySelectorAll('div, section, aside, dialog, [role="dialog"]');
                const blockers = [];
                
                allElements.forEach(el => {
                    const style = getComputedStyle(el);
                    const pos = style.position;
                    const zIndex = parseInt(style.zIndex || '0', 10);
                    const display = style.display;
                    const visibility = style.visibility;
                    const opacity = parseFloat(style.opacity);
                    
                    // Check if it's a potential blocker
                    if ((pos === 'fixed' || pos === 'absolute') && 
                        zIndex >= 40 && 
                        display !== 'none' && 
                        visibility !== 'hidden') {
                        
                        const rect = el.getBoundingClientRect();
                        const coversCenter = rect.left <= centerX && rect.right >= centerX && 
                                           rect.top <= centerY && rect.bottom >= centerY;
                        
                        if (coversCenter || (rect.width > window.innerWidth * 0.5 && rect.height > window.innerHeight * 0.5)) {
                            blockers.push({
                                element: el,
                                id: el.id || '(none)',
                                className: el.className?.toString()?.slice(0, 80) || '(none)',
                                zIndex: zIndex,
                                position: pos,
                                opacity: opacity,
                                pointerEvents: style.pointerEvents,
                                size: `${Math.round(rect.width)}x${Math.round(rect.height)}`
                            });
                        }
                    }
                });
                
                console.log('\nüöß POTENTIAL BLOCKERS (z-index >= 40, covers center):');
                if (blockers.length === 0) {
                    console.log('   ‚úÖ None found');
                } else {
                    blockers.sort((a, b) => b.zIndex - a.zIndex);
                    blockers.slice(0, 10).forEach((b, i) => {
                        console.log(`   ${i+1}. z:${b.zIndex} | ${b.position} | PE:${b.pointerEvents} | ${b.size}`);
                        console.log(`      id="${b.id}" class="${b.className}"`);
                        b.element.style.outline = '2px dashed orange';
                    });
                }
                
                // 4) Check for loading overlays specifically
                const loadingSelectors = [
                    '#loadingOverlay', '.loading-overlay', '.loading-screen',
                    '[class*="loading"]', '[class*="spinner"]', '[class*="overlay"]',
                    '.modal-backdrop', '.click-shield', '[class*="backdrop"]'
                ];
                
                console.log('\n‚è≥ LOADING/MODAL OVERLAYS:');
                let foundLoading = false;
                loadingSelectors.forEach(sel => {
                    const els = document.querySelectorAll(sel);
                    els.forEach(el => {
                        const style = getComputedStyle(el);
                        if (style.display !== 'none' && style.visibility !== 'hidden' && parseFloat(style.opacity) > 0) {
                            console.log(`   ‚ö†Ô∏è VISIBLE: ${sel}`, el);
                            foundLoading = true;
                        }
                    });
                });
                if (!foundLoading) console.log('   ‚úÖ None visible');
                
                // 5) Check ReactGridLayout drag layer
                const rglDragLayer = document.querySelector('.react-grid-layout');
                if (rglDragLayer) {
                    const rglStyle = getComputedStyle(rglDragLayer);
                    console.log('\nüìê REACT GRID LAYOUT:');
                    console.log('   pointerEvents:', rglStyle.pointerEvents);
                    console.log('   zIndex:', rglStyle.zIndex);
                    
                    const placeholders = document.querySelectorAll('.react-grid-placeholder, .react-draggable-dragging');
                    if (placeholders.length > 0) {
                        console.log('   ‚ö†Ô∏è Active drag/placeholder elements:', placeholders.length);
                    }
                }
                
                console.log('\n==================================================');
                console.log('üí° TO FIX: Run window.forceUnfreeze() to restore pointer-events');
                
                return { topElement, bodyPE, htmlPE, rootPE, blockers };
            };

            // üîß FORCE UNFREEZE: Restore pointer-events and remove stuck overlays
            window.forceUnfreeze = function() {
                console.log('üîß FORCE UNFREEZE - Restoring UI...');
                
                // Restore pointer-events
                document.body.style.pointerEvents = 'auto';
                document.documentElement.style.pointerEvents = 'auto';
                const root = document.querySelector('#root');
                if (root) root.style.pointerEvents = 'auto';
                
                // Remove/hide common blockers
                const blockerSelectors = [
                    '.loading-overlay', '.loading-screen', '#loadingOverlay',
                    '.modal-backdrop', '.click-shield', '[class*="backdrop"]:not(.header-backdrop)'
                ];
                
                blockerSelectors.forEach(sel => {
                    document.querySelectorAll(sel).forEach(el => {
                        const style = getComputedStyle(el);
                        if (style.display !== 'none' && style.position === 'fixed') {
                            console.log('   Hiding blocker:', sel, el);
                            el.style.display = 'none';
                            el.style.pointerEvents = 'none';
                        }
                    });
                });
                
                // Remove any stuck drag states from RGL
                document.querySelectorAll('.react-draggable-dragging').forEach(el => {
                    el.classList.remove('react-draggable-dragging');
                });
                
                console.log('‚úÖ UI should be responsive now');
            };

            // ‚ö° AUTO-FAILSAFE: Periodically check and restore pointer-events
            // Using longer interval (10s) to reduce main thread blocking
            const failsafeInterval = window._performanceOptimizedFailsafeInterval || 10000;
            setInterval(function() {
                const bodyPE = getComputedStyle(document.body).pointerEvents;
                const htmlPE = getComputedStyle(document.documentElement).pointerEvents;
                
                if (bodyPE === 'none' || htmlPE === 'none') {
                    console.warn('[Failsafe] ‚ö†Ô∏è pointer-events blocked, restoring...');
                    document.body.style.pointerEvents = 'auto';
                    document.documentElement.style.pointerEvents = 'auto';
                    const root = document.querySelector('#root');
                    if (root) root.style.pointerEvents = 'auto';
                }
            }, failsafeInterval);

            // üìä CLICK MONITOR: Log clicks to detect if they're being captured
            document.addEventListener('click', function(e) {
                window._freezeDiagnostics.lastClickTime = Date.now();
                window._freezeDiagnostics.clickCount++;
                
                if (window._freezeDiagnostics.isMonitoring) {
                    console.log('[CLICK]', {
                        target: e.target,
                        id: e.target.id,
                        class: e.target.className,
                        defaultPrevented: e.defaultPrevented,
                        propagationStopped: e._propagationStopped || false
                    });
                }
            }, true); // capture phase

            // üéØ START CLICK MONITORING
            window.startClickMonitor = function() {
                window._freezeDiagnostics.isMonitoring = true;
                console.log('üëÅÔ∏è Click monitoring ENABLED - all clicks will be logged');
            };

            window.stopClickMonitor = function() {
                window._freezeDiagnostics.isMonitoring = false;
                console.log('üëÅÔ∏è Click monitoring DISABLED');
            };

            console.log('‚úÖ Freeze Diagnostics loaded. Commands: diagnoseFreeze(), forceUnfreeze(), startClickMonitor()');
        })();
    </script>

    <!-- Emma Configuration - Centralized prompts and settings -->
    <script type="module">
        import { emmaConfig } from './emma-config.js';
        window.emmaConfig = emmaConfig;
        console.log('‚úÖ Emma Config charg√©:', window.emmaConfig ? 'OK' : 'ERREUR');

        // Init Toast Helper Global
        window.showToast = (msg, type = 'info') => {
            if (window.Toast) window.Toast.show(msg, type);
            else console.log('Toast:', msg);
        };
        // BUG #A3 FIX: Welcome Toast - Positionn√© en haut pour ne pas couvrir la navigation
        window.addEventListener('load', () => {
            setTimeout(() => {
                if(window.showToast) {
                    // Positionner le toast en haut au lieu du bas pour ne pas couvrir la navigation
                    const toastContainer = document.getElementById('toast-container');
                    if (toastContainer) {
                        toastContainer.style.bottom = 'auto';
                        toastContainer.style.top = '24px';
                    }
                    window.showToast('Bienvenue sur votre Dashboard Premium', 'gold', 'JSLai Wealth');
                    // R√©initialiser la position apr√®s 3 secondes
                    setTimeout(() => {
                        if (toastContainer) {
                            toastContainer.style.top = 'auto';
                            toastContainer.style.bottom = '24px';
                        }
                    }, 3000);
                }
            }, 1000);
        });
    </script>

    <!-- Styles Emma -->
    <link rel="stylesheet" href="emma-styles.css">
    <!-- Note: Tous les styles inline ont √©t√© extraits vers des fichiers CSS s√©par√©s -->
    <!-- et sont import√©s via /css/gob-design-system.css -->
    <!-- Fichiers cr√©√©s: animations.css, fonts.css, tab-styles.css, iconoir-fixes.css, -->
    <!-- ui-effects.css, card-effects.css, mobile-responsive.css, scrollbar-styles.css, utilities.css -->

    <!-- üîê Auth Guard - Protection du Dashboard -->
    <script src="/js/auth-guard.js"></script>
    <!-- Note: Styles Emma IA (buttons, glass-card, footer-info-bar, etc.) -->
    <!-- extraits vers /css/emma-components.css (import√© via gob-design-system.css) -->
</head>

<body class="min-h-screen bg-black m-0 p-0">
    <div id="root" class="min-h-screen w-full"></div>

    <!-- Stock Analysis Components (fixed API routing) -->
    <!-- <script src="/js/dashboard/stockAnalysisAPI-FIXED.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/StockAnalysisModal.js"></script> -->

    <!-- Advanced Analysis Components -->
    <!-- <script type="text/babel" src="/js/dashboard/components/PeerComparisonModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/ScenarioAnalysisModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/AdvancedScreenerModal.js"></script> -->

    <!-- NEW: Enhanced Analysis Modals with Full API Integration -->
    <!-- <script type="text/babel" src="/js/dashboard/components/AIStockAnalysisModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/NewsAndSentimentModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/AnalystConsensusModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/EarningsCalendarModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/EconomicEventsModal.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/WatchlistScreenerModal.js"></script> -->

    <!-- <script src="/js/dashboard/pdfExporter.js"></script> -->

    <!-- Main Tabs Components -->
    <!-- DUPLICATE REMOVED: EconomicCalendarTab.js & FastGraphsTab.js already loaded above -->
    <!-- <script type="text/babel" src="/js/dashboard/components/tabs/EconomicCalendarTab.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/tabs/FastGraphsTab.js"></script> -->
    <script type="text/babel" src="/js/dashboard/components/tabs/AdvancedAnalysisModals.js"></script>
    <script type="text/babel" src="/js/dashboard/components/tabs/AdvancedAnalysisTab.js"></script>
    <!-- V0 Integration Wrapper - Permet d'int√©grer directement les composants v0 -->
    <script src="/js/dashboard/components/v0-integration-wrapper.js"></script>
    <script type="text/babel" src="/js/dashboard/components/tabs/CurveWatchTab.js"></script>

    <!-- Grid Layout Components (MUST load AFTER all tab components) -->
    <script type="text/babel" src="js/dashboard/components/tabs/MarketsEconomyTabRGL.js"></script>
    <script type="text/babel" src="js/dashboard/components/grid-layout/RglDashboard.js"></script>
    <script type="text/babel" src="js/dashboard/components/grid-layout/DashboardGridWrapper.js"></script>

    <!-- Announcement Bars System (Gemini-powered) -->
    <!-- <script type="text/babel" src="/js/dashboard/components/AnnouncementBar.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/AnnouncementBarManager.js"></script> -->
    <!-- DUPLICATE REMOVED: ThemeSelector.js already loaded above -->
    <!-- <script type="text/babel" src="/js/dashboard/components/ThemeSelector.js"></script> -->
    <script type="text/babel" src="/js/dashboard/components/TradingViewTicker.js"></script>
    <!-- <script type="text/babel" src="/js/dashboard/components/MobileNavOverlay.js"></script> -->
    <!-- <script type="text/babel" src="/js/dashboard/components/SecondaryNavEditor.js"></script> -->
    <!-- <script type="text/babel" src="js/dashboard/components/ComponentManager.js"></script> -->



    <!-- Signal that all components are loaded -->
    <script>
        // Mark components as ready after all scripts are parsed
        window.__COMPONENTS_READY__ = true;
        window.dispatchEvent(new CustomEvent('components-ready'));
        console.log('‚úÖ All component scripts loaded, components-ready event dispatched');
    </script>

    <!-- Inline bundle - Using Babel Standalone (intentional for standalone file) -->
    <!-- PRODUCTION NOTE: This file is >500KB and compiled by Babel in-browser -->
    <!-- The warning about file size is expected. For optimization, use precompiled version -->
    <script type="text/babel" data-presets="react" src="/js/dashboard/app-inline.js?v=3.2"></script>

    <!-- Global Real-time Sync (must load after app-inline to dispatch events) -->
    <script src="/js/dashboard/realtime-sync.js"></script>
    <!-- Debug / Context Indicator -->
    <div id="footer-info-bar">
        <span class="brand">GOB Apps</span>
        <span class="separator">|</span>
        <span id="footer-context">public/beta-combined-dashboard.html</span>
    </div>
    <!-- FAILSAFE: Force remove loader if app hangs -->
    <script>
        setTimeout(function() {
            const loader = document.getElementById('loadingOverlay');
            if (loader && loader.style.display !== 'none') {
                console.warn('‚ö†Ô∏è Failsafe triggered: Removing stuck loader');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
            }
        }, 10000); // 10 seconds max load time
    </script>
    <!-- <script type="text/babel" src="/js/dashboard/components/DevTimer.js"></script> -->
</body>

</html>
