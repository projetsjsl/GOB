<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emma Config - Interface Am√©lior√©e</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animations & Transitions */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse-success {
            0%, 100% { background-color: #10b981; }
            50% { background-color: #34d399; }
        }

        .toast {
            animation: slideIn 0.3s ease-out;
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.expanded {
            max-height: 2000px;
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        .pulse-success {
            animation: pulse-success 0.5s ease-in-out;
        }

        /* Boutons am√©lior√©s */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #cbd5e1;
            transition: .3s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Color picker enhanced */
        .color-picker-group {
            position: relative;
        }
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .color-preview:hover {
            transform: scale(1.1);
            border-color: #3b82f6;
        }

        /* Section collapsible */
        .section-header {
            cursor: pointer;
            user-select: none;
        }
        .section-header:hover {
            background-color: #f9fafb;
        }
        .section-icon {
            transition: transform 0.3s ease;
        }
        .section-icon.rotated {
            transform: rotate(180deg);
        }

        /* Tooltip personnalis√© */
        .tooltip {
            position: relative;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            background-color: #1f2937;
            color: white;
            text-align: left;
            padding: 8px 12px;
            border-radius: 6px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Status indicator */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        .status-saved { background-color: #10b981; }
        .status-unsaved { background-color: #f59e0b; }
        .status-error { background-color: #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Status Bar -->
    <div class="sticky top-0 z-40 bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-bold text-gray-800">ü§ñ Emma Config</h1>
                <div class="flex items-center text-sm">
                    <span id="saveStatus" class="status-indicator status-saved"></span>
                    <span id="saveStatusText" class="text-gray-600">Sauvegard√©</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="undoBtn" class="tooltip px-3 py-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition disabled:opacity-30" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>
                    <span class="tooltiptext">Annuler (Ctrl+Z)</span>
                </button>
                <button id="redoBtn" class="tooltip px-3 py-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition disabled:opacity-30" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"></path></svg>
                    <span class="tooltiptext">R√©tablir (Ctrl+Y)</span>
                </button>
                <div class="h-6 w-px bg-gray-300"></div>
                <button id="previewToggle" class="tooltip px-3 py-1.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                    <span class="tooltiptext">Aper√ßu temps r√©el</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Tab Navigation -->
        <div class="bg-white rounded-xl shadow-sm p-2 mb-6 inline-flex gap-1">
            <button onclick="switchTab('design')" id="tabDesign" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 bg-blue-50 text-blue-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                Design Email
            </button>
            <button onclick="switchTab('sms')" id="tabSms" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 text-gray-600 hover:bg-gray-50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                Config SMS
            </button>
            <button onclick="switchTab('prompts')" id="tabPrompts" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 text-gray-600 hover:bg-gray-50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                Prompts
            </button>
        </div>

        <!-- Design Tab Content -->
        <div id="designContent" class="space-y-6">

            <!-- SECTION 1: Branding -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="section-header p-4 border-b flex justify-between items-center" onclick="toggleSection('branding')">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
                        </div>
                        <div>
                            <h2 class="font-semibold text-gray-900">Identit√© de Marque</h2>
                            <p class="text-sm text-gray-500">Logo, nom, slogan et identit√© visuelle</p>
                        </div>
                    </div>
                    <svg id="brandingIcon" class="w-5 h-5 text-gray-400 section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="brandingSection" class="collapsible-content expanded">
                    <div class="p-6 space-y-6">
                        <!-- Avatar & Logo -->
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <label class="flex items-center gap-2 text-sm font-medium text-gray-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    Avatar Emma
                                </label>
                                <div class="flex gap-3">
                                    <div id="avatarPreview" class="w-16 h-16 rounded-full border-2 border-gray-200 flex items-center justify-center bg-gray-50 overflow-hidden">
                                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <input type="url" id="avatarUrl" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/avatar.png">
                                        <p class="text-xs text-gray-500">64x64px recommand√© ¬∑ Formats: PNG, JPG, WebP</p>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <label class="flex items-center gap-2 text-sm font-medium text-gray-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    Logo Entreprise
                                </label>
                                <div class="flex gap-3">
                                    <div id="logoPreview" class="w-16 h-16 rounded-lg border-2 border-gray-200 flex items-center justify-center bg-gray-50 overflow-hidden">
                                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <input type="url" id="logoUrl" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="https://example.com/logo.png">
                                        <p class="text-xs text-gray-500">150x40px recommand√© ¬∑ Fond transparent pr√©f√©r√©</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Company Info -->
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Nom de l'entreprise</label>
                                <input type="text" id="companyName" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="GOB Apps" value="GOB Apps">
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Slogan / Tagline</label>
                                <input type="text" id="tagline" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Intelligence Financi√®re Propuls√©e par Emma IA" value="Intelligence Financi√®re Propuls√©e par Emma IA">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: Couleurs -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="section-header p-4 border-b flex justify-between items-center" onclick="toggleSection('colors')">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                        </div>
                        <div>
                            <h2 class="font-semibold text-gray-900">Palette de Couleurs</h2>
                            <p class="text-sm text-gray-500">Th√®me chromatique des emails et SMS</p>
                        </div>
                    </div>
                    <svg id="colorsIcon" class="w-5 h-5 text-gray-400 section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="colorsSection" class="collapsible-content expanded">
                    <div class="p-6">
                        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- Primary Color -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-700">Couleur Primaire</label>
                                <div class="color-picker-group flex items-center gap-3">
                                    <input type="color" id="colorPrimary" value="#6366f1" class="color-preview">
                                    <div class="flex-1">
                                        <input type="text" id="colorPrimaryHex" value="#6366f1" class="w-full px-3 py-2 border rounded-lg text-sm font-mono" pattern="^#[0-9A-Fa-f]{6}$">
                                        <p class="text-xs text-gray-500 mt-1">Headers, liens, accents</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Primary Dark -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-700">Primaire Fonc√©</label>
                                <div class="color-picker-group flex items-center gap-3">
                                    <input type="color" id="colorPrimaryDark" value="#4f46e5" class="color-preview">
                                    <div class="flex-1">
                                        <input type="text" id="colorPrimaryDarkHex" value="#4f46e5" class="w-full px-3 py-2 border rounded-lg text-sm font-mono">
                                        <p class="text-xs text-gray-500 mt-1">Titres, emphasis</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Primary Light -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-700">Primaire Clair</label>
                                <div class="color-picker-group flex items-center gap-3">
                                    <input type="color" id="colorPrimaryLight" value="#8b5cf6" class="color-preview">
                                    <div class="flex-1">
                                        <input type="text" id="colorPrimaryLightHex" value="#8b5cf6" class="w-full px-3 py-2 border rounded-lg text-sm font-mono">
                                        <p class="text-xs text-gray-500 mt-1">Bordures, highlights</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Text Color -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-700">Texte Principal</label>
                                <div class="color-picker-group flex items-center gap-3">
                                    <input type="color" id="colorText" value="#1f2937" class="color-preview">
                                    <div class="flex-1">
                                        <input type="text" id="colorTextHex" value="#1f2937" class="w-full px-3 py-2 border rounded-lg text-sm font-mono">
                                        <p class="text-xs text-gray-500 mt-1">Corps du texte</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Color Presets -->
                        <div class="mt-6 pt-6 border-t">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Th√®mes Pr√©d√©finis</label>
                            <div class="flex gap-2">
                                <button onclick="applyColorPreset('blue')" class="tooltip px-4 py-2 rounded-lg border-2 border-blue-500 bg-blue-50 hover:bg-blue-100 transition flex items-center gap-2">
                                    <div class="flex gap-1">
                                        <div class="w-4 h-4 rounded-full bg-blue-600"></div>
                                        <div class="w-4 h-4 rounded-full bg-blue-500"></div>
                                        <div class="w-4 h-4 rounded-full bg-blue-400"></div>
                                    </div>
                                    <span class="text-sm font-medium">Bleu</span>
                                    <span class="tooltiptext">Th√®me professionnel bleu</span>
                                </button>
                                <button onclick="applyColorPreset('purple')" class="tooltip px-4 py-2 rounded-lg border-2 border-purple-300 hover:bg-purple-50 transition flex items-center gap-2">
                                    <div class="flex gap-1">
                                        <div class="w-4 h-4 rounded-full bg-purple-600"></div>
                                        <div class="w-4 h-4 rounded-full bg-purple-500"></div>
                                        <div class="w-4 h-4 rounded-full bg-purple-400"></div>
                                    </div>
                                    <span class="text-sm font-medium">Violet</span>
                                    <span class="tooltiptext">Th√®me cr√©atif violet</span>
                                </button>
                                <button onclick="applyColorPreset('green')" class="tooltip px-4 py-2 rounded-lg border-2 border-green-300 hover:bg-green-50 transition flex items-center gap-2">
                                    <div class="flex gap-1">
                                        <div class="w-4 h-4 rounded-full bg-green-600"></div>
                                        <div class="w-4 h-4 rounded-full bg-green-500"></div>
                                        <div class="w-4 h-4 rounded-full bg-green-400"></div>
                                    </div>
                                    <span class="text-sm font-medium">Vert</span>
                                    <span class="tooltiptext">Th√®me nature vert</span>
                                </button>
                                <button onclick="applyColorPreset('orange')" class="tooltip px-4 py-2 rounded-lg border-2 border-orange-300 hover:bg-orange-50 transition flex items-center gap-2">
                                    <div class="flex gap-1">
                                        <div class="w-4 h-4 rounded-full bg-orange-600"></div>
                                        <div class="w-4 h-4 rounded-full bg-orange-500"></div>
                                        <div class="w-4 h-4 rounded-full bg-orange-400"></div>
                                    </div>
                                    <span class="text-sm font-medium">Orange</span>
                                    <span class="tooltiptext">Th√®me √©nergique orange</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: Header Configuration -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="section-header p-4 border-b flex justify-between items-center" onclick="toggleSection('header')">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        </div>
                        <div>
                            <h2 class="font-semibold text-gray-900">En-t√™te Email</h2>
                            <p class="text-sm text-gray-500">Configuration du header des emails</p>
                        </div>
                    </div>
                    <svg id="headerIcon" class="w-5 h-5 text-gray-400 section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="headerSection" class="collapsible-content expanded">
                    <div class="p-6 space-y-6">
                        <!-- Header Options -->
                        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    <span class="text-sm font-medium">Avatar</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showAvatar" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <span class="text-sm font-medium">Date</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showDate" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
                                    <span class="text-sm font-medium">√âdition</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showEdition" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Header Styling -->
                        <div class="grid md:grid-cols-2 gap-6 pt-4 border-t">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Taille Police Titre</label>
                                <div class="flex items-center gap-3">
                                    <input type="range" id="headerFontSize" min="20" max="40" value="32" class="flex-1">
                                    <span id="headerFontSizeValue" class="text-sm font-mono text-gray-600 w-12">32px</span>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Padding Vertical</label>
                                <div class="flex items-center gap-3">
                                    <input type="range" id="headerPadding" min="16" max="64" value="32" class="flex-1">
                                    <span id="headerPaddingValue" class="text-sm font-mono text-gray-600 w-12">32px</span>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Arrondi Coins (Border Radius)</label>
                                <div class="flex items-center gap-3">
                                    <input type="range" id="headerBorderRadius" min="0" max="24" value="12" class="flex-1">
                                    <span id="headerBorderRadiusValue" class="text-sm font-mono text-gray-600 w-12">12px</span>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Alignement Texte</label>
                                <select id="headerTextAlign" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="left">Gauche</option>
                                    <option value="center" selected>Centre</option>
                                    <option value="right">Droite</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 4: Footer Configuration -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="section-header p-4 border-b flex justify-between items-center" onclick="toggleSection('footer')">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-gray-500 to-gray-600 rounded-lg flex items-center justify-center text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        </div>
                        <div>
                            <h2 class="font-semibold text-gray-900">Pied de Page</h2>
                            <p class="text-sm text-gray-500">Footer, disclaimer, copyright et liens</p>
                        </div>
                    </div>
                    <svg id="footerIcon" class="w-5 h-5 text-gray-400 section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <div id="footerSection" class="collapsible-content expanded">
                    <div class="p-6 space-y-6">
                        <!-- Footer Toggles -->
                        <div class="grid sm:grid-cols-2 gap-4">
                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <span class="text-sm font-medium">Afficher Logo</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showLogo" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition">
                                <div class="flex items-center gap-3">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                    <span class="text-sm font-medium">Disclaimer</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showDisclaimer" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Footer Texts -->
                        <div class="space-y-4 pt-4 border-t">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Texte du Disclaimer</label>
                                <textarea id="disclaimerText" rows="3" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ce briefing est g√©n√©r√© automatiquement par Emma IA √† des fins informatives uniquement.">Ce briefing est g√©n√©r√© automatiquement par Emma IA √† des fins informatives uniquement.</textarea>
                                <p class="text-xs text-gray-500">Texte l√©gal affich√© en petits caract√®res</p>
                            </div>

                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Copyright</label>
                                <input type="text" id="copyrightText" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="¬© 2025 GOB Apps - Tous droits r√©serv√©s" value="¬© 2025 GOB Apps - Tous droits r√©serv√©s">
                            </div>
                        </div>

                        <!-- Social Links (NEW) -->
                        <div class="space-y-4 pt-4 border-t">
                            <div class="flex items-center justify-between">
                                <label class="block text-sm font-medium text-gray-700">Liens R√©seaux Sociaux</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showSocialLinks">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div id="socialLinksContainer" class="grid md:grid-cols-2 gap-4 opacity-50 pointer-events-none">
                                <div class="space-y-2">
                                    <label class="block text-xs text-gray-600">LinkedIn</label>
                                    <input type="url" id="socialLinkedIn" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="https://linkedin.com/company/...">
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-xs text-gray-600">Twitter / X</label>
                                    <input type="url" id="socialTwitter" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="https://twitter.com/...">
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-xs text-gray-600">Facebook</label>
                                    <input type="url" id="socialFacebook" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="https://facebook.com/...">
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-xs text-gray-600">Site Web</label>
                                    <input type="url" id="socialWebsite" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="https://...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex flex-wrap gap-3 justify-between">
                    <div class="flex gap-3">
                        <button id="saveDesignBtn" class="btn px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-medium shadow-lg shadow-green-500/30 transition flex items-center gap-2">
                            <svg id="saveIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                            <span id="saveBtnText">Sauvegarder la Configuration</span>
                        </button>

                        <button id="resetDesignBtn" class="tooltip btn px-6 py-3 border-2 border-gray-300 hover:border-gray-400 hover:bg-gray-50 rounded-lg font-medium transition flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                            <span>R√©initialiser</span>
                            <span class="tooltiptext">Restaurer les valeurs par d√©faut</span>
                        </button>
                    </div>

                    <div class="flex gap-3">
                        <button id="exportHtmlBtn" class="tooltip btn px-6 py-3 border-2 border-blue-300 hover:border-blue-400 hover:bg-blue-50 text-blue-600 rounded-lg font-medium transition flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            <span>Exporter HTML</span>
                            <span class="tooltiptext">T√©l√©charger un exemple d'email</span>
                        </button>

                        <button id="testEmailBtn" class="tooltip btn px-6 py-3 border-2 border-purple-300 hover:border-purple-400 hover:bg-purple-50 text-purple-600 rounded-lg font-medium transition flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            <span>Envoyer Test</span>
                            <span class="tooltiptext">Recevoir un email de test</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SMS Tab Content (Placeholder) -->
        <div id="smsContent" class="hidden">
            <div class="bg-white rounded-xl shadow-sm p-8 text-center">
                <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Configuration SMS</h3>
                <p class="text-gray-500">Cette section sera disponible prochainement</p>
            </div>
        </div>

        <!-- Prompts Tab Content (Placeholder) -->
        <div id="promptsContent" class="hidden">
            <div class="bg-white rounded-xl shadow-sm p-8 text-center">
                <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Gestion des Prompts</h3>
                <p class="text-gray-500">Cette section sera disponible prochainement</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // STATE MANAGEMENT
        // ============================================================================
        let currentConfig = {};
        let history = [];
        let historyIndex = -1;
        const MAX_HISTORY = 50;

        // ============================================================================
        // TAB SWITCHING
        // ============================================================================
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-blue-50', 'text-blue-600');
                btn.classList.add('text-gray-600', 'hover:bg-gray-50');
            });
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('bg-blue-50', 'text-blue-600');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('text-gray-600', 'hover:bg-gray-50');

            // Show/hide content
            document.getElementById('designContent').classList.toggle('hidden', tab !== 'design');
            document.getElementById('smsContent').classList.toggle('hidden', tab !== 'sms');
            document.getElementById('promptsContent').classList.toggle('hidden', tab !== 'prompts');
        }

        // ============================================================================
        // SECTION TOGGLE (COLLAPSIBLE)
        // ============================================================================
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId + 'Section');
            const icon = document.getElementById(sectionId + 'Icon');

            section.classList.toggle('expanded');
            icon.classList.toggle('rotated');
        }

        // ============================================================================
        // COLOR PICKER SYNC
        // ============================================================================
        function setupColorPickers() {
            const colorInputs = ['colorPrimary', 'colorPrimaryDark', 'colorPrimaryLight', 'colorText'];

            colorInputs.forEach(id => {
                const colorPicker = document.getElementById(id);
                const hexInput = document.getElementById(id + 'Hex');

                colorPicker.addEventListener('input', (e) => {
                    hexInput.value = e.target.value;
                    updatePreview();
                    saveToHistory();
                });

                hexInput.addEventListener('change', (e) => {
                    if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) {
                        colorPicker.value = e.target.value;
                        updatePreview();
                        saveToHistory();
                    }
                });
            });
        }

        // ============================================================================
        // RANGE SLIDERS SYNC
        // ============================================================================
        function setupRangeSliders() {
            const sliders = [
                { id: 'headerFontSize', unit: 'px' },
                { id: 'headerPadding', unit: 'px' },
                { id: 'headerBorderRadius', unit: 'px' }
            ];

            sliders.forEach(({ id, unit }) => {
                const slider = document.getElementById(id);
                const display = document.getElementById(id + 'Value');

                slider.addEventListener('input', (e) => {
                    display.textContent = e.target.value + unit;
                    updatePreview();
                    saveToHistory();
                });
            });
        }

        // ============================================================================
        // SOCIAL LINKS TOGGLE
        // ============================================================================
        document.getElementById('showSocialLinks').addEventListener('change', (e) => {
            const container = document.getElementById('socialLinksContainer');
            if (e.target.checked) {
                container.classList.remove('opacity-50', 'pointer-events-none');
            } else {
                container.classList.add('opacity-50', 'pointer-events-none');
            }
        });

        // ============================================================================
        // COLOR PRESETS
        // ============================================================================
        const colorPresets = {
            blue: {
                primary: '#3b82f6',
                primaryDark: '#2563eb',
                primaryLight: '#60a5fa',
                text: '#1e3a8a'
            },
            purple: {
                primary: '#8b5cf6',
                primaryDark: '#7c3aed',
                primaryLight: '#a78bfa',
                text: '#5b21b6'
            },
            green: {
                primary: '#10b981',
                primaryDark: '#059669',
                primaryLight: '#34d399',
                text: '#065f46'
            },
            orange: {
                primary: '#f97316',
                primaryDark: '#ea580c',
                primaryLight: '#fb923c',
                text: '#9a3412'
            }
        };

        function applyColorPreset(presetName) {
            const preset = colorPresets[presetName];
            if (!preset) return;

            document.getElementById('colorPrimary').value = preset.primary;
            document.getElementById('colorPrimaryHex').value = preset.primary;
            document.getElementById('colorPrimaryDark').value = preset.primaryDark;
            document.getElementById('colorPrimaryDarkHex').value = preset.primaryDark;
            document.getElementById('colorPrimaryLight').value = preset.primaryLight;
            document.getElementById('colorPrimaryLightHex').value = preset.primaryLight;
            document.getElementById('colorText').value = preset.text;
            document.getElementById('colorTextHex').value = preset.text;

            updatePreview();
            saveToHistory();
            showToast('Th√®me appliqu√© avec succ√®s!', 'success');
        }

        // ============================================================================
        // TOAST NOTIFICATIONS
        // ============================================================================
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast flex items-center gap-3 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' :
                type === 'warning' ? 'bg-orange-500' :
                'bg-blue-500'
            } text-white min-w-[300px]`;

            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : type === 'warning' ? '‚ö†' : '‚Ñπ';

            toast.innerHTML = `
                <div class="text-2xl">${icon}</div>
                <div class="flex-1">${message}</div>
                <button onclick="this.parentElement.remove()" class="hover:bg-white/20 rounded p-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            `;

            document.getElementById('toastContainer').appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // ============================================================================
        // HISTORY MANAGEMENT (UNDO/REDO)
        // ============================================================================
        function saveToHistory() {
            const state = getFormData();

            // Remove future history if we're not at the end
            if (historyIndex < history.length - 1) {
                history = history.slice(0, historyIndex + 1);
            }

            history.push(JSON.parse(JSON.stringify(state)));

            if (history.length > MAX_HISTORY) {
                history.shift();
            } else {
                historyIndex++;
            }

            updateHistoryButtons();
            updateSaveStatus(false);
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                applyState(history[historyIndex]);
                updateHistoryButtons();
                showToast('Action annul√©e', 'info');
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                applyState(history[historyIndex]);
                updateHistoryButtons();
                showToast('Action r√©tablie', 'info');
            }
        }

        function updateHistoryButtons() {
            document.getElementById('undoBtn').disabled = historyIndex <= 0;
            document.getElementById('redoBtn').disabled = historyIndex >= history.length - 1;
        }

        // ============================================================================
        // SAVE CONFIGURATION
        // ============================================================================
        async function saveConfiguration() {
            const saveBtn = document.getElementById('saveDesignBtn');
            const saveIcon = document.getElementById('saveIcon');
            const saveBtnText = document.getElementById('saveBtnText');

            // Show loading state
            saveBtn.disabled = true;
            saveIcon.classList.add('spinner');
            saveBtnText.textContent = 'Sauvegarde en cours...';

            try {
                const config = getFormData();

                const response = await fetch('/api/email-design', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (!response.ok) throw new Error('Erreur lors de la sauvegarde');

                const result = await response.json();

                // Success state
                saveIcon.classList.remove('spinner');
                saveIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>';
                saveBtnText.textContent = 'Sauvegard√©!';
                saveBtn.classList.add('pulse-success');

                updateSaveStatus(true);
                showToast('Configuration sauvegard√©e dans Supabase!', 'success');

                setTimeout(() => {
                    saveIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>';
                    saveBtnText.textContent = 'Sauvegarder la Configuration';
                    saveBtn.classList.remove('pulse-success');
                    saveBtn.disabled = false;
                }, 2000);

            } catch (error) {
                saveIcon.classList.remove('spinner');
                saveBtnText.textContent = 'Erreur - R√©essayer';
                showToast('Erreur: ' + error.message, 'error');

                setTimeout(() => {
                    saveIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>';
                    saveBtnText.textContent = 'Sauvegarder la Configuration';
                    saveBtn.disabled = false;
                }, 2000);
            }
        }

        function updateSaveStatus(saved) {
            const indicator = document.getElementById('saveStatus');
            const text = document.getElementById('saveStatusText');

            if (saved) {
                indicator.className = 'status-indicator status-saved';
                text.textContent = 'Sauvegard√©';
            } else {
                indicator.className = 'status-indicator status-unsaved';
                text.textContent = 'Modifications non sauvegard√©es';
            }
        }

        // ============================================================================
        // GET/SET FORM DATA
        // ============================================================================
        function getFormData() {
            return {
                branding: {
                    avatar: {
                        url: document.getElementById('avatarUrl').value,
                        alt: 'Emma IA',
                        size: 64
                    },
                    logo: {
                        url: document.getElementById('logoUrl').value,
                        alt: document.getElementById('companyName').value,
                        width: 150
                    },
                    companyName: document.getElementById('companyName').value,
                    tagline: document.getElementById('tagline').value
                },
                colors: {
                    primary: document.getElementById('colorPrimary').value,
                    primaryDark: document.getElementById('colorPrimaryDark').value,
                    primaryLight: document.getElementById('colorPrimaryLight').value,
                    textDark: document.getElementById('colorText').value,
                    textMuted: '#6b7280'
                },
                header: {
                    showAvatar: document.getElementById('showAvatar').checked,
                    showDate: document.getElementById('showDate').checked,
                    showEdition: document.getElementById('showEdition').checked,
                    fontSize: parseInt(document.getElementById('headerFontSize').value),
                    padding: parseInt(document.getElementById('headerPadding').value),
                    borderRadius: parseInt(document.getElementById('headerBorderRadius').value),
                    textAlign: document.getElementById('headerTextAlign').value
                },
                footer: {
                    showLogo: document.getElementById('showLogo').checked,
                    showDisclaimer: document.getElementById('showDisclaimer').checked,
                    disclaimerText: document.getElementById('disclaimerText').value,
                    copyrightText: document.getElementById('copyrightText').value,
                    socialLinks: {
                        enabled: document.getElementById('showSocialLinks').checked,
                        linkedin: document.getElementById('socialLinkedIn').value,
                        twitter: document.getElementById('socialTwitter').value,
                        facebook: document.getElementById('socialFacebook').value,
                        website: document.getElementById('socialWebsite').value
                    }
                }
            };
        }

        function applyState(state) {
            if (state.branding) {
                document.getElementById('avatarUrl').value = state.branding.avatar?.url || '';
                document.getElementById('logoUrl').value = state.branding.logo?.url || '';
                document.getElementById('companyName').value = state.branding.companyName || '';
                document.getElementById('tagline').value = state.branding.tagline || '';
            }

            if (state.colors) {
                document.getElementById('colorPrimary').value = state.colors.primary;
                document.getElementById('colorPrimaryHex').value = state.colors.primary;
                document.getElementById('colorPrimaryDark').value = state.colors.primaryDark;
                document.getElementById('colorPrimaryDarkHex').value = state.colors.primaryDark;
                document.getElementById('colorPrimaryLight').value = state.colors.primaryLight;
                document.getElementById('colorPrimaryLightHex').value = state.colors.primaryLight;
                document.getElementById('colorText').value = state.colors.textDark;
                document.getElementById('colorTextHex').value = state.colors.textDark;
            }

            // Apply header/footer settings...
            updatePreview();
        }

        // ============================================================================
        // PREVIEW UPDATE
        // ============================================================================
        function updatePreview() {
            // TODO: Implement live preview
            console.log('Preview updated');
        }

        // ============================================================================
        // RESET TO DEFAULTS
        // ============================================================================
        function resetDesignToDefaults() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser toute la configuration?')) {
                // Reset to defaults...
                showToast('Configuration r√©initialis√©e', 'info');
                saveToHistory();
            }
        }

        // ============================================================================
        // EXPORT HTML
        // ============================================================================
        function exportHtml() {
            showToast('G√©n√©ration du HTML...', 'info');
            // TODO: Generate and download HTML
        }

        // ============================================================================
        // SEND TEST EMAIL
        // ============================================================================
        function sendTestEmail() {
            const email = prompt('Entrez votre adresse email pour recevoir un test:');
            if (email) {
                showToast(`Email de test envoy√© √† ${email}`, 'success');
                // TODO: Send test email
            }
        }

        // ============================================================================
        // EVENT LISTENERS
        // ============================================================================
        document.addEventListener('DOMContentLoaded', () => {
            setupColorPickers();
            setupRangeSliders();

            // Save button
            document.getElementById('saveDesignBtn').addEventListener('click', saveConfiguration);

            // Reset button
            document.getElementById('resetDesignBtn').addEventListener('click', resetDesignToDefaults);

            // Export button
            document.getElementById('exportHtmlBtn').addEventListener('click', exportHtml);

            // Test email button
            document.getElementById('testEmailBtn').addEventListener('click', sendTestEmail);

            // Undo/Redo buttons
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('redoBtn').addEventListener('click', redo);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                } else if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
                    e.preventDefault();
                    redo();
                } else if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveConfiguration();
                }
            });

            // Track changes
            document.querySelectorAll('input, textarea, select').forEach(el => {
                el.addEventListener('change', () => {
                    updateSaveStatus(false);
                });
            });

            // Initial history state
            saveToHistory();
            updateSaveStatus(true);
        });
    </script>
</body>
</html>
