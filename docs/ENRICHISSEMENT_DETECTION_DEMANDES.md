# Enrichissement des Cas de D√©tection - Emma IA

## üìã R√©sum√©

Am√©lioration majeure du syst√®me de d√©tection d'Emma pour couvrir un √©ventail beaucoup plus large de domaines financiers et de types de demandes. Cette mise √† jour permet √† Emma de mieux identifier les questions qui n√©cessitent uniquement Perplexity (connaissances g√©n√©rales) versus celles n√©cessitant des APIs compl√©mentaires (donn√©es temps r√©el).

## üéØ Objectif

√âlargir la couverture de d√©tection pour inclure :
- Plus de domaines financiers sp√©cialis√©s
- Plus de types de questions (calculs, simulations, m√©thodologies)
- Plus de produits financiers (warrants, convertibles, produits structur√©s)
- Plus de contextes (r√©glementation, ESG, gestion de risque avanc√©e)
- Plus de strat√©gies (arbitrage, pairs trading, quantitative)

## ‚úÖ Domaines Ajout√©s

### 1. **Forex/Devises** (Nouveau)
- Taux de change, paires de devises
- Carry trade, couverture de change
- Risque de change, exposition aux devises
- Volatilit√© et corr√©lation des devises

**Keywords**: `forex`, `fx`, `devise`, `taux de change`, `currency pair`, `usd`, `eur`, `gbp`, `carry trade`, `currency hedging`, etc.

### 2. **Obligations/Bonds** (Enrichi)
- Obligations corporatives, gouvernementales, municipales
- High yield, investment grade
- Duration, convexity, credit spread
- Yield to maturity, courbe des taux
- Fixed income, revenu fixe

**Keywords**: `bonds`, `obligations`, `corporate bonds`, `treasury bonds`, `yield`, `duration`, `convexity`, `ytm`, `fixed income`, etc.

### 3. **Immobilier/Real Estate** (Nouveau)
- REITs, fiducies immobili√®res
- Immobilier commercial et r√©sidentiel
- Cap rate, NOI (Net Operating Income)
- Valorisation immobili√®re, cycle immobilier

**Keywords**: `immobilier`, `real estate`, `reit`, `reits`, `cap rate`, `noi`, `real estate investment`, etc.

### 4. **Private Equity/Venture Capital** (Nouveau)
- Capital-investissement, venture capital
- Startups, unicornes, s√©ries de financement
- LBO, MBO, leveraged buyout
- Valorisation de startups, exits

**Keywords**: `private equity`, `venture capital`, `vc`, `startup`, `unicorn`, `series a`, `lbo`, `leveraged buyout`, etc.

### 5. **Warrants/Convertibles** (Nouveau)
- Warrants d'achat/vente, certificats
- Obligations convertibles
- Ratio de conversion, prime de conversion
- Effet de levier des warrants

**Keywords**: `warrant`, `warrants`, `certificat`, `convertible`, `convertible bond`, `conversion ratio`, `conversion premium`, etc.

### 6. **Calculs/Simulations** (Nouveau)
- DCF, VAN, TRI, WACC
- Valeur terminale, perp√©tuit√©
- Analyse de sensibilit√©, sc√©narios
- Monte Carlo, backtesting
- Stress testing

**Keywords**: `calculer`, `dcf`, `discounted cash flow`, `van`, `npv`, `irr`, `wacc`, `monte carlo`, `backtesting`, `stress test`, etc.

### 7. **R√©glementation/Compliance** (Nouveau)
- SEC, AMF, r√©gulateurs
- Insider trading, manipulation de march√©
- Disclosure, divulgation
- GAAP, IFRS, normes comptables
- Audit, v√©rification

**Keywords**: `r√©glementation`, `compliance`, `sec`, `amf`, `insider trading`, `market manipulation`, `gaap`, `ifrs`, etc.

### 8. **ESG/Durabilit√©** (Nouveau)
- Environmental, Social, Governance
- Responsabilit√© sociale d'entreprise (RSE)
- Obligations vertes, investissement durable
- Risque climatique, transition √©nerg√©tique
- ESG rating, notation ESG

**Keywords**: `esg`, `sustainability`, `csr`, `rse`, `green bonds`, `sustainable investing`, `climate risk`, `esg rating`, etc.

### 9. **Arbitrage/Strat√©gies Avanc√©es** (Nouveau)
- Arbitrage statistique, pairs trading
- Market neutral, long/short
- Relative value, spread trading
- Mean reversion, momentum
- Trading quantitatif, algorithmique
- High frequency trading (HFT)

**Keywords**: `arbitrage`, `pairs trading`, `statistical arbitrage`, `market neutral`, `quantitative strategy`, `algorithmic trading`, `hft`, etc.

### 10. **M√©thodologies d'Analyse** (Nouveau)
- DCF, multiples de valorisation
- Entreprises comparables, peer group
- Transactions pr√©c√©dentes
- Sum of parts, SOTP
- Mod√®les LBO, acquisition
- Financial modeling, pro forma
- Tableaux de sensibilit√©

**Keywords**: `m√©thodologie`, `dcf`, `multiples`, `comparable companies`, `comps`, `financial modeling`, `pro forma`, `sensitivity table`, etc.

### 11. **M&A/Fusions-Acquisitions** (Nouveau)
- Fusions, acquisitions, takeovers
- OPA, OPE, offre publique
- Merger arbitrage
- Due diligence, synergies
- Prime d'acquisition, multiples de transaction

**Keywords**: `fusion`, `acquisition`, `m&a`, `merger`, `takeover`, `opa`, `due diligence`, `synergy`, `acquisition premium`, etc.

### 12. **IPO/Introduction en Bourse** (Nouveau)
- Introduction en bourse, going public
- IPO pricing, valorisation IPO
- Underpricing, performance IPO
- Lock-up period, roadshow
- Book building, allocation IPO

**Keywords**: `ipo`, `introduction en bourse`, `going public`, `ipo pricing`, `ipo valuation`, `lock up period`, `roadshow`, etc.

### 13. **Gestion de Risque Avanc√©e** (Nouveau)
- VaR, CVaR, Value at Risk
- Stress testing, analyse de sc√©narios
- M√©triques de risque (Sharpe, Sortino, Calmar)
- Max drawdown, tracking error
- Risque syst√©matique, idiosyncratique
- Tail risk, black swan

**Keywords**: `risk management`, `var`, `value at risk`, `cvar`, `stress testing`, `sharpe ratio`, `max drawdown`, `tail risk`, etc.

### 14. **Behavioral Finance** (Nouveau)
- Finance comportementale
- Psychologie des march√©s
- Biais cognitifs (confirmation, ancrage)
- FOMO, sentiment de march√©
- Comportement gr√©gaire, surconfiance

**Keywords**: `behavioral finance`, `finance comportementale`, `psychologie des march√©s`, `cognitive bias`, `fomo`, `market sentiment`, etc.

### 15. **Produits Structur√©s** (Nouveau)
- Structured products, notes structur√©es
- Capital prot√©g√©, principal protected
- Autocallable, barrier options
- Knock in, knock out
- Produits li√©s au march√© (equity, commodity, currency)

**Keywords**: `structured products`, `produits structur√©s`, `structured note`, `capital prot√©g√©`, `autocallable`, `barrier option`, etc.

### 16. **Commodities** (Enrichi)
- Ajout de plus de mati√®res premi√®res sp√©cifiques
- Indices de commodities (GCI)
- Contango, backwardation

**Keywords**: `crude oil`, `wti`, `brent`, `gold`, `silver`, `platinum`, `commodity index`, etc.

## üìä Impact sur le Syst√®me

### Fichiers Modifi√©s

1. **`/api/emma-agent.js`**
   - M√©thode `_shouldUsePerplexityOnly()` enrichie avec 16 nouveaux domaines
   - Plus de 500 nouveaux keywords ajout√©s
   - Logique de routage am√©lior√©e pour chaque domaine

2. **`/lib/utils/ticker-extractor.js`**
   - M√©thode `isNonTickerQuestion()` enrichie
   - Ajout des m√™mes domaines pour √©viter les faux positifs de tickers
   - Protection contre l'extraction erron√©e de tickers dans ces contextes

3. **`/lib/intent-analyzer.js`**
   - 16 nouveaux intents ajout√©s
   - Mapping keywords ‚Üí intent pour meilleure classification
   - Confidences ajust√©es selon la sp√©cificit√© de chaque domaine

## üîÑ Logique de Routage

### Perplexity Seul (Connaissances G√©n√©rales)
Ces domaines utilisent **uniquement Perplexity** car :
- Questions conceptuelles ou explicatives
- Donn√©es historiques ou g√©n√©rales disponibles via Perplexity
- Pas besoin de donn√©es temps r√©el pr√©cises
- Analyses qualitatives plut√¥t que quantitatives

**Exemples** :
- "Comment fonctionne un warrant ?"
- "Qu'est-ce que l'arbitrage statistique ?"
- "Explique-moi la m√©thodologie DCF"
- "Quels sont les principes ESG ?"

### APIs N√©cessaires (Donn√©es Temps R√©el)
Ces cas n√©cessitent des **APIs compl√©mentaires** :
- Prix en temps r√©el pr√©cis
- Ratios financiers exacts
- Indicateurs techniques sp√©cifiques
- Donn√©es utilisateur (watchlist, historique)
- Courbes de taux structur√©es

**Exemples** :
- "Prix actuel de AAPL"
- "P/E ratio de MSFT vs GOOGL"
- "RSI de TSLA sur 14 jours"
- "Ma watchlist aujourd'hui"

## üéØ B√©n√©fices

1. **Pr√©cision Am√©lior√©e**
   - Moins de faux positifs de tickers
   - Meilleure identification du type de question
   - Routage optimal vers la bonne source de donn√©es

2. **Couverture √âlargie**
   - 16 nouveaux domaines financiers couverts
   - Plus de 500 nouveaux keywords
   - Support pour questions avanc√©es et sp√©cialis√©es

3. **Performance Optimis√©e**
   - √âvite les appels API inutiles pour questions conceptuelles
   - Utilise Perplexity efficacement pour connaissances g√©n√©rales
   - R√©serve les APIs pour donn√©es temps r√©el pr√©cises

4. **Exp√©rience Utilisateur**
   - R√©ponses plus pertinentes et compl√®tes
   - Moins d'erreurs d'interpr√©tation
   - Support pour un √©ventail beaucoup plus large de questions

## üìù Exemples de Questions Maintenant Support√©es

### Forex
- "Quel est le taux de change USD/CAD actuel ?"
- "Explique-moi le carry trade"
- "Quels sont les risques de change pour les entreprises exportatrices ?"

### Obligations
- "Quelle est la diff√©rence entre high yield et investment grade ?"
- "Comment calculer le yield to maturity ?"
- "Qu'est-ce que la duration d'une obligation ?"

### Private Equity
- "Comment fonctionne un LBO ?"
- "Qu'est-ce qu'une s√©rie A de financement ?"
- "Explique-moi la valorisation d'une startup"

### Calculs Financiers
- "Comment calculer la VAN d'un projet ?"
- "Explique-moi la m√©thodologie DCF"
- "Qu'est-ce que le WACC et comment le calculer ?"

### ESG
- "Qu'est-ce que l'investissement ESG ?"
- "Comment √©valuer le risque climatique d'une entreprise ?"
- "Explique-moi les obligations vertes"

### Arbitrage
- "Qu'est-ce que l'arbitrage statistique ?"
- "Comment fonctionne le pairs trading ?"
- "Explique-moi les strat√©gies market neutral"

## üîÆ Prochaines √âtapes Possibles

1. **Tests de Validation**
   - Tester chaque nouveau domaine avec des questions r√©elles
   - V√©rifier la pr√©cision de la d√©tection
   - Valider le routage Perplexity vs APIs

2. **Affinements**
   - Ajuster les keywords selon les retours utilisateurs
   - Optimiser les confidences des intents
   - Am√©liorer les exceptions (ex: courbe des taux)

3. **Documentation Utilisateur**
   - Cr√©er un guide des types de questions support√©es
   - Exemples par domaine
   - Best practices pour poser des questions √† Emma

## ‚úÖ Statut

**Termin√©** - Tous les domaines ont √©t√© ajout√©s et int√©gr√©s dans le syst√®me de d√©tection.

---

*Derni√®re mise √† jour : Novembre 2025*
