# üìß Emma En Direct - Cognitive Briefing System

**Architecture:** Cognitive Scaffolding + Adaptive Email Generation + Preview System

---

## üéØ NOUVEAU FLOW (5 √âTAPES)

### **AVANT (Actuel):**
```
1. Perplexity: Donn√©es march√©
2. Perplexity: Actualit√©s
3. Perplexity: Analyse
4. G√©n√©ration HTML
5. Preview statique
```

### **APR√àS (Avec Cognitive Scaffolding):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âTAPE 0: COGNITIVE SCAFFOLDING                     ‚îÇ ‚Üê NOUVEAU
‚îÇ - Emma Agent analyse l'actualit√© du jour           ‚îÇ
‚îÇ - Intent: Trending topics, important news          ‚îÇ
‚îÇ - D√©tecte: earnings, fed meeting, market crash etc ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âTAPE 1: SMART DATA GATHERING                      ‚îÇ ‚Üê NOUVEAU
‚îÇ - Emma Agent s√©lectionne outils pertinents         ‚îÇ
‚îÇ - R√©cup√®re: market data, news, economic calendar   ‚îÇ
‚îÇ - Filtre par pertinence                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âTAPE 2: CONTENT SELECTION                         ‚îÇ ‚Üê NOUVEAU
‚îÇ - Emma d√©cide: What's important today?             ‚îÇ
‚îÇ - Priorit√©: Breaking news > Earnings > Normal      ‚îÇ
‚îÇ - Adapte prompt selon intent                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âTAPE 3: ADAPTIVE EMAIL GENERATION                 ‚îÇ ‚Üê AM√âLIOR√â
‚îÇ - Perplexity avec prompt ajust√© dynamiquement      ‚îÇ
‚îÇ - Inclut SEULEMENT donn√©es pertinentes             ‚îÇ
‚îÇ - Style adapt√© √† l'urgence/importance              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √âTAPE 4: INTELLIGENT PREVIEW                       ‚îÇ ‚Üê AM√âLIOR√â
‚îÇ - Affiche email avec metadata                      ‚îÇ
‚îÇ - Montre: intent, confidence, tools used           ‚îÇ
‚îÇ - Boutons: Edit, Send, Cancel                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß† √âTAPE 0: COGNITIVE SCAFFOLDING

### **Objectif:**
Analyser l'environnement macro et d√©tecter les √©v√©nements importants du jour.

### **Intent Analysis Prompt:**
```javascript
const intentAnalysisPrompt = `Tu es Emma, assistante financi√®re experte.
Analyse l'actualit√© et l'environnement de march√© pour ${briefingType}.

DATE: ${new Date().toLocaleDateString('fr-FR')}
HEURE: ${new Date().toLocaleTimeString('fr-FR')}
BRIEFING: ${briefingType} (morning/noon/evening)

ANALYSE L'ACTUALIT√â DU JOUR ET D√âTECTE:

1. **TRENDING TOPICS**: Quels sont les sujets dominants aujourd'hui?
   - Earnings releases (Apple, Tesla, etc.)
   - Fed/ECB meetings
   - Economic data (CPI, jobs report, etc.)
   - Geopolitical events
   - Market crashes/rallies

2. **IMPORTANCE LEVEL**:
   - BREAKING (10/10): √âv√©nement majeur (market crash, Fed decision)
   - HIGH (7-9/10): Earnings important, economic data critique
   - MEDIUM (4-6/10): Normal market day
   - LOW (1-3/10): Quiet market

3. **RECOMMENDED TOOLS**:
   Sugg√®re quels outils Emma Agent doit utiliser:
   - polygon-stock-price: Si focus sur indices/actions
   - economic-calendar: Si √©v√©nement macro important
   - earnings-calendar: Si earnings releases
   - finnhub-news: Si breaking news
   - analyst-recommendations: Si changements ratings importants

4. **EMAIL STYLE**:
   - urgent: Si BREAKING news (style alarmiste)
   - professional: Si HIGH importance (style s√©rieux)
   - casual: Si MEDIUM/LOW (style informatif)

R√âPONDS EN JSON:
{
  "intent": "earnings_day",
  "confidence": 0.95,
  "importance_level": 8,
  "trending_topics": [
    "Apple Q4 earnings beat expectations",
    "Fed hints at rate pause",
    "Tech sector rally"
  ],
  "recommended_tools": [
    "earnings-calendar",
    "polygon-stock-price",
    "finnhub-news",
    "analyst-recommendations"
  ],
  "email_style": "professional",
  "key_tickers": ["AAPL", "TSLA", "MSFT"],
  "prompt_adjustments": {
    "focus_on": "earnings results and guidance",
    "tone": "optimistic but cautious",
    "priority_sections": ["earnings", "market_reaction", "outlook"]
  },
  "summary": "Apple vient de publier des r√©sultats record. Le march√© r√©agit positivement. Fed signale une possible pause dans les hausses de taux."
}`;
```

### **Emma Agent Call:**
```javascript
const intentResponse = await fetch('/api/emma-agent', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        message: intentAnalysisPrompt,
        context: {
            briefing_type: type,
            analysis_type: 'briefing_intent_analysis',
            date: new Date().toISOString()
        }
    })
});

const intentData = await intentResponse.json();
// ‚Üí intentData.response contient le JSON pars√©
```

---

## üìä √âTAPE 1: SMART DATA GATHERING

### **Objectif:**
Utiliser Emma Agent pour r√©cup√©rer SEULEMENT les donn√©es pertinentes selon l'intent.

### **Exemple - Normal Day:**
```javascript
Intent: "market_overview"
Tools: ["polygon-stock-price", "finnhub-news"]
Focus: "Indices principaux + top 5 news"
```

### **Exemple - Earnings Day:**
```javascript
Intent: "earnings_day"
Tools: [
  "earnings-calendar",      // Quels earnings aujourd'hui
  "polygon-stock-price",    // Prix actions qui publient
  "analyst-recommendations", // R√©actions analystes
  "finnhub-news"            // News sur les earnings
]
Focus: "Earnings + Guidance + Market reaction"
```

### **Exemple - Fed Meeting:**
```javascript
Intent: "fed_decision"
Tools: [
  "economic-calendar",      // √âv√©nement Fed
  "polygon-stock-price",    // Indices + VIX
  "finnhub-news"            // R√©action m√©dias
]
Focus: "Fed decision + Indices reaction + Bond yields"
```

### **Emma Agent Call:**
```javascript
const dataResponse = await fetch('/api/emma-agent', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        message: `R√©cup√©rer les donn√©es pour briefing ${type}. Focus: ${intentData.summary}`,
        context: {
            briefing_type: type,
            intent: intentData.intent,
            recommended_tools: intentData.recommended_tools,
            key_tickers: intentData.key_tickers,
            tickers: teamTickers,
            news_requested: true
        }
    })
});

const smartData = await dataResponse.json();
// ‚Üí smartData contient donn√©es filtr√©es et pertinentes
```

---

## üéØ √âTAPE 2: CONTENT SELECTION

### **Objectif:**
D√©cider ce qui doit √™tre dans l'email bas√© sur l'importance.

### **Logique de S√©lection:**
```javascript
function selectEmailContent(intentData, smartData) {
    const sections = [];

    // SECTION 1: TOUJOURS - Market Overview (si disponible)
    if (smartData.market_indices) {
        sections.push({
            title: "üìä Vue d'ensemble du march√©",
            priority: 10,
            content: smartData.market_indices
        });
    }

    // SECTION 2: CONDITIONNELLE - Breaking News
    if (intentData.importance_level >= 8) {
        sections.push({
            title: "üö® BREAKING - √âv√©nement majeur",
            priority: 9,
            content: intentData.trending_topics[0],
            style: "alert"
        });
    }

    // SECTION 3: CONDITIONNELLE - Earnings (si earnings day)
    if (intentData.intent === 'earnings_day' && smartData.earnings) {
        sections.push({
            title: "üìà R√©sultats trimestriels",
            priority: 8,
            content: smartData.earnings
        });
    }

    // SECTION 4: CONDITIONNELLE - Fed/ECB Decision
    if (intentData.intent === 'fed_decision' && smartData.economic_events) {
        sections.push({
            title: "üèõÔ∏è D√©cision de politique mon√©taire",
            priority: 9,
            content: smartData.economic_events
        });
    }

    // SECTION 5: TOUJOURS - Top News
    if (smartData.top_news) {
        sections.push({
            title: "üì∞ Actualit√©s principales",
            priority: 7,
            content: smartData.top_news.slice(0, 5)  // Top 5
        });
    }

    // SECTION 6: CONDITIONNELLE - Watchlist (si tickers watchlist impact√©s)
    if (smartData.watchlist_updates && smartData.watchlist_updates.length > 0) {
        sections.push({
            title: "üëÅÔ∏è Votre Watchlist",
            priority: 6,
            content: smartData.watchlist_updates
        });
    }

    // Trier par priorit√© d√©croissante
    sections.sort((a, b) => b.priority - a.priority);

    return sections;
}
```

---

## ‚úçÔ∏è √âTAPE 3: ADAPTIVE EMAIL GENERATION

### **Objectif:**
G√©n√©rer l'email avec Perplexity en utilisant un prompt **adapt√© dynamiquement**.

### **Prompt Template Adaptatif:**
```javascript
function buildAdaptivePrompt(type, intentData, selectedSections) {
    const basePrompt = getBasePrompt(type);  // Morning/Noon/Evening base

    // Ajustements selon l'intent
    let adaptedPrompt = basePrompt;

    // Si BREAKING news
    if (intentData.importance_level >= 8) {
        adaptedPrompt = `üö® BREAKING - √âv√©nement majeur d√©tect√©

${intentData.trending_topics[0]}

${basePrompt}

‚ö†Ô∏è INSTRUCTIONS SP√âCIALES:
- COMMENCER par l'√©v√©nement majeur
- Style: Urgent mais professionnel
- Inclure implications pour le march√©
- Recommandations tactiques imm√©diates
`;
    }

    // Si Earnings Day
    else if (intentData.intent === 'earnings_day') {
        adaptedPrompt = `üìà EARNINGS DAY - ${intentData.key_tickers.join(', ')}

${basePrompt}

üìä FOCUS PRIORITAIRE:
- R√©sultats vs attentes
- Guidance management
- R√©action march√©
- Implications secteur
`;
    }

    // Si Fed Decision
    else if (intentData.intent === 'fed_decision') {
        adaptedPrompt = `üèõÔ∏è FED DECISION DAY

${basePrompt}

üéØ FOCUS PRIORITAIRE:
- D√©cision taux
- Commentaires Powell
- R√©action obligataire
- Impact devises/actions
`;
    }

    // Ajouter sections s√©lectionn√©es
    adaptedPrompt += `\n\nSECTIONS √Ä INCLURE (PAR ORDRE DE PRIORIT√â):\n`;
    selectedSections.forEach((section, index) => {
        adaptedPrompt += `${index + 1}. ${section.title}\n`;
    });

    // Ajouter donn√©es r√©elles
    adaptedPrompt += `\n\nDONN√âES R√âELLES:\n`;
    selectedSections.forEach(section => {
        adaptedPrompt += `\n${section.title}:\n${JSON.stringify(section.content, null, 2)}\n`;
    });

    return adaptedPrompt;
}
```

### **Perplexity Call avec Prompt Adaptatif:**
```javascript
const analysisResponse = await fetch('/api/ai-services', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        service: 'perplexity',
        prompt: buildAdaptivePrompt(type, intentData, selectedSections),
        section: 'analysis',
        model: 'sonar-reasoning-pro',  // Mod√®le le plus puissant pour analyse
        max_tokens: 3000,
        temperature: 0.2  // Tr√®s factuel
    })
});
```

---

## üëÅÔ∏è √âTAPE 4: INTELLIGENT PREVIEW

### **Objectif:**
Afficher un preview complet avec metadata et options d'√©dition.

### **Preview Component:**
```javascript
const EmailPreview = ({ briefing, intentData, smartData }) => {
    return (
        <div className="email-preview">
            {/* Header avec metadata */}
            <div className="preview-header">
                <h3>üìß Preview - {briefing.subject}</h3>
                <div className="metadata">
                    <span className="badge intent">
                        Intent: {intentData.intent}
                    </span>
                    <span className="badge confidence">
                        Confiance: {(intentData.confidence * 100).toFixed(0)}%
                    </span>
                    <span className="badge importance">
                        Importance: {intentData.importance_level}/10
                    </span>
                    <span className="badge style">
                        Style: {intentData.email_style}
                    </span>
                </div>
            </div>

            {/* Trending Topics */}
            <div className="trending-topics">
                <h4>üî• Trending Topics</h4>
                <ul>
                    {intentData.trending_topics.map((topic, i) => (
                        <li key={i}>{topic}</li>
                    ))}
                </ul>
            </div>

            {/* Tools Used */}
            <div className="tools-used">
                <h4>üîß Outils Emma Agent utilis√©s</h4>
                <div className="tools-list">
                    {smartData.tools_used?.map((tool, i) => (
                        <span key={i} className="tool-badge">{tool}</span>
                    ))}
                </div>
            </div>

            {/* Email HTML Preview */}
            <div className="email-html-preview">
                <iframe
                    srcDoc={briefing.html}
                    style={{ width: '100%', height: '600px', border: '1px solid #ddd' }}
                    title="Email Preview"
                />
            </div>

            {/* Actions */}
            <div className="preview-actions">
                <button onClick={() => editEmail(briefing)}>
                    ‚úèÔ∏è Modifier
                </button>
                <button onClick={() => regenerateEmail(briefing, intentData)}>
                    üîÑ R√©g√©n√©rer
                </button>
                <button onClick={() => sendEmail(briefing)}>
                    üìß Envoyer maintenant
                </button>
                <button onClick={() => cancelPreview()}>
                    ‚ùå Annuler
                </button>
            </div>
        </div>
    );
};
```

---

## üéØ EXEMPLES CONCRETS

### **Exemple 1: Normal Morning (Importance: 5/10)**

**Intent Analysis:**
```json
{
  "intent": "market_overview",
  "confidence": 0.85,
  "importance_level": 5,
  "trending_topics": [
    "Indices stables apr√®s s√©ance mixte",
    "Dollar l√©g√®rement en hausse",
    "P√©trole √† $85/baril"
  ],
  "recommended_tools": [
    "polygon-stock-price",
    "finnhub-news"
  ],
  "email_style": "casual",
  "key_tickers": [],
  "summary": "Journ√©e calme sans √©v√©nements majeurs"
}
```

**Email Sections:**
1. Vue d'ensemble march√© (indices)
2. Top 5 news
3. Watchlist si updates

**Style:** Informatif et concis

---

### **Exemple 2: Apple Earnings Day (Importance: 9/10)**

**Intent Analysis:**
```json
{
  "intent": "earnings_day",
  "confidence": 0.98,
  "importance_level": 9,
  "trending_topics": [
    "Apple Q4 earnings: EPS $1.52 vs $1.39 attendu",
    "Revenus iPhone en hausse de 12%",
    "Action AAPL +5% en pre-market"
  ],
  "recommended_tools": [
    "earnings-calendar",
    "polygon-stock-price",
    "analyst-recommendations",
    "finnhub-news"
  ],
  "email_style": "professional",
  "key_tickers": ["AAPL"],
  "summary": "Apple surpasse les attentes avec des r√©sultats records"
}
```

**Email Sections:**
1. üö® BREAKING - Apple Earnings Beat
2. Vue d'ensemble march√© (focus tech)
3. R√©sultats d√©taill√©s AAPL
4. R√©actions analystes
5. Top news related
6. Watchlist si AAPL dedans

**Style:** Professionnel, optimiste, d√©taill√©

---

### **Exemple 3: Fed Decision Day (Importance: 10/10)**

**Intent Analysis:**
```json
{
  "intent": "fed_decision",
  "confidence": 1.0,
  "importance_level": 10,
  "trending_topics": [
    "Fed maintains rates at 5.25-5.50%",
    "Powell signals potential pause in hikes",
    "Market rallies on dovish tone"
  ],
  "recommended_tools": [
    "economic-calendar",
    "polygon-stock-price",
    "finnhub-news"
  ],
  "email_style": "urgent",
  "key_tickers": [],
  "summary": "La Fed maintient les taux et signale une pause possible"
}
```

**Email Sections:**
1. üö® BREAKING - Fed Decision
2. D√©tails d√©cision + Commentaires Powell
3. R√©action march√© (indices, VIX, bonds)
4. Implications devises et mati√®res premi√®res
5. Top news related
6. Recommandations tactiques

**Style:** Urgent, factuel, actionnable

---

## üîÑ WORKFLOW COMPLET

```javascript
async function generateCognitiveBriefing(type) {
    console.log('üß† Cognitive Briefing START');

    // √âTAPE 0: Intent Analysis
    const intentData = await analyzeIntent(type);
    console.log('Intent:', intentData);

    // √âTAPE 1: Smart Data Gathering
    const smartData = await gatherSmartData(type, intentData);
    console.log('Data gathered:', smartData);

    // √âTAPE 2: Content Selection
    const selectedSections = selectEmailContent(intentData, smartData);
    console.log('Sections:', selectedSections);

    // √âTAPE 3: Adaptive Email Generation
    const adaptivePrompt = buildAdaptivePrompt(type, intentData, selectedSections);
    const emailContent = await generateEmailWithPerplexity(adaptivePrompt);
    console.log('Email generated');

    // √âTAPE 4: Create Briefing Object
    const briefing = {
        type,
        subject: getSubjectForType(type, intentData),
        html: createBriefingHTML(type, emailContent, selectedSections),
        intentData,
        smartData,
        selectedSections,
        timestamp: new Date().toISOString()
    };

    // √âTAPE 5: Show Preview
    setPreviewBriefing(briefing);
    setShowPreview(true);

    console.log('‚úÖ Cognitive Briefing COMPLETE');
    return briefing;
}
```

---

## üìä COMPARAISON AVANT/APR√àS

| M√©trique | AVANT | APR√àS (Cognitive) |
|----------|-------|-------------------|
| **Intent Analysis** | ‚ùå Non | ‚úÖ Oui (Emma Agent) |
| **Tools Selection** | ‚ùå Fixe | ‚úÖ Adaptatif |
| **Content Filtering** | ‚ùå Tout inclus | ‚úÖ Pertinent uniquement |
| **Prompt Adaptation** | ‚ùå Statique | ‚úÖ Dynamique |
| **Email Style** | ‚ùå Fixe | ‚úÖ Adapt√© √† l'urgence |
| **Preview Metadata** | ‚ùå Basique | ‚úÖ Complet |
| **User Control** | ‚ùå Limit√© | ‚úÖ Total (Edit, Regenerate) |

---

## üöÄ B√âN√âFICES

1. ‚úÖ **Pertinence:** Email adapt√© aux √©v√©nements du jour
2. ‚úÖ **Intelligence:** Emma comprend le contexte macro
3. ‚úÖ **Efficacit√©:** Seulement donn√©es importantes
4. ‚úÖ **Flexibilit√©:** Style adapt√© √† l'urgence
5. ‚úÖ **Contr√¥le:** Preview complet avant envoi
6. ‚úÖ **Transparence:** Metadata (intent, tools, confidence)

---

## üìö R√âF√âRENCES

- **Emma Agent:** `/api/emma-agent.js`
- **AI Services:** `/api/ai-services.js`
- **Dashboard:** `/public/beta-combined-dashboard.html`
- **Tools Config:** `/config/tools_config.json`

---

**Version:** 2.0 - Cognitive Briefing System
**Derni√®re mise √† jour:** 2025-10-16
